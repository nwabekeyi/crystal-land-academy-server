import{r as s,f as $,j as M,a as ys,i as ws}from"./index-BjRj4E9N.js";import{u as Oe}from"./useApi-Dc_17l6o.js";import{d as Is,C as js}from"./confirmationModal-BI-pjpWY.js";import{d as Ts}from"./Edit-B2skTUFP.js";import{d as Fs}from"./Visibility-a52RjxKw.js";import{T as Xe,j as _s,v as Me,a1 as qs,a2 as Os,a3 as xs,y as Ps}from"./TextField-Bo9w-J2w.js";import{I as Be}from"./IconButton-B7MXtFvX.js";import{t as $s}from"./modal-CJ-lRFD-.js";import{A as Us}from"./actionButton-DtGJv9hI.js";import{A as Ze}from"./Alert-CgPIs6Fg.js";import{M as Ke}from"./MenuItem-Bx5V02DH.js";const Rs=(r,l,ae,y,B)=>{const{callApi:_}=Oe(),z=s.useRef(!0),[U,ne]=s.useState(!1),[i,v]=s.useState(!1),[E,fe]=s.useState(!1),[T,ce]=s.useState({section:"",className:"All",boardingStatus:"All",status:"All"}),[u,pe]=s.useState({section:"",className:"All",isSuspended:"All",isWithdrawn:"All"}),[q,de]=s.useState("All"),[x,re]=s.useState("All"),[le,ue]=s.useState([]),[c,J]=s.useState([]),[e,b]=s.useState([]),[R,Y]=s.useState(null),[ie,me]=s.useState(["All","JSS 1","Primary 3","Primary 5","Primary 6"]),ee=["All","JSS 1","Primary 3","Primary 5","Primary 6"],Ne=["All","Primary","Secondary"],oe=["All","Primary","Secondary"],Q=["All","Boarder","Day Student"],Se=["All","Active","Suspended","Withdrawn"],De=["All","Active","Suspended","Withdrawn"];s.useEffect(()=>{console.log("Syncing selectedStudentSection:",T.section||"All"),de(T.section||"All")},[T.section]),s.useEffect(()=>{console.log("Syncing selectedTeacherSection:",u.section||"All"),re(u.section||"All")},[u.section]);const Ee=s.useCallback((m,P)=>{console.log("handleStudentFilterChange:",{key:m,value:P}),ce(N=>{let Z={...N};return m==="status"?Z={...Z,status:P}:Z={...Z,[m]:P==="All"?"":P,...m==="section"&&{className:"All"}},console.log("New student filters:",Z),Z}),m==="section"&&de(P)},[]),Ae=s.useCallback((m,P)=>{console.log("handleTeacherFilterChange:",{key:m,value:P}),pe(N=>{let Z={...N};return m==="status"?Z={...Z,isSuspended:P==="Suspended"?"true":P==="Active"?"false":"",isWithdrawn:P==="Withdrawn"?"true":P==="Active"?"false":""}:Z={...Z,[m]:P==="All"?"":P,...m==="section"&&{className:"All"}},console.log("New teacher filters:",Z),Z}),m==="section"&&re(P)},[]),f=s.useCallback(async()=>{console.log("fetchStudentsData studentFilters:",T),ne(!0);try{const m={page:l+1,limit:B};T.section&&T.section!=="All"&&(m.section=T.section),T.className&&T.className!=="All"&&(m.className=T.className),T.boardingStatus&&T.boardingStatus!=="All"&&(m.boardingStatus=T.boardingStatus),T.status==="Withdrawn"?m.isWithdrawn="true":T.status==="Suspended"?m.isSuspended="true":T.status==="Active"&&(m.isWithdrawn="false",m.isSuspended="false");const P=new URLSearchParams(m).toString();console.log("Calling fetchStudentsData with params:",m);const N=await _(`${$.STUDENTS}?${P}`,"GET");if(console.log("fetchStudentsData response:",N),N&&N.status==="success")ue(N.data||[]),me(["All",...N.classLevels||[]]),Y(null);else throw new Error((N==null?void 0:N.message)||"Failed to fetch students")}catch(m){console.error("Error fetching students:",m),z.current&&(ue([]),Y(m.message||"Failed to fetch students"))}finally{ne(!1)}},[_,l,B,T]),h=s.useCallback(async()=>{console.log("fetchTeachersData teacherFilters:",u),v(!0);try{const m={page:ae+1,limit:B};u.section&&u.section!=="All"&&(m.section=u.section),u.className&&u.className!=="All"&&(m.className=u.className),u.isSuspended&&u.isSuspended!=="All"&&(m.isSuspended=u.isSuspended),u.isWithdrawn&&u.isWithdrawn!=="All"&&(m.isWithdrawn=u.isWithdrawn);const P=new URLSearchParams(m).toString();console.log("Calling fetchTeachersData with params:",m);const N=await _(`${$.TEACHERS}?${P}`,"GET");if(console.log("fetchTeachersData response:",N),N&&N.status==="success")J(N.data.data||[]),Y(null);else throw new Error((N==null?void 0:N.message)||"Failed to fetch teachers")}catch(m){console.error("Error fetching teachers:",m),z.current&&(J([]),Y(m.message||"Failed to fetch teachers"))}finally{v(!1)}},[_,ae,B,u]),p=s.useCallback(async()=>{console.log("fetchAdminsData"),fe(!0);try{const m={page:y+1,limit:B},P=new URLSearchParams(m).toString();console.log("Calling fetchAdminsData with params:",m);const N=await _(`${$.ADMINS}?${P}`,"GET");if(console.log("fetchAdminsData response:",N),N&&N.status==="success")b(N.data||[]),Y(null);else throw new Error((N==null?void 0:N.message)||"Failed to fetch admins")}catch(m){console.error("Error fetching admins:",m),z.current&&(b([]),Y(m.message||"Failed to fetch admins"))}finally{fe(!1)}},[_,y,B]),W=s.useCallback(m=>{console.log("Fetching data for tab:",r),(r===0||m==="student")&&(console.log("Calling fetchStudentsData"),f()),(r===1||m==="teacher")&&(console.log("Calling fetchTeachersData"),h()),(r===2||m==="admin")&&(console.log("Calling fetchAdminsData"),p())},[r,f,h,p]);return s.useEffect(()=>(console.log("useUserDataFetch useEffect triggered with tabIndex:",r,"studentFilters:",T,"teacherFilters:",u),W(),()=>{console.log("Cleaning up useUserDataFetch"),z.current=!1}),[W,T,u]),{fetchData:W,studentsData:{students:le},teachersData:{teachers:c},adminsData:{admins:e},studentsLoading:U,teachersLoading:i,adminsLoading:E,studentsError:R&&r===0?R:null,teachersError:R&&r===1?R:null,adminsError:R&&r===2?R:null,students:le,teachers:c,admins:e,setStudents:ue,setTeachers:J,setAdmins:b,studentFilters:T,teacherFilters:u,handleStudentFilterChange:Ee,handleTeacherFilterChange:Ae,studentSections:Ne,teacherSections:oe,studentClassNames:ie,teacherClassNames:ee,boardingStatuses:Q,studentStatuses:Se,teacherStatuses:De,selectedStudentSection:q,setSelectedStudentSection:de,selectedTeacherSection:x,setSelectedTeacherSection:re,fetchStudentsData:f,fetchTeachersData:h,fetchAdminsData:p}},Ms=(r,l,ae,y,B,_,z)=>{const{callApi:U}=Oe(),[ne,i]=s.useState(!1),[v,E]=s.useState(!1),[fe,T]=s.useState(!1),[ce,u]=s.useState(!1),[pe,q]=s.useState(!1),[de,x]=s.useState(!1),[re,le]=s.useState(null),[ue,c]=s.useState(null),[J,e]=s.useState(null),[b,R]=s.useState(null),[Y,ie]=s.useState(null),[me,ee]=s.useState(null),Ne=s.useCallback((f,h)=>{let p=[];return h==="student"?p=l||[]:h==="teacher"?p=ae||[]:h==="admin"&&(p=y||[]),p.find(W=>W._id===f)||null},[l,ae,y]),oe=s.useCallback(async f=>{i(!0),le(null);try{if(!f||!f._id||!f.role)throw new Error("Invalid user data");const h=f.role==="student"?`${$.DELETE_STUDENT}/${f._id}`:f.role==="teacher"?`${$.DELETE_TEACHER}/${f._id}`:`${$.ADMINS}/${f._id}`,p=await U(h,"DELETE");console.log("Delete response:",p),sessionStorage.setItem("deleteResult",JSON.stringify(p)),f.role==="student"?await B():f.role==="teacher"?await _():f.role==="admin"&&await z()}catch(h){le(h.message||"Failed to delete user")}finally{i(!1)}},[U,B,_,z]),Q=s.useCallback(async f=>{E(!0),c(null);try{if(!f||!f._id||!f.role)throw new Error("Invalid user data");const h=f.role==="student"?`${$.WITHDRAW_STUDENT}/${f._id}`:`${$.WITHDRAW_TEACHER}/${f._id}`,p=await U(h,"PATCH");console.log("Withdraw response:",p),sessionStorage.setItem("withdrawResult",JSON.stringify(p)),r()}catch(h){c(h.message||"Failed to withdraw user")}finally{E(!1)}},[U,r]),Se=s.useCallback(async f=>{T(!0),e(null);try{if(!f||!f._id||!f.role)throw new Error("Invalid user data");const h=f.role==="student"?`${$.SUSPEND_STUDENT}/${f._id}`:`${$.SUSPEND_TEACHER}/${f._id}`,p=await U(h,"PATCH");console.log("Suspend response:",p),sessionStorage.setItem("suspendResult",JSON.stringify(p)),r()}catch(h){e(h.message||"Failed to suspend user")}finally{T(!1)}},[U,r]),De=s.useCallback(async f=>{u(!0),R(null);try{if(!f||!f._id||!f.role)throw new Error("Invalid user data");const h=f.role==="student"?`${$.UNSUSPEND_STUDENT}/${f._id}`:`${$.UNSUSPEND_TEACHER}/${f._id}`,p=await U(h,"PATCH");console.log("Unsuspend response:",p),sessionStorage.setItem("unsuspendResult",JSON.stringify(p)),r()}catch(h){R(h.message||"Failed to unsuspend user")}finally{u(!1)}},[U,r]),Ee=s.useCallback(async(f,h)=>{q(!0),ie(null);try{const p=h==="student"?$.STUDENTS:h==="teacher"?$.TEACHERS:$.ADMINS,W=await U(p,"POST",{...f,role:h});if(console.log("Add user response:",W),W&&W.status==="success"&&W.data)sessionStorage.setItem("addUserResult",JSON.stringify(W)),h==="student"?await B():h==="teacher"?await _():h==="admin"&&await z();else throw new Error((W==null?void 0:W.message)||"Failed to add user")}catch(p){throw ie(p.message||"Failed to add user"),p}finally{q(!1)}},[U,B,_,z]),Ae=s.useCallback(async(f,h,p)=>{x(!0),ee(null);try{const W=p==="student"?`${$.STUDENTS}/${f}`:p==="teacher"?`${$.TEACHERS}/update/${f}`:`${$.ADMINS}/${f}`,m=await U(W,"PATCH",{...h,role:p});console.log("Update user response:",m),sessionStorage.setItem("updateUserResult",JSON.stringify(m)),p==="student"?await B():p==="teacher"?await _():p==="admin"&&await z()}catch(W){ee(W.message||"Failed to update user")}finally{x(!1)}},[U,B,_,z]);return{locateUserByIdAndRole:Ne,handleDelete:oe,handleWithdraw:Q,handleSuspend:Se,handleUnsuspend:De,handleAddUser:Ee,handleUpdateUser:Ae,deleteLoading:ne,withdrawLoading:v,suspendLoading:fe,unsuspendLoading:ce,addUserLoading:pe,updateUserLoading:de,deleteError:re,withdrawError:ue,suspendError:J,unsuspendError:b,addUserError:Y,updateUserError:me}},Bs=(r,l,ae,y,B)=>{const _=[{id:"sn",label:"S/N",width:90},{id:"_id",label:"ID",width:100,renderCell:i=>M.jsx(Xe,{children:String(i._id)})},{id:"name",label:"Name",flex:1},{id:"email",label:"Email",flex:1},{id:"details",label:"Details",flex:1,renderCell:i=>i.role==="student"?`${i.classLevel||"N/A"} (${i.boardingStatus||"N/A"})`:i.role==="teacher"&&i.subject||"N/A"},{id:"createdAt",label:"Registered Date",flex:1},{id:"actions",label:"Actions",width:200,renderCell:i=>M.jsxs("div",{style:{display:"flex"},children:[M.jsx(Be,{onClick:()=>l({_id:i._id,role:i.role}),disabled:B,children:M.jsx(Ts,{})}),M.jsx(Be,{onClick:()=>ae({_id:i._id,role:i.role}),disabled:B,children:M.jsx(Is,{})}),M.jsx(Be,{onClick:()=>y({_id:i._id,role:i.role}),disabled:B,children:M.jsx(Fs,{})})]})}],z=Array.isArray(r.students)?r.students.map(i=>{var v;return{_id:i._id,sn:i.sn,role:"student",name:`${i.firstName||""} ${i.lastName||""}`.trim()||"N/A",email:i.email||"N/A",classLevel:((v=i.currentClassLevel)==null?void 0:v.className)||"N/A",boardingStatus:i.boardingStatus||"N/A",createdAt:i.createdAt?new Date(i.createdAt).toLocaleDateString():"N/A",isWithdrawn:i.isWithdrawn||!1,isSuspended:i.isSuspended||!1,rowStyle:i.isSuspended?{backgroundColor:"#FFCDD2",color:"red"}:{}}}).sort((i,v)=>i.sn-v.sn):[],U=Array.isArray(r.teachers)?r.teachers.map(i=>{var v;return{_id:i._id,sn:i.sn,role:"teacher",name:`${i.firstName||""} ${i.lastName||""}`.trim()||"N/A",email:i.email||"N/A",subject:Array.isArray(i.subject)&&i.subject.length>0?i.subject.map(E=>E.name).join(", "):"N/A",classLevel:((v=i.currentClassLevel)==null?void 0:v.className)||"N/A",createdAt:i.createdAt?new Date(i.createdAt).toLocaleDateString():"N/A",isWithdrawn:i.isWithdrawn||!1,isSuspended:i.isSuspended||!1,rowStyle:i.isSuspended?{backgroundColor:"#FFCDD2",color:"red"}:{}}}).sort((i,v)=>i.sn-v.sn):[],ne=Array.isArray(r.admins)?r.admins.map((i,v)=>({_id:i._id,sn:i.sn||v+1,role:"admin",name:`${i.firstName||""} ${i.lastName||""}`.trim()||"N/A",email:i.email||"N/A",createdAt:i.createdAt?new Date(i.createdAt).toLocaleDateString():"N/A",rowStyle:{}})).sort((i,v)=>i.sn-v.sn):[];return{columns:_,studentData:z,teacherData:U,adminData:ne}},Ws=()=>{const[r,l]=s.useState(0),[ae,y]=s.useState(0),[B,_]=s.useState(0),[z,U]=s.useState(0),[ne,i]=s.useState(20),[v,E]=s.useState(""),[fe,T]=s.useState("sn"),[ce,u]=s.useState("asc"),[pe,q]=s.useState(null),[de,x]=s.useState({}),[re,le]=s.useState(!1),[ue,c]=s.useState(!1),[J,e]=s.useState(!1),[b,R]=s.useState(!1),[Y,ie]=s.useState(!1),[me,ee]=s.useState(!1),[Ne,oe]=s.useState(!1),{fetchData:Q,studentsData:Se,teachersData:De,adminsData:Ee,studentsLoading:Ae,teachersLoading:f,adminsLoading:h,studentsError:p,teachersError:W,adminsError:m,students:P,teachers:N,admins:Z,setStudents:we,setTeachers:Ie,setAdmins:C,studentFilters:g,teacherFilters:n,handleStudentFilterChange:K,handleTeacherFilterChange:I,studentSections:S,teacherSections:A,studentClassNames:O,teacherClassNames:j,boardingStatuses:V,teacherStatuses:G,selectedStudentSection:D,setSelectedStudentSection:k,selectedTeacherSection:w,setSelectedTeacherSection:X,studentStatuses:t,fetchStudentsData:F,fetchTeachersData:se,fetchAdminsData:te}=Rs(r,ae,B,z,ne),{locateUserByIdAndRole:H,handleDelete:ve,handleWithdraw:he,handleSuspend:ye,handleUnsuspend:L,handleAddUser:Ce,handleUpdateUser:be,addUserLoading:o,updateUserLoading:Le,deleteError:je,withdrawError:xe,suspendError:Pe,unsuspendError:$e,addUserError:Ue,updateUserError:Re}=Ms(Q,P,N,Z,F,se,te),[Te,ke]=s.useState(!1),[Fe,He]=s.useState(!1),[_e,Je]=s.useState(!1),[qe,Ve]=s.useState(!1),[Ge,Ye]=s.useState(!1);s.useEffect(()=>{const a=Ae||f||h||Te||Fe||_e||qe||o||Le;Ye(a),console.log("isLoading updated to:",a,"due to:",{studentsLoading:Ae,teachersLoading:f,adminsLoading:h,deleteLoading:Te,withdrawLoading:Fe,suspendLoading:_e,unsuspendLoading:qe,addUserLoading:o,updateUserLoading:Le})},[Ae,f,h,Te,Fe,_e,qe,o,Le]);const ze=s.useCallback(async(a,d)=>{try{switch(await Ce(a,d),d){case"student":we(ge=>[...ge,a]);break;case"teacher":Ie(ge=>[...ge,a]);break;case"admin":C(ge=>[...ge,a]);break;default:break}}catch(ge){console.error("Error adding user:",ge)}finally{ee(!1),E("")}},[Ce,we,Ie,C]);s.useEffect(()=>{var a,d,ge,Qe;!Te&&!je&&((a=sessionStorage.getItem("deleteResult"))!=null&&a.includes("success"))&&(le(!1),q(null),x({}),sessionStorage.removeItem("selectedUser"),sessionStorage.removeItem("deleteResult"),sessionStorage.removeItem("confirmModal")),!Fe&&!xe&&((d=sessionStorage.getItem("withdrawResult"))!=null&&d.includes("success"))&&(c(!1),q(null),x({}),sessionStorage.removeItem("selectedUser"),sessionStorage.removeItem("withdrawResult"),sessionStorage.removeItem("confirmWithdrawModal")),!_e&&!Pe&&((ge=sessionStorage.getItem("suspendResult"))!=null&&ge.includes("success"))&&(e(!1),q(null),x({}),sessionStorage.removeItem("selectedUser"),sessionStorage.removeItem("suspendResult"),sessionStorage.removeItem("confirmSuspendModal")),!qe&&!$e&&((Qe=sessionStorage.getItem("unsuspendResult"))!=null&&Qe.includes("success"))&&(R(!1),q(null),x({}),sessionStorage.removeItem("selectedUser"),sessionStorage.removeItem("unsuspendResult"),sessionStorage.removeItem("confirmUnsuspendModal")),!o&&!Ue&&!me&&(ee(!1),E("")),!Le&&!Re&&!Y&&(ie(!1),q(null),x({}),sessionStorage.removeItem("selectedUser"))},[Te,Fe,_e,qe,o,Le,je,xe,Pe,$e,Ue,Re,me,Y]);const es=s.useCallback(a=>{const d=H(a._id,a.role);d&&(q({_id:a._id,role:a.role}),oe(!0),sessionStorage.setItem("selectedUser",JSON.stringify({...d,role:a.role})))},[H]),{columns:ss,studentData:ts,teacherData:as,adminData:ns}=Bs({students:Se.students,teachers:De.teachers,admins:Ee.admins},a=>{const d=H(a._id,a.role);d&&(x(d),E(a.role),ie(!0),sessionStorage.setItem("selectedUser",JSON.stringify({...d,role:a.role})))},a=>{const d=H(a._id,a.role);d&&(x(d),q({_id:a._id,role:a.role}),le(!0),sessionStorage.setItem("selectedUser",JSON.stringify({...d,role:a.role})))},es,Ge),ls=s.useCallback(a=>{E(a),ee(!0)},[]),is=s.useCallback(a=>{u(fe===a&&ce==="asc"?"desc":"asc"),T(a)},[fe,ce]),rs=s.useCallback((a,d)=>{y(d)},[]),os=s.useCallback((a,d)=>{_(d)},[]),cs=s.useCallback((a,d)=>{U(d)},[]),ds=s.useCallback(a=>{i(parseInt(a.target.value,10)),y(0),_(0),U(0)},[]),us=s.useCallback(a=>{const d=H(a._id,a.role);d&&(x(d),c(!0),q({_id:a._id,role:a.role}),sessionStorage.setItem("selectedUser",JSON.stringify({...d,role:a.role})))},[H]),ms=s.useCallback(()=>{c(!1),sessionStorage.removeItem("withdrawResult"),sessionStorage.removeItem("confirmWithdrawModal"),sessionStorage.removeItem("selectedUser"),q(null),x({})},[]),gs=s.useCallback(a=>{const d=H(a._id,a.role);d&&(x(d),e(!0),q({_id:a._id,role:a.role}),sessionStorage.setItem("selectedUser",JSON.stringify({...d,role:a.role})))},[H]),fs=s.useCallback(()=>{e(!1),sessionStorage.removeItem("suspendResult"),sessionStorage.removeItem("confirmSuspendModal"),sessionStorage.removeItem("selectedUser"),q(null),x({})},[]),hs=s.useCallback(a=>{const d=H(a._id,a.role);d&&(a.role==="student"||a.role==="teacher")&&(x(d),R(!0),q({_id:a._id,role:a.role}),sessionStorage.setItem("selectedUser",JSON.stringify({...d,role:a.role})))},[H]),bs=s.useCallback(()=>{R(!1),sessionStorage.removeItem("unsuspendResult"),sessionStorage.removeItem("confirmUnsuspendModal"),sessionStorage.removeItem("selectedUser"),q(null),x({})},[]),ps=s.useCallback((a,d)=>{l(d),y(0),_(0),U(0),Q()},[Q]),Ss=s.useCallback(a=>{const d=H(a._id,a.role);d&&(x(d),E(a.role),ie(!0),sessionStorage.setItem("selectedUser",JSON.stringify({...d,role:a.role})),Q(a.role))},[H]),As=s.useCallback(a=>{a&&(ke(!0),ve(a).then(()=>{Q(a.role)}).catch(d=>{console.error("Delete error:",d),setDeleteError(d.message||"Failed to delete user")}).finally(()=>{ke(!1)}))},[ve]),vs=s.useCallback(a=>{a&&(He(!0),he(a).then(()=>{Q(a.role)}).catch(d=>{console.error("Withdraw error:",d),setWithdrawError(d.message||"Failed to withdraw user")}).finally(()=>{He(!1)}))},[he]),Ls=s.useCallback(a=>{a&&(Je(!0),ye(a).then(()=>{Q(a.role)}).catch(d=>{console.error("Suspend error:",d),setSuspendError(d.message||"Failed to suspend user")}).finally(()=>{Je(!1)}))},[ye]),Ns=s.useCallback(a=>{a&&(Ve(!0),L(a).then(()=>{Q(a.role)}).catch(d=>{console.error("Unsuspend error:",d),setUnsuspendError(d.message||"Failed to unsuspend user")}).finally(()=>{Ve(!1)}))},[L]),Cs=s.useCallback((a,d)=>{ze(a,d).finally(()=>{Q(d)})},[ze]),Ds=s.useCallback((a,d,ge)=>{be(a,d,ge).finally(()=>{ie(!1),q(null),x({}),sessionStorage.removeItem("selectedUser"),Q(ge)})},[be]),Es=s.useCallback(a=>{console.log("Refreshing data for role:",a),window.location.reload()},[]);return{studentData:ts,teacherData:as,adminData:ns,selectedRole:v,setSelectedRole:E,sortBy:fe,sortDirection:ce,studentPage:ae,teacherPage:B,adminPage:z,rowsPerPage:ne,selectedUser:pe,setSelectedUser:q,editUserDetailsState:de,openDeleteModal:re,setOpenDeleteModal:le,editDialogOpen:Y,setEditDialogOpen:ie,signUpDialogOpen:me,setSignUpDialogOpen:ee,handleRoleSelect:ls,handleSortChange:is,handleStudentPageChange:rs,handleTeacherPageChange:os,handleAdminPageChange:cs,handleRowsPerPageChange:ds,handleEdit:Ss,onDelete:As,onWithdraw:vs,onSuspend:Ls,onUnsuspend:Ns,handleWithdrawOpen:us,handleWithdrawClose:ms,handleSuspendOpen:gs,handleSuspendClose:fs,handleUnsuspendOpen:hs,handleUnsuspendClose:bs,onAddUser:Cs,onUpdateUser:Ds,columns:ss,tabIndex:r,handleTabChange:ps,loading:Ge,studentsError:p,teachersError:W,adminsError:m,deleteError:je,withdrawError:xe,suspendError:Pe,unsuspendError:$e,addUserError:Ue,updateUserError:Re,studentSections:S,teacherSections:A,studentClassNames:O,teacherClassNames:j,boardingStatuses:V,teacherStatuses:G,selectedStudentSection:D,setSelectedStudentSection:k,selectedTeacherSection:w,setSelectedTeacherSection:X,studentFilters:g,teacherFilters:n,handleStudentFilterChange:K,handleTeacherFilterChange:I,students:P,teachers:N,admins:Z,setStudents:we,setTeachers:Ie,setAdmins:C,viewUserDetails:Ne,setViewUserDetails:oe,locateUserByIdAndRole:H,withdrawModalOpen:ue,suspendModalOpen:J,unsuspendModalOpen:b,studentStatuses:t,deleteLoading:Te,withdrawLoading:Fe,suspendLoading:_e,unsuspendLoading:qe,refreshData:Es}},We=r=>/^[0-9a-fA-F]{24}$/.test(r),ks=({role:r,selectedUser:l})=>{var Q,Se,De,Ee,Ae,f,h,p,W,m,P,N,Z,we,Ie;const[ae,y]=s.useState(""),{error:B,callApi:_}=Oe(),[z,U]=s.useState(!1),[ne,i]=s.useState(""),[v,E]=s.useState(!1),{callApi:fe}=Oe(),{refreshData:T}=Ws(),ce=ys(C=>{var g;return(g=C.auth)==null?void 0:g.user}),[u,pe]=s.useState([]),[q,de]=s.useState([]),[x,re]=s.useState([]),[le,ue]=s.useState([]),[c,J]=s.useState([]),[e,b]=s.useState({}),[R,Y]=s.useState(null),ie=s.useRef(null);s.useEffect(()=>{(async()=>{try{const g=await _(`${$.CLASS_LEVEL}/sign-up-data`,"GET");g.status==="success"?(console.log("ClassLevelData fetched:",g.data),pe(g.data)):y(g.message||"Failed to fetch class level data")}catch(g){console.error("Error fetching class level data:",g),y("Failed to load class level data. Please try again.")}})()},[_]),s.useEffect(()=>{if(u.length===0){console.log("ClassLevelData not loaded yet"),de([]);return}const C=u.map(g=>({value:g.section,label:g.section}));de(C),console.log("Updated sections:",C)},[u]),s.useEffect(()=>{if(u.length===0){console.log("ClassLevelData not loaded yet for formData");return}console.log("Initializing formData with classLevelData:",u);const C=me(r,l);b(C)},[r,l,u]),s.useEffect(()=>{var n,K,I,S;if(u.length===0){re([]),console.log("Cleared classLevelOptions: classLevelData empty");return}const C=r==="student"?(n=e.currentClassLevel)==null?void 0:n.section:(I=(K=e.teachingAssignments)==null?void 0:K[0])==null?void 0:I.section;if(!C){re([]),console.log("Cleared classLevelOptions: No section selected");return}const g=((S=u.find(A=>A.section===C))==null?void 0:S.classNames.map(A=>({value:A.classLevel,label:A.name})))||[];re(g),console.log("Updated classLevelOptions for section",C,":",g),b(A=>{var O,j,V,G,D,k;if(r==="student"){const w=((O=A.currentClassLevel)==null?void 0:O.classLevel)||"";if(!g.some(t=>t.value===w)&&g.length>0&&!l)return{...A,currentClassLevel:{...A.currentClassLevel,classLevel:((j=g[0])==null?void 0:j.value)||"",subclass:""}}}else if(r==="teacher"){const w=((G=(V=A.teachingAssignments)==null?void 0:V[0])==null?void 0:G.classLevel)||"";if(!g.some(t=>t.value===w)&&g.length>0&&!l)return{...A,teachingAssignments:[{...(D=A.teachingAssignments)==null?void 0:D[0],classLevel:((k=g[0])==null?void 0:k.value)||"",subclasses:[""],subject:""}]}}return A})},[(Q=e.currentClassLevel)==null?void 0:Q.section,(De=(Se=e.teachingAssignments)==null?void 0:Se[0])==null?void 0:De.section,u,r,l]),s.useEffect(()=>{var K,I,S,A,O,j,V,G;if(u.length===0){ue([]),console.log("Cleared subclassOptions: classLevelData empty");return}const C=r==="student"?(K=e.currentClassLevel)==null?void 0:K.section:(S=(I=e.teachingAssignments)==null?void 0:I[0])==null?void 0:S.section,g=r==="student"?(A=e.currentClassLevel)==null?void 0:A.classLevel:(j=(O=e.teachingAssignments)==null?void 0:O[0])==null?void 0:j.classLevel;if(!C||!g){ue([]),console.log("Cleared subclassOptions: No section or classLevel selected");return}const n=((G=(V=u.find(D=>D.section===C))==null?void 0:V.classNames.find(D=>D.classLevel===g))==null?void 0:G.subclasses.map(D=>({value:D.letter,label:D.letter})))||[];ue(n),console.log("Updated subclassOptions for classLevel",g,":",n),b(D=>{var k,w,X,t,F,se,te;if(r==="student"){const H=((k=D.currentClassLevel)==null?void 0:k.subclass)||"";if(!n.some(he=>he.value===H)&&n.length>0&&!l)return{...D,currentClassLevel:{...D.currentClassLevel,subclass:((w=n[0])==null?void 0:w.value)||""}}}else if(r==="teacher"){const H=((F=(t=(X=D.teachingAssignments)==null?void 0:X[0])==null?void 0:t.subclasses)==null?void 0:F[0])||"";if(!n.some(he=>he.value===H)&&n.length>0&&!l)return{...D,teachingAssignments:[{...(se=D.teachingAssignments)==null?void 0:se[0],subclasses:[((te=n[0])==null?void 0:te.value)||""],subject:""}]}}return D})},[(Ee=e.currentClassLevel)==null?void 0:Ee.classLevel,(f=(Ae=e.teachingAssignments)==null?void 0:Ae[0])==null?void 0:f.classLevel,(h=e.currentClassLevel)==null?void 0:h.section,(W=(p=e.teachingAssignments)==null?void 0:p[0])==null?void 0:W.section,u,r,l]),s.useEffect(async()=>{var A,O,j,V,G,D,k,w,X;if(r!=="teacher"||u.length===0||!((O=(A=e.teachingAssignments)==null?void 0:A[0])!=null&&O.section)||!((V=(j=e.teachingAssignments)==null?void 0:j[0])!=null&&V.classLevel)||!((k=(D=(G=e.teachingAssignments)==null?void 0:G[0])==null?void 0:D.subclasses)!=null&&k[0])){J([]),console.log("Cleared subjectOptions: Not teacher or missing section/classLevel/subclass");return}const C=e.teachingAssignments[0].section,g=e.teachingAssignments[0].classLevel,n=e.teachingAssignments[0].subclasses[0],K=(X=(w=u.find(t=>t.section===C))==null?void 0:w.classNames.find(t=>t.classLevel===g))==null?void 0:X.subclasses.find(t=>t.letter===n),I=(K==null?void 0:K.subjects)||[];console.log(I);const S=await Promise.all(I.map(async t=>{try{const F=`${$.SUBJECT}/${t._id}`,se=await fe(F),te=se.status==="success"&&se.data?se.data:se;return console.log(te),!te||!te.name?(console.warn(`No valid name returned for subject ID ${t._id}, falling back to local name`),{value:t._id.toString(),label:t.name.name||`Subject ${t._id}`}):{value:t._id.toString(),label:te.name.name}}catch(F){return console.error(`Failed to fetch subject ${t._id}:`,F.message),{value:t._id.toString(),label:t.name.name.name||`Subject ${t._id}`}}}));J(S),console.log("Updated subjectOptions for section:",C,"classLevel:",g,"subclass:",n,"subjects:",S),r==="teacher"&&!l&&b(t=>{var te,H,ve,he;const F=((H=(te=t.teachingAssignments)==null?void 0:te[0])==null?void 0:H.subject)||"";return!S.some(ye=>ye.value===F)&&S.length>0?{...t,teachingAssignments:[{...(ve=t.teachingAssignments)==null?void 0:ve[0],subject:((he=S[0])==null?void 0:he.value)||""}]}:t})},[(P=(m=e.teachingAssignments)==null?void 0:m[0])==null?void 0:P.subclasses,(Z=(N=e.teachingAssignments)==null?void 0:N[0])==null?void 0:Z.classLevel,(Ie=(we=e.teachingAssignments)==null?void 0:we[0])==null?void 0:Ie.section,u,r,l]);const me=(C,g)=>{var K,I,S,A,O,j,V,G,D,k,w,X;const n={};if(!ee[C])return console.error("Invalid role:",C),n;if(g&&We(g._id)){console.log("Using selectedUser data:",g);const t=g;return n.firstName=t.firstName||"",n.lastName=t.lastName||"",n.middleName=t.middleName||"",n.email=t.email||"",n.gender=t.gender||"",n.NIN=t.NIN||"",n.tribe=t.tribe||"",n.religion=t.religion||"",n.formalSchool=t.formalSchool||"",n.boardingStatus=t.boardingStatus||"Day Student",n.profilePicture="",n.profilePictureUrl=t.profilePictureUrl||"",C==="student"?(n.currentClassLevel={section:((K=t.currentClassLevel)==null?void 0:K.section)||"",classLevel:((I=t.currentClassLevel)==null?void 0:I.classLevel)||"",subclass:((S=t.currentClassLevel)==null?void 0:S.subclass)||""},n.boardingDetails=t.boardingStatus==="Boarder"?{hall:((A=t.boardingDetails)==null?void 0:A.hall)||"",roomNumber:((O=t.boardingDetails)==null?void 0:O.roomNumber)||"",bedNumber:((j=t.boardingDetails)==null?void 0:j.bedNumber)||"",houseMaster:((V=t.boardingDetails)==null?void 0:V.houseMaster)||""}:void 0,n.guardians=(G=t.guardians)!=null&&G.length?[{name:t.guardians[0].name||"",relationship:t.guardians[0].relationship||"",phone:t.guardians[0].phone||"",email:t.guardians[0].email||"",address:t.guardians[0].address||""}]:[{}]):C==="teacher"&&(n.address=t.address||"",n.qualification=t.qualification||"",n.phoneNumber=t.phoneNumber||"",n.tribe=t.tribe||"",n.religion=t.religion||"",n.bankAccountDetails=t.bankAccountDetails?{accountName:t.bankAccountDetails.accountName||"",accountNumber:t.bankAccountDetails.accountNumber||"",bank:t.bankAccountDetails.bank||""}:{},n.teachingAssignments=(D=t.teachingAssignments)!=null&&D.length?[{section:t.teachingAssignments[0].section||"",classLevel:t.teachingAssignments[0].classLevel||"",subclasses:t.teachingAssignments[0].subclasses||[""],subject:((k=t.teachingAssignments[0].subject)==null?void 0:k._id.toString())||""}]:[{}],n.linkedInProfile=t.linkedInProfile||""),console.log("getInitialFormData result (selectedUser):",n),n}if(ee[C].forEach(t=>{if(t.name.includes("currentClassLevel")||t.name.includes("guardians")||t.name.includes("bankAccountDetails")||t.name.includes("teachingAssignments")){const[F,se,te]=t.name.split(/\.|\[|\]/).filter(Boolean);F==="guardians"||F==="teachingAssignments"?(n[F]=n[F]||[{}],n[F][0][se]=""):(n[F]=n[F]||{},n[F][se]="")}else n[t.name]=(t.type==="select","")}),C==="student"&&u.length>0){const t=u.map(F=>({value:F.section,label:F.section}));n.currentClassLevel={section:((w=t[0])==null?void 0:w.value)||"",classLevel:"",subclass:""},n.boardingStatus="Day Student"}else if(C==="teacher"&&u.length>0){const t=u.map(F=>({value:F.section,label:F.section}));n.teachingAssignments=[{section:((X=t[0])==null?void 0:X.value)||"",classLevel:"",subclasses:[""],subject:""}]}else C==="admin"&&(n.firstName="",n.lastName="",n.email="");return console.log("getInitialFormData result (new user):",n),n},ee={student:[{label:"First Name",name:"firstName",type:"text",required:!l},{label:"Last Name",name:"lastName",type:"text",required:!l},{label:"Middle Name",name:"middleName",type:"text",required:!1},{label:"Email",name:"email",type:"email",required:!l},{label:"Profile Picture",name:"profilePicture",type:"file",required:!l},{label:"Gender",name:"gender",type:"select",required:!l,options:[{value:"Male",label:"Male"},{value:"Female",label:"Female"},{value:"Other",label:"Other"}]},{label:"NIN",name:"NIN",type:"text",required:!1},{label:"Tribe",name:"tribe",type:"text",required:!1},{label:"Religion",name:"religion",type:"text",required:!1},{label:"Formal School",name:"formalSchool",type:"text",required:!1},{label:"Class Section",name:"currentClassLevel.section",type:"select",required:!l,options:q},{label:"Class Level",name:"currentClassLevel.classLevel",type:"select",required:!l,options:x},{label:"Subclass",name:"currentClassLevel.subclass",type:"select",required:!l,options:le},{label:"Boarding Status",name:"boardingStatus",type:"select",required:!l,options:[{value:"Boarder",label:"Boarder"},{value:"Day Student",label:"Day Student"}]},{label:"Boarding Hall",name:"boardingDetails.hall",type:"text",required:!1},{label:"Room Number",name:"boardingDetails.roomNumber",type:"text",required:!1},{label:"Bed Number",name:"boardingDetails.bedNumber",type:"text",required:!1},{label:"House Master",name:"boardingDetails.houseMaster",type:"text",required:!1},{label:"Guardian Name",name:"guardians[0].name",type:"text",required:!l},{label:"Guardian Relationship",name:"guardians[0].relationship",type:"text",required:!l},{label:"Guardian Phone",name:"guardians[0].phone",type:"text",required:!l},{label:"Guardian Email",name:"guardians[0].email",type:"email",required:!1},{label:"Guardian Address",name:"guardians[0].address",type:"text",required:!1}].filter(Boolean),teacher:[{label:"First Name",name:"firstName",type:"text",required:!l},{label:"Last Name",name:"lastName",type:"text",required:!l},{label:"Middle Name",name:"middleName",type:"text",required:!1},{label:"Email",name:"email",type:"email",required:!l},{label:"Profile Picture",name:"profilePicture",type:"file",required:!l},{label:"Gender",name:"gender",type:"select",required:!l,options:[{value:"Male",label:"Male"},{value:"Female",label:"Female"},{value:"Other",label:"Other"}]},{label:"NIN",name:"NIN",type:"text",required:!l},{label:"Address",name:"address",type:"text",required:!l},{label:"Qualification",name:"qualification",type:"select",required:!l,options:[{value:"SSCE",label:"SSCE"},{value:"OND",label:"OND"},{value:"HND",label:"HND"},{value:"BSc",label:"BSc"},{value:"MBA",label:"MBA"},{value:"BTech",label:"BTech"},{value:"MSc",label:"MSc"},{value:"PhD",label:"PhD"},{value:"Other",label:"Other"}]},{label:"Phone Number",name:"phoneNumber",type:"tel",required:!l},{label:"Tribe",name:"tribe",type:"text",required:!l},{label:"Religion",name:"religion",type:"select",required:!l,options:[{value:"Christianity",label:"Christianity"},{value:"Islam",label:"Islam"},{value:"Hinduism",label:"Hinduism"},{value:"Buddhism",label:"Buddhism"},{value:"Atheism",label:"Atheism"},{value:"Other",label:"Other"}]},{label:"Teaching Section",name:"teachingAssignments[0].section",type:"select",required:!l,options:q},{label:"Teaching Class Level",name:"teachingAssignments[0].classLevel",type:"select",required:!l,options:x},{label:"Teaching Subclass",name:"teachingAssignments[0].subclasses[0]",type:"select",required:!l,options:le},{label:"Subclass Subject",name:"teachingAssignments[0].subject",type:"select",required:!1,options:c},{label:"Bank Account Name",name:"bankAccountDetails.accountName",type:"text",required:!l},{label:"Bank Account Number",name:"bankAccountDetails.accountNumber",type:"text",required:!l},{label:"Bank Name",name:"bankAccountDetails.bank",type:"text",required:!l},{label:"LinkedIn Profile",name:"linkedInProfile",type:"text",required:!1}].filter(Boolean),admin:[{label:"First Name",name:"firstName",type:"text",required:!l},{label:"Last Name",name:"lastName",type:"text",required:!l},{label:"Email",name:"email",type:"email",required:!l},{label:"Profile Picture",name:"profilePicture",type:"file",required:!l}].filter(Boolean)};return console.log(c),{formRef:ie,formData:e,error:ae,loading:v,handleChange:C=>{const{name:g,value:n,files:K}=C.target;if(g==="profilePicture")Y(K[0]);else if(g.includes("currentClassLevel")){const[,I]=g.split(".");b(S=>{var O,j,V,G,D;const A={...S.currentClassLevel,[I]:n};if(I==="section"){const k=((O=u.find(w=>w.section===n))==null?void 0:O.classNames.map(w=>({value:w.classLevel,label:w.name})))||[];A.classLevel=((j=k[0])==null?void 0:j.value)||"",A.subclass=""}else if(I==="classLevel"){const k=((G=(V=u.find(w=>w.section===S.currentClassLevel.section))==null?void 0:V.classNames.find(w=>w.classLevel===n))==null?void 0:G.subclasses.map(w=>({value:w.letter,label:w.letter})))||[];A.subclass=((D=k[0])==null?void 0:D.value)||""}return{...S,currentClassLevel:A}})}else if(g.includes("teachingAssignments")){const[,I,S,A]=g.split(/\.|\[|\]/).filter(Boolean);b(O=>{var V,G,D,k,w;const j=[...O.teachingAssignments||[{}]];if(S==="subclasses"&&A==="0")j[0]={...j[0],subclasses:[n],subject:""};else if(S==="subject")j[0]={...j[0],subject:n};else if(S==="section"){const X=((V=u.find(t=>t.section===n))==null?void 0:V.classNames.map(t=>({value:t.classLevel,label:t.name})))||[];j[0]={...j[0],section:n,classLevel:((G=X[0])==null?void 0:G.value)||"",subclasses:[""],subject:""}}else if(S==="classLevel"){const X=((k=(D=u.find(t=>t.section===O.teachingAssignments[0].section))==null?void 0:D.classNames.find(t=>t.classLevel===n))==null?void 0:k.subclasses.map(t=>({value:t.letter,label:t.letter})))||[];j[0]={...j[0],classLevel:n,subclasses:[((w=X[0])==null?void 0:w.value)||""],subject:""}}else j[0]={...j[0],[S]:n};return{...O,teachingAssignments:j}})}else if(g.includes("boardingDetails")){const[,I]=g.split(".");b(S=>({...S,boardingDetails:{...S.boardingDetails,[I]:n}}))}else if(g.includes("guardians")){const[,I,S]=g.split(/\.|\[|\]/).filter(Boolean);b(A=>{const O=[...A.guardians||[{}]];return O[0]={...O[0],[S]:n},{...A,guardians:O}})}else if(g.includes("bankAccountDetails")){const[,I]=g.split(".");b(S=>({...S,bankAccountDetails:{...S.bankAccountDetails,[I]:n}}))}else b(g==="boardingStatus"?I=>({...I,boardingStatus:n,boardingDetails:n==="Boarder"?I.boardingDetails||{}:void 0}):I=>({...I,[g]:n}))},handleSubmit:async C=>{var g,n,K,I,S,A,O,j,V,G,D,k,w,X,t,F,se,te,H,ve,he,ye;if(C.preventDefault(),E(!0),y(""),r==="admin"&&(ce==null?void 0:ce.role)!=="superadmin"){y("Only superadmins can create or update admins."),E(!1);return}if(l&&!We(l._id)){y("Invalid user ID format"),E(!1);return}if(!l){if(!e.firstName||!e.lastName||!e.email||!e.gender){y("First name, last name, email, and gender are required"),E(!1);return}if(r==="student"){if(!((g=e.currentClassLevel)!=null&&g.section)||!((n=e.currentClassLevel)!=null&&n.classLevel)||!((K=e.currentClassLevel)!=null&&K.subclass)){y("Class level section, class level, and subclass are required"),E(!1);return}if(!((S=(I=e.guardians)==null?void 0:I[0])!=null&&S.name)||!((O=(A=e.guardians)==null?void 0:A[0])!=null&&O.relationship)||!((V=(j=e.guardians)==null?void 0:j[0])!=null&&V.phone)){y("Guardian name, relationship, and phone are required"),E(!1);return}if(!["Boarder","Day Student"].includes(e.boardingStatus)){y("Boarding status must be 'Boarder' or 'Day Student'"),E(!1);return}if(e.boardingStatus==="Boarder"&&(!((G=e.boardingDetails)!=null&&G.hall)||!((D=e.boardingDetails)!=null&&D.roomNumber))){y("Boarding Hall and Room Number are required for Boarder students"),E(!1);return}}else if(r==="teacher"){if(!e.NIN||!e.address||!e.qualification||!e.phoneNumber||!e.tribe||!e.religion||!((k=e.bankAccountDetails)!=null&&k.accountName)||!((w=e.bankAccountDetails)!=null&&w.accountNumber)||!((X=e.bankAccountDetails)!=null&&X.bank)||!((F=(t=e.teachingAssignments)==null?void 0:t[0])!=null&&F.section)||!((te=(se=e.teachingAssignments)==null?void 0:se[0])!=null&&te.classLevel)||!((he=(ve=(H=e.teachingAssignments)==null?void 0:H[0])==null?void 0:ve.subclasses)!=null&&he.length)){y("All required teacher fields, including section, class level, and subclass, must be filled"),E(!1);return}if(!/^\d{11}$/.test(e.NIN)){y("NIN must be 11 digits"),E(!1);return}if(!/^\d{10}$/.test(e.bankAccountDetails.accountNumber)){y("Bank account number must be 10 digits"),E(!1);return}if(!e.teachingAssignments[0].subclasses.every(o=>/^[A-Z]$/.test(o))){y("Subclasses must be single uppercase letters"),E(!1);return}const L=u.find(o=>o.section===e.teachingAssignments[0].section),Ce=L==null?void 0:L.classNames.find(o=>o.classLevel===e.teachingAssignments[0].classLevel);if(!Ce){y("Invalid class level selection. Please select a valid class."),E(!1);return}if(!Ce.subclasses.some(o=>o.letter===e.teachingAssignments[0].subclasses[0])){y("Invalid subclass selection. Please select a valid subclass."),E(!1);return}}else if(r==="admin"&&(!e.firstName||!e.lastName||!e.email)){y("First name, last name, and email are required for admins"),E(!1);return}if(!R){y("Profile picture is required"),E(!1);return}}try{const L=new FormData;Object.keys(e).forEach(o=>{var Le,je;o==="currentClassLevel"&&e[o]?(L.append("currentClassLevel[section]",e[o].section||""),L.append("currentClassLevel[classLevel]",e[o].classLevel||""),L.append("currentClassLevel[subclass]",e[o].subclass||"")):o==="boardingDetails"&&e[o]&&e.boardingStatus==="Boarder"?(L.append("boardingDetails[hall]",e[o].hall||""),L.append("boardingDetails[roomNumber]",e[o].roomNumber||""),L.append("boardingDetails[bedNumber]",e[o].bedNumber||""),L.append("boardingDetails[houseMaster]",e[o].houseMaster||"")):o==="guardians"&&((Le=e[o])!=null&&Le.length)?(L.append("guardians[0][name]",e[o][0].name||""),L.append("guardians[0][relationship]",e[o][0].relationship||""),L.append("guardians[0][phone]",e[o][0].phone||""),L.append("guardians[0][email]",e[o][0].email||""),L.append("guardians[0][address]",e[o][0].address||"")):o==="bankAccountDetails"&&e[o]?(L.append("bankAccountDetails[accountName]",e[o].accountName||""),L.append("bankAccountDetails[accountNumber]",e[o].accountNumber||""),L.append("bankAccountDetails[bank]",e[o].bank||"")):o==="teachingAssignments"&&((je=e[o])!=null&&je.length)&&e[o][0].section?(L.append("section",e[o][0].section||""),L.append("classLevel",e[o][0].classLevel||""),L.append("subclassLetter",e[o][0].subclasses[0]||""),e[o][0].subject&&L.append("subject",e[o][0].subject)):o==="isWithdrawn"||o==="isSuspended"?L.append(o,e[o]==="true"):(o==="applicationStatus"&&e[o]||!l||e[o]&&e[o]!==""&&o!=="boardingDetails"&&o!=="profilePictureUrl")&&L.append(o,e[o])}),R&&L.append("profilePicture",R),console.log("Payload being sent:");for(let[o,Le]of L.entries())console.log(`${o}: ${Le}`);let Ce;l&&We(l._id)?Ce=r==="student"?`${$.STUDENTS}/${l._id}`:r==="teacher"?`${$.TEACHERS}/update/${l._id}`:`${$.ADMINS}/${l._id}`:Ce=r==="student"?$.CREATE_STUDENT:r==="teacher"?$.CREATE_TEACHER:$.CREATE_ADMIN;const be=await _(Ce,l?"PATCH":"POST",L,{"Content-Type":"multipart/form-data"});be&&be.status==="success"?(i(`${be.data.firstName} ${be.data.lastName} has been successfully ${l?"updated":"registered"}`),b(me(r,null)),Y(null),T(r)):(console.log("Submit error:",B),i((be==null?void 0:be.message)||"An error occurred")),U(!0)}catch(L){console.error("Error submitting form:",L),y(((ye=L.response)==null?void 0:ye.message)||"Failed to submit the form. Please try again.")}finally{E(!1)}},roleFields:ee,profilePicture:R,modalOpen:z,modalMessage:ne,setModalOpen:U,subjectOptions:c,classLevelOptions:x,subclassOptions:le,sections:q}},st=({role:r,selectedUser:l,studentReg:ae,offline:y})=>{const B=_s();$s(B.palette.mode);const{roleFields:_,error:z,loading:U,handleChange:ne,handleSubmit:i,formData:v,formRef:E,modalOpen:fe,modalMessage:T,setModalOpen:ce,subjectOptions:u,classLevelOptions:pe,subclassOptions:q,sections:de}=ks({role:r,selectedUser:l});console.log("SignUpForm - role:",r,"selectedUser:",l,"studentReg:",ae,"formData:",v,"subjectOptions:",u,"classLevelOptions:",pe,"subclassOptions:",q,"sections:",de);const x=()=>{ce(!1)};if(U||!v||Object.keys(v).length===0)return M.jsx(ws,{});if(!_[r])return M.jsx(Ze,{severity:"error",children:"Invalid role specified"});const re=c=>{if(!v)return"";if(c.includes(".")){const J=c.split(/\.|\[|\]/).filter(Boolean);let e=v;for(const b of J)if(Array.isArray(e)&&b.match(/^\d+$/)?e=e[parseInt(b)]:e=e==null?void 0:e[b],e==null)return"";return e}return v[c]||""},le=(c,J)=>{if(c==="currentClassLevel.section"||c==="teachingAssignments[0].section"){const e=de.find(b=>b.value===J);return e?e.label:""}else if(c==="currentClassLevel.classLevel"||c==="teachingAssignments[0].classLevel"){const e=pe.find(b=>b.value===J);return e?e.label:""}else if(c==="currentClassLevel.subclass"||c==="teachingAssignments[0].subclasses[0]"){const e=q.find(b=>b.value===J);return e?e.label:""}else if(c==="teachingAssignments[0].subject"){const e=u.find(b=>b.value===J);return e?e.label:""}else if(c==="gender"||c==="qualification"||c==="religion"||c==="boardingStatus"){const e=_[r].find(R=>R.name===c),b=e==null?void 0:e.options.find(R=>R.value===J);return b?b.label:""}return J},ue=_[r].filter(c=>r==="student"&&c.name.includes("boardingDetails")?v.boardingStatus==="Boarder":!0);return M.jsxs(Me,{sx:{paddingBottom:ae&&"20px"},children:[M.jsxs(Xe,{variant:"h4",children:[l?"Update":"Sign Up"," (",r.charAt(0).toUpperCase()+r.slice(1),")"]}),M.jsxs("form",{onSubmit:i,ref:E,children:[ue.map(c=>{var J,e,b,R,Y,ie,me,ee,Ne;return M.jsx(Me,{mb:2,children:c.type==="select"?M.jsxs(qs,{fullWidth:!0,children:[M.jsx(Os,{children:c.label}),M.jsxs(xs,{name:c.name,value:le(c.name,re(c.name))||"",onChange:oe=>{const Q=c.options.find(Se=>Se.label===oe.target.value);ne({target:{name:c.name,value:Q?Q.value:oe.target.value}})},required:c.required,disabled:c.name==="currentClassLevel.classLevel"&&!((J=v.currentClassLevel)!=null&&J.section)||c.name==="currentClassLevel.subclass"&&!((e=v.currentClassLevel)!=null&&e.classLevel)||c.name==="teachingAssignments[0].classLevel"&&!((R=(b=v.teachingAssignments)==null?void 0:b[0])!=null&&R.section)||c.name==="teachingAssignments[0].subclasses[0]"&&!((ie=(Y=v.teachingAssignments)==null?void 0:Y[0])!=null&&ie.classLevel)||c.name==="teachingAssignments[0].subject"&&!((Ne=(ee=(me=v.teachingAssignments)==null?void 0:me[0])==null?void 0:ee.subclasses)!=null&&Ne[0]),children:[!c.required&&M.jsx(Ke,{value:"",children:"None"}),c.options.map(oe=>M.jsx(Ke,{value:oe.label,children:oe.label},oe.value))]})]}):c.type==="file"?M.jsx(Me,{children:M.jsx("input",{type:"file",name:c.name,id:c.name,onChange:ne,required:c.required,accept:"image/*",style:{display:"block",width:"100%"}})}):M.jsx(Ps,{label:c.label,name:c.name,type:c.type,value:re(c.name),onChange:ne,required:c.required,fullWidth:!0})},c.name)}),z&&M.jsx(Ze,{severity:"error",children:z}),M.jsx(Us,{content:l?"Update":"Sign Up",submit:!0})]}),M.jsx(js,{open:fe,message:T,title:"User Registration Confirmation",onClose:x})]})};export{st as S,Ws as u};
