import{r as f,e as F,j as e,a as Ue}from"./index-BC37bsQa.js";import{t as We,M as Se,r as Ye}from"./modal-GEZs9M28.js";import{T as Oe}from"./table-B7mrHx2s.js";import{H as Ae}from"./Header-B8AhHNUH.js";import{u as R}from"./useApi-CayfBA9a.js";import{j as Pe,v as S,Z as I,$ as M,a0 as L,x as xe,T as b,y as se,q as Be}from"./TextField-DJHC7RPB.js";import{M as y}from"./MenuItem-Boxsdccj.js";import{C as Ee,A as _e}from"./confirmationModal-jYsKQ6Iz.js";import{w as He}from"./dasboardPagesContainer-BPvvQ7M3.js";import{d as ze}from"./Edit-Bw6_MmcY.js";import{C as Ze}from"./customIconButton-T4eZ1J52.js";import"./IconButton-FKrVB40t.js";import"./useMediaQuery-BLrmJgPF.js";import"./index-C3bpa2xi.js";import"./loadingButton-DWigVCde.js";import"./CircularProgress-D3qA5W-A.js";import"./index-D_NzLyvY.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-Br8NJCec.js";const qe=6048e5,Ne=6e4,De=36e5,Me=Symbol.for("constructDateFrom");function ue(n,t){return typeof n=="function"?n(t):n&&typeof n=="object"&&Me in n?n[Me](t):n instanceof Date?new n.constructor(t):new Date(t)}function me(n,t){return ue(t||n,n)}let we={};function Ie(){return we}function ne(n,t){var o,h,u,g;const l=Ie(),s=(t==null?void 0:t.weekStartsOn)??((h=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:h.weekStartsOn)??l.weekStartsOn??((g=(u=l.locale)==null?void 0:u.options)==null?void 0:g.weekStartsOn)??0,r=me(n,t==null?void 0:t.in),c=r.getDay(),x=(c<s?7:0)+c-s;return r.setDate(r.getDate()-x),r.setHours(0,0,0,0),r}function Je(n,t){var g,O,k,A;const l=me(n,t==null?void 0:t.in),s=l.getFullYear(),r=Ie(),c=(t==null?void 0:t.firstWeekContainsDate)??((O=(g=t==null?void 0:t.locale)==null?void 0:g.options)==null?void 0:O.firstWeekContainsDate)??r.firstWeekContainsDate??((A=(k=r.locale)==null?void 0:k.options)==null?void 0:A.firstWeekContainsDate)??1,x=ue((t==null?void 0:t.in)||n,0);x.setFullYear(s+1,0,c),x.setHours(0,0,0,0);const o=ne(x,t),h=ue((t==null?void 0:t.in)||n,0);h.setFullYear(s,0,c),h.setHours(0,0,0,0);const u=ne(h,t);return+l>=+o?s+1:+l>=+u?s:s-1}function Ve(n,t){var o,h,u,g;const l=Ie(),s=(t==null?void 0:t.firstWeekContainsDate)??((h=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:h.firstWeekContainsDate)??l.firstWeekContainsDate??((g=(u=l.locale)==null?void 0:u.options)==null?void 0:g.firstWeekContainsDate)??1,r=Je(n,t),c=ue((t==null?void 0:t.in)||n,0);return c.setFullYear(r,0,s),c.setHours(0,0,0,0),ne(c,t)}function be(n,t){const l=me(n,t==null?void 0:t.in),s=+ne(l,t)-+Ve(l,t);return Math.round(s/qe)+1}function he(n,t){const l=()=>ue(t==null?void 0:t.in,NaN),r=Xe(n);let c;if(r.date){const u=et(r.date,2);c=tt(u.restDateString,u.year)}if(!c||isNaN(+c))return l();const x=+c;let o=0,h;if(r.time&&(o=at(r.time),isNaN(o)))return l();if(r.timezone){if(h=st(r.timezone),isNaN(h))return l()}else{const u=new Date(x+o),g=me(0,t==null?void 0:t.in);return g.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),g.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),g}return me(x+o+h,t==null?void 0:t.in)}const fe={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Ke=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Ge=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Qe=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Xe(n){const t={},l=n.split(fe.dateTimeDelimiter);let s;if(l.length>2)return t;if(/:/.test(l[0])?s=l[0]:(t.date=l[0],s=l[1],fe.timeZoneDelimiter.test(t.date)&&(t.date=n.split(fe.timeZoneDelimiter)[0],s=n.substr(t.date.length,n.length))),s){const r=fe.timezone.exec(s);r?(t.time=s.replace(r[1],""),t.timezone=r[1]):t.time=s}return t}function et(n,t){const l=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=n.match(l);if(!s)return{year:NaN,restDateString:""};const r=s[1]?parseInt(s[1]):null,c=s[2]?parseInt(s[2]):null;return{year:c===null?r:c*100,restDateString:n.slice((s[1]||s[2]).length)}}function tt(n,t){if(t===null)return new Date(NaN);const l=n.match(Ke);if(!l)return new Date(NaN);const s=!!l[4],r=oe(l[1]),c=oe(l[2])-1,x=oe(l[3]),o=oe(l[4]),h=oe(l[5])-1;if(s)return ct(t,o,h)?nt(t,o,h):new Date(NaN);{const u=new Date(0);return!rt(t,c,x)||!it(t,r)?new Date(NaN):(u.setUTCFullYear(t,c,Math.max(r,x)),u)}}function oe(n){return n?parseInt(n):1}function at(n){const t=n.match(Ge);if(!t)return NaN;const l=ye(t[1]),s=ye(t[2]),r=ye(t[3]);return dt(l,s,r)?l*De+s*Ne+r*1e3:NaN}function ye(n){return n&&parseFloat(n.replace(",","."))||0}function st(n){if(n==="Z")return 0;const t=n.match(Qe);if(!t)return 0;const l=t[1]==="+"?-1:1,s=parseInt(t[2]),r=t[3]&&parseInt(t[3])||0;return ot(s,r)?l*(s*De+r*Ne):NaN}function nt(n,t,l){const s=new Date(0);s.setUTCFullYear(n,0,4);const r=s.getUTCDay()||7,c=(t-1)*7+l+1-r;return s.setUTCDate(s.getUTCDate()+c),s}const lt=[31,null,31,30,31,30,31,31,30,31,30,31];function $e(n){return n%400===0||n%4===0&&n%100!==0}function rt(n,t,l){return t>=0&&t<=11&&l>=1&&l<=(lt[t]||($e(n)?29:28))}function it(n,t){return t>=1&&t<=($e(n)?366:365)}function ct(n,t,l){return t>=1&&t<=53&&l>=0&&l<=6}function dt(n,t,l){return n===24?t===0&&l===0:l>=0&&l<60&&t>=0&&t<60&&n>=0&&n<25}function ot(n,t){return t>=0&&t<=59}const ut=({babtechUser:n})=>{const t=Pe(),l=We(t.palette.mode),{loading:s,error:r,callApi:c,data:x}=R(),[o,h]=f.useState(""),[u,g]=f.useState(1),[O,k]=f.useState([]),[A,a]=f.useState("dayOfWeek"),[U,H]=f.useState("asc"),[G,W]=f.useState(0),[le,N]=f.useState(5),Q=["First Term","Second Term","Third Term"],D=12;f.useEffect(()=>{c(`${F.TIMETABLE}/student`)},[]),f.useEffect(()=>{x!=null&&x.success&&k(x.data.map((m,T)=>({...m,sn:T+1})))},[x]);const Y=m=>{const T=he(m),P=ne(he("2024-09-01"));return be(T,{weekStartsOn:1})-be(P,{weekStartsOn:1})+1},V=O.filter(m=>{var E;if(!o)return!0;const T=(E=m.academicYear)==null?void 0:E.name.includes(o.split(" ")[0]),P=Y(m.date||new Date().toISOString());return T&&P===u}).map(m=>({...m,date:m.date?new Date(m.date).toLocaleDateString():"N/A"})),re=[{id:"sn",label:"S/N",flex:.5},{id:"dayOfWeek",label:"Day",flex:1,renderCell:m=>e.jsx(b,{children:m.dayOfWeek})},{id:"startTime",label:"Start Time",flex:1,renderCell:m=>e.jsx(b,{children:m.startTime})},{id:"endTime",label:"End Time",flex:1,renderCell:m=>e.jsx(b,{children:m.endTime})},{id:"subject",label:"Subject",flex:1,renderCell:m=>{var T;return e.jsx(b,{children:((T=m.subject)==null?void 0:T.name)||"N/A"})}},{id:"teacher",label:"Teacher",flex:1,renderCell:m=>{var T,P;return e.jsxs(b,{children:[(T=m.teacher)==null?void 0:T.firstName," ",(P=m.teacher)==null?void 0:P.lastName]})}},{id:"location",label:"Location",flex:1,renderCell:m=>e.jsx(b,{children:m.location})},{id:"attended",label:"Attended",flex:1,renderCell:m=>{var T,P,E;return e.jsx(b,{children:((E=(P=(T=m.periodAttendance)==null?void 0:T[0])==null?void 0:P.attendance.find(ee=>ee.studentId===n._id))==null?void 0:E.status)||"N/A"})}}],X=m=>{H(A===m&&U==="asc"?"desc":"asc"),a(m)},K=(m,T)=>W(T),ie=m=>{N(parseInt(m.target.value,10)),W(0)},$={columns:re,tableHeader:`Schedule for ${o||"Current Term"}, Week ${u}`,data:V,sortBy:A,sortDirection:U,onSortChange:X,page:G,rowsPerPage:le,onPageChange:K,onRowsPerPageChange:ie};return e.jsxs(S,{py:"20px",children:[e.jsx(Ae,{title:"STUDENT TIMETABLE",subtitle:"Weekly Schedule Overview"}),e.jsxs(S,{mb:"20px",display:"flex",gap:"20px",alignItems:"center",children:[e.jsxs(I,{sx:{minWidth:150},children:[e.jsx(M,{id:"term-select-label",children:"Term"}),e.jsx(L,{labelId:"term-select-label",value:o,label:"Term",onChange:m=>{h(m.target.value),g(1),W(0)},children:Q.map(m=>e.jsx(y,{value:m,children:m},m))})]}),e.jsxs(S,{display:"flex",alignItems:"center",gap:"10px",children:[e.jsx(xe,{variant:"contained",onClick:()=>u>1&&g(u-1),disabled:u===1,sx:{backgroundColor:l.blueAccent[700]},children:"Previous Week"}),e.jsxs(b,{variant:"h6",children:["Week ",u]}),e.jsx(xe,{variant:"contained",onClick:()=>u<D&&g(u+1),disabled:u===D,sx:{backgroundColor:l.blueAccent[700]},children:"Next Week"})]})]}),e.jsx(S,{children:s?e.jsx(b,{children:"Loading..."}):r?e.jsx(b,{color:"error",children:r}):V.length>0?e.jsx(Oe,{...$}):e.jsx(b,{children:"No schedule available for this week."})})]})},Fe=["Monday","Tuesday","Wednesday","Thursday","Friday"],mt=({open:n,onClose:t,onConfirm:l,newSchedule:s,setNewSchedule:r,classLevelData:c,subjectData:x,teacherData:o,isLoading:h})=>{var u,g,O,k,A;return e.jsx(Se,{open:n,onClose:t,title:"Add New Timetable",onConfirm:l,confirmMessage:"Add",styleProps:{padding:"20px"},noConfirm:h,children:e.jsxs(S,{display:"flex",flexDirection:"column",gap:"16px",mt:"10px",children:[e.jsxs(I,{fullWidth:!0,children:[e.jsx(M,{id:"class-level-modal-label",children:"Class Level"}),e.jsx(L,{labelId:"class-level-modal-label",value:s.classLevel,label:"Class Level",onChange:a=>r({...s,classLevel:a.target.value,subclassLetter:""}),children:(u=c==null?void 0:c.data)==null?void 0:u.map(a=>e.jsx(y,{value:a._id,children:a.name},a._id))})]}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(M,{id:"subclass-modal-label",children:"Subclass"}),e.jsx(L,{labelId:"subclass-modal-label",value:s.subclassLetter,label:"Subclass",onChange:a=>r({...s,subclassLetter:a.target.value}),disabled:!s.classLevel,children:(O=(g=c==null?void 0:c.data)==null?void 0:g.find(a=>a._id===s.classLevel))==null?void 0:O.subclasses.map(a=>e.jsx(y,{value:a.letter,children:a.letter},a.letter))})]}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(M,{id:"subject-modal-label",children:"Subject"}),e.jsx(L,{labelId:"subject-modal-label",value:s.subject,label:"Subject",onChange:a=>r({...s,subject:a.target.value}),children:(k=x==null?void 0:x.data)==null?void 0:k.map(a=>e.jsx(y,{value:a._id,children:a.name},a._id))})]}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(M,{id:"teacher-modal-label",children:"Teacher"}),e.jsx(L,{labelId:"teacher-modal-label",value:s.teacher,label:"Teacher",onChange:a=>r({...s,teacher:a.target.value}),children:(A=o==null?void 0:o.data)==null?void 0:A.map(a=>e.jsxs(y,{value:a._id,children:[a.firstName," ",a.lastName]},a._id))})]}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(M,{id:"day-modal-label",children:"Day of Week"}),e.jsx(L,{labelId:"day-modal-label",value:s.dayOfWeek,label:"Day of Week",onChange:a=>r({...s,dayOfWeek:a.target.value}),children:Fe.map(a=>e.jsx(y,{value:a,children:a},a))})]}),e.jsx(se,{label:"Start Time (HH:MM)",value:s.startTime,onChange:a=>r({...s,startTime:a.target.value}),fullWidth:!0}),e.jsx(se,{label:"Number of Periods",type:"number",value:s.numberOfPeriods,onChange:a=>r({...s,numberOfPeriods:a.target.value}),fullWidth:!0,inputProps:{min:1}}),e.jsx(se,{label:"Location",value:s.location,onChange:a=>r({...s,location:a.target.value}),fullWidth:!0})]})})},ft=({open:n,onClose:t,onConfirm:l,newSchedule:s,setNewSchedule:r,classLevelData:c,subjectData:x,teacherData:o,isLoading:h})=>{var u,g,O,k,A;return e.jsx(Se,{open:n,onClose:t,title:"Edit Timetable",onConfirm:l,confirmMessage:"Update",styleProps:{padding:"20px"},noConfirm:h,children:e.jsxs(S,{display:"flex",flexDirection:"column",gap:"16px",mt:"10px",children:[e.jsxs(I,{fullWidth:!0,children:[e.jsx(M,{id:"class-level-modal-label",children:"Class Level"}),e.jsx(L,{labelId:"class-level-modal-label",value:s.classLevel,label:"Class Level",onChange:a=>r({...s,classLevel:a.target.value,subclassLetter:""}),children:(u=c==null?void 0:c.data)==null?void 0:u.map(a=>e.jsx(y,{value:a._id,children:a.name},a._id))})]}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(M,{id:"subclass-modal-label",children:"Subclass"}),e.jsx(L,{labelId:"subclass-modal-label",value:s.subclassLetter,label:"Subclass",onChange:a=>r({...s,subclassLetter:a.target.value}),disabled:!s.classLevel,children:(O=(g=c==null?void 0:c.data)==null?void 0:g.find(a=>a._id===s.classLevel))==null?void 0:O.subclasses.map(a=>e.jsx(y,{value:a.letter,children:a.letter},a.letter))})]}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(M,{id:"subject-modal-label",children:"Subject"}),e.jsx(L,{labelId:"subject-modal-label",value:s.subject,label:"Subject",onChange:a=>r({...s,subject:a.target.value}),children:(k=x==null?void 0:x.data)==null?void 0:k.map(a=>e.jsx(y,{value:a._id,children:a.name},a._id))})]}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(M,{id:"teacher-modal-label",children:"Teacher"}),e.jsx(L,{labelId:"teacher-modal-label",value:s.teacher,label:"Teacher",onChange:a=>r({...s,teacher:a.target.value}),children:(A=o==null?void 0:o.data)==null?void 0:A.map(a=>e.jsxs(y,{value:a._id,children:[a.firstName," ",a.lastName]},a._id))})]}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(M,{id:"day-modal-label",children:"Day of Week"}),e.jsx(L,{labelId:"day-modal-label",value:s.dayOfWeek,label:"Day of Week",onChange:a=>r({...s,dayOfWeek:a.target.value}),children:Fe.map(a=>e.jsx(y,{value:a,children:a},a))})]}),e.jsx(se,{label:"Start Time (HH:MM)",value:s.startTime,onChange:a=>r({...s,startTime:a.target.value}),fullWidth:!0}),e.jsx(se,{label:"Number of Periods",type:"number",value:s.numberOfPeriods,onChange:a=>r({...s,numberOfPeriods:a.target.value}),fullWidth:!0,inputProps:{min:1}}),e.jsx(se,{label:"Location",value:s.location,onChange:a=>r({...s,location:a.target.value}),fullWidth:!0})]})})},xt=({open:n,onClose:t,onConfirm:l,attendanceChanges:s,handleAttendanceChange:r,studentData:c,isLoading:x})=>{var o;return e.jsx(Se,{open:n,onClose:t,title:"Mark Attendance",onConfirm:l,confirmMessage:"Confirm",styleProps:{padding:"20px"},noConfirm:x,children:e.jsx(S,{display:"flex",flexDirection:"column",gap:"16px",mt:"10px",children:(o=c==null?void 0:c.data)==null?void 0:o.map(h=>e.jsxs(S,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(b,{children:[h.firstName," ",h.lastName]}),e.jsx(I,{sx:{minWidth:100},children:e.jsxs(L,{value:s[h._id]||"Absent",onChange:u=>r(h._id,u.target.value),children:[e.jsx(y,{value:"Present",children:"Present"}),e.jsx(y,{value:"Absent",children:"Absent"}),e.jsx(y,{value:"Late",children:"Late"}),e.jsx(y,{value:"Excused",children:"Excused"})]})})]},h._id))})})};var Le={},bt=Be;Object.defineProperty(Le,"__esModule",{value:!0});var Re=Le.default=void 0,ht=bt(Ye()),gt=e;Re=Le.default=(0,ht.default)((0,gt.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle");const jt=({babtechUser:n})=>{const t=Pe(),l=We(t.palette.mode),{loading:s,error:r,callApi:c,data:x}=R(),{callApi:o,data:h}=R(),{loading:u,error:g,callApi:O}=R(),[k,A]=f.useState(""),[a,U]=f.useState(1),[H,G]=f.useState([]),[W,le]=f.useState("dayOfWeek"),[N,Q]=f.useState("asc"),[D,Y]=f.useState(0),[V,re]=f.useState(5),[X,K]=f.useState(!1),[ie,$]=f.useState(!1),[m,T]=f.useState(""),[P,E]=f.useState(null),[ee,z]=f.useState({}),ge=["First Term","Second Term","Third Term"],Z=12;f.useEffect(()=>{c(`${F.TIMETABLE}/teacher`)},[]),f.useEffect(()=>{x!=null&&x.success&&G(x.data.map((d,j)=>({...d,sn:j+1})))},[x]);const je=async(d,j)=>{var v;const p=await o(`${F.CLASS_LEVEL}/${d}/subclasses/${j}/students`);return((v=p==null?void 0:p.data)==null?void 0:v.students)||[]},te=d=>{const j=he(d),p=ne(he("2024-09-01"));return be(j,{weekStartsOn:1})-be(p,{weekStartsOn:1})+1},ce=H.filter(d=>{var v;if(!k)return!0;const j=(v=d.academicYear)==null?void 0:v.name.includes(k.split(" ")[0]),p=te(d.date||new Date().toISOString());return j&&p===a}).map(d=>({...d,date:d.date?new Date(d.date).toLocaleDateString():"N/A"})),de=(d,j)=>{z(p=>({...p,[d]:j}))},q=async()=>{if(!H.find(_=>_._id===P))return;const p={periodIndex:0,attendanceData:Object.entries(ee).map(([_,B])=>({studentId:_,status:B,notes:B==="Absent"||B==="Excused"?"Marked by instructor":""}))},v=await O(`${F.MARK_TIMETABLE}/${P}/attendance`,"PUT",p);v!=null&&v.success?(G(H.map(_=>_._id===P?{..._,periodAttendance:v.data.periodAttendance}:_)),T("Attendance marked successfully"),K(!1),$(!0),E(null),z({})):(T(g||"Failed to mark attendance"),$(!0))},w=async d=>{const j=H.find(p=>p._id===d);if(j){const v=(await je(j.classLevel._id,j.subclassLetter)).reduce((_,B)=>{var i,C;const ae=(C=(i=j.periodAttendance)==null?void 0:i[0])==null?void 0:C.attendance.find(J=>J.studentId===B._id);return{..._,[B._id]:(ae==null?void 0:ae.status)||"Absent"}},{});z(v),E(d),K(!0)}},Ce=[{id:"sn",label:"S/N",flex:.5},{id:"dayOfWeek",label:"Day",flex:1,renderCell:d=>e.jsx(b,{children:d.dayOfWeek})},{id:"startTime",label:"Start Time",flex:1,renderCell:d=>e.jsx(b,{children:d.startTime})},{id:"endTime",label:"End Time",flex:1,renderCell:d=>e.jsx(b,{children:d.endTime})},{id:"numberOfPeriods",label:"Periods",flex:1,renderCell:d=>e.jsx(b,{children:d.numberOfPeriods})},{id:"subject",label:"Subject",flex:1,renderCell:d=>{var j;return e.jsx(b,{children:((j=d.subject)==null?void 0:j.name)||"N/A"})}},{id:"location",label:"Location",flex:1,renderCell:d=>e.jsx(b,{children:d.location})},{id:"attendance",label:"Attendance",flex:2,renderCell:d=>{var j,p;return e.jsxs(S,{children:[(p=(j=d.periodAttendance)==null?void 0:j[0])==null?void 0:p.attendance.map(v=>e.jsxs(b,{mb:"5px",children:["Student ID ",v.studentId,": ",v.status]},v.studentId)),e.jsx(_e,{content:"Mark Attendance",icon:e.jsx(Re,{}),onClick:()=>w(d._id)})]})}}],Te=d=>{Q(W===d&&N==="asc"?"desc":"asc"),le(d)},pe=(d,j)=>Y(j),ve=d=>{re(parseInt(d.target.value,10)),Y(0)},ke={columns:Ce,tableHeader:`Schedule for ${k||"Current Term"}, Week ${a}`,data:ce,sortBy:W,sortDirection:N,onSortChange:Te,page:D,rowsPerPage:V,onPageChange:pe,onRowsPerPageChange:ve};return e.jsxs(S,{py:"20px",children:[e.jsx(Ae,{title:"TEACHER TIMETABLE",subtitle:"Manage Weekly Schedule and Attendance"}),e.jsxs(S,{mb:"20px",display:"flex",gap:"20px",alignItems:"center",children:[e.jsxs(I,{sx:{minWidth:150},children:[e.jsx(M,{id:"term-select-label",children:"Term"}),e.jsx(L,{labelId:"term-select-label",value:k,label:"Term",onChange:d=>{A(d.target.value),U(1),Y(0)},children:ge.map(d=>e.jsx(y,{value:d,children:d},d))})]}),e.jsxs(S,{display:"flex",alignItems:"center",gap:"10px",children:[e.jsx(xe,{variant:"contained",onClick:()=>a>1&&U(a-1),disabled:a===1,sx:{backgroundColor:l.blueAccent[700]},children:"Previous Week"}),e.jsxs(b,{variant:"h6",children:["Week ",a]}),e.jsx(xe,{variant:"contained",onClick:()=>a<Z&&U(a+1),disabled:a===Z,sx:{backgroundColor:l.blueAccent[700]},children:"Next Week"})]})]}),e.jsx(S,{children:s?e.jsx(b,{children:"Loading..."}):r?e.jsx(b,{color:"error",children:r}):ce.length>0?e.jsx(Oe,{...ke}):e.jsx(b,{children:"No schedule available for this week."})}),e.jsx(xt,{open:X,onClose:()=>{K(!1),E(null),z({})},onConfirm:q,attendanceChanges:ee,handleAttendanceChange:de,studentData:h,isLoading:u}),e.jsx(Ee,{open:ie,onClose:()=>$(!1),title:"Attendance Operation",message:m,isLoading:u})]})},Ct=()=>{var v,_,B,ae;const n=Pe(),t=We(n.palette.mode),{loading:l,error:s,callApi:r,data:c}=R(),{callApi:x,data:o}=R(),{callApi:h,data:u}=R(),{callApi:g,data:O}=R(),{loading:k,error:A,callApi:a}=R(),{loading:U,error:H,callApi:G}=R(),[W,le]=f.useState(""),[N,Q]=f.useState(""),[D,Y]=f.useState([]),[V,re]=f.useState("dayOfWeek"),[X,K]=f.useState("asc"),[ie,$]=f.useState(0),[m,T]=f.useState(5),[P,E]=f.useState(!1),[ee,z]=f.useState(!1),[ge,Z]=f.useState(!1),[je,te]=f.useState(""),[ce,de]=f.useState(null),[q,w]=f.useState({classLevel:"",subclassLetter:"",subject:"",teacher:"",dayOfWeek:"",startTime:"",numberOfPeriods:1,location:""});f.useEffect(()=>{x(F.CLASS_LEVEL),h(F.SUBJECT),g(F.TEACHERS)},[]),f.useEffect(()=>{W&&N&&r(`${F.TIMETABLE}?classLevel=${W}&subclassLetter=${N}`)},[W,N]),f.useEffect(()=>{c!=null&&c.success&&Y(c.data.map((i,C)=>({...i,sn:C+1})))},[c]);const Ce=async()=>{const i={...q,numberOfPeriods:parseInt(q.numberOfPeriods,10)},C=await a(F.TIMETABLE,"POST",i);C!=null&&C.success?(Y([...D,{...C.data,sn:D.length+1}]),te("Timetable added successfully"),E(!1),Z(!0),w({classLevel:"",subclassLetter:"",subject:"",teacher:"",dayOfWeek:"",startTime:"",numberOfPeriods:1,location:""})):(te(A||"Failed to add timetable"),Z(!0))},Te=async()=>{const i={...q,numberOfPeriods:parseInt(q.numberOfPeriods,10)},C=await G(`${F.TIMETABLE}/${ce._id}`,"PUT",i);C!=null&&C.success?(Y(D.map(J=>J._id===ce._id?{...C.data,sn:J.sn}:J)),te("Timetable updated successfully"),z(!1),Z(!0),w({classLevel:"",subclassLetter:"",subject:"",teacher:"",dayOfWeek:"",startTime:"",numberOfPeriods:1,location:""}),de(null)):(te(H||"Failed to update timetable"),Z(!0))},pe=i=>{de(i),w({classLevel:i.classLevel._id,subclassLetter:i.subclassLetter,subject:i.subject._id,teacher:i.teacher._id,dayOfWeek:i.dayOfWeek,startTime:i.startTime,numberOfPeriods:i.numberOfPeriods,location:i.location}),z(!0)},ve=[{id:"sn",label:"S/N",flex:.5},{id:"dayOfWeek",label:"Day",flex:1,renderCell:i=>e.jsx(b,{children:i.dayOfWeek})},{id:"startTime",label:"Start Time",flex:1,renderCell:i=>e.jsx(b,{children:i.startTime})},{id:"endTime",label:"End Time",flex:1,renderCell:i=>e.jsx(b,{children:i.endTime})},{id:"numberOfPeriods",label:"Periods",flex:1,renderCell:i=>e.jsx(b,{children:i.numberOfPeriods})},{id:"subject",label:"Subject",flex:1,renderCell:i=>{var C;return e.jsx(b,{children:((C=i.subject)==null?void 0:C.name)||"N/A"})}},{id:"teacher",label:"Teacher",flex:1,renderCell:i=>{var C,J;return e.jsxs(b,{children:[(C=i.teacher)==null?void 0:C.firstName," ",(J=i.teacher)==null?void 0:J.lastName]})}},{id:"location",label:"Location",flex:1,renderCell:i=>e.jsx(b,{children:i.location})},{id:"actions",label:"Actions",flex:1,renderCell:i=>e.jsx(Ze,{onClick:()=>pe(i),icon:e.jsx(ze,{}),title:"Edit Timetable",sx:{color:t.blueAccent[500]}})}],ke=i=>{K(V===i&&X==="asc"?"desc":"asc"),re(i)},d=(i,C)=>$(C),j=i=>{T(parseInt(i.target.value,10)),$(0)},p={columns:ve,tableHeader:`Timetable for ${W?(v=o==null?void 0:o.data.find(i=>i._id===W))==null?void 0:v.name:"N/A"} ${N||""}`,data:D,sortBy:V,sortDirection:X,onSortChange:ke,page:ie,rowsPerPage:m,onPageChange:d,onRowsPerPageChange:j};return e.jsxs(S,{py:"20px",children:[e.jsx(Ae,{title:"ADMIN TIMETABLE",subtitle:"Manage Class and Subclass Timetables"}),e.jsxs(S,{mb:"20px",display:"flex",gap:"20px",alignItems:"center",children:[e.jsxs(I,{sx:{minWidth:150},children:[e.jsx(M,{id:"class-level-select-label",children:"Class Level"}),e.jsx(L,{labelId:"class-level-select-label",value:W,label:"Class Level",onChange:i=>{le(i.target.value),Q(""),$(0)},children:(_=o==null?void 0:o.data)==null?void 0:_.map(i=>e.jsx(y,{value:i._id,children:i.name},i._id))})]}),e.jsxs(I,{sx:{minWidth:150},children:[e.jsx(M,{id:"subclass-select-label",children:"Subclass"}),e.jsx(L,{labelId:"subclass-select-label",value:N,label:"Subclass",onChange:i=>{Q(i.target.value),$(0)},disabled:!W,children:(ae=(B=o==null?void 0:o.data)==null?void 0:B.find(i=>i._id===W))==null?void 0:ae.subclasses.map(i=>e.jsx(y,{value:i.letter,children:i.letter},i.letter))})]}),e.jsx(_e,{content:"Add Timetable",onClick:()=>E(!0),disabled:!W||!N})]}),e.jsx(S,{children:l?e.jsx(b,{children:"Loading..."}):s?e.jsx(b,{color:"error",children:s}):D.length>0?e.jsx(Oe,{...p}):e.jsx(b,{children:"No timetable available for selected filters."})}),e.jsx(mt,{open:P,onClose:()=>{E(!1),w({classLevel:"",subclassLetter:"",subject:"",teacher:"",dayOfWeek:"",startTime:"",numberOfPeriods:1,location:""})},onConfirm:Ce,newSchedule:q,setNewSchedule:w,classLevelData:o,subjectData:u,teacherData:O,isLoading:k}),e.jsx(ft,{open:ee,onClose:()=>{z(!1),de(null)},onConfirm:Te,newSchedule:q,setNewSchedule:w,classLevelData:o,subjectData:u,teacherData:O,isLoading:U}),e.jsx(Ee,{open:ge,onClose:()=>Z(!1),title:"Timetable Operation",message:je,isLoading:k||U})]})},Tt=()=>{const t=Ue(l=>l.users.user).role;return e.jsx("div",{children:t==="student"?e.jsx(ut,{}):t==="teacher"?e.jsx(jt,{}):e.jsx(Ct,{})})},Ut=He(Tt);export{Ut as default};
