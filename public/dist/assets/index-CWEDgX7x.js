import{r as m,f as N,j as e,a as D}from"./index-CUx_BIfb.js";import{t as I,M as L}from"./modal-D-FEyCwe.js";import{H as O}from"./Header-C6ewtNOz.js";import{C as P}from"./accordion-Dz4OcIMH.js";import{w as F}from"./dasboardPagesContainer-MMQB9i4e.js";import{u as _}from"./useApi-B5A5LOF2.js";import{j as R,M as J,v as x,T as u,x as E}from"./TextField-CnJy6qLH.js";import{C as B}from"./CircularProgress-BgN2WNYl.js";import"./IconButton-CSIbz2lV.js";import"./index-Ci-mqblD.js";import"./confirmationModal-C7esu7_Z.js";import"./MenuItem-Y8p8i8nN.js";import"./index-Dn2bJmhV.js";import"./loadingButton-BcWtTSRw.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-BurnVOpP.js";const H=j=>{const{loading:o,error:C,callApi:f}=_(),[p,h]=m.useState([]),[n,S]=m.useState({}),g=m.useRef(!0),{loading:T,error:A,callApi:y}=_(),M=m.useCallback(async(s,l)=>{var c;if(!s)return console.warn("No subjectId provided in getSubjectName"),"Unknown Subject";if(n[s])return console.log(`Returning cached subject name for ID ${s}: ${n[s]}`),n[s];try{console.log(`Fetching subject name from API for ID: ${s}`);const i=await y(`${N.SUBJECT_NAME}/${s}`,"GET");console.log(`Subject name API response for ID ${s}:`,JSON.stringify(i,null,2));const a=((c=i==null?void 0:i.data)==null?void 0:c.name)||"Unknown Subject";return l()&&(console.log(`Caching subject name for ID ${s}: ${a}`),S(b=>({...b,[s]:a}))),a}catch(i){return console.error(`Error fetching subject name for ID ${s}:`,i.message),console.error("Error details:",i),"Unknown Subject"}},[y,n]),v=async s=>{try{const l=`${N.CURRICULUM}/teacher/${s}`;console.log(`Fetching curricula for teacher ID: ${s}`);const c=await f(l,"GET");if(c&&c.status==="success"&&g.current){console.log("Curricula API response:",JSON.stringify(c.data,null,2));const i=await Promise.all(c.data.map(async a=>{var k,r,t;const b=((k=a.subjectId)==null?void 0:k.name)||a.subjectId;console.log(`Processing curriculum ID ${a._id}, using subjectId: ${b}`);const w=await M(b,()=>g.current);return{_id:a._id,subject:w,subjectId:b,classLevel:((r=a.classLevelId)==null?void 0:r.name)||"Unknown Class",classLevelId:(t=a.classLevelId)==null?void 0:t._id,topics:a.topics.map((d,U)=>({_id:d._id||`topic_${U}`,topic:d.topic||"Untitled Topic",description:d.description||"No description available",resources:d.resources||[],isCompleted:d.isCompleted||!1})),completionRate:a.completionRate||0}}));console.log("Transformed curricula:",JSON.stringify(i,null,2)),h(i)}return c}catch(l){throw console.error("Error fetching curricula:",l.message),console.error("Error details:",l),new Error(l.message||"Failed to fetch curricula")}},$=async(s,l)=>{try{return await f(`${N.CURRICULUM}/${s}/topics/${l}/complete`,"PATCH")}catch(c){throw new Error(c.message||"Failed to mark topic as completed")}};return m.useEffect(()=>()=>{g.current=!1},[j]),{loading:o||T,error:C||A,curricula:p,fetchTeacherCurricula:v,markTopicAsCompleted:$,subjectNamesCache:n}},G=({open:j,onClose:o,onConfirm:C,curriculumId:f,topic:p})=>{const h=R(),n=I(h.palette.mode);return e.jsx(J,{open:j,onClose:o,children:e.jsxs(x,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:n.primary[400],p:4,borderRadius:1},children:[e.jsx(u,{variant:"h6",sx:{mb:2,color:n.grey[100]},children:"Mark Topic as Completed"}),e.jsxs(u,{sx:{mb:2,color:n.grey[100]},children:['Are you sure you want to mark the topic "',p==null?void 0:p.topic,'" as completed?']}),e.jsxs(x,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[e.jsx(E,{onClick:o,sx:{mr:1,color:n.grey[100]},children:"Cancel"}),e.jsx(E,{variant:"contained",onClick:()=>C(f,p._id),sx:{bgcolor:n.greenAccent[500]},children:"Confirm"})]})]})})},W=({open:j,onClose:o,message:C,isSuccess:f})=>{const p=R(),h=I(p.palette.mode);return e.jsx(L,{open:j,onClose:o,title:f?"Success":"Error",confirmText:"OK",showCancel:!1,styleProps:{backgroundColor:h.primary[400],borderRadius:"8px",width:"400px",margin:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:e.jsx(u,{sx:{mb:2,color:h.grey[100]},children:C})})},K=()=>{const j=R(),o=I(j.palette.mode),{loading:C,error:f,curricula:p,fetchTeacherCurricula:h,markTopicAsCompleted:n}=H(),{user:S}=D(r=>r.users),g=S==null?void 0:S._id,[T,A]=m.useState(!1),[y,M]=m.useState(null),[v,$]=m.useState(null),[s,l]=m.useState(!1),[c,i]=m.useState(""),[a,b]=m.useState(!0),w=(r,t=!0)=>{i(r),b(t),l(!0)};m.useEffect(()=>{g&&h(g)},[g]);const k=async(r,t)=>{try{const d=await n(r,t);d.status==="success"?(w("Topic marked as completed"),await h(g)):w(d.message||"Failed to mark topic as completed",!1)}catch(d){w(d.message||"Failed to mark topic as completed",!1)}};return e.jsxs(x,{sx:{p:3},children:[e.jsx(O,{title:"Teacher Curriculum Management",subtitle:"View and mark topics as completed for your assigned subjects"}),C?e.jsx(x,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(B,{color:"primary"})}):f?e.jsx(u,{variant:"body1",color:o.redAccent[500],sx:{mt:2},children:f}):p.length>0?p.map(r=>e.jsxs(x,{sx:{mb:4},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(u,{variant:"h2",sx:{color:o.blueAccent[200],fontWeight:"bold"},children:[r.subject," (",r.classLevel,")"]}),e.jsxs(u,{sx:{color:o.grey[100]},children:["Completion Rate: ",r.completionRate.toFixed(2),"%"]})]}),r.topics.length>0?r.topics.map((t,d)=>e.jsx(x,{sx:{mb:1},children:e.jsx(P,{title:`${d+1}. ${t.topic}`,details:e.jsxs(x,{children:[e.jsx(u,{variant:"body1",color:o.grey[100],sx:{mb:1},children:t.description||"No description available"}),e.jsxs(u,{variant:"body1",sx:{color:o.blueAccent[200]},children:["Resources:"," ",Array.isArray(t.resources)?t.resources.join(", "):"No resources available"]}),e.jsxs(u,{variant:"body1",sx:{color:t.isCompleted?o.greenAccent[500]:o.redAccent[500]},children:["Status: ",t.isCompleted?"Completed":"Not Completed"]}),!t.isCompleted&&e.jsx(x,{sx:{mt:2},children:e.jsx(E,{onClick:()=>{M(r),$(t),A(!0)},sx:{color:o.greenAccent[500]},children:"Mark Complete"})})]}),defaultExpanded:!1})},t._id||"")):e.jsxs(u,{variant:"body1",color:o.grey[100],children:["No topics available for ",r.subject,"."]})]},r._id)):e.jsx(u,{variant:"body1",color:o.grey[100],children:"No curricula available for your subjects."}),e.jsx(G,{open:T,onClose:()=>A(!1),onConfirm:k,curriculumId:y==null?void 0:y._id,topic:v}),e.jsx(W,{open:s,onClose:()=>l(!1),message:c,isSuccess:a})]})},ie=F(K);export{ie as default};
