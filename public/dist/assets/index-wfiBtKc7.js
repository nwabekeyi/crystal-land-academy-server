import{r as o,a as _,e as $,j as t,q as X}from"./index-CLJpG2dk.js";import{t as Z,M as O}from"./modal-XFOrivt9.js";import{T as ee}from"./table-DRJIH1ed.js";import{u as g}from"./useApi-D9NfFDCx.js";import{H as te}from"./Header-C2Z8qgVI.js";import{j as se,w as E,T as Q,y as $e,z as B}from"./TextField-DnFjd7Bb.js";import{C as oe,A as H}from"./confirmationModal-DA-HYkBj.js";import{C as W}from"./customIconButton-CjOkIuBG.js";import{d as Re}from"./Edit-D4AylpDL.js";import{A as Be,a as Oe}from"./index-BCSm3FX-.js";import{d as Ne}from"./Visibility-CdDafq2Y.js";import{w as Ue}from"./dasboardPagesContainer-Agv8G4ht.js";import"./IconButton-CYiLhvVe.js";import"./useMediaQuery-BwTWbx11.js";import"./index-5Q6o5QFk.js";import"./loadingButton-BxFe2z54.js";import"./CircularProgress-Dt1gNg0v.js";import"./MenuItem-BK6LVNsx.js";import"./useSlot-D-PIrMBn.js";const He=()=>{const[m,T]=o.useState([]),[r,A]=o.useState("date"),[S,s]=o.useState("asc"),[j,a]=o.useState(0),[u,w]=o.useState(5),p=_(n=>n.users.user),f=p==null?void 0:p.cohort,D=f?`${$.TIMETABLE}/${f}`:null,P=se();Z(P.palette.mode);const{loading:y,data:h,callApi:b}=g();o.useEffect(()=>{D&&b(D,"GET")},[D,b]),o.useEffect(()=>{h&&T(h)},[h]);const i=n=>{var v;return(v=n==null?void 0:n.attendance)==null?void 0:v.includes(p.userId)},c=m.map(n=>({...n,attended:i(n)?"Yes":"No"})),N=[{id:"date",label:"Date"},{id:"location",label:"Location"},{id:"time",label:"Time"},{id:"topic",label:"Topic"},{id:"attended",label:"Attended"}],M=n=>{s(r===n&&S==="asc"?"desc":"asc"),A(n)},x=n=>{a(n)},I=n=>{w(parseInt(n.target.value,10))},k=n=>{console.log(n)};return t.jsxs(E,{py:"20px",children:[t.jsx(te,{title:"TIME TABLE",subtitle:"Overview of Schedule"}),y?t.jsx(X,{}):t.jsx(E,{children:t.jsx(ee,{columns:N,tableHeader:"Schedule",data:c,sortBy:r,sortDirection:S,onSortChange:M,page:j,rowsPerPage:u,onPageChange:x,onRowsPerPageChange:I,onRowClick:k})})]})},We=({openAttendanceModal:m,handleAttendanceModalClose:T,timeTable:r,cohortName:A})=>{const[S,s]=o.useState([]),[j,a]=o.useState(!1),{loading:u,error:w,callApi:p}=g(),{loading:f,callApi:D,data:P}=g();o.useEffect(()=>{(async()=>{const c=await p(`${$.COHORT}/students/${A}`);c&&c.students&&s(c.students),a(!0)})()},[A]);const y=()=>{a(!1)},h=async i=>{const c={studentId:i,cohortName:A,timeTableId:r.id};await D($.MARK_ATTENDANCE,"PATCH",c)},b=i=>{var c;return(c=r==null?void 0:r.attendance)==null?void 0:c.includes(i)};return t.jsxs(O,{open:m,onClose:T,title:"Mark Attendance",noConfirm:!0,confirmMessage:"Attendance",children:[u?t.jsx(X,{}):S.map(i=>t.jsxs(E,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,p:2,borderRadius:"4px",border:"1px solid #ccc",children:[t.jsxs(E,{display:"flex",alignItems:"center",children:[t.jsx(Be,{src:i.profilePicture,alt:i.firstName,sx:{width:48,height:48,mr:2}}),t.jsxs(Q,{variant:"h6",children:[i.firstName," ",i.lastName]})]}),t.jsx($e,{variant:"contained",color:"primary",onClick:()=>h(i.userId),disabled:b(i.userId)||f,children:b(i.userId)?"Attendance Marked":f?"Marking...":"Mark Attendance"})]},i.userId)),t.jsx(oe,{open:j,onClose:y,title:"Confirmation marked attendance",isLoading:f,message:P.message}),w&&t.jsx(Q,{color:"error",children:w})]})},_e=()=>{const m=se();Z(m.palette.mode);const[T,r]=o.useState(!1),[A,S]=o.useState(!1),[s,j]=o.useState(null),[a,u]=o.useState({date:"",course:"",time:"",location:"",topic:""}),[w,p]=o.useState(0),[f,D]=o.useState(10),[P,y]=o.useState("date"),[h,b]=o.useState("asc"),[i,c]=o.useState(null),[N,M]=o.useState([]),[x,I]=o.useState(!1),[k,n]=o.useState(!1),[v,F]=o.useState(!1),[ae,ne]=o.useState(""),[ie,G]=o.useState(!1),[K,le]=o.useState(!1),[Ge,ce]=o.useState(!1),q=_(e=>e.users.user),U=q.cohort,L=`${$.TIMETABLE}/${U}`;console.log(U);const re=()=>{x===!0&&I(!1),k===!0&&n(!1)},de=e=>{F(!0),ne(e)},ue=e=>{F(!1)},{callApi:pe}=g(),{callApi:me}=g(),{loading:fe,error:z,callApi:he}=g(),{loading:xe,error:Ce,callApi:ge}=g(),{data:Te,callApi:Ae}=g();o.useEffect(()=>{(async()=>{if(L){const l=await me(L,"GET");M(l)}})()},[]);const V=(e,l)=>{if(!e||!l)return"Invalid Date";const C=new Date(e).toISOString().split("T")[0],d=new Date(`${C}T${l}`);return isNaN(d)?"Invalid Date":d},Se=[{id:"date",label:"Date",renderCell:e=>V(e.date,e.time).toLocaleDateString()},{id:"time",label:"Time"},{id:"location",label:"Location"},{id:"topic",label:"Topic"},{id:"actions",label:"Actions",renderCell:e=>{const d=V(e.date,e.time)<=new Date,Le=e.done;return le(Le),ce(d),t.jsxs(E,{sx:{px:0},children:[t.jsx(W,{onClick:()=>De(e),icon:t.jsx(Re,{})}),t.jsx(W,{onClick:()=>Ee(e),icon:t.jsx(Ne,{})}),t.jsx(W,{onClick:()=>we(e),icon:t.jsx(Oe,{})})]})}}],Y=()=>r(!0),R=()=>{r(!1),u({date:"",course:"",time:"",location:"",topic:""}),j(null)},je=()=>S(!0),J=()=>{S(!1),c(null)},De=e=>{j(e),u({date:e.date||"",time:e.time||"",location:e.location||"",topic:e.topic||"",course:e.course||""}),Y()},be=async()=>{if(s){const e={date:a.date,time:a.time,location:a.location,topic:a.topic,course:a.course};await he(`${L}/${s.id}`,"PUT",e)&&M(C=>C.map(d=>d.id===s.id?{...d,...e}:d)),n(!0),R()}},Me=async()=>{if(s){const e={cohortName:U,entryId:s.id};await Ae($.MARK_TIMETABLE,"PATCH",e)&&M(C=>C.map(d=>d.id===s.id?{...d,done:!0}:d)),n(!0),R()}};console.log(Te);const Ee=e=>{j(e),G(!0)},we=e=>{c(e),je()},Pe=async()=>{s&&(await ge(`${L}/${s.id}`,"DELETE")?M(l=>l.filter(C=>C.id!==s.id)):I(!0),J(),I(!0))},ke=async()=>{const e={date:a.date,time:a.time,location:a.location,topic:a.topic,course:a.course},l=await pe(L,"POST",e);l&&M(l.timetable),R()},ye=e=>{b(P===e&&h==="asc"?"desc":"asc"),y(e)},Ie=(e,l)=>{p(l)},ve=e=>{D(+e.target.value),p(0)};return t.jsxs(E,{children:[t.jsx(te,{title:"TIME TABLE",subtitle:"Overview of Weekly Schedule"}),t.jsx(H,{onClick:Y,content:"Add Schedule"}),t.jsx(ee,{columns:Se,data:N,page:w,rowsPerPage:f,onSortChange:ye,sortBy:P,sortDirection:h,onPageChange:Ie,onRowsPerPageChange:ve,hiddenColumnsSmallScreen:["topic","location"]}),t.jsxs(O,{open:T,onClose:R,title:s?"Edit Schedule":"Add Schedule",onConfirm:s?be:ke,confirmMessage:s?"Update":"Add",children:[t.jsx(B,{fullWidth:!0,name:"date",label:"Date",type:"date",value:a.date,onChange:e=>u({...a,date:e.target.value}),sx:{mb:"15px"},InputLabelProps:{shrink:!0}}),t.jsx(B,{fullWidth:!0,name:"time",label:"Time",type:"time",value:a.time,onChange:e=>u({...a,time:e.target.value}),sx:{mb:"15px"},InputLabelProps:{shrink:!0}}),t.jsx(B,{fullWidth:!0,name:"location",label:"Location",value:a.location,onChange:e=>u({...a,location:e.target.value}),sx:{mb:"15px"}}),t.jsx(B,{fullWidth:!0,name:"topic",label:"Topic",value:a.topic,onChange:e=>u({...a,topic:e.target.value}),sx:{mb:"15px"}})]}),t.jsxs(O,{open:ie,onClose:()=>G(!1),title:"Assignment Details",noConfirm:!0,children:[t.jsxs(E,{children:[t.jsxs("p",{children:["Topic: ",s==null?void 0:s.topic]}),t.jsxs("p",{children:["Date: ",s==null?void 0:s.date]}),t.jsxs("p",{children:["Time: ",s==null?void 0:s.time]}),t.jsxs("p",{children:["Location: ",s==null?void 0:s.location]})]}),t.jsx(H,{onClick:()=>de(s),content:"Mark Attendance",sx:{width:"120px"}}),t.jsx(H,{onClick:()=>Me(),content:K?"Schedule completed":"Mark as done",sx:{width:"120px",mx:1},disable:K})]}),t.jsx(O,{open:A,onClose:J,title:"Delete Schedule",onConfirm:Pe,confirmMessage:"Delete",children:"Are you sure you want to delete this schedule?"}),t.jsx(oe,{open:x||k,onClose:re,title:x?"Delete Confirmation":"Update confirmation",isLoading:x?xe:fe,message:x?"Time Table successfully deleted":k?z:x&&Ce||k&&z?"Could not update time table, something went wrong":"something went wrong"}),t.jsx(We,{openAttendanceModal:v,cohortName:q.cohort,timeTable:ae,handleAttendanceModalClose:ue})]})},Fe=()=>{const m=_(r=>r.users.user),T=m.role;return t.jsx("div",{children:T==="student"?t.jsx(He,{}):t.jsx(_e,{babtechUser:m})})},dt=Ue(Fe);export{dt as default};
