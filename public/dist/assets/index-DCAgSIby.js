var Ae=Object.defineProperty;var Ee=(t,r,c)=>r in t?Ae(t,r,{enumerable:!0,configurable:!0,writable:!0,value:c}):t[r]=c;var Ce=(t,r,c)=>Ee(t,typeof r!="symbol"?r+"":r,c);import{r as k,j as e,a as me,e as oe,P as ie,Q as ce,R as Be}from"./index-DA7CL_TF.js";import{I as $e}from"./index-P3cg80UH.js";import{M as ye,t as Re}from"./modal-wWp9HhCh.js";import{H as Le}from"./Header-BlzJdVFL.js";import{T as Me}from"./table-CXJqNpdC.js";import{u as _e}from"./useApi-ml5YL047.js";import{u as qe}from"./useAdminData-DyCZuZSS.js";import{u as ze,M as xe}from"./MenuItem-BCUhhSjD.js";import{g as ue,a as pe,_ as he,ae as Oe,at as ve,b as z,s as ae,d as ne,h as X,e as fe,B as Ne,r as Te,c as be,u as ke,i as Ue,au as We,T as U,w as T,z as Z,y as we,$ as De,a0 as Ye,a1 as Se,j as He}from"./TextField-DsWKLBt2.js";import{a as Ve}from"./index-5ke-byr1.js";import{A as Pe}from"./confirmationModal-CbjipPnn.js";import{f as Qe,g as Ge}from"./index.esm-eqyGBvba.js";import{I as je}from"./IconButton-B3zrSn9q.js";import{G as le}from"./index-T8L-m1Uk.js";import{w as Je}from"./dasboardPagesContainer-DeFbZVuk.js";import"./useMediaQuery-DnG2P9HY.js";import"./loadingButton-CvGiH4xI.js";import"./CircularProgress-DO8NoW4k.js";import"./useSlot-DI2k78L0.js";function Ke(t){return ue("PrivateSwitchBase",t)}pe("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const Xe=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],Ze=t=>{const{classes:r,checked:c,disabled:s,edge:b}=t,m={root:["root",c&&"checked",s&&"disabled",b&&`edge${X(b)}`],input:["input"]};return fe(m,Ke,r)},et=ae(Ne)(({ownerState:t})=>z({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),tt=ae("input",{shouldForwardProp:Te})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),rt=k.forwardRef(function(r,c){const{autoFocus:s,checked:b,checkedIcon:m,className:h,defaultChecked:u,disabled:w,disableFocusRipple:C=!1,edge:$=!1,icon:f,id:i,inputProps:P,inputRef:O,name:R,onBlur:D,onChange:y,onFocus:j,readOnly:_,required:W=!1,tabIndex:S,type:L,value:M}=r,F=he(r,Xe),[I,V]=Oe({controlled:b,default:!!u,name:"SwitchBase",state:"checked"}),A=ve(),Q=o=>{j&&j(o),A&&A.onFocus&&A.onFocus(o)},J=o=>{D&&D(o),A&&A.onBlur&&A.onBlur(o)},G=o=>{if(o.nativeEvent.defaultPrevented)return;const E=o.target.checked;V(E),y&&y(o,E)};let H=w;A&&typeof H>"u"&&(H=A.disabled);const K=L==="checkbox"||L==="radio",g=z({},r,{checked:I,disabled:H,disableFocusRipple:C,edge:$}),n=Ze(g);return e.jsxs(et,z({component:"span",className:ne(n.root,h),centerRipple:!0,focusRipple:!C,disabled:H,tabIndex:null,role:void 0,onFocus:Q,onBlur:J,ownerState:g,ref:c},F,{children:[e.jsx(tt,z({autoFocus:s,checked:b,defaultChecked:u,className:n.input,disabled:H,id:K?i:void 0,name:R,onChange:G,readOnly:_,ref:O,required:W,ownerState:g,tabIndex:S,type:L},L==="checkbox"&&M===void 0?{}:{value:M},P)),I?m:f]}))}),at=be(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),st=be(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),nt=be(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function ot(t){return ue("MuiCheckbox",t)}const de=pe("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),it=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],ct=t=>{const{classes:r,indeterminate:c,color:s,size:b}=t,m={root:["root",c&&"indeterminate",`color${X(s)}`,`size${X(b)}`]},h=fe(m,ot,r);return z({},r,h)},lt=ae(rt,{shouldForwardProp:t=>Te(t)||t==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:c}=t;return[r.root,c.indeterminate&&r.indeterminate,r[`size${X(c.size)}`],c.color!=="default"&&r[`color${X(c.color)}`]]}})(({theme:t,ownerState:r})=>z({color:(t.vars||t).palette.text.secondary},!r.disableRipple&&{"&:hover":{backgroundColor:t.vars?`rgba(${r.color==="default"?t.vars.palette.action.activeChannel:t.vars.palette[r.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:Ue(r.color==="default"?t.palette.action.active:t.palette[r.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},r.color!=="default"&&{[`&.${de.checked}, &.${de.indeterminate}`]:{color:(t.vars||t).palette[r.color].main},[`&.${de.disabled}`]:{color:(t.vars||t).palette.action.disabled}})),dt=e.jsx(st,{}),mt=e.jsx(at,{}),ut=e.jsx(nt,{}),Fe=k.forwardRef(function(r,c){var s,b;const m=ke({props:r,name:"MuiCheckbox"}),{checkedIcon:h=dt,color:u="primary",icon:w=mt,indeterminate:C=!1,indeterminateIcon:$=ut,inputProps:f,size:i="medium",className:P}=m,O=he(m,it),R=C?$:w,D=C?$:h,y=z({},m,{color:u,indeterminate:C,size:i}),j=ct(y);return e.jsx(lt,z({type:"checkbox",inputProps:z({"data-indeterminate":C},f),icon:k.cloneElement(R,{fontSize:(s=R.props.fontSize)!=null?s:i}),checkedIcon:k.cloneElement(D,{fontSize:(b=D.props.fontSize)!=null?b:i}),ownerState:y,ref:c,className:ne(j.root,P)},O,{classes:j}))});function pt(t){return ue("MuiFormControlLabel",t)}const re=pe("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),ht=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],ft=t=>{const{classes:r,disabled:c,labelPlacement:s,error:b,required:m}=t,h={root:["root",c&&"disabled",`labelPlacement${X(s)}`,b&&"error",m&&"required"],label:["label",c&&"disabled"],asterisk:["asterisk",b&&"error"]};return fe(h,pt,r)},bt=ae("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:c}=t;return[{[`& .${re.label}`]:r.label},r.root,r[`labelPlacement${X(c.labelPlacement)}`]]}})(({theme:t,ownerState:r})=>z({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${re.disabled}`]:{cursor:"default"}},r.labelPlacement==="start"&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},r.labelPlacement==="top"&&{flexDirection:"column-reverse",marginLeft:16},r.labelPlacement==="bottom"&&{flexDirection:"column",marginLeft:16},{[`& .${re.label}`]:{[`&.${re.disabled}`]:{color:(t.vars||t).palette.text.disabled}}})),gt=ae("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,r)=>r.asterisk})(({theme:t})=>({[`&.${re.error}`]:{color:(t.vars||t).palette.error.main}})),Ie=k.forwardRef(function(r,c){var s,b;const m=ke({props:r,name:"MuiFormControlLabel"}),{className:h,componentsProps:u={},control:w,disabled:C,disableTypography:$,label:f,labelPlacement:i="end",required:P,slotProps:O={}}=m,R=he(m,ht),D=ve(),y=(s=C??w.props.disabled)!=null?s:D==null?void 0:D.disabled,j=P??w.props.required,_={disabled:y,required:j};["checked","name","onChange","value","inputRef"].forEach(I=>{typeof w.props[I]>"u"&&typeof m[I]<"u"&&(_[I]=m[I])});const W=We({props:m,muiFormControl:D,states:["error"]}),S=z({},m,{disabled:y,labelPlacement:i,required:j,error:W.error}),L=ft(S),M=(b=O.typography)!=null?b:u.typography;let F=f;return F!=null&&F.type!==U&&!$&&(F=e.jsx(U,z({component:"span"},M,{className:ne(L.label,M==null?void 0:M.className),children:F}))),e.jsxs(bt,z({className:ne(L.root,h),ownerState:S,ref:c},R,{children:[k.cloneElement(w,_),j?e.jsxs(Ve,{display:"block",children:[F,e.jsxs(gt,{ownerState:S,"aria-hidden":!0,className:L.asterisk,children:["â€‰","*"]})]}):F]}))}),Ct=()=>{const t={id:"",name:"",fromYear:"",toYear:"",isCurrent:!1},r={academicYearId:"",terms:[{name:"1st Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1},{name:"2nd Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1},{name:"3rd Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1}]},[c,s]=k.useState(t),[b,m]=k.useState(r),[h,u]=k.useState({name:"",fromYear:"",toYear:"",general:""}),[w,C]=k.useState({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]}),[$,f]=k.useState(!1),[i,P]=k.useState(!1),{loading:O,callApi:R}=_e(),D=ze(),{academicYears:y,currentAcademicYear:j,refetchAcademicYears:_,refetchCurrentYear:W}=qe(),S=me(n=>{var o;return(o=n.users.user)==null?void 0:o._id}),L=n=>{const{name:o,value:E,type:x,checked:B}=n.target,a=x==="checkbox"?B:E;s(l=>({...l,[o]:a})),u(l=>({...l,[o]:"",general:""}))},M=(n,o,E=!1)=>{const{name:x,value:B,type:a,checked:l}=n.target,Y=a==="checkbox"?l:B;m(d=>{const v=[...d.terms];return v[o]={...v[o],[x]:Y,createdBy:S},E&&Y&&v.forEach((q,se)=>{se!==o&&(q.isCurrent=!1)}),{...d,terms:v}}),C(d=>({...d,terms:d.terms.map((v,q)=>q===o?{...v,[x]:""}:v),general:""}))},F=()=>{const{name:n,fromYear:o,toYear:E}=c,x={name:"",fromYear:"",toYear:"",general:""};return n.trim()?/^\d{4}\/\d{4}$/.test(n.trim())||(x.name="Name must be in format YYYY/YYYY (e.g., 2024/2025)"):x.name="Academic year name is required",o.trim()||(x.fromYear="From year is required"),E.trim()||(x.toYear="To year is required"),u(x),!x.name&&!x.fromYear&&!x.toYear},I=()=>{const{terms:n}=b,o={general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]};(!n||n.length!==3||!n.every(a=>["1st Term","2nd Term","3rd Term"].includes(a.name)))&&(o.general="Exactly three terms (1st Term, 2nd Term, 3rd Term) are required"),n.filter(a=>a.isCurrent).length>1&&(o.general="Only one term can be set as current");const x=Array.from({length:10},(a,l)=>`${l+1} month${l+1>1?"s":""}`);n.forEach((a,l)=>{a.description.trim()||(o.terms[l].description="Description is required"),(!a.duration||!x.includes(a.duration))&&(o.terms[l].duration="Duration must be between 1 and 10 months"),a.startDate||(o.terms[l].startDate="Start date is required"),a.endDate||(o.terms[l].endDate="End date is required"),a.startDate&&a.endDate&&new Date(a.startDate)>=new Date(a.endDate)&&(o.terms[l].endDate="End date must be after start date")});const B=n.map(a=>a.duration);new Set(B).size!==B.length&&(o.general="All terms must have unique durations");for(let a=0;a<n.length;a++)for(let l=a+1;l<n.length;l++)n[a].startDate&&n[a].endDate&&n[l].startDate&&n[l].endDate&&new Date(n[a].startDate)<=new Date(n[l].endDate)&&new Date(n[l].startDate)<=new Date(n[a].endDate)&&(o.terms[l].startDate=`Terms ${n[a].name} and ${n[l].name} have overlapping dates`);return C(o),!o.general&&o.terms.every(a=>!a.description&&!a.duration&&!a.startDate&&!a.endDate)},V=async()=>{var a,l;if(!F())return!1;if(!S)return u(Y=>({...Y,general:"User not authenticated. Please log in."})),!1;const{name:n,fromYear:o,toYear:E,isCurrent:x}=c,B={name:n,fromYear:new Date(o).toISOString(),toYear:new Date(E).toISOString(),isCurrent:x,createdBy:S,academicTerms:[],students:[],teachers:[]};try{P(!0),u(v=>({...v,name:"",fromYear:"",toYear:"",general:""}));const Y=await R(oe.ACADEMIC_YEARS,"POST",B);if(!Y||Y.status!=="success")throw new Error((Y==null?void 0:Y.message)||"Failed to create academic year");const d=Y.data;return D(ie([...y,d])),x&&D(ce(d)),await _(),await W(),s(t),f(!1),!0}catch(Y){const d=((l=(a=Y.response)==null?void 0:a.data)==null?void 0:l.message)||Y.message||"Failed to create academic year";return u(v=>({...v,general:d})),D(u(d)),!1}finally{P(!1)}},A=async()=>{var x,B;if(!I())return!1;if(!S)return C(a=>({...a,general:"User not authenticated. Please log in."})),!1;const{terms:n,academicYearId:o}=b,E={academicYearId:o,terms:n.map(a=>({...a,startDate:a.startDate?new Date(a.startDate).toISOString():void 0,endDate:a.endDate?new Date(a.endDate).toISOString():void 0,createdBy:S}))};try{P(!0),C(d=>({...d,general:"",terms:d.terms.map(()=>({description:"",duration:"",startDate:"",endDate:""}))}));const a=await R(oe.ACADEMIC_TERMS,"POST",E);if(!a||a.status!=="success")throw new Error((a==null?void 0:a.message)||"Failed to create academic term");const l=a.data,Y=y.map(d=>d._id===o?{...d,academicTerms:[...d.academicTerms||[],l._id]}:d);return D(ie(Y)),await _(),m(r),!0}catch(a){const l=((B=(x=a.response)==null?void 0:x.data)==null?void 0:B.message)||a.message||"Failed to create academic term";return C(Y=>({...Y,general:l})),D(u(l)),!1}finally{P(!1)}},Q=async()=>{var l,Y;if(!F())return!1;const{id:n,name:o,fromYear:E,toYear:x,isCurrent:B}=c;if(!S)return u(d=>({...d,general:"User not authenticated. Please log in."})),!1;const a={name:o,fromYear:new Date(E).toISOString(),toYear:new Date(x).toISOString(),isCurrent:B,createdBy:S};try{P(!0),u(q=>({...q,name:"",fromYear:"",toYear:"",general:""}));const d=await R(`${oe.ACADEMIC_YEARS}/${n}`,"PATCH",a);if(!d||d.status!=="success")throw new Error((d==null?void 0:d.message)||"Failed to update academic year");const v=d.data;return D(ie(y.map(q=>q._id===n?v:q))),B?D(ce(v)):(j==null?void 0:j._id)===n&&!B&&D(ce(null)),await _(),await W(),s(t),f(!1),!0}catch(d){const v=((Y=(l=d.response)==null?void 0:l.data)==null?void 0:Y.message)||d.message||"Failed to update academic year";return u(q=>({...q,general:v})),D(u(v)),!1}finally{P(!1)}};return{setFormValues:s,formValues:c,handleChange:L,handleTermChange:M,handleSubmit:async()=>$?await Q():await V(),handleCreateAcademicTerm:A,startEdit:n=>{s({id:n._id,name:n.name,fromYear:n.fromYear.split("T")[0],toYear:n.toYear.split("T")[0],isCurrent:n.isCurrent}),f(!0),u({name:"",fromYear:"",toYear:"",general:""})},startAddTerm:n=>{m({...r,academicYearId:n,terms:r.terms.map(o=>({...o,createdBy:S}))}),C({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]})},editMode:$,setEditMode:f,academicYears:y,currentAcademicYear:j,loading:O,error:h,termError:w,isSubmitting:i,resetForm:()=>{s(t),u({name:"",fromYear:"",toYear:"",general:""}),f(!1)},resetTermForm:()=>{m(r),C({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]})},termFormValues:b}},xt=({open:t,onClose:r,handleSubmit:c,error:s={},editMode:b=!1,userId:m,formValues:h,handleChange:u,isSubmitting:w=!1})=>{const C=new Date().toISOString().split("T")[0],$=async f=>{f.preventDefault(),console.log("Form submission attempted with values:",h);try{await c(h)?(console.log("Submission successful"),r()):console.log("Submission failed, handleSubmit returned false")}catch(i){console.error("Submission error:",i)}};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            opacity: 1;
          }
          input[type="date"] {
            color-scheme: light;
          }
        `}),e.jsx(ye,{open:t,onClose:r,title:b?"Edit Academic Year":"Add Academic Year",noConfirm:!0,children:e.jsxs(T,{component:"form",onSubmit:$,children:[e.jsx(T,{mb:2,children:e.jsx(Z,{label:"Academic Year Name (e.g., 2024/2025)",name:"name",value:h.name||"",onChange:u,fullWidth:!0,required:!0,error:!!s.name,helperText:s.name||"Format: YYYY/YYYY (e.g., 2024/2025)"})}),e.jsx(T,{mb:2,children:e.jsx(Z,{label:"From Year",name:"fromYear",type:"date",value:h.fromYear||"",onChange:u,fullWidth:!0,required:!0,error:!!s.fromYear,helperText:s.fromYear,InputLabelProps:{shrink:!0},inputProps:{min:C}})}),e.jsx(T,{mb:2,children:e.jsx(Z,{label:"To Year",name:"toYear",type:"date",value:h.toYear||"",onChange:u,fullWidth:!0,required:!0,error:!!s.toYear,helperText:s.toYear,InputLabelProps:{shrink:!0},inputProps:{min:h.fromYear||C}})}),e.jsx(T,{mb:2,children:e.jsx(Ie,{control:e.jsx(Fe,{checked:h.isCurrent||!1,onChange:u,name:"isCurrent",color:"primary"}),label:"Set as Current Academic Year"})}),s.general&&e.jsx(U,{variant:"caption",color:"error",mb:2,children:s.general}),e.jsx(we,{type:"submit",variant:"contained",color:"primary",disabled:w,fullWidth:!0,children:w?"Submitting...":b?"Update Academic Year":"Submit"})]})})]})},Dt=({open:t,onClose:r,handleSubmit:c,error:s={},userId:b,formValues:m,handleChange:h,isSubmitting:u=!1})=>{const w=new Date().toISOString().split("T")[0],C=async f=>{f.preventDefault();try{await c()&&r()}catch(i){console.error("Submission error:",i)}},$=Array.from({length:10},(f,i)=>`${i+1} month${i+1>1?"s":""}`);return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            opacity: 1;
          }
          input[type="date"] {
            color-scheme: light;
          }
        `}),e.jsx(ye,{open:t,onClose:r,title:"Add Academic Term",noConfirm:!0,children:e.jsxs(T,{component:"form",onSubmit:C,children:[m.terms.map((f,i)=>{var P,O,R,D,y,j,_,W,S,L,M,F,I,V,A,Q,J,G,H,K;return e.jsxs(T,{mb:3,sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(U,{variant:"h6",children:f.name}),e.jsx(T,{mb:2,children:e.jsxs(De,{fullWidth:!0,required:!0,error:!!((O=(P=s.terms)==null?void 0:P[i])!=null&&O.name),children:[e.jsx(Ye,{id:`term-name-label-${i}`,children:"Term Name"}),e.jsx(Se,{labelId:`term-name-label-${i}`,name:"name",value:f.name||"",onChange:g=>h(g,i),label:"Term Name",disabled:!0,children:["1st Term","2nd Term","3rd Term"].map(g=>e.jsx(xe,{value:g,children:g},g))}),((D=(R=s.terms)==null?void 0:R[i])==null?void 0:D.name)&&e.jsx(U,{variant:"caption",color:"error",children:s.terms[i].name})]})}),e.jsx(T,{mb:2,children:e.jsx(Z,{label:"Description",name:"description",value:f.description||"",onChange:g=>h(g,i),fullWidth:!0,required:!0,error:!!((j=(y=s.terms)==null?void 0:y[i])!=null&&j.description),helperText:(W=(_=s.terms)==null?void 0:_[i])==null?void 0:W.description})}),e.jsx(T,{mb:2,children:e.jsxs(De,{fullWidth:!0,required:!0,error:!!((L=(S=s.terms)==null?void 0:S[i])!=null&&L.duration),children:[e.jsx(Ye,{id:`duration-label-${i}`,children:"Duration"}),e.jsx(Se,{labelId:`duration-label-${i}`,name:"duration",value:f.duration||"3 months",onChange:g=>h(g,i),label:"Duration",children:$.map(g=>e.jsx(xe,{value:g,children:g},g))}),((F=(M=s.terms)==null?void 0:M[i])==null?void 0:F.duration)&&e.jsx(U,{variant:"caption",color:"error",children:s.terms[i].duration})]})}),e.jsx(T,{mb:2,children:e.jsx(Z,{label:"Start Date",name:"startDate",type:"date",value:f.startDate||"",onChange:g=>h(g,i),fullWidth:!0,required:!0,error:!!((V=(I=s.terms)==null?void 0:I[i])!=null&&V.startDate),helperText:(Q=(A=s.terms)==null?void 0:A[i])==null?void 0:Q.startDate,InputLabelProps:{shrink:!0},inputProps:{min:w}})}),e.jsx(T,{mb:2,children:e.jsx(Z,{label:"End Date",name:"endDate",type:"date",value:f.endDate||"",onChange:g=>h(g,i),fullWidth:!0,required:!0,error:!!((G=(J=s.terms)==null?void 0:J[i])!=null&&G.endDate),helperText:(K=(H=s.terms)==null?void 0:H[i])==null?void 0:K.endDate,InputLabelProps:{shrink:!0},inputProps:{min:f.startDate||w}})}),e.jsx(T,{mb:2,children:e.jsx(Ie,{control:e.jsx(Fe,{checked:f.isCurrent||!1,onChange:g=>h(g,i,!0),name:"isCurrent",color:"primary"}),label:"Set as Current Term"})})]},f.name)}),s.general&&e.jsx(U,{variant:"caption",color:"error",mb:2,children:s.general}),e.jsx(we,{type:"submit",variant:"contained",color:"primary",disabled:u,fullWidth:!0,children:u?"Submitting...":"Submit"})]})})]})};class Yt extends Be.Component{constructor(){super(...arguments);Ce(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(c){return{hasError:!0,error:c}}componentDidCatch(c,s){console.error("Error caught by boundary:",c,s)}render(){var c;return this.state.hasError?e.jsxs(T,{sx:{p:3,textAlign:"center"},children:[e.jsx(U,{variant:"h5",color:"error",children:"Something went wrong."}),e.jsx(U,{variant:"body1",mt:2,children:((c=this.state.error)==null?void 0:c.message)||"An unexpected error occurred."}),e.jsx(Pe,{content:"Reload",onClick:()=>window.location.reload(),sx:{mt:2}})]}):this.props.children}}const St=()=>{var q,se,ge;const t=He(),r=Re(t.palette.mode),{academicYears:c,currentAcademicYear:s,loading:b,error:m,termError:h,handleSubmit:u,handleCreateAcademicTerm:w,startEdit:C,startAddTerm:$,editMode:f,setEditMode:i,formValues:P,termFormValues:O,handleChange:R,handleTermChange:D,isSubmitting:y,resetForm:j,resetTermForm:_}=Ct(),[W,S]=k.useState(!1),[L,M]=k.useState(!1),F=me(p=>{var N;return(N=p.users.user)==null?void 0:N._id})||"",[I,V]=k.useState("name"),[A,Q]=k.useState("asc"),[J,G]=k.useState(0),[H,K]=k.useState(5),[g,n]=k.useState(""),o=[{id:"sn",label:"S/N"},{id:"name",label:"Name"},{id:"fromYear",label:"From Year"},{id:"toYear",label:"To Year"},{id:"isCurrent",label:"Current"},{id:"studentCount",label:"Students"},{id:"teacherCount",label:"Teachers"},{id:"actions",label:"Actions"}],E=c.map((p,N)=>{var ee,te;return{sn:N+1,id:p._id,name:p.name,fromYear:new Date(p.fromYear).toLocaleDateString(),toYear:new Date(p.toYear).toLocaleDateString(),isCurrent:p.isCurrent?"Yes":"No",studentCount:((ee=p.students)==null?void 0:ee.length)||0,teacherCount:((te=p.teachers)==null?void 0:te.length)||0,actions:e.jsxs(T,{children:[e.jsxs(je,{onClick:()=>{console.log("EditIcon clicked for academicYearId:",p._id),x(p)},children:[e.jsx(Qe,{})," "]}),e.jsxs(je,{onClick:()=>{console.log("AddCircleIcon clicked for academicYearId:",p._id),B(p._id)},children:[e.jsx(Ge,{})," "]})]})}}),x=p=>{console.log("handleEdit called with year:",p._id),C(p),S(!0)},B=p=>{console.log("handleAddTerm called with academicYearId:",p);try{$(p),M(!0)}catch(N){console.error("Error in handleAddTerm:",N)}},a=p=>{const N=I===p&&A==="asc";V(p),Q(N?"desc":"asc")},l=(p,N)=>{G(N)},Y=p=>{K(parseInt(p.target.value,10)),G(0)},v=[...E.filter(p=>p.name.toLowerCase().includes(g.toLowerCase()))].sort((p,N)=>{const ee=p[I],te=N[I];return A==="asc"?ee>te?1:-1:ee<te?1:-1});return e.jsx(Yt,{children:e.jsxs(le,{container:!0,children:[e.jsx(le,{item:!0,xs:12,children:e.jsx(Le,{title:"Academics Management",subtitle:"Manage Academic Sessions"})}),e.jsx(le,{item:!0,xs:12,children:b?e.jsx(T,{children:"Loading..."}):m.general?e.jsx(T,{sx:{color:"red"},children:m.general}):e.jsxs(e.Fragment,{children:[e.jsxs(T,{sx:{mb:3,p:2,backgroundColor:r.primary[400],borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(T,{children:[e.jsx(U,{variant:"h5",color:r.grey[100],children:"Current Academic Year"}),s?e.jsxs(U,{variant:"body1",color:r.grey[100],children:[s.name," (",new Date(s.fromYear).toLocaleDateString()," -"," ",new Date(s.toYear).toLocaleDateString(),") |"," ",((q=s.students)==null?void 0:q.length)||0," Students,"," ",((se=s.teachers)==null?void 0:se.length)||0," Teachers,"," ",((ge=s.academicTerms)==null?void 0:ge.length)||0," Terms"]}):e.jsx(U,{variant:"body1",color:r.redAccent[500],children:"No current academic year set."})]}),e.jsx(Pe,{onClick:()=>{S(!0),i(!1),j()},content:"Add Academic Year"})]}),e.jsx(xt,{open:W,onClose:()=>{S(!1),i(!1),j()},handleSubmit:u,error:m,editMode:f,userId:F,formValues:P,handleChange:R,isSubmitting:y}),e.jsx(Dt,{open:L,onClose:()=>{M(!1),_()},handleSubmit:w,error:h,userId:F,formValues:O,handleChange:D,isSubmitting:y}),e.jsx(Me,{columns:o,tableHeader:"Academic Years",data:v,sortBy:I,sortDirection:A,onSortChange:a,page:J,rowsPerPage:H,onPageChange:l,onRowsPerPageChange:Y,hiddenColumnsSmallScreen:["fromYear","toYear","studentCount","teacherCount","academicTermCount","actions"],hiddenColumnsTabScreen:["studentCount","teacherCount","academicTermCount"]})]})})]})})},jt=()=>{const t=me(r=>r.users.user.role);return console.log(t),e.jsx("div",{children:t==="teacher"?e.jsx($e,{}):e.jsx(St,{})})},Ut=Je(jt);export{Ut as default};
