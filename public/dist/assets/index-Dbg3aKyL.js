import{r,f as v,j as e,a as Bs}from"./index-BO-TmkzE.js";import{u as D}from"./useApi-bPe3HYn1.js";import{M as ue,t as Ps}from"./modal-CG0C6vpP.js";import{C as Ge}from"./accordion-M8ImoQcF.js";import{v as k,T as c,y,a1 as Y,a2 as B,a3 as P,x as R,j as Ws}from"./TextField-CigEBK4R.js";import{G as j}from"./index-BJVcWxQk.js";import{M as C}from"./MenuItem-Cm8_Zc8l.js";import"./IconButton-DnpiNGo6.js";import"./useSlot-DtaxXO1z.js";import"./confirmationModal-DjrrgVpa.js";import"./CircularProgress-oo0vmEJK.js";import"./index-nsUM-GnQ.js";import"./loadingButton-CiJH9dFC.js";import"./crystal-land-log-removebg-DVF-nlbN.js";const Us=({userId:M})=>{const[w,d]=r.useState(""),[n,S]=r.useState(""),[p,W]=r.useState(""),[f,J]=r.useState(""),[Se,U]=r.useState(!1),[m,i]=r.useState(!1),[N,X]=r.useState(!1),[Q,L]=r.useState(!1),[me,O]=r.useState(!1),[V,K]=r.useState(!1),[pe,G]=r.useState(""),[Me,be]=r.useState(""),[Ee,z]=r.useState(null),[g,$]=r.useState(null),[q,he]=r.useState([]),[_,a]=r.useState({question:"",optionA:"",optionB:"",optionC:"",optionD:"",correctAnswer:"",score:""}),[l,b]=r.useState({name:"",description:"",subject:"",classLevel:"",passMark:"",totalMark:"",duration:"",examDate:"",examTime:"",examType:"test",academicTerm:"",academicYear:"",startDate:"",startTime:"",subclassLetter:""}),[Z,ee]=r.useState([]),[xe,Oe]=r.useState([]),[Te,qe]=r.useState([]),[ge,Fe]=r.useState([]),[se,te]=r.useState([]),[Ye,ae]=r.useState(""),[De,Be]=r.useState({}),[Pe,E]=r.useState(""),[F,je]=r.useState({startDate:"",startTime:""}),{data:re,loading:_e,error:$e,callApi:ke}=D(),{data:A,loading:h,error:H,callApi:I}=D(),{data:x,loading:We,error:Re,callApi:us}=D(),{data:Ne,loading:ms,error:Ue,callApi:ps}=D(),{data:oe,loading:hs,error:ze,callApi:xs}=D(),{data:ne,loading:gs,error:He,callApi:Ie}=D(),{data:le,loading:js,error:Je,callApi:Ve}=D(),{data:Ae,loading:fs,error:Ke,callApi:ye}=D(),{data:we,loading:Cs,error:Ze,callApi:Ss}=D(),{data:Qe,loading:bs,error:es,callApi:As}=D(),{data:ie,loading:vs,error:ss,callApi:Ms}=D(),{data:ce,loading:Es,error:ts,callApi:as}=D(),{data:ve,loading:Ts,error:rs,callApi:os}=D(),{data:de,loading:Ds,error:ns,callApi:ls}=D(),{data:fe,loading:ys,error:Xe,callApi:is}=D();r.useEffect(()=>{M?(ke(`${v.CLASS_LEVEL}/admin/no-sensitive-data`,"GET"),Ie(v.CURRENT_ACADEMIC_TERM,"GET"),Ve(v.ACADEMIC_YEARS,"GET")):(E("User not authenticated"),console.error("Fetch initial data failed: User not authenticated"))},[ke,Ie,Ve,M]),r.useEffect(()=>{if(M&&n&&f){const s=`${v.ADMIN_EXAM}?classLevel=${n}&academicYear=${f}${p?`&subclassLetter=${p}`:""}`;I(s,"GET"),console.log(`Fetching exams with query: ${s}`)}},[I,M,n,p,f]),r.useEffect(()=>{if(M&&n){const s=`${v.SUBJECT}/subclass/filter?classLevel=${n}${p?`&subclassLetter=${p}`:""}`;is(s,"GET"),console.log(`Fetching subjects for subclass with query: ${s}`)}else te([]),ae("")},[is,M,n,p]),r.useEffect(()=>{if(re!=null&&re.data){const s=re.data.data||[];Fe(s.map(t=>{var o;return{_id:t._id,name:t.name,displayName:t.name,subclasses:((o=t.subclasses)==null?void 0:o.map(u=>u.letter))||[],section:t.section||""}})),console.log("Classes:",s)}},[re]),r.useEffect(()=>{var s;ne!=null&&ne.data&&(Oe(Array.isArray(ne.data)?ne.data:[ne.data]),console.log("Academic Terms:",ne.data)),le!=null&&le.data&&(qe(le.data||[]),console.log("Academic Years:",le.data),!f&&((s=le.data)==null?void 0:s.length)>0&&J(le.data[0]._id))},[ne,le,f]),r.useEffect(()=>{if(A!=null&&A.data){const s=Array.isArray(A.data)?A.data:A.data.exams||A.data.data||[];ee(s),console.log("Exams set:",s)}else(A==null?void 0:A.status)==="success"&&!A.data&&(ee([]),console.log("Exams set to empty array: No data returned"))},[A]),r.useEffect(()=>{if(fe!=null&&fe.data){const s=Array.isArray(fe.data)?fe.data:fe.data.subjects||[];te(s.map(t=>{var o;return{_id:t._id,name:((o=t.name)==null?void 0:o.name)||"Unknown Subject"}})),ae(s.length===0?"No subjects found for this class/subclass":""),console.log("Subjects for subclass:",s)}Xe&&(ae(`Failed to fetch subjects: ${Xe}`),te([]))},[fe,Xe]),r.useEffect(()=>{if(A!=null&&A.data){const s=[...new Set(A.data.map(t=>{var o;return(o=t.subject)==null?void 0:o._id}).filter(Boolean))];console.log("Unique subject IDs:",s),s.forEach(t=>{De[t]||(ls(`${v.SUBJECT}/${t}`,"GET"),console.log(`Fetching subject name for ID: ${t}`))})}},[A,ls,De]),r.useEffect(()=>{de!=null&&de.data&&(Be(s=>({...s,[de.data._id]:de.data.name})),console.log("Subject Name:",de.data._id,de.data.name))},[de]),r.useEffect(()=>{Ae!=null&&Ae.data&&(he(Ae.data||[]),console.log("Questions:",Ae.data))},[Ae]),r.useEffect(()=>{if(((Ne==null?void 0:Ne.status)==="success"||(oe==null?void 0:oe.status)==="success"||(ce==null?void 0:ce.status)==="success")&&n&&f){const s=`${v.ADMIN_EXAM}?classLevel=${n}&academicYear=${f}${p?`&subclassLetter=${p}`:""}`;I(s,"GET"),console.log(`Refreshing exams with query: ${s}`)}if((x==null?void 0:x.status)==="success"&&(x!=null&&x.data)){const s=x.data;if(ee(t=>[...t.filter(u=>u._id!==s._id),s]),G("Exam created successfully"),O(!0),console.log("New exam added to state:",s),n&&f){const t=`${v.ADMIN_EXAM}?classLevel=${n}&academicYear=${f}${p?`&subclassLetter=${p}`:""}`;I(t,"GET"),console.log(`Refreshing exams after create with query: ${t}`)}}((we==null?void 0:we.status)==="success"||(Qe==null?void 0:Qe.status)==="success"||(ie==null?void 0:ie.status)==="success")&&(ye(`${v.ADMIN_EXAM}/${g==null?void 0:g._id}/questions`,"GET"),console.log(`Refreshing questions for exam ${g==null?void 0:g._id}`))},[x,Ne,oe,ce,we,Qe,ie,I,ye,n,p,f,g]),r.useEffect(()=>{(oe==null?void 0:oe.status)==="success"&&(G("Exam deleted successfully"),O(!0)),(ie==null?void 0:ie.status)==="success"&&(G("Question deleted successfully"),O(!0)),(ce==null?void 0:ce.status)==="success"&&(G("Exam approved successfully"),O(!0))},[oe,ie,ce]),r.useEffect(()=>{g!=null&&g._id&&(ye(`${v.ADMIN_EXAM}/${g._id}/questions`,"GET"),os(`${v.ADMIN_EXAM}/${g._id}/scores`,"GET"),console.log(`Fetching questions and scores for exam ${g._id}`))},[g,ye,os]),r.useEffect(()=>{const t=[$e,H&&`Failed to fetch exams: ${H}`,He,Je,Re,Ue&&`Failed to update exam: ${Ue}`,ze,Ke,Ze,es,ss,ts,rs,ns].filter(Boolean).join("; ")||"";E(t),console.error("API Errors:",t)},[$e,H,He,Je,Re,Ue,ze,Ke,Ze,es,ss,ts,rs,ns]);const _s=s=>{const{name:t,value:o}=s.target;je(u=>({...u,[t]:o})),console.log("Approval input change:",t,o)},$s=async s=>{const t=Z.find(o=>o._id===s);if(!t){E("Selected exam not found"),console.error("Exam approve error: Exam not found",s);return}if(!q||q.length===0||(g==null?void 0:g._id)!==s)await ye(`${v.ADMIN_EXAM}/${s}/questions`,"GET").then(()=>{const o=q.reduce((u,T)=>u+(Number(T.score)||0),0);if(o!==t.totalMark){be(`Total score of questions (${o}) does not match the exam’s total mark (${t.totalMark}).`),K(!0),console.error("Exam approve error: Total question scores do not match exam total mark");return}G("Please provide start date and time to approve this exam."),z(()=>async()=>{if(!F.startDate||!F.startTime){E("Start date and time are required for approval"),console.error("Exam approve error: Missing start date or time");return}try{await as(`${v.ADMIN_EXAM}/${s}/approve`,"PATCH",{startDate:F.startDate,startTime:F.startTime}),L(!1),je({startDate:"",startTime:""}),console.log("Exam approved:",s)}catch(u){E(u.message||"Failed to approve exam"),L(!1),console.error("Exam approve error:",u.message)}}),L(!0)});else{const o=q.reduce((u,T)=>u+(Number(T.score)||0),0);if(o!==t.totalMark){be(`Total score of questions (${o}) does not match the exam’s total mark (${t.totalMark}).`),K(!0),console.error("Exam approve error: Total question scores do not match exam total mark");return}G("Please provide start date and time to approve this exam."),z(()=>async()=>{if(!F.startDate||!F.startTime){E("Start date and time are required for approval"),console.error("Exam approve error: Missing start date or time");return}try{await as(`${v.ADMIN_EXAM}/${s}/approve`,"PATCH",{startDate:F.startDate,startTime:F.startTime}),L(!1),je({startDate:"",startTime:""}),console.log("Exam approved:",s)}catch(u){E(u.message||"Failed to approve exam"),L(!1),console.error("Exam approve error:",u.message)}}),L(!0)}},ks=r.useCallback(()=>!se||!n?(console.log("No subjects: subjectsForSubclass or selectedClass missing",{subjectsForSubclass:se,selectedClass:n}),[]):(console.log(`Subjects for class ${n}${p?`, subclass ${p}`:""}:`,se),se),[se,n,p]),Ns=r.useCallback((s,t)=>{const o=Z.filter(u=>{var T;return u.classLevel===s&&((T=u.subject)==null?void 0:T._id)===t&&u.academicYear===f&&(p===""||u.subclassLetter===p||u.subclassLetter==null)});return console.log(`Filtered exams for class ${s}, subject ${t}${p?`, subclass ${p}`:""}, academic year ${f}:`,o),o},[Z,p,f]),ws=r.useCallback(s=>{if(!(ve!=null&&ve.data)||!s)return console.log("No test scores: testScoresData or exam missing",{testScoresData:ve,exam:s}),[];const t=ve.data.map((o,u)=>{var T,Ce;return{sn:u+1,studentName:`${((T=o.student)==null?void 0:T.firstName)||""} ${((Ce=o.student)==null?void 0:Ce.lastName)||""}`,score:o.score,date:new Date(o.date).toLocaleDateString()}});return console.log("Test scores for exam",s==null?void 0:s._id,":",t),t},[ve]),Qs=r.useCallback(()=>{const s=[...new Set(ge.map(t=>t.section))].filter(Boolean);return console.log("Sections:",s),s.sort()},[ge]),Ls=r.useCallback(s=>{const t=ge.filter(o=>o.section===s);return console.log("Classes for section",s,":",t),t},[ge]),Os=s=>{d(s.target.value),S(""),W(""),$(null),ee([]),te([]),ae(""),console.log("Selected section:",s.target.value)},qs=s=>{S(s.target.value),W(""),$(null),ee([]),te([]),ae(""),console.log("Selected class:",s.target.value)},Fs=s=>{W(s.target.value),$(null),console.log("Selected subclass:",s.target.value)},Ys=s=>{J(s.target.value),$(null),ee([]),console.log("Selected academic year:",s.target.value)},cs=r.useCallback((s,t)=>{S(s),W(t||""),te([]),ae(""),console.log("Modal class/subclass change:",s,t)},[]);return{selectedSection:w,selectedClass:n,subclassLetter:p,selectedAcademicYear:f,questionsModalOpen:Se,examModalOpen:m,deleteConfirmModalOpen:N,approveConfirmModalOpen:Q,successModalOpen:me,scoreMismatchModalOpen:V,confirmationMessage:pe,confirmationAction:Ee,scoreMismatchMessage:Me,selectedExam:g,questions:q,newQuestion:_,newExam:l,exams:Z,academicTerms:xe,academicYears:Te,classes:ge,subjectsForSubclass:se,subjectsError:Ye,subjectNames:De,error:Pe,approveExamData:F,handleApproveInputChange:_s,loading:_e||h||gs||js||fs||We||ms||hs||Cs||bs||vs||Es||Ts||Ds||ys,getSections:Qs,getClassesForSection:Ls,getSubjectsForClass:ks,getExamsForSubject:Ns,getTestScoresData:ws,handleSectionChange:Os,handleClassChange:qs,handleSubclassChange:Fs,handleAcademicYearChange:Ys,handleClassOrSubclassChange:cs,openQuestionsModal:s=>{$(s),U(!0),console.log("Opening questions modal for exam:",s._id)},openExamModal:(s=null)=>{var t,o,u,T;s?($(s),b({_id:s._id,name:s.name,description:s.description,subject:((t=s.subject)==null?void 0:t._id)||"",classLevel:s.classLevel,passMark:s.passMark,totalMark:s.totalMark,duration:s.duration,examDate:s.examDate?s.examDate.split("T")[0]:"",examTime:s.examTime,examType:s.examType,academicTerm:s.academicTerm,academicYear:s.academicYear,startDate:s.startDate?s.startDate.split("T")[0]:"",startTime:s.startTime||"",subclassLetter:s.subclassLetter||""})):($(null),b({name:"",description:"",subject:"",classLevel:n||"",passMark:"",totalMark:"",duration:"",examDate:"",examTime:"",examType:"test",academicTerm:((o=xe.find(Ce=>Ce.isCurrent))==null?void 0:o._id)||((u=xe[0])==null?void 0:u._id)||"",academicYear:f||((T=Te[0])==null?void 0:T._id)||"",startDate:"",startTime:"",subclassLetter:p||""})),i(!0),console.log("Opening exam modal, exam:",s)},handleQuestionInputChange:s=>{const{name:t,value:o}=s.target;a(u=>({...u,[t]:o})),console.log("Question input change:",t,o)},handleOptionChange:(s,t)=>{a(o=>{const u=[o.optionA,o.optionB,o.optionC,o.optionD];return u[s]=t,{...o,optionA:u[0],optionB:u[1],optionC:u[2],optionD:u[3]}}),console.log("Option change:",s,t)},handleAddQuestion:async()=>{const s={question:_.question,optionA:_.optionA,optionB:_.optionB,optionC:_.optionC,optionD:_.optionD,correctAnswer:_.correctAnswer,score:Number(_.score)};try{return await Ss(`${v.ADMIN_EXAM}/${g._id}/questions`,"POST",s),a({question:"",optionA:"",optionB:"",optionC:"",optionD:"",correctAnswer:"",score:""}),console.log("Question added"),Promise.resolve()}catch(t){throw console.error("Question add error:",t.message),new Error(t.message||"Failed to add question")}},handleUpdateQuestion:async(s,t)=>{try{return await As(`${v.ADMIN_EXAM}/${g._id}/questions/${s}`,"PATCH",{question:t.question,optionA:t.optionA,optionB:t.optionB,optionC:t.optionC,optionD:t.optionD,correctAnswer:t.correctAnswer,score:Number(t.score)}),console.log("Question updated:",s),Promise.resolve()}catch(o){throw console.error("Question update error:",o.message),new Error(o.message||"Failed to update question")}},handleDeleteQuestion:async s=>{try{return await Ms(`${v.ADMIN_EXAM}/${g._id}/questions/${s}`,"DELETE"),X(!1),console.log("Question deleted:",s),Promise.resolve()}catch(t){throw E(t.message||"Failed to delete question"),X(!1),console.error("Question delete error:",t.message),new Error(t.message)}},handleApproveExam:$s,handleExamInputChange:s=>{const{name:t,value:o}=s.target;b(u=>({...u,[t]:o})),console.log("Exam input change:",t,o),(t==="classLevel"||t==="subclassLetter")&&cs(t==="classLevel"?o:l.classLevel,t==="subclassLetter"?o:l.subclassLetter)},handleSaveExam:async()=>{var T,Ce,ds;const s=Number(l.totalMark),t=Number(l.passMark),o=Number(l.duration),u={name:l.name,description:l.description,subject:l.subject,classLevel:l.classLevel,passMark:t,totalMark:s,duration:o,examDate:l.examDate,examTime:l.examTime,examType:l.examType,academicTerm:l.academicTerm,academicYear:l.academicYear,startDate:l.startDate||null,startTime:l.startTime||null,subclassLetter:l.subclassLetter||null,createdBy:M};try{return g?(await ps(`${v.ADMIN_EXAM}/${g._id}`,"PATCH",u),console.log("Exam updated:",g._id)):(await us(v.ADMIN_EXAM,"POST",u),console.log("Exam created")),i(!1),b({name:"",description:"",subject:"",classLevel:n||"",passMark:"",totalMark:"",duration:"",examDate:"",examTime:"",examType:"test",academicTerm:((T=xe.find(Le=>Le.isCurrent))==null?void 0:T._id)||((Ce=xe[0])==null?void 0:Ce._id)||"",academicYear:f||((ds=Te[0])==null?void 0:ds._id)||"",startDate:"",startTime:"",subclassLetter:p||""}),$(null),Promise.resolve()}catch(Le){throw console.error("Exam save error:",Le.message),new Error(Le.message||"Failed to save exam")}},handleDeleteExam:async s=>{try{return await xs(`${v.ADMIN_EXAM}/${s}`,"DELETE"),X(!1),console.log("Exam deleted:",s),Promise.resolve()}catch(t){throw E(t.message||"Failed to delete exam"),X(!1),console.error("Exam delete error:",t.message),new Error(t.message)}},setQuestionsModalOpen:U,setExamModalOpen:i,setDeleteConfirmModalOpen:X,setApproveConfirmModalOpen:L,setSuccessModalOpen:O,setScoreMismatchModalOpen:K}},Xs=({open:M,onClose:w,selectedExam:d,questions:n,newQuestion:S,handleQuestionInputChange:p,handleOptionChange:W,handleAddQuestion:f,handleUpdateQuestion:J,handleDeleteQuestion:Se,getTestScoresData:U,colors:m})=>{const[i,N]=r.useState(null),[X,Q]=r.useState(""),[L,me]=r.useState(!1),[O,V]=r.useState(null),[K,pe]=r.useState(!1),[G,Me]=r.useState(""),be=a=>{V(a),me(!0)},Ee=()=>{O&&(Se(O),me(!1),V(null))},z=()=>{if(!i.question||!i.optionA||!i.optionB||!i.optionC||!i.optionD||!i.correctAnswer||!i.score){Q("Please fill all question fields, including score");return}const a=Number(i.score);if(a<=0){Q("Score must be greater than zero");return}if(n.filter(b=>b._id!==i._id).reduce((b,Z)=>b+(Number(Z.score)||0),0)+a>d.totalMark){Q("Total score for questions cannot exceed exam’s total mark");return}if(![i.optionA,i.optionB,i.optionC,i.optionD].includes(i.correctAnswer)){Q("Correct answer must match one of the provided options");return}J(i._id,{question:i.question,optionA:i.optionA,optionB:i.optionB,optionC:i.optionC,optionD:i.optionD,correctAnswer:i.correctAnswer,score:a}).then(()=>{pe(!0),Me("Question updated successfully"),N(null),Q("")})},g=()=>{N(null),Q("")},$=n.reduce((a,l)=>a+(Number(l.score)||0),0),q=d?d.totalMark-$:0,he=n.map((a,l)=>({id:a._id,sn:l+1,_id:a._id,question:a.question,correctAnswer:a.correctAnswer,score:a.score,optionA:a.optionA,optionB:a.optionB,optionC:a.optionC,optionD:a.optionD}));console.log("AdminQuestionsModal - Questions Data:",he);const _=d?U(d).map((a,l)=>({id:a._id,sn:l+1,studentName:a.studentName,score:a.score,date:a.date})):[];return console.log("AdminQuestionsModal - Test Scores Data:",_),e.jsx(ue,{open:M,onClose:()=>{w(),N(null),Q(""),pe(!1)},title:d?`Manage Questions for ${d.name}`:"Manage Questions",noConfirm:!0,children:e.jsxs(k,{sx:{p:2},children:[X&&e.jsx(c,{color:"error",sx:{mb:2},children:X}),d&&e.jsxs(c,{sx:{mb:2,color:"#000"},children:["Total Marks: ",d.totalMark," | Current Total: ",$," | Remaining:"," ",q]}),e.jsx(c,{variant:"h6",sx:{mb:2,color:"#000"},children:"Add New Question"}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Question",name:"question",value:S.question,onChange:p,variant:"outlined"})}),["optionA","optionB","optionC","optionD"].map((a,l)=>e.jsx(j,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,label:`Option ${l+1}`,value:S[a],onChange:b=>W(l,b.target.value),variant:"outlined"})},l)),e.jsx(j,{item:!0,xs:6,children:e.jsxs(Y,{fullWidth:!0,children:[e.jsx(B,{children:"Correct Answer"}),e.jsxs(P,{name:"correctAnswer",value:S.correctAnswer,onChange:p,label:"Correct Answer",children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select correct answer"})}),[S.optionA,S.optionB,S.optionC,S.optionD].map((a,l)=>e.jsx(C,{value:a,disabled:!a,children:a||`Option ${l+1}`},l))]})]})}),e.jsx(j,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,label:"Score",name:"score",type:"number",value:S.score,onChange:p,variant:"outlined",inputProps:{min:1,max:q}})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(R,{variant:"contained",color:"primary",onClick:f,children:"Add Question"})})]}),i&&e.jsxs(k,{sx:{mt:4},children:[e.jsx(c,{variant:"h6",sx:{mb:2,color:"#000"},children:"Edit Question"}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Question",value:i.question||"",onChange:a=>N({...i,question:a.target.value}),variant:"outlined"})}),["optionA","optionB","optionC","optionD"].map((a,l)=>e.jsx(j,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,label:`Option ${l+1}`,value:i[a]||"",onChange:b=>N({...i,[a]:b.target.value}),variant:"outlined"})},l)),e.jsx(j,{item:!0,xs:6,children:e.jsxs(Y,{fullWidth:!0,children:[e.jsx(B,{children:"Correct Answer"}),e.jsxs(P,{value:i.correctAnswer||"",onChange:a=>N({...i,correctAnswer:a.target.value}),label:"Correct Answer",children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select correct answer"})}),[i.optionA,i.optionB,i.optionC,i.optionD].map((a,l)=>e.jsx(C,{value:a,disabled:!a,children:a||`Option ${l+1}`},l))]})]})}),e.jsx(j,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,label:"Score",type:"number",value:i.score||"",onChange:a=>N({...i,score:a.target.value}),variant:"outlined",inputProps:{min:1,max:q+(Number(i.score)||0)}})}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx(R,{variant:"contained",color:"primary",onClick:z,children:"Save Changes"}),e.jsx(R,{variant:"outlined",color:"secondary",onClick:g,sx:{ml:2},children:"Cancel"})]})]})]}),e.jsx(Ge,{title:"Existing Questions",details:e.jsxs(k,{sx:{p:2,minHeight:"100px"},children:[e.jsx(c,{variant:"h6",sx:{mb:2,color:"#000"},children:"Questions"}),he.length>0?he.map(a=>{var l,b;return e.jsxs(k,{sx:{mb:2,p:2,border:`1px solid ${((l=m==null?void 0:m.primary)==null?void 0:l[200])||"#ccc"}`,borderRadius:"4px",backgroundColor:((b=m==null?void 0:m.primary)==null?void 0:b[400])||"#f5f5f5",color:"#000"},children:[e.jsxs(c,{children:[e.jsx("strong",{children:"S/N:"})," ",a.sn]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Question:"})," ",a.question]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Option A:"})," ",a.optionA]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Option B:"})," ",a.optionB]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Option C:"})," ",a.optionC]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Option D:"})," ",a.optionD]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Correct Answer:"})," ",a.correctAnswer]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Score:"})," ",a.score]}),e.jsxs(k,{display:"flex",gap:"10px",sx:{mt:1},children:[e.jsx(R,{variant:"contained",color:"secondary",size:"small",onClick:()=>N(a),children:"Edit"}),e.jsx(R,{variant:"contained",color:"error",size:"small",onClick:()=>be(a._id),children:"Delete"})]})]},a._id)}):e.jsx(c,{color:"#000",children:"No questions available for this exam."})]}),colors:m,defaultExpanded:!0}),e.jsx(Ge,{title:"Test Scores",details:e.jsxs(k,{sx:{p:2,minHeight:"100px"},children:[e.jsx(c,{variant:"h6",sx:{mb:2,color:"#000"},children:"Scores"}),_.length>0?_.map(a=>{var l,b;return e.jsxs(k,{sx:{mb:2,p:2,border:`1px solid ${((l=m==null?void 0:m.primary)==null?void 0:l[200])||"#ccc"}`,borderRadius:"4px",backgroundColor:((b=m==null?void 0:m.primary)==null?void 0:b[400])||"#f5f5f5",color:"#000"},children:[e.jsxs(c,{children:[e.jsx("strong",{children:"S/N:"})," ",a.sn]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Student Name:"})," ",a.studentName]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Score:"})," ",a.score]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Date:"})," ",a.date]})]},a.id)}):e.jsx(c,{color:"#000",children:"No test scores available for this exam."})]}),colors:m,defaultExpanded:!0}),e.jsx(ue,{open:L,onClose:()=>me(!1),title:"Confirm Delete Question",confirmText:"Delete",onConfirm:Ee,showCancel:!0,cancelText:"Cancel",children:e.jsx(c,{children:"Are you sure you want to delete this question?"})}),e.jsx(ue,{open:K,onClose:()=>pe(!1),title:"Success",noConfirm:!0,children:e.jsx(c,{children:G})})]})})},Gs=({open:M,onClose:w,newExam:d,handleExamInputChange:n,handleSaveExam:S,classes:p,subjects:W,academicTerms:f,academicYears:J,colors:Se,isEditing:U})=>e.jsx(ue,{open:M,onClose:w,title:U?"Edit Exam":"Create New Exam",onConfirm:S,confirmText:U?"Save Changes":"Create Exam",showCancel:!0,cancelText:"Cancel",children:e.jsx(k,{children:e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Exam Name",name:"name",value:d.name,onChange:n,variant:"outlined",required:!0})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Description",name:"description",value:d.description,onChange:n,variant:"outlined",multiline:!0,rows:3,required:!0})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(Y,{fullWidth:!0,required:!0,children:[e.jsx(B,{children:"Class"}),e.jsxs(P,{name:"classLevel",value:d.classLevel,onChange:n,label:"Class",children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select a class"})}),p.map(m=>e.jsx(C,{value:m._id,children:m.displayName},m._id))]})]})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(Y,{fullWidth:!0,required:!0,children:[e.jsx(B,{children:"Subject"}),e.jsxs(P,{name:"subject",value:d.subject,onChange:n,label:"Subject",children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select a subject"})}),W.map(m=>e.jsx(C,{value:m._id,children:m.name},m._id))]})]})}),e.jsx(j,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,label:"Pass Mark",name:"passMark",type:"number",value:d.passMark,onChange:n,variant:"outlined",required:!0,inputProps:{max:d.totalMark||100,min:0}})}),e.jsx(j,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,label:"Total Mark",name:"totalMark",type:"number",value:d.totalMark,onChange:n,variant:"outlined",required:!0,inputProps:{max:100,min:0}})}),e.jsx(j,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,label:"Duration (minutes)",name:"duration",type:"number",value:d.duration,onChange:n,variant:"outlined",required:!0,inputProps:{min:1}})}),e.jsx(j,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,label:"Exam Date",name:"examDate",type:"date",value:d.examDate,onChange:n,variant:"outlined",InputLabelProps:{shrink:!0},required:!0})}),e.jsx(j,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,label:"Exam Time",name:"examTime",type:"time",value:d.examTime,onChange:n,variant:"outlined",InputLabelProps:{shrink:!0},required:!0})}),e.jsx(j,{item:!0,xs:6,children:e.jsxs(Y,{fullWidth:!0,required:!0,children:[e.jsx(B,{children:"Exam Type"}),e.jsxs(P,{name:"examType",value:d.examType,onChange:n,label:"Exam Type",children:[e.jsx(C,{value:"test",children:"Test"}),e.jsx(C,{value:"exam",children:"Exam"})]})]})}),e.jsx(j,{item:!0,xs:6,children:e.jsxs(Y,{fullWidth:!0,required:!0,children:[e.jsx(B,{children:"Academic Term"}),e.jsxs(P,{name:"academicTerm",value:d.academicTerm,onChange:n,label:"Academic Term",children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select a term"})}),f.length>0?f.map(m=>e.jsx(C,{value:m._id,children:m.name},m._id)):e.jsx(C,{value:"",disabled:!0,children:e.jsx("em",{children:"No academic terms available"})})]})]})}),e.jsx(j,{item:!0,xs:6,children:e.jsxs(Y,{fullWidth:!0,required:!0,children:[e.jsx(B,{children:"Academic Year"}),e.jsxs(P,{name:"academicYear",value:d.academicYear,onChange:n,label:"Academic Year",children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select a year"})}),J.map(m=>e.jsx(C,{value:m._id,children:m.name},m._id))]})]})})]})})}),Rs=({open:M,onClose:w,onConfirm:d,message:n,approveExamData:S,handleApproveInputChange:p})=>e.jsx(ue,{open:M,onClose:w,title:"Approve Exam",confirmText:"Approve",onConfirm:d,showCancel:!0,cancelText:"Cancel",children:e.jsxs(k,{children:[e.jsx(c,{sx:{mb:2,color:"#000"},children:n}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Start Date",name:"startDate",type:"date",value:S.startDate,onChange:p,variant:"outlined",InputLabelProps:{shrink:!0},required:!0})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Start Time",name:"startTime",type:"time",value:S.startTime,onChange:p,variant:"outlined",InputLabelProps:{shrink:!0},required:!0})})]})]})}),jt=()=>{var A;const M=Bs(h=>{var H;return(H=h.users)==null?void 0:H.user._id}),{selectedSection:w,selectedClass:d,subclassLetter:n,selectedAcademicYear:S,questionsModalOpen:p,examModalOpen:W,approveConfirmModalOpen:f,successModalOpen:J,scoreMismatchModalOpen:Se,confirmationMessage:U,confirmationAction:m,selectedExam:i,questions:N,newQuestion:X,newExam:Q,exams:L,academicTerms:me,academicYears:O,classes:V,error:K,approveExamData:pe,handleApproveInputChange:G,scoreMismatchMessage:Me,getSections:be,getClassesForSection:Ee,getSubjectsForClass:z,getExamsForSubject:g,getTestScoresData:$,handleSectionChange:q,handleClassChange:he,handleSubclassChange:_,handleAcademicYearChange:a,openQuestionsModal:l,openExamModal:b,handleQuestionInputChange:Z,handleOptionChange:ee,handleAddQuestion:xe,handleUpdateQuestion:Oe,handleDeleteQuestion:Te,handleApproveExam:qe,handleExamInputChange:ge,handleSaveExam:Fe,handleDeleteExam:se,setQuestionsModalOpen:te,setExamModalOpen:Ye,setApproveConfirmModalOpen:ae,setSuccessModalOpen:De,setScoreMismatchModalOpen:Be}=Us({userId:M}),Pe=Ws(),E=Ps(Pe.palette.mode),[F,je]=r.useState(!1),[re,_e]=r.useState(null),$e=h=>{_e(h),je(!0)},ke=()=>{re&&(se(re),je(!1),_e(null))};return console.log("AdminExamManagement - User ID:",M),console.log("AdminExamManagement - Exams:",L),console.log("AdminExamManagement - Selected Class:",d),console.log("AdminExamManagement - Subjects:",z(d)),console.log("AdminExamManagement - Subclass Letter:",n),console.log("AdminExamManagement - Academic Year:",S),console.log("AdminExamManagement - Classes:",V),console.log("AdminExamManagement - Colors:",E),e.jsxs(k,{m:"20px",children:[e.jsx(c,{variant:"h4",sx:{mb:2,color:"#000"},children:"Admin Exam Management"}),K&&e.jsx(c,{color:"error",sx:{mb:2},children:K}),e.jsxs(Y,{sx:{minWidth:200,mb:2},children:[e.jsx(B,{children:"Select Academic Year"}),e.jsxs(P,{value:S,onChange:a,children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select an academic year"})}),O.map(h=>e.jsx(C,{value:h._id,children:h.name},h._id))]})]}),e.jsxs(Y,{sx:{minWidth:200,mb:2,ml:2},children:[e.jsx(B,{children:"Select Section"}),e.jsxs(P,{value:w,onChange:q,children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select a section"})}),be().map(h=>e.jsx(C,{value:h,children:h},h))]})]}),w&&e.jsxs(Y,{sx:{minWidth:200,mb:2,ml:2},children:[e.jsx(B,{children:"Select Class"}),e.jsxs(P,{value:d,onChange:he,children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select a class"})}),Ee(w).map(h=>e.jsx(C,{value:h._id,children:h.displayName},h._id))]})]}),d&&e.jsxs(Y,{sx:{minWidth:200,mb:2,ml:2},children:[e.jsx(B,{children:"Select Subclass"}),e.jsxs(P,{value:n,onChange:_,children:[e.jsx(C,{value:"",children:e.jsx("em",{children:"Select a subclass"})}),(((A=V.find(h=>h._id===d))==null?void 0:A.subclasses)||[]).map(h=>e.jsx(C,{value:h,children:h},h))]})]}),e.jsx(R,{variant:"contained",color:"primary",onClick:()=>b(),sx:{mb:2,ml:2},disabled:!d||!S,children:"Create New Exam"}),d&&S?z(d).length>0?z(d).map(h=>{const H=g(d,h._id);console.log(`Rendering accordion for subject ${h._id} (${h.name}):`,H);const I=H.map((x,We)=>({id:x._id,sn:We+1,_id:x._id,name:x.name,description:x.description,examType:x.examType,totalMark:x.totalMark,passMark:x.passMark,examStatus:x.examStatus}));return console.log(`Table data for subject ${h._id} (${h.name}):`,I),e.jsx(Ge,{title:h.name,colors:E,defaultExpanded:!1,details:e.jsxs(k,{sx:{p:2},children:[e.jsxs(c,{variant:"h6",sx:{mb:2,color:"#000"},children:["Exams for ",h.name,n?` (${n})`:""]}),I.length>0?I.map(x=>e.jsxs(k,{sx:{mb:2,p:2,border:`1px solid ${E.primary[200]}`,borderRadius:"4px",backgroundColor:E.primary[400],color:"#000"},children:[e.jsxs(c,{children:[e.jsx("strong",{children:"S/N:"})," ",x.sn]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Exam Name:"})," ",x.name]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Description:"})," ",x.description]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Type:"})," ",x.examType]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Total Mark:"})," ",x.totalMark]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Pass Mark:"})," ",x.passMark]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Status:"})," ",x.examStatus]}),e.jsxs(k,{display:"flex",gap:"10px",sx:{mt:1},children:[e.jsx(R,{variant:"contained",color:"primary",size:"small",onClick:()=>l(x),disabled:x.examStatus==="approved",children:"Manage Questions"}),e.jsxs(e.Fragment,{children:[e.jsx(R,{variant:"contained",color:"secondary",size:"small",onClick:()=>b(x),children:"Edit"}),e.jsx(R,{variant:"contained",color:"error",size:"small",onClick:()=>$e(x._id),children:"Delete"}),x.examStatus==="approved"?e.jsx(c,{color:"success.main",children:"Exam has been approved"}):e.jsx(R,{variant:"contained",color:"success",size:"small",onClick:()=>qe(x._id),children:"Approve"})]})]})]},x._id)):e.jsxs(c,{color:"#000",children:["No exams available for ",h.name.name,n?` (${n})`:"","."]})]})},h._id)}):e.jsxs(c,{color:"#000",children:["No exams yet for this class",n?` (${n})`:"","."]}):e.jsx(c,{color:"#000",children:"Please select a class, subclass, and academic year to view exams"}),e.jsx(ue,{open:F,onClose:()=>je(!1),title:"Confirm Delete Exam",confirmText:"Delete",onConfirm:ke,showCancel:!0,cancelText:"Cancel",children:e.jsx(c,{children:"Are you sure you want to delete this exam?"})}),e.jsx(Rs,{open:f,onClose:()=>{ae(!1),setApproveExamData({startDate:"",startTime:""})},onConfirm:m,message:U,approveExamData:pe,handleApproveInputChange:G}),e.jsx(ue,{open:J,onClose:()=>De(!1),title:"Success",noConfirm:!0,children:e.jsx(c,{children:U})}),e.jsx(ue,{open:Se,onClose:()=>Be(!1),title:"Score Mismatch",noConfirm:!0,children:e.jsx(c,{children:Me})}),e.jsx(Xs,{open:p,onClose:()=>{te(!1),setSelectedExam(null)},selectedExam:i,questions:N,newQuestion:X,handleQuestionInputChange:Z,handleOptionChange:ee,handleAddQuestion:xe,handleUpdateQuestion:Oe,handleDeleteQuestion:Te,getTestScoresData:$,colors:E}),e.jsx(Gs,{open:W,onClose:()=>{Ye(!1),setSelectedExam(null)},newExam:Q,handleExamInputChange:ge,handleSaveExam:Fe,classes:V,subjects:z(d),academicTerms:me,academicYears:O,colors:E,isEditing:!!i})]})};export{jt as default};
