import{r as b,f as _,j as e,a as F}from"./index-CUx_BIfb.js";import{t as k}from"./modal-D-FEyCwe.js";import{H as J}from"./Header-C6ewtNOz.js";import{C as V}from"./accordion-Dz4OcIMH.js";import{w as B}from"./dasboardPagesContainer-MMQB9i4e.js";import{u as D}from"./useApi-B5A5LOF2.js";import{j as M,M as W,v as j,T as u,x as O,a1 as q,a2 as G,a3 as H}from"./TextField-CnJy6qLH.js";import{M as R}from"./MenuItem-Y8p8i8nN.js";import{C as z}from"./CircularProgress-BgN2WNYl.js";import"./IconButton-CSIbz2lV.js";import"./index-Ci-mqblD.js";import"./confirmationModal-C7esu7_Z.js";import"./index-Dn2bJmhV.js";import"./loadingButton-BcWtTSRw.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-BurnVOpP.js";const K=()=>{const{loading:g,error:l,callApi:s}=D(),[h,c]=b.useState([]),[A,$]=b.useState([]),[n,y]=b.useState({}),f=b.useRef(!0),{loading:S,error:I,callApi:C}=D(),w=b.useCallback(async(t,p)=>{var m;if(!t)return console.warn("No subjectId provided in getSubjectName"),"Unknown Subject";if(n[t])return console.log(`Returning cached subject name for ID ${t}: ${n[t]}`),n[t];try{console.log(`Fetching subject name from API for ID: ${t}`);const d=await C(`${_.SUBJECT_NAME}/${t}`,"GET");console.log(`Subject name API response for ID ${t}:`,JSON.stringify(d,null,2));const i=((m=d==null?void 0:d.data)==null?void 0:m.name)||"Unknown Subject";return p()&&(console.log(`Caching subject name for ID ${t}: ${i}`),y(x=>({...x,[t]:i}))),i}catch(d){return console.error(`Error fetching subject name for ID ${t}:`,d.message),console.error("Error details:",d),"Unknown Subject"}},[C,n]),T=async(t,p="")=>{try{const m=[`classLevelId=${t}`];p&&m.push(`subjectId=${p}`);const d=`${_.CURRICULUM}?${m.join("&")}`;console.log(`Fetching curricula with URL: ${d}`);const i=await s(d,"GET");if(i&&i.status==="success"&&f.current){console.log("Curricula API response:",JSON.stringify(i.data,null,2));const x=await Promise.all(i.data.map(async o=>{var E,L,U;const a=((E=o.subjectId)==null?void 0:E.name)||o.subjectId;console.log(`Processing curriculum ID ${o._id}, using subjectId: ${a}`);const N=await w(a,()=>f.current);return{_id:o._id,subject:N,subjectId:a,classLevel:((L=o.classLevelId)==null?void 0:L.name)||"Unknown Class",classLevelId:(U=o.classLevelId)==null?void 0:U._id,topics:o.topics.map((v,P)=>({_id:v._id||`topic_${P}`,topic:v.topic||"Untitled Topic",description:v.description||"No description available",resources:v.resources||[],isCompleted:v.isCompleted||!1})),completionRate:o.completionRate||0}}));console.log("Transformed curricula:",JSON.stringify(x,null,2)),c(x);const r=await Promise.all([...new Set(i.data.map(o=>{var a;return((a=o.subjectId)==null?void 0:a.name)||o.subjectId}))].filter(o=>o).map(async o=>({_id:o,name:await w(o,()=>f.current)})));console.log("Transformed subjects:",JSON.stringify(r,null,2)),$(r)}return i}catch(m){throw console.error("Error fetching curricula:",m.message),console.error("Error details:",m),new Error(m.message||"Failed to fetch curricula")}};return b.useEffect(()=>()=>{f.current=!1},[]),{loading:g||S,error:l||I,curricula:h,subjects:A,fetchCurricula:T,subjectNamesCache:n}},Q=({open:g,onClose:l,topic:s})=>{const h=M(),c=k(h.palette.mode);return e.jsx(W,{open:g,onClose:l,children:e.jsxs(j,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:c.primary[400],p:4,borderRadius:1},children:[e.jsx(u,{variant:"h6",sx:{mb:2,color:c.grey[100]},children:"Topic Details"}),e.jsxs(u,{variant:"body1",sx:{mb:1,color:c.grey[100]},children:[e.jsx("strong",{children:"Topic:"})," ",(s==null?void 0:s.topic)||"Untitled Topic"]}),e.jsxs(u,{variant:"body1",sx:{mb:1,color:c.grey[100]},children:[e.jsx("strong",{children:"Description:"})," ",(s==null?void 0:s.description)||"No description available"]}),e.jsxs(u,{variant:"body1",sx:{mb:1,color:c.blueAccent[200]},children:[e.jsx("strong",{children:"Resources:"})," ",Array.isArray(s==null?void 0:s.resources)?s.resources.join(", "):"No resources available"]}),e.jsxs(u,{variant:"body1",sx:{mb:2,color:s!=null&&s.isCompleted?c.greenAccent[500]:c.redAccent[500]},children:[e.jsx("strong",{children:"Status:"})," ",s!=null&&s.isCompleted?"Completed":"Not Completed"]}),e.jsx(j,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(O,{variant:"contained",onClick:l,sx:{bgcolor:c.blueAccent[700]},children:"Close"})})]})})},X=()=>{var i,x;const g=M(),l=k(g.palette.mode),{loading:s,error:h,curricula:c,subjects:A,fetchCurricula:$}=K(),{user:n}=F(r=>r.users),y=n==null?void 0:n.classLevelId,f=((i=n==null?void 0:n.currentClassLevel)==null?void 0:i.className)||"Unknown Class",S=((x=n==null?void 0:n.currentClassLevel)==null?void 0:x.subclass)||"",[I,C]=b.useState(!1),[w,T]=b.useState(null),[t,p]=b.useState({subjectId:""});b.useEffect(()=>{y&&$(y,t.subjectId)},[y,t.subjectId]);const m=r=>{p({subjectId:r.target.value})},d=r=>{T(r),C(!0)};return e.jsxs(j,{sx:{p:3},children:[e.jsx(J,{title:"Curriculum Overview",subtitle:`Explore the curriculum for ${f}${S?` (${S})`:""}`}),e.jsx(j,{sx:{display:"flex",mb:2},children:e.jsxs(q,{sx:{minWidth:200},children:[e.jsx(G,{children:"Subject"}),e.jsxs(H,{name:"subjectId",value:t.subjectId,onChange:m,children:[e.jsx(R,{value:"",children:"All Subjects"}),A.map(r=>e.jsx(R,{value:r._id,children:r.name||"Unknown Subject"},r._id))]})]})}),s?e.jsx(j,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(z,{color:"primary"})}):h?e.jsx(u,{variant:"body1",color:l.redAccent[500],sx:{mt:2},children:h}):c.length>0?c.map((r,o)=>e.jsxs(j,{sx:{mb:4},children:[e.jsx(u,{variant:"h2",sx:{color:l.blueAccent[200],mb:2,fontWeight:"bold"},children:r.subject}),r.topics.length>0?r.topics.map((a,N)=>e.jsx(j,{sx:{mb:1},children:e.jsx(V,{title:`${N+1}. ${a.topic}`,details:e.jsxs(j,{children:[e.jsx(u,{variant:"body1",color:l.grey[100],sx:{mb:1},children:a.description||"No description available"}),e.jsxs(u,{variant:"body1",sx:{color:l.blueAccent[200],mb:1},children:["Resources:"," ",Array.isArray(a.resources)?a.resources.join(", "):"No resources available"]}),e.jsxs(u,{variant:"body1",sx:{color:a.isCompleted?l.greenAccent[500]:l.redAccent[500],mb:1},children:["Status: ",a.isCompleted?"Completed":"Not Completed"]}),e.jsx(O,{onClick:()=>d(a),sx:{color:l.blueAccent[200]},children:"View Details"})]}),defaultExpanded:!1})},a._id||N)):e.jsxs(u,{variant:"body1",color:l.grey[100],children:["No topics available for ",r.subject,"."]})]},r._id||o)):e.jsx(u,{variant:"body1",color:l.grey[100],children:"No curriculum available for your class."}),e.jsx(Q,{open:I,onClose:()=>C(!1),topic:w})]})},je=B(X);export{je as default};
