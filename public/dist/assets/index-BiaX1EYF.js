import{r as x,a as Oe,e as _,j as O,i as Be}from"./index-CmongNqj.js";import{u as Ee}from"./useApi-DRHDw2QR.js";import{u as Pe,M as je}from"./MenuItem-CBa9F7RL.js";import{A as Fe,C as Ie}from"./confirmationModal-DmU1e-AI.js";import{t as Me}from"./modal-DOkj5b5S.js";import{j as Te,v as be,T as $e,a1 as Re,a2 as Ve,a3 as _e,y as Ge}from"./TextField-BRCl01nD.js";import{A as ye}from"./Alert-odNfgFZz.js";const ge=r=>/^[0-9a-fA-F]{24}$/.test(r),He=({role:r,selectedUser:t})=>{var k,E,U,ie,pe,fe,he,ve,Le,Ae,Ne,Se,Ce,qe,De;const[ee,N]=x.useState(""),{error:oe,callApi:R}=Ee(),[se,ae]=x.useState(!1),[Z,te]=x.useState(""),[B,D]=x.useState(!1);Pe();const J=Oe(d=>{var l;return(l=d.auth)==null?void 0:l.user}),[f,ue]=x.useState([]),[G,K]=x.useState([]),[H,w]=x.useState([]),[X,W]=x.useState([]),[ne,le]=x.useState([]),[e,v]=x.useState({}),[c,S]=x.useState(null),T=x.useRef(null);x.useEffect(()=>{(async()=>{try{const l=await R(`${_.CLASS_LEVEL}/sign-up-data`,"GET");l.status==="success"?(console.log("ClassLevelData fetched:",l.data),ue(l.data)):N(l.message||"Failed to fetch class level data")}catch(l){console.error("Error fetching class level data:",l),N("Failed to load class level data. Please try again.")}})()},[R]),x.useEffect(()=>{if(f.length===0){console.log("ClassLevelData not loaded yet"),K([]);return}const d=f.map(l=>({value:l.section,label:l.section}));K(d),console.log("Updated sections:",d)},[f]),x.useEffect(()=>{if(f.length===0){console.log("ClassLevelData not loaded yet for formData");return}console.log("Initializing formData with classLevelData:",f);const d=Y(r,t);v(d)},[r,t,f]),x.useEffect(()=>{var a,j,p,i;if(f.length===0){w([]),console.log("Cleared classLevelOptions: classLevelData empty");return}const d=r==="student"?(a=e.currentClassLevel)==null?void 0:a.section:(p=(j=e.teachingAssignments)==null?void 0:j[0])==null?void 0:p.section;if(!d){w([]),console.log("Cleared classLevelOptions: No section selected");return}const l=((i=f.find(o=>o.section===d))==null?void 0:i.classNames.map(o=>({value:o.classLevel,label:o.name})))||[];w(l),console.log("Updated classLevelOptions for section",d,":",l),v(o=>{var h,g,C,q,u,A;if(r==="student"){const b=((h=o.currentClassLevel)==null?void 0:h.classLevel)||"";if(!l.some(s=>s.value===b)&&l.length>0&&!t)return{...o,currentClassLevel:{...o.currentClassLevel,classLevel:((g=l[0])==null?void 0:g.value)||"",subclass:""}}}else if(r==="teacher"){const b=((q=(C=o.teachingAssignments)==null?void 0:C[0])==null?void 0:q.classLevel)||"";if(!l.some(s=>s.value===b)&&l.length>0&&!t)return{...o,teachingAssignments:[{...(u=o.teachingAssignments)==null?void 0:u[0],classLevel:((A=l[0])==null?void 0:A.value)||"",subclasses:[""],subject:""}]}}return o})},[(k=e.currentClassLevel)==null?void 0:k.section,(U=(E=e.teachingAssignments)==null?void 0:E[0])==null?void 0:U.section,f,r,t]),x.useEffect(()=>{var j,p,i,o,h,g,C,q;if(f.length===0){W([]),console.log("Cleared subclassOptions: classLevelData empty");return}const d=r==="student"?(j=e.currentClassLevel)==null?void 0:j.section:(i=(p=e.teachingAssignments)==null?void 0:p[0])==null?void 0:i.section,l=r==="student"?(o=e.currentClassLevel)==null?void 0:o.classLevel:(g=(h=e.teachingAssignments)==null?void 0:h[0])==null?void 0:g.classLevel;if(!d||!l){W([]),console.log("Cleared subclassOptions: No section or classLevel selected");return}const a=((q=(C=f.find(u=>u.section===d))==null?void 0:C.classNames.find(u=>u.classLevel===l))==null?void 0:q.subclasses.map(u=>({value:u.letter,label:u.letter})))||[];W(a),console.log("Updated subclassOptions for classLevel",l,":",a),v(u=>{var A,b,y,s,L,P,F;if(r==="student"){const I=((A=u.currentClassLevel)==null?void 0:A.subclass)||"";if(!a.some(M=>M.value===I)&&a.length>0&&!t)return{...u,currentClassLevel:{...u.currentClassLevel,subclass:((b=a[0])==null?void 0:b.value)||""}}}else if(r==="teacher"){const I=((L=(s=(y=u.teachingAssignments)==null?void 0:y[0])==null?void 0:s.subclasses)==null?void 0:L[0])||"";if(!a.some(M=>M.value===I)&&a.length>0&&!t)return{...u,teachingAssignments:[{...(P=u.teachingAssignments)==null?void 0:P[0],subclasses:[((F=a[0])==null?void 0:F.value)||""],subject:""}]}}return u})},[(ie=e.currentClassLevel)==null?void 0:ie.classLevel,(fe=(pe=e.teachingAssignments)==null?void 0:pe[0])==null?void 0:fe.classLevel,(he=e.currentClassLevel)==null?void 0:he.section,(Le=(ve=e.teachingAssignments)==null?void 0:ve[0])==null?void 0:Le.section,f,r,t]),x.useEffect(()=>{var o,h,g,C,q,u,A,b,y;if(r!=="teacher"||f.length===0||!((h=(o=e.teachingAssignments)==null?void 0:o[0])!=null&&h.section)||!((C=(g=e.teachingAssignments)==null?void 0:g[0])!=null&&C.classLevel)||!((A=(u=(q=e.teachingAssignments)==null?void 0:q[0])==null?void 0:u.subclasses)!=null&&A[0])){le([]),console.log("Cleared subjectOptions: Not teacher or missing section/classLevel/subclass");return}const d=e.teachingAssignments[0].section,l=e.teachingAssignments[0].classLevel,a=e.teachingAssignments[0].subclasses[0],j=(y=(b=f.find(s=>s.section===d))==null?void 0:b.classNames.find(s=>s.classLevel===l))==null?void 0:y.subclasses.find(s=>s.letter===a),i=((j==null?void 0:j.subjects)||[]).map(s=>({value:s._id.toString(),label:s.name}));le(i),console.log("Updated subjectOptions for section:",d,"classLevel:",l,"subclass:",a,"subjects:",i),r==="teacher"&&!t&&v(s=>{var F,I,V,M;const L=((I=(F=s.teachingAssignments)==null?void 0:F[0])==null?void 0:I.subject)||"";return!i.some(re=>re.value===L)&&i.length>0?{...s,teachingAssignments:[{...(V=s.teachingAssignments)==null?void 0:V[0],subject:((M=i[0])==null?void 0:M.value)||""}]}:s})},[(Ne=(Ae=e.teachingAssignments)==null?void 0:Ae[0])==null?void 0:Ne.subclasses,(Ce=(Se=e.teachingAssignments)==null?void 0:Se[0])==null?void 0:Ce.classLevel,(De=(qe=e.teachingAssignments)==null?void 0:qe[0])==null?void 0:De.section,f,r,t]);const Y=(d,l)=>{var j,p,i,o,h,g,C,q,u,A,b,y;const a={};if(!z[d])return console.error("Invalid role:",d),a;if(l&&ge(l._id)){console.log("Using selectedUser data:",l);const s=l;return a.firstName=s.firstName||"",a.lastName=s.lastName||"",a.middleName=s.middleName||"",a.email=s.email||"",a.gender=s.gender||"",a.NIN=s.NIN||"",a.tribe=s.tribe||"",a.religion=s.religion||"",a.formalSchool=s.formalSchool||"",a.boardingStatus=s.boardingStatus||"Day Student",a.profilePicture="",a.profilePictureUrl=s.profilePictureUrl||"",d==="student"?(a.currentClassLevel={section:((j=s.currentClassLevel)==null?void 0:j.section)||"",classLevel:((p=s.currentClassLevel)==null?void 0:p.classLevel)||"",subclass:((i=s.currentClassLevel)==null?void 0:i.subclass)||""},a.boardingDetails=s.boardingStatus==="Boarder"?{hall:((o=s.boardingDetails)==null?void 0:o.hall)||"",roomNumber:((h=s.boardingDetails)==null?void 0:h.roomNumber)||"",bedNumber:((g=s.boardingDetails)==null?void 0:g.bedNumber)||"",houseMaster:((C=s.boardingDetails)==null?void 0:C.houseMaster)||""}:void 0,a.guardians=(q=s.guardians)!=null&&q.length?[{name:s.guardians[0].name||"",relationship:s.guardians[0].relationship||"",phone:s.guardians[0].phone||"",email:s.guardians[0].email||"",address:s.guardians[0].address||""}]:[{}]):d==="teacher"&&(a.address=s.address||"",a.qualification=s.qualification||"",a.phoneNumber=s.phoneNumber||"",a.tribe=s.tribe||"",a.religion=s.religion||"",a.bankAccountDetails=s.bankAccountDetails?{accountName:s.bankAccountDetails.accountName||"",accountNumber:s.bankAccountDetails.accountNumber||"",bank:s.bankAccountDetails.bank||""}:{},a.teachingAssignments=(u=s.teachingAssignments)!=null&&u.length?[{section:s.teachingAssignments[0].section||"",classLevel:s.teachingAssignments[0].classLevel||"",subclasses:s.teachingAssignments[0].subclasses||[""],subject:((A=s.teachingAssignments[0].subject)==null?void 0:A._id.toString())||""}]:[{}],a.linkedInProfile=s.linkedInProfile||""),console.log("getInitialFormData result (selectedUser):",a),a}if(z[d].forEach(s=>{if(s.name.includes("currentClassLevel")||s.name.includes("guardians")||s.name.includes("bankAccountDetails")||s.name.includes("teachingAssignments")){const[L,P,F]=s.name.split(/\.|\[|\]/).filter(Boolean);L==="guardians"||L==="teachingAssignments"?(a[L]=a[L]||[{}],a[L][0][P]=""):(a[L]=a[L]||{},a[L][P]="")}else a[s.name]=(s.type==="select","")}),d==="student"&&f.length>0){const s=f.map(L=>({value:L.section,label:L.section}));a.currentClassLevel={section:((b=s[0])==null?void 0:b.value)||"",classLevel:"",subclass:""},a.boardingStatus="Day Student"}else if(d==="teacher"&&f.length>0){const s=f.map(L=>({value:L.section,label:L.section}));a.teachingAssignments=[{section:((y=s[0])==null?void 0:y.value)||"",classLevel:"",subclasses:[""],subject:""}]}else d==="admin"&&(a.firstName="",a.lastName="",a.email="");return console.log("getInitialFormData result (new user):",a),a},z={student:[{label:"First Name",name:"firstName",type:"text",required:!t},{label:"Last Name",name:"lastName",type:"text",required:!t},{label:"Middle Name",name:"middleName",type:"text",required:!1},{label:"Email",name:"email",type:"email",required:!t},{label:"Profile Picture",name:"profilePicture",type:"file",required:!t},{label:"Gender",name:"gender",type:"select",required:!t,options:[{value:"Male",label:"Male"},{value:"Female",label:"Female"},{value:"Other",label:"Other"}]},{label:"NIN",name:"NIN",type:"text",required:!1},{label:"Tribe",name:"tribe",type:"text",required:!1},{label:"Religion",name:"religion",type:"text",required:!1},{label:"Formal School",name:"formalSchool",type:"text",required:!1},{label:"Class Section",name:"currentClassLevel.section",type:"select",required:!t,options:G},{label:"Class Level",name:"currentClassLevel.classLevel",type:"select",required:!t,options:H},{label:"Subclass",name:"currentClassLevel.subclass",type:"select",required:!t,options:X},{label:"Boarding Status",name:"boardingStatus",type:"select",required:!t,options:[{value:"Boarder",label:"Boarder"},{value:"Day Student",label:"Day Student"}]},{label:"Boarding Hall",name:"boardingDetails.hall",type:"text",required:!1},{label:"Room Number",name:"boardingDetails.roomNumber",type:"text",required:!1},{label:"Bed Number",name:"boardingDetails.bedNumber",type:"text",required:!1},{label:"House Master",name:"boardingDetails.houseMaster",type:"text",required:!1},{label:"Guardian Name",name:"guardians[0].name",type:"text",required:!t},{label:"Guardian Relationship",name:"guardians[0].relationship",type:"text",required:!t},{label:"Guardian Phone",name:"guardians[0].phone",type:"text",required:!t},{label:"Guardian Email",name:"guardians[0].email",type:"email",required:!1},{label:"Guardian Address",name:"guardians[0].address",type:"text",required:!1}].filter(Boolean),teacher:[{label:"First Name",name:"firstName",type:"text",required:!t},{label:"Last Name",name:"lastName",type:"text",required:!t},{label:"Middle Name",name:"middleName",type:"text",required:!1},{label:"Email",name:"email",type:"email",required:!t},{label:"Profile Picture",name:"profilePicture",type:"file",required:!t},{label:"Gender",name:"gender",type:"select",required:!t,options:[{value:"Male",label:"Male"},{value:"Female",label:"Female"},{value:"Other",label:"Other"}]},{label:"NIN",name:"NIN",type:"text",required:!t},{label:"Address",name:"address",type:"text",required:!t},{label:"Qualification",name:"qualification",type:"select",required:!t,options:[{value:"SSCE",label:"SSCE"},{value:"OND",label:"OND"},{value:"HND",label:"HND"},{value:"BSc",label:"BSc"},{value:"MBA",label:"MBA"},{value:"BTech",label:"BTech"},{value:"MSc",label:"MSc"},{value:"PhD",label:"PhD"},{value:"Other",label:"Other"}]},{label:"Phone Number",name:"phoneNumber",type:"tel",required:!t},{label:"Tribe",name:"tribe",type:"text",required:!t},{label:"Religion",name:"religion",type:"select",required:!t,options:[{value:"Christianity",label:"Christianity"},{value:"Islam",label:"Islam"},{value:"Hinduism",label:"Hinduism"},{value:"Buddhism",label:"Buddhism"},{value:"Atheism",label:"Atheism"},{value:"Other",label:"Other"}]},{label:"Teaching Section",name:"teachingAssignments[0].section",type:"select",required:!t,options:G},{label:"Teaching Class Level",name:"teachingAssignments[0].classLevel",type:"select",required:!t,options:H},{label:"Teaching Subclass",name:"teachingAssignments[0].subclasses[0]",type:"select",required:!t,options:X},{label:"Subclass Subject",name:"teachingAssignments[0].subject",type:"select",required:!1,options:ne},{label:"Bank Account Name",name:"bankAccountDetails.accountName",type:"text",required:!t},{label:"Bank Account Number",name:"bankAccountDetails.accountNumber",type:"text",required:!t},{label:"Bank Name",name:"bankAccountDetails.bank",type:"text",required:!t},{label:"LinkedIn Profile",name:"linkedInProfile",type:"text",required:!1}].filter(Boolean),admin:[{label:"First Name",name:"firstName",type:"text",required:!t},{label:"Last Name",name:"lastName",type:"text",required:!t},{label:"Email",name:"email",type:"email",required:!t},{label:"Profile Picture",name:"profilePicture",type:"file",required:!t}].filter(Boolean)};return{formRef:T,formData:e,error:ee,loading:B,handleChange:d=>{const{name:l,value:a,files:j}=d.target;if(l==="profilePicture")S(j[0]);else if(l.includes("currentClassLevel")){const[,p]=l.split(".");v(i=>{var h,g,C,q,u;const o={...i.currentClassLevel,[p]:a};if(p==="section"){const A=((h=f.find(b=>b.section===a))==null?void 0:h.classNames.map(b=>({value:b.classLevel,label:b.name})))||[];o.classLevel=((g=A[0])==null?void 0:g.value)||"",o.subclass=""}else if(p==="classLevel"){const A=((q=(C=f.find(b=>b.section===i.currentClassLevel.section))==null?void 0:C.classNames.find(b=>b.classLevel===a))==null?void 0:q.subclasses.map(b=>({value:b.letter,label:b.letter})))||[];o.subclass=((u=A[0])==null?void 0:u.value)||""}return{...i,currentClassLevel:o}})}else if(l.includes("teachingAssignments")){const[,p,i,o]=l.split(/\.|\[|\]/).filter(Boolean);v(h=>{var C,q,u,A,b;const g=[...h.teachingAssignments||[{}]];if(i==="subclasses"&&o==="0")g[0]={...g[0],subclasses:[a],subject:""};else if(i==="subject")g[0]={...g[0],subject:a};else if(i==="section"){const y=((C=f.find(s=>s.section===a))==null?void 0:C.classNames.map(s=>({value:s.classLevel,label:s.name})))||[];g[0]={...g[0],section:a,classLevel:((q=y[0])==null?void 0:q.value)||"",subclasses:[""],subject:""}}else if(i==="classLevel"){const y=((A=(u=f.find(s=>s.section===h.teachingAssignments[0].section))==null?void 0:u.classNames.find(s=>s.classLevel===a))==null?void 0:A.subclasses.map(s=>({value:s.letter,label:s.letter})))||[];g[0]={...g[0],classLevel:a,subclasses:[((b=y[0])==null?void 0:b.value)||""],subject:""}}else g[0]={...g[0],[i]:a};return{...h,teachingAssignments:g}})}else if(l.includes("boardingDetails")){const[,p]=l.split(".");v(i=>({...i,boardingDetails:{...i.boardingDetails,[p]:a}}))}else if(l.includes("guardians")){const[,p,i]=l.split(/\.|\[|\]/).filter(Boolean);v(o=>{const h=[...o.guardians||[{}]];return h[0]={...h[0],[i]:a},{...o,guardians:h}})}else if(l.includes("bankAccountDetails")){const[,p]=l.split(".");v(i=>({...i,bankAccountDetails:{...i.bankAccountDetails,[p]:a}}))}else v(l==="boardingStatus"?p=>({...p,boardingStatus:a,boardingDetails:a==="Boarder"?p.boardingDetails||{}:void 0}):p=>({...p,[l]:a}))},handleSubmit:async d=>{var l,a,j,p,i,o,h,g,C,q,u,A,b,y,s,L,P,F,I,V,M,re;if(d.preventDefault(),D(!0),N(""),r==="admin"&&(J==null?void 0:J.role)!=="superadmin"){N("Only superadmins can create or update admins."),D(!1);return}if(t&&!ge(t._id)){N("Invalid user ID format"),D(!1);return}if(!t){if(!e.firstName||!e.lastName||!e.email||!e.gender){N("First name, last name, email, and gender are required"),D(!1);return}if(r==="student"){if(!((l=e.currentClassLevel)!=null&&l.section)||!((a=e.currentClassLevel)!=null&&a.classLevel)||!((j=e.currentClassLevel)!=null&&j.subclass)){N("Class level section, class level, and subclass are required"),D(!1);return}if(!((i=(p=e.guardians)==null?void 0:p[0])!=null&&i.name)||!((h=(o=e.guardians)==null?void 0:o[0])!=null&&h.relationship)||!((C=(g=e.guardians)==null?void 0:g[0])!=null&&C.phone)){N("Guardian name, relationship, and phone are required"),D(!1);return}if(!["Boarder","Day Student"].includes(e.boardingStatus)){N("Boarding status must be 'Boarder' or 'Day Student'"),D(!1);return}if(e.boardingStatus==="Boarder"&&(!((q=e.boardingDetails)!=null&&q.hall)||!((u=e.boardingDetails)!=null&&u.roomNumber))){N("Boarding Hall and Room Number are required for Boarder students"),D(!1);return}}else if(r==="teacher"){if(!e.NIN||!e.address||!e.qualification||!e.phoneNumber||!e.tribe||!e.religion||!((A=e.bankAccountDetails)!=null&&A.accountName)||!((b=e.bankAccountDetails)!=null&&b.accountNumber)||!((y=e.bankAccountDetails)!=null&&y.bank)||!((L=(s=e.teachingAssignments)==null?void 0:s[0])!=null&&L.section)||!((F=(P=e.teachingAssignments)==null?void 0:P[0])!=null&&F.classLevel)||!((M=(V=(I=e.teachingAssignments)==null?void 0:I[0])==null?void 0:V.subclasses)!=null&&M.length)){N("All required teacher fields, including section, class level, and subclass, must be filled"),D(!1);return}if(!/^\d{11}$/.test(e.NIN)){N("NIN must be 11 digits"),D(!1);return}if(!/^\d{10}$/.test(e.bankAccountDetails.accountNumber)){N("Bank account number must be 10 digits"),D(!1);return}if(!e.teachingAssignments[0].subclasses.every(n=>/^[A-Z]$/.test(n))){N("Subclasses must be single uppercase letters"),D(!1);return}const m=f.find(n=>n.section===e.teachingAssignments[0].section),Q=m==null?void 0:m.classNames.find(n=>n.classLevel===e.teachingAssignments[0].classLevel);if(!Q){N("Invalid class level selection. Please select a valid class."),D(!1);return}if(!Q.subclasses.some(n=>n.letter===e.teachingAssignments[0].subclasses[0])){N("Invalid subclass selection. Please select a valid subclass."),D(!1);return}}else if(r==="admin"&&(!e.firstName||!e.lastName||!e.email)){N("First name, last name, and email are required for admins"),D(!1);return}if(!c){N("Profile picture is required"),D(!1);return}}try{const m=new FormData;Object.keys(e).forEach(n=>{var ce,xe;n==="currentClassLevel"&&e[n]?(m.append("currentClassLevel[section]",e[n].section||""),m.append("currentClassLevel[classLevel]",e[n].classLevel||""),m.append("currentClassLevel[subclass]",e[n].subclass||"")):n==="boardingDetails"&&e[n]&&e.boardingStatus==="Boarder"?(m.append("boardingDetails[hall]",e[n].hall||""),m.append("boardingDetails[roomNumber]",e[n].roomNumber||""),m.append("boardingDetails[bedNumber]",e[n].bedNumber||""),m.append("boardingDetails[houseMaster]",e[n].houseMaster||"")):n==="guardians"&&((ce=e[n])!=null&&ce.length)?(m.append("guardians[0][name]",e[n][0].name||""),m.append("guardians[0][relationship]",e[n][0].relationship||""),m.append("guardians[0][phone]",e[n][0].phone||""),m.append("guardians[0][email]",e[n][0].email||""),m.append("guardians[0][address]",e[n][0].address||"")):n==="bankAccountDetails"&&e[n]?(m.append("bankAccountDetails[accountName]",e[n].accountName||""),m.append("bankAccountDetails[accountNumber]",e[n].accountNumber||""),m.append("bankAccountDetails[bank]",e[n].bank||"")):n==="teachingAssignments"&&((xe=e[n])!=null&&xe.length)&&e[n][0].section?(m.append("section",e[n][0].section||""),m.append("classLevel",e[n][0].classLevel||""),m.append("subclassLetter",e[n][0].subclasses[0]||""),e[n][0].subject&&m.append("subject",e[n][0].subject)):n==="isWithdrawn"||n==="isSuspended"?m.append(n,e[n]==="true"):(n==="applicationStatus"&&e[n]||!t||e[n]&&e[n]!==""&&n!=="boardingDetails"&&n!=="profilePictureUrl")&&m.append(n,e[n])}),c&&m.append("profilePicture",c),console.log("Payload being sent:");for(let[n,ce]of m.entries())console.log(`${n}: ${ce}`);let Q;t&&ge(t._id)?Q=r==="student"?`${_.STUDENTS}/${t._id}`:r==="teacher"?`${_.TEACHERS}/update/${t._id}`:`${_.ADMINS}/${t._id}`:Q=r==="student"?_.CREATE_STUDENT:r==="teacher"?_.CREATE_TEACHER:_.CREATE_ADMIN;const $=await R(Q,t?"PATCH":"POST",m,{"Content-Type":"multipart/form-data"});$&&$.status==="success"?(te(`${$.data.firstName} ${$.data.lastName} has been successfully ${t?"updated":"registered"}`),v(Y(r,null)),S(null)):(console.log("Submit error:",oe),te(($==null?void 0:$.message)||"An error occurred")),ae(!0)}catch(m){console.error("Error submitting form:",m),N(((re=m.response)==null?void 0:re.message)||"Failed to submit the form. Please try again.")}finally{D(!1)}},roleFields:z,profilePicture:c,modalOpen:se,modalMessage:Z,setModalOpen:ae,subjectOptions:ne,classLevelOptions:H,subclassOptions:X,sections:G}},Xe=({role:r,selectedUser:t,studentReg:ee,offline:N})=>{const oe=Te();Me(oe.palette.mode);const{roleFields:R,error:se,loading:ae,handleChange:Z,handleSubmit:te,formData:B,formRef:D,modalOpen:J,modalMessage:f,setModalOpen:ue,subjectOptions:G,classLevelOptions:K,subclassOptions:H,sections:w}=He({role:r,selectedUser:t});console.log("SignUpForm - role:",r,"selectedUser:",t,"studentReg:",ee,"formData:",B,"subjectOptions:",G,"classLevelOptions:",K,"subclassOptions:",H,"sections:",w);const X=()=>{ue(!1)};if(ae||!B||Object.keys(B).length===0)return O.jsx(Be,{});if(!R[r])return O.jsx(ye,{severity:"error",children:"Invalid role specified"});const W=e=>{if(!B)return"";if(e.includes(".")){const v=e.split(/\.|\[|\]/).filter(Boolean);let c=B;for(const S of v)if(Array.isArray(c)&&S.match(/^\d+$/)?c=c[parseInt(S)]:c=c==null?void 0:c[S],c==null)return"";return c}return B[e]||""},ne=(e,v)=>{if(e==="currentClassLevel.section"||e==="teachingAssignments[0].section"){const c=w.find(S=>S.value===v);return c?c.label:""}else if(e==="currentClassLevel.classLevel"||e==="teachingAssignments[0].classLevel"){const c=K.find(S=>S.value===v);return c?c.label:""}else if(e==="currentClassLevel.subclass"||e==="teachingAssignments[0].subclasses[0]"){const c=H.find(S=>S.value===v);return c?c.label:""}else if(e==="teachingAssignments[0].subject"){const c=G.find(S=>S.value===v);return c?c.label:""}else if(e==="gender"||e==="qualification"||e==="religion"||e==="boardingStatus"){const c=R[r].find(T=>T.name===e),S=c==null?void 0:c.options.find(T=>T.value===v);return S?S.label:""}return v},le=R[r].filter(e=>r==="student"&&e.name.includes("boardingDetails")?B.boardingStatus==="Boarder":!0);return O.jsxs(be,{sx:{paddingBottom:ee&&"20px"},children:[O.jsxs($e,{variant:"h4",children:[t?"Update":"Sign Up"," (",r.charAt(0).toUpperCase()+r.slice(1),")"]}),O.jsxs("form",{onSubmit:te,ref:D,children:[le.map(e=>{var v,c,S,T,Y,z,me,de,k;return O.jsx(be,{mb:2,children:e.type==="select"?O.jsxs(Re,{fullWidth:!0,children:[O.jsx(Ve,{children:e.label}),O.jsxs(_e,{name:e.name,value:ne(e.name,W(e.name))||"",onChange:E=>{const U=e.options.find(ie=>ie.label===E.target.value);Z({target:{name:e.name,value:U?U.value:E.target.value}})},required:e.required,disabled:e.name==="currentClassLevel.classLevel"&&!((v=B.currentClassLevel)!=null&&v.section)||e.name==="currentClassLevel.subclass"&&!((c=B.currentClassLevel)!=null&&c.classLevel)||e.name==="teachingAssignments[0].classLevel"&&!((T=(S=B.teachingAssignments)==null?void 0:S[0])!=null&&T.section)||e.name==="teachingAssignments[0].subclasses[0]"&&!((z=(Y=B.teachingAssignments)==null?void 0:Y[0])!=null&&z.classLevel)||e.name==="teachingAssignments[0].subject"&&!((k=(de=(me=B.teachingAssignments)==null?void 0:me[0])==null?void 0:de.subclasses)!=null&&k[0]),children:[!e.required&&O.jsx(je,{value:"",children:"None"}),e.options.map(E=>O.jsx(je,{value:E.label,children:E.label},E.value))]})]}):e.type==="file"?O.jsx(be,{children:O.jsx("input",{type:"file",name:e.name,id:e.name,onChange:Z,required:e.required,accept:"image/*",style:{display:"block",width:"100%"}})}):O.jsx(Ge,{label:e.label,name:e.name,type:e.type,value:W(e.name),onChange:Z,required:e.required,fullWidth:!0})},e.name)}),se&&O.jsx(ye,{severity:"error",children:se}),O.jsx(Fe,{content:t?"Update":"Sign Up",submit:!0})]}),O.jsx(Ie,{open:J,message:f,title:"User Registration Confirmation",onClose:X})]})};export{Xe as S};
