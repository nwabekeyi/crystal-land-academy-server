import{r as c,j as s}from"./index-B-gfigdE.js";import{t as Z,D as ee,a as se,b as te,c as ae}from"./modal-CjM-E6bY.js";import{H as ie}from"./Header-C7TPBC1M.js";import{T as re}from"./table-DoKeEdmi.js";import{C as ce}from"./accordion-DmkX1Bc4.js";import{C as ne}from"./confirmationModal-BhSIITCd.js";import{j as oe,v as m,a1 as k,a2 as de,a3 as le,T as r,x as v}from"./TextField-CvoFiyNY.js";import{M as me}from"./MenuItem-Cq1E3Tk4.js";import{R as ue,a as he}from"./RadioGroup-BpAkOzOn.js";import{F as xe}from"./FormControlLabel-8SjwIHrT.js";import"./IconButton-DXPrO4pt.js";import"./index-DvYUmvmj.js";import"./index-CfhEgBJ4.js";import"./loadingButton-B4jIQRMH.js";import"./CircularProgress-Cjpv5aMd.js";import"./useApi-BpL-F3eV.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-DYcMRowa.js";import"./useMediaQuery-MbFwq1kw.js";const n={academicYears:[{_id:"year_1",name:"2023–2024"},{_id:"year_2",name:"2024–2025"}],classes:[{_id:"class_1",academicYearId:"year_2",section:"Primary",displayName:"Primary 1A",students:["stu_1","stu_2"],subjectsTaught:["Mathematics","English"]},{_id:"class_2",academicYearId:"year_2",section:"Secondary",displayName:"Secondary 1B",students:["stu_3"],subjectsTaught:["Science"]}],students:[{_id:"stu_1",firstName:"John",lastName:"Doe",classId:"class_1",subjects:["Mathematics","English"]},{_id:"stu_2",firstName:"Jane",lastName:"Smith",classId:"class_1",subjects:["Mathematics"]},{_id:"stu_3",firstName:"Alice",lastName:"Brown",classId:"class_2",subjects:["Science"]}],testQuestions:[{id:"q_1",classId:"class_1",subject:"Mathematics",question:"What is the solution to 2x + 3 = 7?",options:["x = 1","x = 2","x = 3","x = 4"],correctAnswer:"x = 2"},{id:"q_2",classId:"class_1",subject:"Mathematics",question:"What is 3 + 5?",options:["6","7","8","9"],correctAnswer:"8"},{id:"q_3",classId:"class_1",subject:"English",question:'What is a synonym for "happy"?',options:["Sad","Joyful","Angry","Tired"],correctAnswer:"Joyful"},{id:"q_4",classId:"class_1",subject:"English",question:'What is the past tense of "run"?',options:["Ran","Run","Running","Runs"],correctAnswer:"Ran"},{id:"q_5",classId:"class_2",subject:"Science",question:"What gas do plants absorb during photosynthesis?",options:["Oxygen","Nitrogen","Carbon Dioxide","Hydrogen"],correctAnswer:"Carbon Dioxide"},{id:"q_6",classId:"class_2",subject:"Science",question:"What is the chemical symbol for water?",options:["H2O","CO2","O2","N2"],correctAnswer:"H2O"}],tests:[{id:"test_1",classId:"class_1",subject:"Mathematics",questionIds:["q_1","q_2"],duration:300},{id:"test_2",classId:"class_1",subject:"English",questionIds:["q_3","q_4"],duration:300},{id:"test_3",classId:"class_2",subject:"Science",questionIds:["q_5","q_6"],duration:300}],testScores:[{id:"score_1",testId:"test_1",studentId:"stu_1",score:100,date:"2024-09-20",academicYearId:"year_2"},{id:"score_2",testId:"test_2",studentId:"stu_1",score:50,date:"2024-09-21",academicYearId:"year_2"}],examScores:[{id:"exam_1",studentId:"stu_1",subject:"Mathematics",score:85,academicYearId:"year_2",term:"First Term"},{id:"exam_2",studentId:"stu_1",subject:"English",score:90,academicYearId:"year_2",term:"First Term"},{id:"exam_3",studentId:"stu_1",subject:"Mathematics",score:80,academicYearId:"year_1",term:"First Term"}]},De=()=>{var N;const R=oe();Z(R.palette.mode);const b="stu_1",_=n.students.find(e=>e._id===b),[S,B]=c.useState("year_2"),[L,A]=c.useState(!1),[o,C]=c.useState(null),[q,p]=c.useState({}),[f,I]=c.useState(0),[u,j]=c.useState(!1),[l,g]=c.useState(!1),[W,T]=c.useState(null),[y,F]=c.useState(n.testScores),[H,Y]=c.useState(!1),[$,J]=c.useState("");c.useEffect(()=>{let e;return u&&f>0&&!l&&(e=setInterval(()=>{I(t=>t<=1?(M(),0):t-1)},1e3)),()=>clearInterval(e)},[u,f,l]);const h=n.classes.find(e=>e.students.includes(b)),P=n.tests.filter(e=>e.classId===(h==null?void 0:h._id)&&_.subjects.includes(e.subject)),Q=e=>{const t=n.tests.filter(a=>a.classId===(h==null?void 0:h._id)&&_.subjects.includes(a.subject)),i=y.filter(a=>a.studentId===b&&a.academicYearId===e),x=n.examScores.filter(a=>a.studentId===b&&a.academicYearId===e);return _.subjects.map(a=>{var D,O;const V=t.filter(d=>d.subject===a),X=i.filter(d=>V.some(K=>K.id===d.testId)),w=x.filter(d=>d.subject===a);return{subject:a,testScores:X.map(d=>({testId:d.testId,score:d.score,date:new Date(d.date).toLocaleDateString()})),examScore:((D=w[0])==null?void 0:D.score)||"N/A",examTerm:((O=w[0])==null?void 0:O.term)||"N/A"}})},z=e=>{C(e),I(e.duration),p({}),j(!1),g(!1),T(null),A(!0)},G=(e,t)=>{p(i=>({...i,[e]:t}))},M=()=>{if(!u||l)return;let e=0;const t=n.testQuestions.filter(a=>o.questionIds.includes(a.id));t.forEach(a=>{q[a.id]===a.correctAnswer&&(e+=1)});const i=e/t.length*100;T(i),g(!0),j(!1);const x={id:`score_${y.length+1}`,testId:o.id,studentId:b,score:i,date:new Date().toISOString().split("T")[0],academicYearId:S};F([...y,x]),J(`Test submitted! Your score: ${i}%`),Y(!0)},U=[{id:"subject",label:"Subject",flex:2},{id:"tests",label:"Available Tests",flex:2,renderCell:e=>s.jsx(r,{children:e.tests.length>0?`${e.tests.length} test(s) available`:"No tests available"})},{id:"actions",label:"Actions",flex:1,renderCell:e=>s.jsx(v,{variant:"contained",color:"primary",size:"small",onClick:()=>z(e.tests[0]),disabled:e.tests.length===0||y.some(t=>{var i;return t.testId===((i=e.tests[0])==null?void 0:i.id)}),children:"Take Test"})}],E=_.subjects.map((e,t)=>({id:t+1,subject:e,tests:P.filter(i=>i.subject===e)}));return s.jsxs(m,{py:"20px",children:[s.jsx(ie,{title:"STUDENT TESTS & EXAMS",subtitle:"Take Tests and View Scores"}),s.jsxs(m,{mb:"20px",children:[s.jsxs(k,{sx:{minWidth:200,mb:3},children:[s.jsx(de,{id:"academic-year-select-label",children:"Academic Year"}),s.jsx(le,{labelId:"academic-year-select-label",value:S,label:"Academic Year",onChange:e=>B(e.target.value),children:n.academicYears.map(e=>s.jsx(me,{value:e._id,children:e.name},e._id))})]}),s.jsx(r,{variant:"h5",sx:{mb:2},children:"Subjects and Tests"}),E.length>0?s.jsx(re,{columns:U,tableHeader:`Subjects for ${(N=n.academicYears.find(e=>e._id===S))==null?void 0:N.name}`,data:E,page:0,rowsPerPage:5,sortBy:"subject",sortDirection:"asc",hiddenColumnsSmallScreen:["tests"]}):s.jsx(r,{children:"No subjects assigned."}),s.jsx(r,{variant:"h5",sx:{mt:4,mb:2},children:"Scores Breakdown"}),n.academicYears.map(e=>s.jsx(ce,{title:e.name,details:s.jsx(m,{children:Q(e._id).map((t,i)=>s.jsxs(m,{sx:{mb:2},children:[s.jsx(r,{variant:"h6",children:t.subject}),s.jsx(r,{variant:"body1",children:"Test Scores:"}),t.testScores.length>0?s.jsx("ul",{children:t.testScores.map((x,a)=>s.jsx("li",{children:s.jsxs(r,{variant:"body2",children:["Test ",a+1,": ",x.score,"% (",x.date,")"]})},a))}):s.jsx(r,{variant:"body2",children:"No test scores available."}),s.jsxs(r,{variant:"body1",sx:{mt:1},children:["Exam Score: ",t.examScore," ",t.examScore!=="N/A"?`(${t.examTerm})`:""]})]},i))}),defaultExpanded:e._id===S},e._id))]}),s.jsxs(ee,{open:L,onClose:()=>{A(!1),C(null),p({}),I(0),j(!1),g(!1),T(null)},children:[s.jsxs(se,{children:[o==null?void 0:o.subject," Test",u&&!l&&s.jsxs(r,{variant:"body2",display:"inline",sx:{ml:2},children:["Time Left: ",Math.floor(f/60),":",(f%60).toString().padStart(2,"0")]})]}),s.jsxs(te,{children:[o&&!l&&s.jsxs(m,{display:"flex",flexDirection:"column",gap:"16px",children:[n.testQuestions.filter(e=>o.questionIds.includes(e.id)).map(e=>s.jsxs(m,{children:[s.jsx(r,{variant:"body1",sx:{mb:1},children:e.question}),s.jsx(k,{component:"fieldset",children:s.jsx(ue,{value:q[e.id]||"",onChange:t=>G(e.id,t.target.value),children:e.options.map((t,i)=>s.jsx(xe,{value:t,control:s.jsx(he,{}),label:t,disabled:l},i))})})]},e.id)),!u&&s.jsx(v,{variant:"contained",color:"primary",onClick:()=>j(!0),children:"Start Test"})]}),l&&s.jsxs(m,{children:[s.jsx(r,{variant:"h6",children:"Test Submitted!"}),s.jsxs(r,{variant:"body1",children:["Your Score: ",W,"%"]})]})]}),s.jsxs(ae,{children:[u&&!l&&s.jsx(v,{variant:"contained",color:"primary",onClick:M,disabled:Object.keys(q).length<(o==null?void 0:o.questionIds.length),children:"Submit Test"}),s.jsx(v,{onClick:()=>{A(!1),C(null),p({}),I(0),j(!1),g(!1),T(null)},children:"Close"})]})]}),s.jsx(ne,{open:H,onClose:()=>Y(!1),isLoading:!1,title:"Test Result",message:$})]})};export{De as default};
