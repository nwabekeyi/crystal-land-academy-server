import{r as n,j as e}from"./index-22HUb1_z.js";import{a as _}from"./index-dxrUZtLq.js";import{d as k}from"./Visibility-CAQTlKmU.js";import{u as A}from"./useApi-BivKV4bK.js";import{r as w,M as $}from"./modal-CFzM2TvC.js";import{T as D}from"./table-iQGSzLj8.js";import{H as T}from"./Header-CXtHvVsg.js";import{t as H}from"./constants-BJW4J9P5.js";import{I as y}from"./IconButton-xWupQFdG.js";import"./MenuItem-38XN_-vW.js";import"./confirmationModal-BxJ-28ob.js";import"./index-DF2Knd0X.js";import"./loadingButton-DUprIo-A.js";import"./useSlot-Bb0ot7dQ.js";import"./useMediaQuery-vabypUKQ.js";const N=()=>{const[c,t]=n.useState([]),[d,i]=n.useState(null),[m,o]=n.useState(null),[p,u]=n.useState(!1),{callApi:j,loading:q}=A(),{callApi:v,loading:h}=A(),{callApi:C,loading:f}=A(),g=async()=>{o(null);try{const r=await j("https://crystal-land-academy-server.onrender.com/api/v1/enquiries","GET");if(r)return t(Array.isArray(r)?r:[]),r.filter(l=>!l.read).length}catch(r){console.error("Error fetching enquiries:",r),o("Failed to fetch enquiries")}},E=async r=>{try{const s=await v(`https://crystal-land-academy-server.onrender.com/api/v1/enquiries/${r}`,"PATCH");t(l=>l.map(a=>a._id===r?{...a,read:s.read}:a))}catch(s){console.error("Error updating enquiry:",s),o("Failed to update enquiry")}},x=async r=>{try{await C(`https://crystal-land-academy-server.onrender.com/api/v1/enquiries/${r}`,"DELETE"),t(s=>s.filter(l=>l._id!==r))}catch(s){console.error("Error deleting enquiry:",s),o("Failed to delete enquiry")}};return n.useEffect(()=>{g()},[]),{enquiries:c,selectedEnquiry:d,loading:q||h||f,error:m,fetchEnquiries:g,markAsRead:E,removeEnquiry:x,openModal:r=>{i(r),r.read!==!0&&E(r._id),u(!0)},closeModal:()=>{i(null),u(!1)},confirmDeleteModal:p}};var R={},F=H;Object.defineProperty(R,"__esModule",{value:!0});var b=R.default=void 0,I=F(w()),W=e;b=R.default=(0,I.default)((0,W.jsx)("path",{d:"M12 19c0-3.87 3.13-7 7-7 1.08 0 2.09.25 3 .68V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h8.08c-.05-.33-.08-.66-.08-1M4 6l8 5 8-5v2l-8 5-8-5zm13.34 16-3.54-3.54 1.41-1.41 2.12 2.12 4.24-4.24L23 16.34z"}),"MarkEmailRead");const ae=()=>{const{enquiries:c,selectedEnquiry:t,loading:d,error:i,openModal:m,closeModal:o,confirmDeleteModal:p,removeEnquiry:u,markAsRead:j}=N(),q=[{id:"name",label:"Name",minWidth:100},{id:"phoneNumber",label:"Phone No.",minWidth:50},{id:"status",label:"Status",minWidth:50},{id:"actions",label:"Actions",minWidth:150,renderCell:a=>a.actions}],v=c.map(a=>({...a,status:a.read?"Read":"Unread",actions:e.jsxs(e.Fragment,{children:[e.jsx(y,{onClick:()=>m(a),"aria-label":"view",style:{marginRight:"10px"},children:e.jsx(k,{})}),e.jsx(y,{onClick:()=>u(a._id),"aria-label":"delete",color:"error",children:e.jsx(_,{})})]})})),[h,C]=n.useState("name"),[f,g]=n.useState("asc"),[E,x]=n.useState(0),[S,M]=n.useState(10),r=a=>{g(h===a&&f==="asc"?"desc":"asc"),C(a)},s=(a,P)=>{x(P)},l=a=>{M(parseInt(a.target.value,10)),x(0)};return e.jsxs("div",{children:[e.jsx(T,{title:"Enquiries",subtitle:"Enquiries from prospects"}),d&&e.jsx("p",{children:"Loading..."}),i&&e.jsx("p",{style:{color:"red"},children:i}),!d&&!i&&c.length===0&&e.jsx("p",{children:"No enquiries found."}),!d&&!i&&c.length>0&&e.jsx(D,{columns:q,tableHeader:"Enquiries",data:v,sortBy:h,sortDirection:f,onSortChange:r,page:E,rowsPerPage:S,onPageChange:s,onRowsPerPageChange:l,onRowClick:a=>m(a)}),p&&t&&e.jsx($,{open:p,onClose:o,noConfirm:!0,title:"Enquiry",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:t.name}),e.jsx("p",{children:t.message}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status: "}),t.read?"Read":"Unread"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"end",marginTop:"20px"},children:[e.jsx(y,{onClick:()=>{u(t._id),o()},"aria-label":"delete",color:"error",children:e.jsx(_,{})}),!t.read&&e.jsx(y,{onClick:()=>{j(t._id),o()},"aria-label":"mark as read",color:"primary",children:e.jsx(b,{})})]})]})})]})};export{ae as default};
