import{r as f,a as N,f as w,j as s}from"./index-BO-TmkzE.js";import{u as I}from"./useApi-bPe3HYn1.js";import{H as S}from"./Header-DSApfQWn.js";import{C as b}from"./accordion-M8ImoQcF.js";import{C as O}from"./CircularProgress-oo0vmEJK.js";import{A as R}from"./Alert-yflAxarF.js";import{v as h,T as g}from"./TextField-CigEBK4R.js";import"./modal-CG0C6vpP.js";import"./IconButton-DnpiNGo6.js";import"./index-BJVcWxQk.js";import"./confirmationModal-DjrrgVpa.js";import"./MenuItem-Cm8_Zc8l.js";import"./index-nsUM-GnQ.js";import"./loadingButton-CiJH9dFC.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-DtaxXO1z.js";const U=({subclass:t=""})=>{const{loading:u,error:i,callApi:n}=I(),[a,o]=f.useState([]),A=f.useRef(!0),d=N(r=>{var m,l;return(l=(m=r.users)==null?void 0:m.user)==null?void 0:l.classLevelId}),p=f.useCallback(async()=>{if(!d){console.warn("No classLevelId found in Redux state");return}try{const r=[`classLevelId=${d}`];t&&r.push(`subclass=${t}`);const m=`${w.ANNOUNCEMENT}/class-level?${r.join("&")}`;console.log(`Fetching announcements with URL: ${m}`);const l=await n(m,"GET");if(l&&l.status==="success"&&A.current){console.log("Announcements API response:",JSON.stringify(l.data,null,2));const x=l.data.map(c=>{var v,j,L,y;const e=(v=c.targets)==null?void 0:v[0],E=((j=e==null?void 0:e.classLevel)==null?void 0:j.name)||"Unknown Class",C=((L=e==null?void 0:e.classLevel)==null?void 0:L.section)||"",T=(e==null?void 0:e.subclass)||"";return{_id:c._id,title:c.title,message:c.message,dueDate:c.dueDate,createdBy:c.createdByName||"Unknown Teacher",classLevel:E,classLevelId:((y=e==null?void 0:e.classLevel)==null?void 0:y._id)||null,section:C,subclass:T,createdAt:c.createdAt,updatedAt:c.updatedAt}});console.log("Transformed announcements:",JSON.stringify(x,null,2)),o(x)}return l}catch(r){throw console.error("Error fetching announcements:",r.message),console.error("Error details:",r),new Error(r.message||"Failed to fetch announcements")}},[d,t,n]);return f.useEffect(()=>(d&&p(),()=>{A.current=!1}),[d,t,p]),{loading:u,error:i,announcements:a,fetchAnnouncements:p}},W=({subclass:t})=>{const{loading:u,error:i,announcements:n}=U({subclass:t}),a=N(o=>o.users.user);return console.log(n),f.useEffect(()=>{console.log("StudentAnnouncements: Redux user state:",JSON.stringify(a,null,2)),console.log("StudentAnnouncements: classLevelId:",a==null?void 0:a.classLevelId),console.log("StudentAnnouncements: subclass:",t),console.log("StudentAnnouncements: loading:",u),console.log("StudentAnnouncements: error:",i),console.log("StudentAnnouncements: announcements:",JSON.stringify(n,null,2))},[a,t,u,i,n]),u?s.jsx(O,{"aria-label":"Loading announcements"}):i?s.jsx(R,{severity:"error",children:i}):!n||n.length===0?s.jsxs(h,{children:[s.jsx(S,{title:"Class Announcements",subtitle:"This is the announcements page for the class from subject teachers"}),s.jsx(g,{children:"No announcements available for your class."})]}):s.jsxs(h,{children:[s.jsx(S,{title:"Class Announcements",subtitle:"This is the announcements page for the class from subject teachers"}),n.map(o=>s.jsx(b,{title:o.createdBy||"Unknown Teacher",details:s.jsxs(h,{children:[s.jsx(g,{variant:"h6",children:o.title}),s.jsx(g,{children:o.message})]}),defaultExpanded:!1},o._id))]})};export{W as default};
