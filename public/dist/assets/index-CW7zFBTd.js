import{j as e,r as c,a as te,f as N,C as At,i as _e,D as lt,E as Dt}from"./index-DXxzwwbK.js";import{r as je,t as R,M as se}from"./modal-Ci5iPumC.js";import{c as Ae,a as Et,g as kt,u as wt,_ as ct,K as dt,af as Tt,ap as Ft,$ as Mt,o as Rt,b as B,s as De,d as Ce,h as ut,e as Lt,aq as Pt,ar as Ot,q as ve,j as L,v as d,T as r,w as Ee,y as _,a1 as Ie,a2 as $e,a3 as We}from"./TextField-C1UIQ2nv.js";import{H as Nt}from"./Header-Dfg-LaqG.js";import{G as Ve,L as ke,a as we,d as Be,C as Te,b as Fe,A as mt}from"./index-F6-XIzxz.js";import{t as ht}from"./nivo-pie-BY3Cfr1O.js";import{p as xt}from"./nivo-line.es-D-EJnomF.js";import{u as Y}from"./useApi-DVdT1N_3.js";import{u as gt,M as pe}from"./MenuItem-DEndFJiM.js";import{f as Ne,F as Ye,m as He,a as Ge,b as ft}from"./main-v_3NwtIH.js";import{m as qe}from"./main-BnORPkJ6.js";import{A as Ue}from"./Alert-BszfgO2T.js";import{I as Xe}from"./IconButton-DhOWqksS.js";import{X as zt}from"./nivo-bar-DyY61-FA.js";import{u as ot}from"./useMediaQuery-Dk1-EYYS.js";import{w as It}from"./dasboardPagesContainer-tlH_EIyF.js";import{C as pt}from"./confirmationModal-HQTZ8uES.js";import{C as $t}from"./CircularProgress-BGFInVhb.js";import{A as xe}from"./actionButton-DwAij9aY.js";import"./index-Bd97VqvA.js";import"./loadingButton-B9XNayDD.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-B3K9JRnK.js";import"./isEqual-E87wmouz.js";import"./_baseIsEqual-DuYqghKT.js";import"./_baseForOwn-CAA_2CLX.js";import"./_baseSlice-z0Zd1-Ev.js";const Wt={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"},_t=Ae(e.jsx("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),Vt=Ae(e.jsx("path",{d:"M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"}),"StarBorder");function Bt(s){return kt("MuiRating",s)}const ge=Et("MuiRating",["root","sizeSmall","sizeMedium","sizeLarge","readOnly","disabled","focusVisible","visuallyHidden","pristine","label","labelEmptyValueActive","icon","iconEmpty","iconFilled","iconHover","iconFocus","iconActive","decimal"]),Yt=["value"],Ht=["className","defaultValue","disabled","emptyIcon","emptyLabelText","getLabelText","highlightSelectedOnly","icon","IconContainerComponent","max","name","onChange","onChangeActive","onMouseLeave","onMouseMove","precision","readOnly","size","value"];function Gt(s){const t=s.toString().split(".")[1];return t?t.length:0}function ze(s,t){if(s==null)return s;const n=Math.round(s/t)*t;return Number(n.toFixed(Gt(t)))}const qt=s=>{const{classes:t,size:n,readOnly:i,disabled:o,emptyValueFocused:l,focusVisible:a}=s,x={root:["root",`size${ut(n)}`,o&&"disabled",a&&"focusVisible",i&&"readOnly"],label:["label","pristine"],labelEmptyValue:[l&&"labelEmptyValueActive"],icon:["icon"],iconEmpty:["iconEmpty"],iconFilled:["iconFilled"],iconHover:["iconHover"],iconFocus:["iconFocus"],iconActive:["iconActive"],decimal:["decimal"],visuallyHidden:["visuallyHidden"]};return Lt(x,Bt,t)},Ut=De("span",{name:"MuiRating",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:n}=s;return[{[`& .${ge.visuallyHidden}`]:t.visuallyHidden},t.root,t[`size${ut(n.size)}`],n.readOnly&&t.readOnly]}})(({theme:s,ownerState:t})=>B({display:"inline-flex",position:"relative",fontSize:s.typography.pxToRem(24),color:"#faaf00",cursor:"pointer",textAlign:"left",width:"min-content",WebkitTapHighlightColor:"transparent",[`&.${ge.disabled}`]:{opacity:(s.vars||s).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${ge.focusVisible} .${ge.iconActive}`]:{outline:"1px solid #999"},[`& .${ge.visuallyHidden}`]:Wt},t.size==="small"&&{fontSize:s.typography.pxToRem(18)},t.size==="large"&&{fontSize:s.typography.pxToRem(30)},t.readOnly&&{pointerEvents:"none"})),jt=De("label",{name:"MuiRating",slot:"Label",overridesResolver:({ownerState:s},t)=>[t.label,s.emptyValueFocused&&t.labelEmptyValueActive]})(({ownerState:s})=>B({cursor:"inherit"},s.emptyValueFocused&&{top:0,bottom:0,position:"absolute",outline:"1px solid #999",width:"100%"})),Xt=De("span",{name:"MuiRating",slot:"Icon",overridesResolver:(s,t)=>{const{ownerState:n}=s;return[t.icon,n.iconEmpty&&t.iconEmpty,n.iconFilled&&t.iconFilled,n.iconHover&&t.iconHover,n.iconFocus&&t.iconFocus,n.iconActive&&t.iconActive]}})(({theme:s,ownerState:t})=>B({display:"flex",transition:s.transitions.create("transform",{duration:s.transitions.duration.shortest}),pointerEvents:"none"},t.iconActive&&{transform:"scale(1.2)"},t.iconEmpty&&{color:(s.vars||s).palette.action.disabled})),Jt=De("span",{name:"MuiRating",slot:"Decimal",shouldForwardProp:s=>Pt(s)&&s!=="iconActive",overridesResolver:(s,t)=>{const{iconActive:n}=s;return[t.decimal,n&&t.iconActive]}})(({iconActive:s})=>B({position:"relative"},s&&{transform:"scale(1.2)"}));function Kt(s){const t=ct(s,Yt);return e.jsx("span",B({},t))}function it(s){const{classes:t,disabled:n,emptyIcon:i,focus:o,getLabelText:l,highlightSelectedOnly:a,hover:x,icon:m,IconContainerComponent:u,isActive:h,itemValue:f,labelProps:k,name:j,onBlur:D,onChange:p,onClick:C,onFocus:g,readOnly:A,ownerState:w,ratingValue:y,ratingValueRounded:O}=s,v=a?f===y:f<=y,z=f<=x,I=f<=o,J=f===O,H=dt(),G=e.jsx(Xt,{as:u,value:f,className:Ce(t.icon,v?t.iconFilled:t.iconEmpty,z&&t.iconHover,I&&t.iconFocus,h&&t.iconActive),ownerState:B({},w,{iconEmpty:!v,iconFilled:v,iconHover:z,iconFocus:I,iconActive:h}),children:i&&!v?i:m});return A?e.jsx("span",B({},k,{children:G})):e.jsxs(c.Fragment,{children:[e.jsxs(jt,B({ownerState:B({},w,{emptyValueFocused:void 0}),htmlFor:H},k,{children:[G,e.jsx("span",{className:t.visuallyHidden,children:l(f)})]})),e.jsx("input",{className:t.visuallyHidden,onFocus:g,onBlur:D,onChange:p,onClick:C,disabled:n,value:f,id:H,type:"radio",name:j,checked:J})]})}const Qt=e.jsx(_t,{fontSize:"inherit"}),Zt=e.jsx(Vt,{fontSize:"inherit"});function en(s){return`${s} Star${s!==1?"s":""}`}const tn=c.forwardRef(function(t,n){const i=wt({name:"MuiRating",props:t}),{className:o,defaultValue:l=null,disabled:a=!1,emptyIcon:x=Zt,emptyLabelText:m="Empty",getLabelText:u=en,highlightSelectedOnly:h=!1,icon:f=Qt,IconContainerComponent:k=Kt,max:j=5,name:D,onChange:p,onChangeActive:C,onMouseLeave:g,onMouseMove:A,precision:w=1,readOnly:y=!1,size:O="medium",value:v}=i,z=ct(i,Ht),I=dt(D),[J,H]=Tt({controlled:v,default:l,name:"Rating"}),G=ze(J,w),K=Ft(),[{hover:E,focus:Q},X]=c.useState({hover:-1,focus:-1});let T=G;E!==-1&&(T=E),Q!==-1&&(T=Q);const{isFocusVisibleRef:ie,onBlur:le,onFocus:Z,ref:Me}=Mt(),[Re,me]=c.useState(!1),be=c.useRef(),Le=Rt(Me,be,n),ye=P=>{A&&A(P);const W=be.current,{right:q,left:Se,width:ce}=W.getBoundingClientRect();let de;K?de=(q-P.clientX)/ce:de=(P.clientX-Se)/ce;let ee=ze(j*de+w/2,w);ee=Ot(ee,w,j),X(re=>re.hover===ee&&re.focus===ee?re:{hover:ee,focus:ee}),me(!1),C&&E!==ee&&C(P,ee)},Pe=P=>{g&&g(P);const W=-1;X({hover:W,focus:W}),C&&E!==W&&C(P,W)},b=P=>{let W=P.target.value===""?null:parseFloat(P.target.value);E!==-1&&(W=E),H(W),p&&p(P,W)},$=P=>{P.clientX===0&&P.clientY===0||(X({hover:-1,focus:-1}),H(null),p&&parseFloat(P.target.value)===G&&p(P,null))},S=P=>{Z(P),ie.current===!0&&me(!0);const W=parseFloat(P.target.value);X(q=>({hover:q.hover,focus:W}))},V=P=>{if(E!==-1)return;le(P),ie.current===!1&&me(!1);const W=-1;X(q=>({hover:q.hover,focus:W}))},[Ct,rt]=c.useState(!1),he=B({},i,{defaultValue:l,disabled:a,emptyIcon:x,emptyLabelText:m,emptyValueFocused:Ct,focusVisible:Re,getLabelText:u,icon:f,IconContainerComponent:k,max:j,precision:w,readOnly:y,size:O}),ne=qt(he);return e.jsxs(Ut,B({ref:Le,onMouseMove:ye,onMouseLeave:Pe,className:Ce(ne.root,o,y&&"MuiRating-readOnly"),ownerState:he,role:y?"img":null,"aria-label":y?u(T):null},z,{children:[Array.from(new Array(j)).map((P,W)=>{const q=W+1,Se={classes:ne,disabled:a,emptyIcon:x,focus:Q,getLabelText:u,highlightSelectedOnly:h,hover:E,icon:f,IconContainerComponent:k,name:I,onBlur:V,onChange:b,onClick:$,onFocus:S,ratingValue:T,ratingValueRounded:G,readOnly:y,ownerState:he},ce=q===Math.ceil(T)&&(E!==-1||Q!==-1);if(w<1){const de=Array.from(new Array(1/w));return e.jsx(Jt,{className:Ce(ne.decimal,ce&&ne.iconActive),ownerState:he,iconActive:ce,children:de.map((ee,re)=>{const Oe=ze(q-1+(re+1)*w,w);return e.jsx(it,B({},Se,{isActive:!1,itemValue:Oe,labelProps:{style:de.length-1===re?{}:{width:Oe===T?`${(re+1)*w*100}%`:"0%",overflow:"hidden",position:"absolute"}}}),Oe)})},q)}return e.jsx(it,B({},Se,{isActive:ce,itemValue:q}),q)}),!y&&!a&&e.jsxs(jt,{className:Ce(ne.label,ne.labelEmptyValue),ownerState:he,children:[e.jsx("input",{className:ne.visuallyHidden,value:"",id:`${I}-empty`,type:"radio",name:I,checked:G==null,onFocus:()=>rt(!0),onBlur:()=>rt(!1),onChange:b}),e.jsx("span",{className:ne.visuallyHidden,children:m})]})]}))}),Je=Ae(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),Ke=Ae(e.jsx("path",{d:"M3 13h2v-2H3zm0 4h2v-2H3zm0-8h2V7H3zm4 4h14v-2H7zm0 4h14v-2H7zM7 7v2h14V7z"}),"List");var Qe={},nn=ve;Object.defineProperty(Qe,"__esModule",{value:!0});var vt=Qe.default=void 0,sn=nn(je()),an=e;vt=Qe.default=(0,sn.default)((0,an.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7zm-8 2V5h2v6h1.17L12 13.17 9.83 11zm-6 7h14v2H5z"}),"DownloadOutlined");var Ze={},rn=ve;Object.defineProperty(Ze,"__esModule",{value:!0});var bt=Ze.default=void 0,on=rn(je()),ln=e;bt=Ze.default=(0,on.default)((0,ln.jsx)("path",{d:"M12 12.75c1.63 0 3.07.39 4.24.9 1.08.48 1.76 1.56 1.76 2.73V18H6v-1.61c0-1.18.68-2.26 1.76-2.73 1.17-.52 2.61-.91 4.24-.91M4 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m1.13 1.1c-.37-.06-.74-.1-1.13-.1-.99 0-1.93.21-2.78.58C.48 14.9 0 15.62 0 16.43V18h4.5v-1.61c0-.83.23-1.61.63-2.29M20 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m4 3.43c0-.81-.48-1.53-1.22-1.85-.85-.37-1.79-.58-2.78-.58-.39 0-.76.04-1.13.1.4.68.63 1.46.63 2.29V18H24zM12 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3"}),"Groups");var et={},cn=ve;Object.defineProperty(et,"__esModule",{value:!0});var yt=et.default=void 0,dn=cn(je()),un=e;yt=et.default=(0,dn.default)((0,un.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 14H4V8l8 5 8-5zm-8-7L4 6h16z"}),"MailOutline");var tt={},mn=ve;Object.defineProperty(tt,"__esModule",{value:!0});var St=tt.default=void 0,hn=mn(je()),xn=e;St=tt.default=(0,hn.default)((0,xn.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const F=({children:s,noFlex:t,height:n,moreStyles:i={}})=>{const o=L(),l=R(o.palette.mode);return e.jsxs(d,{backgroundColor:l.primary[400],p:"20px",borderRadius:"10px",textAlign:"center",display:!t&&"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",sx:{height:n||"100%",boxShadow:o.palette.mode==="light"?"0px 2px 10px rgba(0, 0, 0, 0.1)":"0px 4px 12px rgba(0, 0, 0, 0.3)",...i},children:[s," "]})},nt=({children:s,...t})=>e.jsxs(Ve,{container:!0,spacing:2,...t,children:[s," "]}),U=({children:s})=>e.jsxs(Ve,{container:!0,item:!0,xs:12,spacing:2,children:[s," "]}),M=({children:s,...t})=>e.jsxs(Ve,{item:!0,xs:12,...t,children:[s," "]}),gn=({classLevels:s})=>{const t=L(),n=R(t.palette.mode);if(console.log("Class Levels Data:",s),!s||!Array.isArray(s)||s.length===0)return e.jsx(d,{children:e.jsx(r,{variant:"body1",align:"center",sx:{mt:2},children:"No class distribution data available for the current academic year"})});const i=a=>a&&typeof a=="object"&&a.name&&a.section&&a.academicYear&&typeof a.studentCount=="number",o=s.filter(a=>i(a)&&a.studentCount>0).map(a=>({id:a.name,label:`${a.name} (${a.section})`,value:a.studentCount,color:a.section==="Primary"?"rgba(75, 192, 192, 0.6)":"rgba(255, 159, 64, 0.6)"})),l=s.filter(i).map(a=>({id:a.name,label:`${a.name} (${a.section})`,studentCount:a.studentCount}));return e.jsxs(d,{children:[e.jsx(r,{variant:"h6",sx:{mb:2,color:n.grey[100]},children:"Class Distribution (Students)"}),o.length===0?e.jsx(r,{variant:"body1",align:"center",children:"No active students to display in the current academic year"}):e.jsx("div",{style:{height:"350px"},children:e.jsx(ht,{data:o,theme:{axis:{domain:{line:{stroke:n.grey[100]}},legend:{text:{fill:n.grey[100]}},ticks:{line:{stroke:n.grey[100],strokeWidth:1},text:{fill:n.grey[100]}}},legends:{text:{fill:n.grey[100]}},tooltip:{container:{background:n.primary[400],color:n.grey[100],fontSize:12},format:a=>`${a} students`}},margin:{top:40,right:80,bottom:80,left:80},innerRadius:.5,padAngle:.7,cornerRadius:3,activeOuterRadiusOffset:8,borderColor:{from:"color",modifiers:[["darker",.2]]},arcLinkLabelsSkipAngle:10,arcLinkLabelsTextColor:n.grey[100],arcLinkLabelsThickness:2,arcLinkLabelsColor:{from:"color"},enableArcLabels:!0,arcLabelsRadiusOffset:.4,arcLabelsSkipAngle:7,arcLabelsTextColor:{from:"color",modifiers:[["darker",2]]},arcLabelsText:a=>`${a} students`,colors:o.map(a=>a.color),defs:[{id:"dots",type:"patternDots",background:"inherit",color:"rgba(255, 255, 255, 0.3)",size:4,padding:1,stagger:!0},{id:"lines",type:"patternLines",background:"inherit",color:"rgba(255, 255, 255, 0.3)",rotation:-45,lineWidth:6,spacing:10}],legends:[{anchor:"bottom",direction:"row",justify:!1,translateX:0,translateY:56,itemsSpacing:0,itemWidth:100,itemHeight:18,itemTextColor:"#999",itemDirection:"left-to-right",itemOpacity:1,symbolSize:18,symbolShape:"circle",effects:[{on:"hover",style:{itemTextColor:"#000"}}]}]})}),e.jsx(d,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:l.length>0?l.map(a=>e.jsxs(r,{sx:{color:n.grey[100],fontSize:12,minWidth:120},children:[a.label,": ",a.studentCount," students"]},a.id)):e.jsx(r,{variant:"body1",align:"center",children:"No valid class distribution data to display for the current academic year"})})]})},st=()=>{var K,E,Q,X;const[s,t]=c.useState(0),n=gt(),i=te(T=>T.adminData.classLevels)||[],o=te(T=>T.adminData.subjects)||[],{loading:l,error:a,callApi:x}=Y(),{loading:m,data:u,error:h,callApi:f}=Y(),{loading:k,data:j,error:D,callApi:p}=Y(),{loading:C,data:g,error:A,callApi:w}=Y(),y=c.useCallback(()=>(console.log("Fetching subjects from:",N.SUBJECT),x(N.SUBJECT,"GET")),[x]),O=c.useCallback(()=>(console.log("Fetching financial data from:",N.FINANCIAL_DATA),f(N.FINANCIAL_DATA,"GET")),[f]),v=c.useCallback(()=>(console.log("Fetching outstanding fees from:",N.OUTSTANDING_FEES_DATA),p(N.OUTSTANDING_FEES_DATA,"GET")),[p]),z=c.useCallback(()=>(console.log("Fetching admin stats from:",N.ADMIN_DATA),w(N.ADMIN_DATA,"GET")),[w]);c.useEffect(()=>{const T=new AbortController;return(async()=>{await Promise.all([y(),O(),v(),z()])})(),()=>{console.log("Cleaning up useAdminData API calls"),T.abort()}},[y,O,v,z]),c.useEffect(()=>{if(g){console.log("Raw Admin Stats Data:",g);const T=g.data||{};console.log("Processed Admin Stats Data:",T),t(T.unreadEnquiries||0)}A&&(console.error("Admin Stats Error:",A),n(setError(A.message||"Failed to fetch admin stats.")))},[g,A,n]),c.useEffect(()=>{u&&(console.log("Raw Financial Data:",u),console.log("Processed Financial Data:",(u==null?void 0:u.data)||{})),h&&(console.error("Financial Data Error:",h),n(setError(h.message||"Failed to fetch financial data.")))},[u,h,n]),c.useEffect(()=>{j&&(console.log("Raw Outstanding Fees Data:",j),console.log("Processed Outstanding Fees Data:",(j==null?void 0:j.data)||[])),D&&(console.error("Outstanding Fees Error:",D),n(setError(D.message||"Failed to fetch outstanding fees data.")))},[j,D,n]);const I=c.useMemo(()=>{var le;const T=((le=g==null?void 0:g.data)==null?void 0:le.enrollmentsPerAcademicYear)||[];return console.log("Enrollments Data:",T),{total:T.map(Z=>({id:`Total-${Z.academicYear}`,academicYear:Z.academicYear,value:Z.enrollmentCount})).filter(Z=>Z.value>0)}},[g]),J=c.useMemo(()=>i.map(T=>({id:T.id,name:T.name,section:T.section,academicYear:T.academicYear,studentCount:T.studentCount})),[i]);c.useEffect(()=>{console.log("Class Distribution Data:",J)},[J]);const H=c.useMemo(()=>{const T=(j==null?void 0:j.data)||[];return console.log("Memoized Outstanding Fees Data:",T),T},[j]),G=[a,h,D,A].find(T=>T)||null;return{usersData:{totalStudents:((K=g==null?void 0:g.data)==null?void 0:K.totalStudents)||0,totalTeachers:((E=g==null?void 0:g.data)==null?void 0:E.totalTeachers)||0,currentYearStudents:((Q=g==null?void 0:g.data)==null?void 0:Q.currentYearStudents)||0,topTeachers:((X=g==null?void 0:g.data)==null?void 0:X.topTeachers)||[]},unreadEnquiriesCount:s,classLevels:J,subjects:o,financialData:(u==null?void 0:u.data)||{primary:[],secondary:[]},outstandingFeesData:H,enrollmentData:I,financialDataLoading:m,financialDataError:h,outstandingFeesLoading:k,outstandingFeesError:D,adminStatsLoading:C,adminStatsError:A,enrollmentDataLoading:C,enrollmentDataError:A,loading:l||m||k||C,error:G,refetchSubjects:y,refetchFinancialData:O,refetchOutstandingFees:v,refetchAdminStats:z}},fn=({isCustomLineColors:s=!1,isDashboard:t=!1})=>{const n=L(),i=c.useMemo(()=>R(n.palette.mode),[n.palette.mode]),{financialData:o,financialDataLoading:l,financialDataError:a}=st(),x=h=>`hsl(${h*360/2%360}, 70%, 60%)`,m=c.useMemo(()=>{var k,j;const h=(o==null?void 0:o.data)||o||{primary:[],secondary:[]};return!((k=h.primary)!=null&&k.length)&&!((j=h.secondary)!=null&&j.length)?[]:["primary","secondary"].filter(D=>{var p;return(p=h[D])==null?void 0:p.length}).map((D,p)=>({id:D.charAt(0).toUpperCase()+D.slice(1),color:s?x(p):void 0,data:h[D].map(C=>({x:C.label.split(" ")[0],y:C.value||0}))}))},[o,s]),u=c.useMemo(()=>{var j,D;const h=(o==null?void 0:o.data)||o||{primary:[],secondary:[]},f=((j=h.primary)==null?void 0:j.reduce((p,C)=>p+(C.value||0),0))||0,k=((D=h.secondary)==null?void 0:D.reduce((p,C)=>p+(C.value||0),0))||0;return f+k},[o]);return l?e.jsx(d,{children:"Loading data..."}):a?e.jsxs(d,{children:["Error: ",a.message||"Failed to load financial data"]}):m.length?e.jsxs(d,{width:"98%",height:t?"300px":"400px",children:[e.jsxs(r,{variant:"subtitle1",sx:{mb:2,color:i.grey[100]},children:["Total Revenue: ₦",u.toLocaleString("en-NG")]}),e.jsx(xt,{data:m,animate:!0,motionConfig:"default",theme:{axis:{domain:{line:{stroke:i.grey[100]}},legend:{text:{fill:i.grey[100],fontSize:8}},ticks:{line:{stroke:i.grey[100],strokeWidth:1},text:{fill:i.grey[100],fontSize:8}}},legends:{text:{fill:i.grey[100],fontSize:8}},tooltip:{container:{background:i.primary[500],color:i.grey[100],fontSize:12},format:h=>`₦${h.toLocaleString("en-NG")}`}},colors:s?{datum:"color"}:{scheme:"nivo"},margin:{top:50,right:110,bottom:50,left:60},xScale:{type:"point"},yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:h=>`₦${h.toLocaleString("en-NG")}`,curve:"catmullRom",axisTop:null,axisRight:null,axisBottom:{tickSize:0,tickPadding:5,tickRotation:45,legend:t?void 0:"Academic Year",legendOffset:36,legendPosition:"middle"},axisLeft:{tickValues:5,tickSize:3,tickPadding:5,tickRotation:0,legend:t?void 0:"Revenue (₦)",legendOffset:-50,legendPosition:"middle",format:h=>`₦${h.toLocaleString("en-NG")}`},enableGridX:!1,enableGridY:!1,pointSize:8,pointColor:{theme:"background"},pointBorderWidth:2,pointBorderColor:{from:"serieColor"},enablePoints:!0,enablePointLabel:!0,pointLabel:"y",pointLabelYOffset:-12,useMesh:!0,legends:[{anchor:"bottom-right",direction:"column",justify:!1,translateX:100,translateY:0,itemsSpacing:0,itemDirection:"left-to-right",itemWidth:80,itemHeight:20,itemOpacity:.75,symbolSize:12,symbolShape:"circle",symbolBorderColor:"rgba(0, 0, 0, .5)",effects:[{on:"hover",style:{itemBackground:"rgba(0, 0, 0, .03)",itemOpacity:1}}]}]})]}):e.jsx(d,{children:"No financial data available."})},pn=()=>{const s=L(),t=R(s.palette.mode),{error:n,callApi:i}=Y(),[o,l]=c.useState([]),[a,x]=c.useState(!1),[m,u]=c.useState(!1),[h,f]=c.useState(!1),[k,j]=c.useState(""),[D,p]=c.useState(!1),[C,g]=c.useState(!1),[A,w]=c.useState(null),[y,O]=c.useState({title:"",description:"",day:"",startDate:"",endDate:""}),[v,z]=c.useState(null),[I,J]=c.useState(null),[H,G]=c.useState(!1),[K,E]=c.useState(null);c.useEffect(()=>{if(K){const b=setTimeout(()=>E(null),5e3);return()=>clearTimeout(b)}},[K]),c.useEffect(()=>{(async()=>{const $=await i(N.EVENT,"GET");if($){console.log("Fetched events:",$);const S=$.data.map(V=>({id:V._id,title:V.title,start:V.startDate,end:V.endDate,allDay:V.startDate===V.endDate}));l(S)}else E(n||"Failed to fetch events")})()},[i,n]);const Q=b=>{const $=new Date(b.startStr),S=new Date($.getTime()+60*60*1e3);J(b),O({title:"",description:"",day:Ne(b.start,{weekday:"long"}),startDate:$.toISOString(),endDate:S.toISOString()}),x(!0)},X=async()=>{if(!sessionStorage.getItem("accessToken")){E("Please log in to add events");return}if(!y.title||!y.description||!y.day||!y.startDate||!y.endDate){E("All fields are required");return}const $=await i(N.EVENT,"POST",{title:y.title,description:y.description,day:y.day,startDate:y.startDate,endDate:y.endDate});if($){const S=$.data;l([...o,{id:S._id,title:S.title,start:S.startDate,end:S.endDate,allDay:S.startDate===S.endDate}]),x(!1),O({title:"",description:"",day:"",startDate:"",endDate:""}),j("Event created successfully"),f(!0),E(null)}else{const S=n||"Failed to create event";S.includes("Authentication required")||S.includes("No token provided")||S.includes("Invalid or expired token")?E("Please log in again to add events"):S.includes("admin only")?E("Only admins can add events"):E(S)}},T=b=>{if(!o.find(V=>V.id===b.event.id))return;const S={_id:b.event.id,title:b.event.title,description:"",day:Ne(b.event.start,{weekday:"long"}),startDate:b.event.start.toISOString(),endDate:b.event.end?b.event.end.toISOString():b.event.start.toISOString()};console.log("Selected event:",S),w(S),p(!0)},ie=()=>{p(!1),z(A),u(!0)},le=()=>{p(!1),g(!0)},Z=async()=>{if(!sessionStorage.getItem("accessToken")){E("Please log in to update events");return}if(!v.title||!v.description||!v.day||!v.startDate||!v.endDate){E("All fields are required");return}const $=await i(`${N.EVENT}/${v._id}`,"PATCH",{title:v.title,description:v.description,day:v.day,startDate:v.startDate,endDate:v.endDate});if($){const S=$.data;l(o.map(V=>V.id===S._id?{id:S._id,title:S.title,start:S.startDate,end:S.endDate,allDay:S.startDate===S.endDate}:V)),u(!1),z(null),j("Event edited successfully"),f(!0),E(null)}else{const S=n||"Failed to update event";S.includes("Authentication required")||S.includes("No token provided")||S.includes("Invalid or expired token")?E("Please log in again to update events"):S.includes("admin only")?E("Only admins can update events"):E(S)}},Me=async()=>{if(!sessionStorage.getItem("accessToken")){E("Please log in to delete events");return}if(await i(`${N.EVENT}/${A._id}`,"DELETE"))l(o.filter(S=>S.id!==A._id)),g(!1),w(null),j("Event deleted successfully"),f(!0),E(null);else{const S=n||"Failed to delete event";S.includes("Authentication required")||S.includes("No token provided")||S.includes("Invalid or expired token")?E("Please log in again to delete events"):S.includes("admin only")?E("Only admins can delete events"):E(S)}},Re=()=>{x(!1),O({title:"",description:"",day:"",startDate:"",endDate:""}),E(null)},me=()=>{u(!1),z(null),E(null)},be=()=>{p(!1),w(null)},Le=()=>{g(!1),w(null)},ye=()=>{f(!1),j("")},Pe=()=>{G(b=>!b)};return e.jsxs(d,{my:"10px",children:[K&&e.jsx(Ue,{severity:"error",sx:{mb:2},onClose:()=>E(null),children:K}),e.jsxs(d,{display:"flex",justifyContent:"center",flexDirection:"column",children:[e.jsxs(d,{flex:"1 1 20%",backgroundColor:t.primary[400],py:"15px",borderRadius:"4px",sx:{width:"100%",height:"75vh",overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(d,{display:"flex",alignItems:"center",marginBottom:"10px",children:[e.jsx(Xe,{onClick:Pe,sx:{backgroundColor:t.blueAccent[500],"&:hover":{backgroundColor:t.blueAccent[700]},padding:"10px",borderRadius:"50%"},children:H?e.jsx(Je,{}):e.jsx(Ke,{})}),e.jsx(r,{variant:"h6",sx:{marginLeft:"10px",fontWeight:"800"},children:H?"Hide Events":"Show Events"})]}),H&&e.jsx(r,{variant:"h4",sx:{marginBottom:"10px"},children:"Events"}),H&&e.jsx(Ee,{children:o.length===0?e.jsx(r,{children:"No events available"}):o.map(b=>e.jsx(ke,{sx:{backgroundColor:t.blueAccent[500],margin:"10px 0",borderRadius:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(we,{primary:b.title,secondary:e.jsx(r,{sx:{fontSize:"0.7em",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:Ne(b.start,{year:"numeric",month:"short",day:"numeric"})})})},b.id))})]}),e.jsx(d,{flex:"1 1 100%",sx:{width:"100%"},children:e.jsx(Ye,{height:"75vh",plugins:[He,Ge,ft,qe],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:"dayGridMonth",editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,select:Q,eventClick:T,events:o})})]}),e.jsx(se,{open:a,onClose:Re,title:"Add Event",onConfirm:X,confirmText:"Create",cancelText:"Cancel",showCancel:!0,children:e.jsxs(d,{p:"20px",children:[e.jsx(_,{label:"Event Title",fullWidth:!0,value:y.title,onChange:b=>O({...y,title:b.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Description",fullWidth:!0,value:y.description,onChange:b=>O({...y,description:b.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Day",fullWidth:!0,value:y.day,InputProps:{readOnly:!0},sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Start Date",type:"datetime-local",fullWidth:!0,value:y.startDate.slice(0,16),onChange:b=>O({...y,startDate:new Date(b.target.value).toISOString()}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"End Date",type:"datetime-local",fullWidth:!0,value:y.endDate.slice(0,16),onChange:b=>O({...y,endDate:new Date(b.target.value).toISOString()}),sx:{marginBottom:"20px"}})]})}),e.jsx(se,{open:m,onClose:me,title:"Edit Event",onConfirm:Z,confirmText:"Save",cancelText:"Cancel",showCancel:!0,children:e.jsxs(d,{p:"20px",children:[e.jsx(_,{label:"Event Title",fullWidth:!0,value:(v==null?void 0:v.title)||"",onChange:b=>z({...v,title:b.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Description",fullWidth:!0,value:(v==null?void 0:v.description)||"",onChange:b=>z({...v,description:b.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Day",fullWidth:!0,value:(v==null?void 0:v.day)||"",onChange:b=>z({...v,day:b.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Start Date",type:"datetime-local",fullWidth:!0,value:(v==null?void 0:v.startDate.slice(0,16))||"",onChange:b=>z({...v,startDate:new Date(b.target.value).toISOString()}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"End Date",type:"datetime-local",fullWidth:!0,value:(v==null?void 0:v.endDate.slice(0,16))||"",onChange:b=>z({...v,endDate:new Date(b.target.value).toISOString()}),sx:{marginBottom:"20px"}})]})}),e.jsx(se,{open:D,onClose:be,title:`Manage Event: ${(A==null?void 0:A.title)||""}`,onConfirm:ie,confirmText:"Edit",onCancel:le,cancelText:"Delete",showCancel:!0,children:e.jsx(d,{p:"20px",children:e.jsxs(r,{children:['Select an action for the event "',A==null?void 0:A.title,'".']})})}),e.jsx(se,{open:C,onClose:Le,title:"Confirm Delete",onConfirm:Me,confirmText:"Confirm",cancelText:"Cancel",showCancel:!0,children:e.jsx(d,{p:"20px",children:e.jsxs(r,{children:['Do you want to delete the event "',A==null?void 0:A.title,'"?']})})}),e.jsx(se,{open:h,onClose:ye,title:"Success",onConfirm:ye,confirmText:"OK",showCancel:!1,children:e.jsx(d,{p:"20px",children:e.jsx(r,{children:k})})})]})},jn=({outstandingFeesData:s})=>{const t=L(),n=R(t.palette.mode);if(console.log("Outstanding Fees Data:",s),!s||!Array.isArray(s)||s.length===0)return e.jsx(d,{children:e.jsx(r,{variant:"body1",align:"center",sx:{mt:2},children:"No outstanding fees data available"})});const i=m=>m&&typeof m=="object"&&m.id&&m.label&&typeof m.value=="number",o=["rgba(75, 192, 192, 0.6)","rgba(255, 159, 64, 0.6)","rgba(153, 102, 255, 0.6)","rgba(60, 179, 113, 0.6)","rgba(100, 149, 237, 0.6)","rgba(255, 99, 132, 0.6)"],l=m=>{const u=Math.abs(m.split("").reduce((h,f)=>h+f.charCodeAt(0),0))%o.length;return o[u]},a=s.filter(m=>i(m)&&m.value>0).map(m=>({id:m.id,label:m.label,value:m.value,color:l(m.id)})),x=s.filter(i).map(m=>({id:m.id,label:m.label,value:m.value}));return e.jsxs(d,{children:[e.jsx(r,{variant:"h6",sx:{mb:2,color:n.grey[100]},children:"Outstanding Fees by Academic Year"}),a.length===0?e.jsx(r,{variant:"body1",align:"center",children:"No outstanding fees to display"}):e.jsx("div",{style:{height:"350px"},children:e.jsx(ht,{data:a,theme:{axis:{domain:{line:{stroke:n.grey[100]}},legend:{text:{fill:n.grey[100]}},ticks:{line:{stroke:n.grey[100],strokeWidth:1},text:{fill:n.grey[100]}}},legends:{text:{fill:n.grey[100]}},tooltip:{container:{background:n.primary[400],color:n.grey[100],fontSize:12},format:m=>`₦${m.toLocaleString()}`}},margin:{top:40,right:80,bottom:80,left:80},innerRadius:.5,padAngle:.7,cornerRadius:3,activeOuterRadiusOffset:8,borderColor:{from:"color",modifiers:[["darker",.2]]},arcLinkLabelsSkipAngle:10,arcLinkLabelsTextColor:n.grey[100],arcLinkLabelsThickness:2,arcLinkLabelsColor:{from:"color"},enableArcLabels:!0,arcLabelsRadiusOffset:.4,arcLabelsSkipAngle:7,arcLabelsTextColor:{from:"color",modifiers:[["darker",2]]},arcLabelsText:m=>`₦${m.toLocaleString()}`,colors:a.map(m=>m.color),defs:[{id:"dots",type:"patternDots",background:"inherit",color:"rgba(255, 255, 255, 0.3)",size:4,padding:1,stagger:!0},{id:"lines",type:"patternLines",background:"inherit",color:"rgba(255, 255, 255, 0.3)",rotation:-45,lineWidth:6,spacing:10}],legends:[{anchor:"bottom",direction:"row",justify:!1,translateX:0,translateY:56,itemsSpacing:0,itemWidth:100,itemHeight:18,itemTextColor:"#999",itemDirection:"left-to-right",itemOpacity:1,symbolSize:18,symbolShape:"circle",effects:[{on:"hover",style:{itemTextColor:"#000"}}]}]})}),e.jsx(d,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:x.length>0?x.map(m=>e.jsxs(r,{sx:{color:n.grey[100],fontSize:12,minWidth:120},children:[m.label,": ₦",m.value.toLocaleString()]},m.id)):e.jsx(r,{variant:"body1",align:"center",children:"No valid outstanding fees data to display"})})]})},vn=()=>{const s=L(),t=R(s.palette.mode),{usersData:n}=te(At),i=n.teachers&&n.teachers.length>0?n.teachers.map(o=>({name:`${o.firstName} ${o.lastName}`.trim(),subject:o.subject&&o.subject.length>0?o.subject[0].name:"No Subject",rating:o.rating||0})).sort((o,l)=>l.rating-o.rating).slice(0,5):[];return e.jsx(d,{sx:{height:"350px",overflowY:"auto"},children:i.length>0?e.jsx(Ee,{children:i.map((o,l)=>e.jsx(ke,{sx:{backgroundColor:t.primary[400],mb:1,borderRadius:"4px"},children:e.jsx(we,{primary:`${o.name} (${o.subject})`,secondary:`Rating: ${o.rating}/5`,sx:{color:t.grey[100]}})},l))}):e.jsx(d,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx(r,{color:t.grey[100],children:"No teachers available"})})})},bn=()=>{var a;const s=L(),t=R(s.palette.mode),{enrollmentData:n,enrollmentDataLoading:i,enrollmentDataError:o}=st();if(i)return e.jsx(d,{children:"Loading..."});if(o)return e.jsxs(d,{children:["Error: ",o.message||"Failed to load data"]});if(!n||!((a=n.total)!=null&&a.length))return e.jsx(d,{children:"No enrollment data available."});const l=n.total.map(x=>({academicYear:x.academicYear,Total:x.value}));return console.log("Enrollment Chart Data:",l),e.jsxs(d,{height:"300px",children:[e.jsx(r,{variant:"h6",sx:{mb:1,color:t.grey[100],fontSize:"14px"},children:"Enrollment"}),e.jsx(zt,{data:l,keys:["Total"],indexBy:"academicYear",theme:{axis:{domain:{line:{stroke:t.grey[100]}},legend:{text:{fill:t.grey[100],fontSize:8}},ticks:{line:{stroke:t.grey[100],strokeWidth:1},text:{fill:t.grey[100],fontSize:8}}},legends:{text:{fill:t.grey[100],fontSize:8}},tooltip:{container:{background:t.primary[400],color:t.grey[100],fontSize:8}}},margin:{top:20,right:60,bottom:40,left:40},padding:.4,colors:{scheme:"nivo"},animate:!0,motionConfig:"default",axisTop:null,axisRight:null,axisBottom:{tickSize:3,tickPadding:3,tickRotation:45,legend:"Academic Year",legendPosition:"middle",legendOffset:30,truncateTickAt:0},axisLeft:{tickSize:3,tickPadding:3,tickRotation:0,legend:"Students",legendPosition:"middle",legendOffset:-30},labelSkipWidth:12,labelSkipHeight:12,labelTextColor:{from:"color",modifiers:[["darker",1.6]]},legends:[{dataFrom:"keys",anchor:"bottom-right",direction:"column",justify:!1,translateX:50,translateY:0,itemsSpacing:1,itemWidth:50,itemHeight:15,itemDirection:"left-to-right",itemOpacity:.85,symbolSize:12,effects:[{on:"hover",style:{itemOpacity:1}}]}]})]})},yn=()=>{const s=L(),t=R(s.palette.mode),[n,i]=c.useState(!0),[o,l]=c.useState(0),[a,x]=c.useState(0),[m,u]=c.useState(0),[h,f]=c.useState(null),{usersData:k,unreadEnquiriesCount:j,classLevels:D,financialData:p,outstandingFeesData:C,enrollmentData:g,loading:A,error:w}=st();if(c.useEffect(()=>{k&&(i(!1),l(k.totalStudents||0),x(k.totalTeachers||0),u(k.currentYearStudents||0)),w&&f(w.message||"An error occurred while fetching data.")},[k,w]),n||A)return e.jsx(_e,{});if(h)return e.jsx(d,{m:"20px",children:e.jsxs(r,{variant:"h4",color:"error",children:["Error: ",h]})});const y={mt:"15px",fontWeight:"bold"};return p&&[...p.primary,...p.secondary].reduce((O,v)=>O+(v.value||0),0),e.jsxs(d,{m:"20px",children:[e.jsx(r,{variant:"h3",fontWeight:"600",mb:"20px",children:"School Administration Dashboard"}),e.jsxs(nt,{children:[e.jsxs(U,{children:[e.jsx(M,{sm:6,md:3,children:e.jsxs(F,{children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Students"}),e.jsxs(d,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(bt,{sx:{fontSize:"70px",color:t.blueAccent[200]}}),e.jsx(r,{variant:"h4",color:t.blueAccent[200],sx:y,children:`${o} students`}),e.jsx(r,{children:"Total active students"})]})]})}),e.jsx(M,{sm:6,md:3,children:e.jsxs(F,{children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Teachers"}),e.jsxs(d,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(Be,{sx:{fontSize:"70px",color:t.blueAccent[200]}}),e.jsx(r,{variant:"h4",color:t.blueAccent[200],sx:y,children:`${a} teachers`}),e.jsx(r,{children:"Total teachers"})]})]})}),e.jsx(M,{sm:6,md:3,children:e.jsxs(F,{children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",children:"New Students"}),e.jsxs(d,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(St,{sx:{fontSize:"70px",color:t.blueAccent[200]}}),e.jsx(r,{variant:"h4",color:t.blueAccent[200],sx:y,children:`${m} students`}),e.jsx(r,{children:"New students this academic year"})]})]})}),e.jsx(M,{sm:6,md:3,children:e.jsxs(F,{children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Unread Enquiries"}),e.jsxs(d,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(yt,{sx:{fontSize:"70px",color:t.blueAccent[200]}}),e.jsx(r,{variant:"h4",color:t.blueAccent[200],sx:y,children:j}),e.jsx(r,{children:"Total unread enquiries"})]})]})})]}),e.jsxs(U,{children:[e.jsx(M,{md:8,children:e.jsxs(F,{noFlex:!0,children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",children:"School Fees Data"}),e.jsx(d,{mt:"10px",children:e.jsx(fn,{financialData:p})})]})}),e.jsx(M,{md:4,children:e.jsxs(F,{noFlex:!0,children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Outstanding Payments"}),e.jsx(d,{mt:"10px",children:e.jsx(jn,{outstandingFeesData:C})})]})})]}),e.jsxs(U,{children:[e.jsx(M,{md:4,children:e.jsxs(F,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",gutterBottom:!0,children:"Enrollment Stats"}),e.jsx(d,{mt:"10px",children:e.jsx(bn,{enrollmentData:g})})]})}),e.jsx(M,{md:4,children:e.jsxs(F,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",gutterBottom:!0,children:"Top Teachers"}),e.jsx(d,{mt:"10px",children:e.jsx(vn,{topTeachers:k.topTeachers})})]})}),e.jsx(M,{md:4,children:e.jsxs(F,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",gutterBottom:!0,children:"Class Distribution"}),e.jsx(d,{mt:"10px",children:e.jsx(gn,{classLevels:D})})]})})]}),e.jsx(U,{children:e.jsx(M,{md:12,children:e.jsxs(F,{noFlex:!0,children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",children:"School Activities"}),e.jsx(d,{mt:"10px",children:e.jsx(pn,{})})]})})})]})]})},ue=({progress:s=.75,size:t=40})=>{const n=L(),i=R(n.palette.mode),o=s*360,a=(x=>x>=.75?i.greenAccent[400]:x>=.5?i.greenAccent[700]:i.redAccent[700])(s);return e.jsx(d,{sx:{background:`radial-gradient(${i.primary[400]} 55%, transparent 56%),
            conic-gradient(${a} 0deg ${o}deg, ${i.blueAccent[200]} ${o}deg 360deg),
            ${i.primary[400]}`,borderRadius:"50%",width:`${t}px`,height:`${t}px`}})};function ae(){const s=gt(),t=te(u=>{var h;return(h=u.users.user)==null?void 0:h._id}),n=te(u=>{var h;return(h=u.users.user)==null?void 0:h.userId}),i=te(u=>u.adminData.currentAcademicYear),{callApi:o}=Y(),[l,a]=c.useState({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:null}),x=c.useCallback(async()=>{if(!t){a({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:"Student ID not found. Please log in."});return}a(u=>({...u,loading:!0,error:null}));try{const u=await o(`${lt}/student-dashboard/${t}`,"GET");if(u&&u.status==="success"){const{data:h}=u;s(Dt(h.currentAcademicYear||null)),a({sessionProgress:h.sessionProgress||0,termAttendance:h.termAttendance||0,feeStatus:h.feeStatus||{percentagePaid:0,totalOutstanding:0},nextClass:h.nextClass||null,missedClasses:h.missedClasses||[],subjectPerformance:h.subjectPerformance||null,allResources:h.allResources||[],assignments:h.assignments||[],timetable:h.timetable||[],loading:!1,error:null})}else a({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:(u==null?void 0:u.message)||"Failed to fetch student dashboard data"})}catch(u){a({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:u.message||"Failed to fetch student dashboard data"})}},[t,o,s]);return c.useEffect(()=>{x()},[x]),{...l,currentAcademicYear:i,formatDateToDDMMYYYY:u=>new Date(u).toLocaleDateString("en-GB"),userId:n}}const Sn=()=>{const{fetchStudentData:s,loading:t,error:n}=ae(),[i,o]=c.useState(null);if(c.useEffect(()=>{(async()=>{const x=await s();o(x)})()},[s]),t)return e.jsx(r,{children:"Loading..."});if(n)return e.jsxs(r,{children:["Error: ",n]});if(!i||i.sessionProgress===0)return e.jsx(r,{children:"No session progress data available"});const{sessionProgress:l}=i;return e.jsxs(d,{children:[e.jsx(r,{variant:"h6",fontWeight:"600",mb:"5px",children:"Session Progress"}),e.jsx(ue,{size:"125",progress:l/100}),e.jsxs(r,{variant:"body2",mt:"10px",children:["Academic year completion: ",l,"%"]})]})},Cn=()=>{const{fetchStudentData:s,loading:t,error:n}=ae(),[i,o]=c.useState(null);if(c.useEffect(()=>{(async()=>{const x=await s();o(x)})()},[s]),t)return e.jsx(r,{children:"Loading..."});if(n)return e.jsxs(r,{children:["Error: ",n]});if(!i||i.termAttendance===0)return e.jsx(r,{children:"No attendance data available"});const{termAttendance:l}=i;return e.jsxs(d,{children:[e.jsx(r,{variant:"h6",fontWeight:"600",mb:"5px",children:"Term Attendance"}),e.jsx(ue,{size:"125",progress:l/100}),e.jsxs(r,{variant:"body2",mt:"10px",children:["Current term attendance: ",l,"%"]})]})},An=()=>{const{fetchStudentData:s,loading:t,error:n}=ae(),[i,o]=c.useState(null);if(c.useEffect(()=>{(async()=>{const x=await s();o(x)})()},[s]),t)return e.jsx(r,{children:"Loading..."});if(n)return e.jsxs(r,{children:["Error: ",n]});if(!i||!i.feeStatus)return e.jsx(r,{children:"No payment data available"});const{feeStatus:l}=i;return e.jsxs(d,{children:[e.jsxs(r,{variant:"h6",fontWeight:"600",mb:"5px",children:["Fee Payment Status (",parseInt(l.percentagePaid),"%)"]}),e.jsx(ue,{size:"125",progress:l.percentagePaid/100}),e.jsxs(r,{variant:"body2",mt:"10px",children:["Outstanding Fees: $",l.totalOutstanding]})]})},Dn=()=>{const s=L(),t=R(s.palette.mode),{fetchStudentData:n,loading:i,error:o}=ae(),[l,a]=c.useState(null);if(c.useEffect(()=>{(async()=>{const u=await n();a(u)})()},[n]),i)return e.jsx(r,{children:"Loading..."});if(o)return e.jsxs(r,{children:["Error: ",o]});if(!l||!l.nextClass)return e.jsx(r,{children:"No upcoming classes"});const{nextClass:x}=l;return e.jsxs(d,{textAlign:"center",children:[e.jsx(r,{variant:"h6",fontWeight:"600",mb:"5px",children:"Next Class"}),e.jsxs(d,{children:[e.jsx(Be,{sx:{fontSize:"30px",color:t.blueAccent[400]}}),e.jsx(r,{variant:"h6",children:x.subject}),e.jsx(r,{children:x.date}),e.jsx(r,{children:x.time}),e.jsxs(r,{children:["Location: ",x.location]})]})]})},En=()=>{const s=L(),t=R(s.palette.mode),{fetchStudentData:n,loading:i,error:o}=ae(),[l,a]=c.useState(null);if(c.useEffect(()=>{(async()=>{const u=await n();a(u)})()},[n]),i)return e.jsx(r,{children:"Loading..."});if(o)return e.jsxs(r,{children:["Error: ",o]});if(!l||!l.subjectPerformance)return e.jsx(r,{children:"No performance data available"});const{subjectPerformance:x}=l;return e.jsx("div",{style:{height:"350px"},children:e.jsx(xt,{data:x,animate:!0,motionConfig:"default",theme:{axis:{domain:{line:{stroke:t.grey[100]}},legend:{text:{fill:t.grey[100],fontSize:8}},ticks:{line:{stroke:t.grey[100],strokeWidth:1},text:{fill:t.grey[100],fontSize:8}}},legends:{text:{fill:t.grey[100],fontSize:8}},tooltip:{container:{color:t.primary[500]}}},colors:{datum:"color"},margin:{top:50,right:110,bottom:50,left:60},xScale:{type:"point"},yScale:{type:"linear",min:0,max:100,stacked:!1,reverse:!1},yFormat:" >-.2f",curve:"catmullRom",axisTop:null,axisRight:null,axisBottom:{tickSize:0,tickPadding:5,tickRotation:0,legend:"Month",legendOffset:36,legendPosition:"middle"},axisLeft:{tickValues:5,tickSize:3,tickPadding:5,tickRotation:0,legend:"Score (%)",legendOffset:-40,legendPosition:"middle"},enableGridX:!1,enableGridY:!1,pointSize:8,pointColor:{theme:"background"},pointBorderWidth:1,pointBorderColor:{from:"serieColor"},pointLabelYOffset:-12,useMesh:!0,legends:[{anchor:"bottom-right",direction:"column",justify:!1,translateX:100,translateY:0,itemsSpacing:0,itemDirection:"left-to-right",itemWidth:80,itemHeight:20,itemOpacity:.75,symbolSize:12,symbolShape:"circle",symbolBorderColor:"rgba(0, 0, 0, .5)",effects:[{on:"hover",style:{itemBackground:"rgba(0, 0, 0, .03)",itemOpacity:1}}]}]})})},kn=()=>{const s=L(),t=R(s.palette.mode),{fetchStudentData:n,formatDateToDDMMYYYY:i,loading:o,error:l}=ae(),[a,x]=c.useState(null);c.useEffect(()=>{(async()=>{const f=await n();x(f)})()},[n]);const m=s.palette.mode==="light"?t.blueAccent[800]:t.greenAccent[600];if(o)return e.jsx(r,{children:"Loading..."});if(l)return e.jsxs(r,{children:["Error: ",l]});if(!a||!a.missedClasses)return e.jsx(r,{children:"No missed classes data available"});const{missedClasses:u}=a;return e.jsxs(d,{children:[e.jsx(r,{variant:"h5",fontWeight:"600",mb:"15px",children:"Missed Classes"}),u.length>0?u.map(h=>e.jsx(Te,{sx:{mb:2},children:e.jsxs(Fe,{sx:{backgroundColor:m,textAlign:"left"},children:[e.jsx(r,{variant:"h6",children:h.subject}),e.jsx(r,{children:i(h.date)}),e.jsx(r,{children:h.time}),e.jsxs(r,{children:["Location: ",h.location]})]})},h.id)):e.jsx(r,{children:"You attended all classes"})]})},wn=()=>{const s=L(),t=R(s.palette.mode),{callApi:n}=Y(),[i,o]=c.useState(null);c.useEffect(()=>{(async()=>{try{const u=await n(N.ANNOUNCEMENT,"GET");u&&u.data&&o(u.data)}catch(u){console.error("Error fetching announcements:",u)}})()},[n]);const l=s.palette.mode==="light"?t.blueAccent[800]:t.greenAccent[600],x=i||[{id:"1",title:"End of Term Exams",message:"Exams start on July 1, 2025.",date:"2025-06-20"},{id:"2",title:"Sports Day",message:"Join us on July 15, 2025.",date:"2025-06-18"}];return e.jsxs(d,{children:[e.jsx(r,{variant:"h5",fontWeight:"600",mb:"15px",children:"Announcements"}),x.length>0?x.map(m=>e.jsx(Te,{sx:{mb:2},children:e.jsxs(Fe,{sx:{backgroundColor:l,textAlign:"left"},children:[e.jsx(r,{variant:"h6",children:m.title}),e.jsx(r,{variant:"body2",children:m.message}),e.jsx(r,{variant:"caption",color:"gray",children:m.date})]})},m.id)):e.jsx(r,{children:"No announcements available"})]})},Tn=()=>{const s=L(),t=R(s.palette.mode),{allResources:n}=ae(),o=n||[{title:"Math Textbook",url:"https://example.com/math-textbook.pdf"},{title:"Science Notes",url:"https://example.com/science-notes.pdf"}],l=s.palette.mode==="light"?t.blueAccent[800]:t.greenAccent[600];return e.jsxs(d,{children:[e.jsx(r,{variant:"h5",fontWeight:"600",mb:"15px",children:"Useful Resources"}),o.length>0?o.map((a,x)=>e.jsx(Te,{sx:{mb:2},children:e.jsxs(Fe,{sx:{backgroundColor:l,textAlign:"left"},children:[e.jsx(r,{variant:"h6",children:a.title}),e.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",children:a.url})]})},x)):e.jsx(r,{children:"No Resources Available"})]})},Fn=()=>{const s=L(),t=R(s.palette.mode),{error:n,callApi:i}=Y(),[o,l]=c.useState([]),[a,x]=c.useState(!1),[m,u]=c.useState(null);c.useEffect(()=>{if(m){const f=setTimeout(()=>u(null),5e3);return()=>clearTimeout(f)}},[m]),c.useEffect(()=>{(async()=>{const k=sessionStorage.getItem("accessToken"),j=k?{Authorization:`Bearer ${k}`}:{},D=await i(N.EVENT,"GET",null,j);if(D){console.log("Fetched events:",D);const p=D.data.map(C=>({id:C._id,title:C.title,start:C.startDate,end:C.endDate,allDay:C.startDate===C.endDate}));l(p)}else{const p=n||"Failed to fetch events";p.includes("Authentication required")||p.includes("No token provided")||p.includes("Invalid or expired token")?u("Please log in to view events"):u(p)}})()},[i,n]);const h=()=>{x(f=>!f)};return e.jsxs(d,{my:"10px",children:[m&&e.jsx(Ue,{severity:"error",sx:{mb:2},onClose:()=>u(null),children:m}),e.jsxs(d,{display:"flex",justifyContent:"center",flexDirection:"column",children:[e.jsxs(d,{flex:"1 1 20%",backgroundColor:t.primary[400],py:"15px",borderRadius:"4px",sx:{width:"100%",height:"70vh",overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(d,{display:"flex",alignItems:"center",marginBottom:"10px",children:[e.jsx(Xe,{onClick:h,sx:{backgroundColor:t.blueAccent[500],"&:hover":{backgroundColor:t.blueAccent[700]},padding:"10px",borderRadius:"50%"},children:a?e.jsx(Je,{}):e.jsx(Ke,{})}),e.jsx(r,{variant:"h6",sx:{marginLeft:"10px",fontWeight:"800"},children:a?"Hide Events":"Show Events"})]}),a&&e.jsx(r,{variant:"h4",sx:{marginBottom:"10px"},children:"Events"}),a&&e.jsx(Ee,{children:o.length===0?e.jsx(r,{children:"No events available"}):o.map(f=>e.jsx(ke,{sx:{backgroundColor:t.blueAccent[500],margin:"10px 0",borderRadius:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(we,{primary:f.title,secondary:e.jsx(r,{sx:{fontSize:"0.7em",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:new Date(f.start).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})})},f.id))})]}),e.jsx(d,{flex:"1 1 100%",sx:{width:"100%"},children:e.jsx(Ye,{height:"70vh",plugins:[He,Ge,qe],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:"dayGridMonth",editable:!1,selectable:!1,dayMaxEvents:!0,events:o})})]})]})},Mn=()=>{const s=L();R(s.palette.mode);const[t,n]=c.useState(!0),[i,o]=c.useState(null),{loading:l,error:a}=ae();return c.useEffect(()=>{l||n(!1),a&&o(a.message||"An error occurred while fetching data.")},[l,a]),t||l?e.jsx(_e,{}):i?e.jsx(d,{m:"20px",children:e.jsxs(r,{variant:"h4",color:"error",children:["Error: ",i]})}):e.jsxs(d,{m:"20px",children:[e.jsx(r,{variant:"h3",fontWeight:"600",mb:"20px",children:"Student Dashboard"}),e.jsxs(nt,{children:[e.jsxs(U,{children:[e.jsx(M,{sm:6,md:3,children:e.jsx(F,{children:e.jsx(Sn,{})})}),e.jsx(M,{sm:6,md:3,children:e.jsx(F,{children:e.jsx(Cn,{})})}),e.jsx(M,{sm:6,md:3,children:e.jsx(F,{children:e.jsx(An,{})})}),e.jsx(M,{sm:6,md:3,children:e.jsx(F,{noFlex:!0,children:e.jsx(Dn,{})})})]}),e.jsxs(U,{children:[e.jsx(M,{md:8,children:e.jsxs(F,{height:"350px",noFlex:!0,children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",mb:"10px",children:"Subject Performance"}),e.jsx(En,{})]})}),e.jsx(M,{md:4,children:e.jsx(F,{noFlex:!0,children:e.jsx(kn,{})})})]}),e.jsxs(U,{children:[e.jsx(M,{md:6,children:e.jsx(F,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx(wn,{})})}),e.jsx(M,{md:6,children:e.jsx(F,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx(Tn,{})})})]}),e.jsx(U,{children:e.jsx(M,{md:12,children:e.jsxs(F,{noFlex:!0,children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",mb:"10px",children:"School Activities"}),e.jsx(Fn,{})]})})})]})]})};function oe(){const[s,t]=c.useState({termProgress:0,studentAttendance:0,assignmentSubmissionRate:{totalAssignmentRate:0},nextClass:null,topStudents:[],leastActiveStudents:[],loading:!1,error:null}),{callApi:n}=Y(),i=te(l=>{var a;return(a=l.users.user)==null?void 0:a._id}),o=c.useCallback(async()=>{if(!i){t(l=>({...l,loading:!1,error:"Teacher ID not found. Please log in."}));return}t(l=>({...l,loading:!0,error:null}));try{const l=await n(`${lt}/teacher-dashboard/${i}`,"GET");if(l&&l.status==="success"){const{data:a}=l;t({termProgress:a.termProgress||0,studentAttendance:a.studentAttendance||0,assignmentSubmissionRate:a.assignmentSubmissionRate||{totalAssignmentRate:0},nextClass:a.nextClass||null,topStudents:a.topStudents||[],leastActiveStudents:a.leastActiveStudents||[],loading:!1,error:null})}else t(a=>({...a,loading:!1,error:(l==null?void 0:l.message)||"Failed to fetch teacher dashboard data"}))}catch(l){t(a=>({...a,loading:!1,error:l.message||"Failed to fetch teacher dashboard data"}))}},[i,n]);return c.useEffect(()=>{o()},[o]),s}const Rn=()=>{const s=L(),t=R(s.palette.mode),{termProgress:n}=oe();return e.jsxs(d,{display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Term Progress"}),e.jsx(d,{mt:"25px",children:n>0?e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:"125",progress:n/100}),e.jsx(r,{variant:"h5",color:t.blueAccent[500],sx:{mt:"15px"},children:`${n}% completed`}),e.jsx(r,{children:"Current term completion"})]}):e.jsx(r,{variant:"body2",color:t.grey[300],children:"No term progress available."})})]})},Ln=()=>{const s=L(),t=R(s.palette.mode),{studentAttendance:n}=oe();return e.jsxs(d,{display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Student Attendance"}),e.jsx(d,{mt:"25px",children:n>0?e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:"125",progress:n/100}),e.jsx(r,{variant:"h5",color:t.blueAccent[500],sx:{mt:"15px"},children:`${n}% attendance rate`}),e.jsx(r,{children:"Average student attendance"})]}):e.jsx(r,{variant:"body2",color:t.grey[300],children:"No attendance data available."})})]})},Pn=()=>{const s=L(),t=R(s.palette.mode),{assignmentSubmissionRate:n}=oe();return e.jsxs(d,{display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(r,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Assignment Submissions"}),e.jsx(d,{mt:"25px",children:n&&n.totalAssignmentRate>0?e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:"125",progress:n.totalAssignmentRate/100}),e.jsx(r,{variant:"h5",color:t.blueAccent[500],sx:{mt:"15px"},children:`${n.totalAssignmentRate}% submission rate`}),e.jsx(r,{children:"Average assignment submission rate"})]}):e.jsx(r,{variant:"body2",color:t.grey[300],children:"No submission data available."})})]})},On=()=>{const s=L(),t=R(s.palette.mode),{nextClass:n}=oe();return e.jsxs(d,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",children:[e.jsx(r,{variant:"h5",fontWeight:"600",mb:"15px",textAlign:"center",children:"Next Class"}),n?e.jsxs(d,{textAlign:"center",children:[e.jsx(Be,{sx:{fontSize:"50px",color:t.blueAccent[500]}}),e.jsx(r,{variant:"h6",children:n.subject}),e.jsx(r,{children:n.date}),e.jsx(r,{children:n.time}),e.jsxs(r,{children:["Location: ",n.location]})]}):e.jsx(r,{variant:"body2",color:t.grey[300],children:"No upcoming classes scheduled."})]})},Nn=()=>{const s=L(),t=R(s.palette.mode),{error:n,callApi:i}=Y(),[o,l]=c.useState([]),[a,x]=c.useState(!1),[m,u]=c.useState(null);c.useEffect(()=>{if(m){const f=setTimeout(()=>u(null),5e3);return()=>clearTimeout(f)}},[m]),c.useEffect(()=>{(async()=>{const k=sessionStorage.getItem("accessToken"),j=k?{Authorization:`Bearer ${k}`}:{},D=await i(N.EVENT,"GET",null,j);if(D){console.log("Fetched events:",D);const p=D.data.map(C=>({id:C._id,title:C.title,start:C.startDate,end:C.endDate,allDay:C.startDate===C.endDate}));l(p)}else{const p=n||"Failed to fetch events";p.includes("Authentication required")||p.includes("No token provided")||p.includes("Invalid or expired token")?u("Please log in to view events"):u(p)}})()},[i,n]);const h=()=>{x(f=>!f)};return e.jsxs(d,{my:"10px",children:[m&&e.jsx(Ue,{severity:"error",sx:{mb:2},onClose:()=>u(null),children:m}),e.jsx(r,{variant:"h5",fontWeight:"600",mb:"15px",children:"Event Calendar"}),e.jsxs(d,{display:"flex",justifyContent:"center",flexDirection:"column",children:[e.jsxs(d,{flex:"1 1 20%",backgroundColor:t.primary[400],py:"15px",borderRadius:"4px",sx:{width:"100%",height:"70vh",overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(d,{display:"flex",alignItems:"center",marginBottom:"10px",children:[e.jsx(Xe,{onClick:h,sx:{backgroundColor:t.blueAccent[500],"&:hover":{backgroundColor:t.blueAccent[700]},padding:"10px",borderRadius:"50%"},children:a?e.jsx(Je,{}):e.jsx(Ke,{})}),e.jsx(r,{variant:"h6",sx:{marginLeft:"10px",fontWeight:"800"},children:a?"Hide Events":"Show Events"})]}),a&&e.jsx(r,{variant:"h4",sx:{marginBottom:"10px"},children:"Events"}),a&&e.jsx(Ee,{children:o.length===0?e.jsx(r,{children:"No events available"}):o.map(f=>e.jsx(ke,{sx:{backgroundColor:t.blueAccent[500],margin:"10px 0",borderRadius:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(we,{primary:f.title,secondary:e.jsx(r,{sx:{fontSize:"0.7em",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:new Date(f.start).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})})},f.id))})]}),e.jsx(d,{flex:"1 1 100%",sx:{width:"100%"},children:e.jsx(Ye,{height:"70vh",plugins:[He,Ge,qe,ft],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:"dayGridMonth",editable:!1,selectable:!1,dayMaxEvents:!0,events:o})})]})]})},zn=()=>{const s=L(),t=R(s.palette.mode),{callApi:n}=Y(),[i,o]=c.useState(null);c.useEffect(()=>{(async()=>{try{const u=await n(N.ANNOUNCEMENT,"GET");u&&u.data&&o(u.data)}catch(u){console.error("Error fetching announcements:",u)}})()},[n]);const l=s.palette.mode==="light"?t.blueAccent[800]:t.greenAccent[600],x=i||[{id:"1",title:"End of Term Exams",message:"Exams start on July 1, 2025.",date:"2025-06-20"},{id:"2",title:"Teachers Meeting",message:"Meeting on July 10, 2025.",date:"2025-06-18"}];return e.jsxs(d,{children:[e.jsx(r,{variant:"h5",fontWeight:"600",mb:"15px",children:"Announcements"}),x.length>0?x.map(m=>e.jsx(Te,{sx:{mb:2},children:e.jsxs(Fe,{sx:{backgroundColor:l,textAlign:"left"},children:[e.jsx(r,{variant:"h6",children:m.title}),e.jsx(r,{variant:"body2",children:m.message}),e.jsx(r,{variant:"caption",color:"gray",children:m.date})]})},m.id)):e.jsx(r,{children:"No announcements available"})]})},In=()=>{const s=L(),t=R(s.palette.mode),{topStudents:n}=oe(),i=s.palette.mode==="light"?t.greenAccent[300]:t.primary[500];return e.jsxs(d,{children:[e.jsx(r,{variant:"h5",fontWeight:"600",mb:"15px",children:"Top Students by Performance"}),n&&n.length>0?n.map((o,l)=>e.jsxs(d,{display:"flex",alignItems:"center",justifyContent:"flex-start",mb:2,backgroundColor:i,p:"15px",borderRadius:"8px",sx:{boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx(mt,{src:o.profilePicture||"",alt:`${o.firstName} ${o.lastName}`,sx:{width:50,height:50,mr:2}}),e.jsxs(d,{children:[e.jsx(r,{variant:"h6",color:"white",children:`${o.firstName} ${o.lastName}`}),e.jsxs(r,{variant:"body2",color:"white",children:["Performance Score: ",o.performanceScore,"%"]})]})]},l)):e.jsx(r,{variant:"body2",color:t.grey[300],children:"No top students available."})]})},$n=()=>{const s=L(),t=R(s.palette.mode),{leastActiveStudents:n}=oe(),i=s.palette.mode==="light"?t.greenAccent[300]:t.primary[500];return e.jsxs(d,{children:[e.jsx(r,{variant:"h5",fontWeight:"600",mb:"15px",children:"Least Active Students"}),n&&n.length>0?n.map((o,l)=>e.jsxs(d,{display:"flex",alignItems:"center",justifyContent:"flex-start",mb:2,backgroundColor:i,p:"15px",borderRadius:"8px",sx:{boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx(mt,{src:o.profilePicture||"",alt:`${o.firstName} ${o.lastName}`,sx:{width:50,height:50,mr:2}}),e.jsxs(d,{children:[e.jsx(r,{variant:"h6",color:"white",children:`${o.firstName} ${o.lastName}`}),e.jsxs(r,{variant:"body2",color:"white",children:["Activity Rate: ",o.activityRate,"%"]})]})]},l)):e.jsx(r,{variant:"body2",color:t.grey[300],children:"No least active students available."})]})},Wn=()=>{const s=L();R(s.palette.mode),ot(s.breakpoints.down("sm")),ot(s.breakpoints.between("sm","md"));const[t,n]=c.useState(!0),[i,o]=c.useState(null),{loading:l,error:a}=oe();return c.useEffect(()=>{l||n(!1),a&&o(a.message||"An error occurred while fetching data.")},[l,a]),t||l?e.jsx(_e,{}):i?e.jsx(d,{m:"20px",children:e.jsxs(r,{variant:"h4",color:"error",children:["Error: ",i]})}):e.jsxs(d,{m:"20px",children:[e.jsx(r,{variant:"h3",fontWeight:"600",mb:"20px",children:"Teacher Dashboard"}),e.jsxs(nt,{children:[e.jsxs(U,{children:[e.jsx(M,{sm:6,md:3,children:e.jsx(F,{children:e.jsx(Rn,{})})}),e.jsx(M,{sm:6,md:3,children:e.jsx(F,{children:e.jsx(Ln,{})})}),e.jsx(M,{sm:6,md:3,children:e.jsx(F,{children:e.jsx(Pn,{})})}),e.jsx(M,{sm:6,md:3,children:e.jsx(F,{children:e.jsx(On,{})})})]}),e.jsxs(U,{children:[e.jsx(M,{md:8,children:e.jsx(F,{noFlex:!0,moreStyles:{height:"500px",overflowY:"auto"},children:e.jsx(Nn,{})})}),e.jsx(M,{md:4,children:e.jsx(F,{noFlex:!0,moreStyles:{height:"500px",overflowY:"auto"},children:e.jsx(zn,{})})})]}),e.jsxs(U,{children:[e.jsx(M,{md:6,children:e.jsx(F,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx(In,{})})}),e.jsx(M,{md:6,children:e.jsx(F,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx($n,{})})})]})]})]})};var at={},_n=ve;Object.defineProperty(at,"__esModule",{value:!0});var fe=at.default=void 0,Vn=_n(je()),Bn=e;fe=at.default=(0,Vn.default)((0,Bn.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-7 9h-2V5h2zm0 4h-2v-2h2z"}),"Announcement");const Yn=({openAnnouncementModal:s,setModalOpen:t})=>{var C;const n=te(g=>g.users.user),[i,o]=c.useState({title:"",message:"",dueDate:"",classLevel:"",subclass:""}),[l,a]=c.useState([]),{data:x,loading:m,callApi:u}=Y(),[h,f]=c.useState(!1),[k,j]=c.useState("");c.useEffect(()=>{if(!n||!n._id){j("User not authenticated. Please log in again."),f(!0);return}n.role==="teacher"&&s&&(async()=>{try{const A=await u(`${N.ACADEMIC_CLASSES}/assigned`,"GET");A&&A.data?a(A.data):(j("No assigned classes found."),f(!0))}catch(A){j("Failed to load assigned classes: "+A.message),f(!0)}})()},[s,n,u]);const D=g=>{const{name:A,value:w}=g.target;o(y=>({...y,[A]:w,...A==="classLevel"?{subclass:""}:{}}))},p=async()=>{if(!n||!n._id){j("User not authenticated. Please log in again."),f(!0);return}const{title:g,message:A,dueDate:w,classLevel:y,subclass:O}=i;if(!g||!A||!w){j("Please fill all required fields (title, message, due date)."),f(!0);return}if(n.role==="teacher"&&(!y||!O)){j("Please select a class level and subclass."),f(!0);return}const v=n.role==="teacher"?{title:g,message:A,date:w,createdBy:n._id,targets:[{classLevel:y,subclass:O}]}:{title:g,message:A,date:w,createdBy:n._id},z=n.role==="teacher"?`${N.ANNOUNCEMENT}/class`:`${N.ANNOUNCEMENT}/general`;try{const I=await u(z,"POST",v);I&&I.status==="success"&&I.data&&I.data.announcement?(o({title:"",message:"",dueDate:"",classLevel:"",subclass:""}),j(""),t(!1),f(!0)):(j("Failed to submit announcement. Please try again."),f(!0))}catch(I){j(I.message||"Failed to submit announcement."),f(!0)}};return!n||!n._id?e.jsx(se,{open:s,onClose:()=>t(!1),title:"Make Announcement",children:e.jsx(d,{sx:{display:"flex",justifyContent:"center",padding:2},children:e.jsx($t,{})})}):e.jsxs(e.Fragment,{children:[e.jsx(se,{open:s,onClose:()=>t(!1),title:"Make Announcement",onConfirm:p,children:e.jsxs(d,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(_,{label:"Title",name:"title",value:i.title,onChange:D,fullWidth:!0,required:!0}),e.jsx(_,{label:"Message",name:"message",value:i.message,onChange:D,fullWidth:!0,multiline:!0,rows:4,required:!0}),e.jsx(_,{label:"Due Date",name:"dueDate",type:"date",value:i.dueDate,onChange:D,fullWidth:!0,InputLabelProps:{shrink:!0},required:!0}),n.role==="teacher"&&e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{fullWidth:!0,children:[e.jsx($e,{children:"Class Level"}),e.jsx(We,{name:"classLevel",value:i.classLevel,onChange:D,required:!0,children:l.map(g=>e.jsxs(pe,{value:g._id,children:[g.section," ",g.name]},g._id))})]}),e.jsxs(Ie,{fullWidth:!0,children:[e.jsx($e,{children:"Subclass"}),e.jsx(We,{name:"subclass",value:i.subclass,onChange:D,required:!0,disabled:!i.classLevel,children:i.classLevel&&((C=l.find(g=>g._id===i.classLevel))==null?void 0:C.subclasses.map(g=>e.jsx(pe,{value:g.letter,children:g.letter},g.letter)))})]})]})]})}),e.jsx(pt,{open:h,isLoading:m,onClose:()=>f(!1),title:"Announcement Submission",message:x&&x.status==="success"?"Announcement submitted successfully!":k||"Could not submit announcement. Please try again."})]})},Hn=({openFeedbackModal:s,setModalOpen:t})=>{const[n,i]=c.useState(""),[o,l]=c.useState(""),[a,x]=c.useState(""),[m,u]=c.useState(""),{data:h,loading:f,error:k,callApi:j}=Y(),[D,p]=c.useState(!1),C=async()=>{const g={name:n,role:o,date:a,comments:m};await j(N.FEEDBACKS,"POST",g),k?console.error("Error submitting feedback:",k):(p(!0),i(""),l(""),x(""),u(""))};return e.jsxs(e.Fragment,{children:[e.jsx(se,{open:s,onClose:()=>t(!1),title:"Send Feedbacks",onConfirm:C,children:e.jsxs(d,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(_,{label:"Name",value:n,onChange:g=>i(g.target.value),fullWidth:!0,margin:"normal"}),e.jsxs(Ie,{fullWidth:!0,margin:"normal",children:[e.jsx($e,{children:"Role"}),e.jsxs(We,{value:o,onChange:g=>l(g.target.value),children:[e.jsx(pe,{value:"Student",children:"Student"}),e.jsx(pe,{value:"Instructor",children:"Instructor"}),e.jsx(pe,{value:"Worker",children:"Worker"})]})]}),e.jsx(_,{label:"Date",type:"date",value:a,onChange:g=>x(g.target.value),fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0}}),e.jsx(_,{label:"Comments",value:m,onChange:g=>u(g.target.value),fullWidth:!0,margin:"normal",multiline:!0,rows:4})]})}),e.jsx(pt,{open:D,isLoading:f,onClose:()=>p(!1),title:"Feedback confirmation",message:h?"Feedback submitted successfully!":"Could not submit announcement."})]})},Gn=({home:s})=>{const[t,n]=c.useState(!1),[i,o]=c.useState(!1),l=L();R(l.palette.mode);const a=te(x=>x.users.user);return console.log("user:",a),!a||!a.firstName?e.jsx(d,{children:e.jsx(r,{children:"Loading user data..."})}):e.jsxs(d,{children:[e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(Nt,{home:!0,title:a.firstName,subtitle:"Welcome to your dashboard"}),e.jsxs(d,{sx:{display:"flex",gap:"10px"},children:[a.role==="admin"&&e.jsxs(d,{sx:{display:"flex",flexDirection:{xs:"column",sm:"column",md:"row"},alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(xe,{icon:e.jsx(vt,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Download Reports"}),e.jsx(xe,{icon:e.jsx(fe,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Make announcement",onClick:()=>o(!0)})]}),a.role==="teacher"&&e.jsxs(d,{sx:{display:"flex",flexDirection:{xs:"column",sm:"column",md:"row"},alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(xe,{icon:e.jsx(fe,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Make announcement",onClick:()=>o(!0)}),e.jsx(xe,{icon:e.jsx(fe,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Submit Feedback",onClick:()=>n(!0)}),e.jsxs(d,{children:[e.jsx(tn,{sx:{fontSize:{xs:"1em",sm:"1.2em"}},value:a.rating,readOnly:!0,precision:.1}),e.jsxs(r,{variant:"h6",sx:{fontSize:{xs:"0.8em",sm:"1em"}},children:["Rating: ",a.rating]})]})]}),a.role==="student"&&e.jsx(d,{sx:{display:"flex",flexDirection:{xs:"column",sm:"column",md:"row"},alignItems:"center",justifyContent:"center",gap:"10px"},children:e.jsx(xe,{icon:e.jsx(fe,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Submit Feedback",onClick:()=>n(!0)})}),e.jsx(Yn,{openAnnouncementModal:i,setModalOpen:o}),e.jsx(Hn,{openFeedbackModal:t,setModalOpen:n})]})]}),a.role==="admin"||a.role==="superadmin"?e.jsx(yn,{user:a}):a.role==="student"?e.jsx(Mn,{user:a}):a.role==="teacher"?e.jsx(Wn,{user:a}):null]})},qn=It(Gn),ys=()=>e.jsx("div",{children:e.jsx(qn,{home:!0})});export{ys as default};
