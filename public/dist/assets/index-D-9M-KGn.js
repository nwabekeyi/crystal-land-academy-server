import{r as x,j as n,a as q,e as O,s as V,k as pe,l as ge,n as K,o as B,f as ye,u as xe}from"./index-BdybpPeh.js";import{L as ve}from"./loadingButton-BLWVx6oC.js";import{u as be,M as z}from"./MenuItem-DmfVB64U.js";import{z as ne,A as Se,_ as A,C as ke,b as u,D as je,E as we,F as Ce,G as Te,H as Re,J as Me,R as Pe,K as Le,k as Ee,d as re,l as Q,r as W,N as Fe,O as Ae,Q as Ie,e as ae,g as ie,S as X,U as Z,u as Y,V as Oe,s as le,a as _e,W as ee,i as Ve,X as De,o as $e,h as ce,T as F,c as N,Y as Ne,v as T,Z as H,$ as Be,a0 as ze,y as te}from"./TextField-kKLYiU0N.js";import{I as U}from"./IconButton-ngG_4x53.js";const We=["ownerState"],He=["variants"],Ue=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function Ge(e){return Object.keys(e).length===0}function qe(e){return typeof e=="string"&&e.charCodeAt(0)>96}function G(e){return e!=="ownerState"&&e!=="theme"&&e!=="sx"&&e!=="as"}const Ye=ne(),Je=e=>e&&e.charAt(0).toLowerCase()+e.slice(1);function D({defaultTheme:e,theme:t,themeId:s}){return Ge(t)?e:t[s]||t}function Ke(e){return e?(t,s)=>s[e]:null}function $(e,t){let{ownerState:s}=t,o=A(t,We);const r=typeof e=="function"?e(u({ownerState:s},o)):e;if(Array.isArray(r))return r.flatMap(i=>$(i,u({ownerState:s},o)));if(r&&typeof r=="object"&&Array.isArray(r.variants)){const{variants:i=[]}=r;let l=A(r,He);return i.forEach(a=>{let c=!0;typeof a.props=="function"?c=a.props(u({ownerState:s},o,s)):Object.keys(a.props).forEach(f=>{(s==null?void 0:s[f])!==a.props[f]&&o[f]!==a.props[f]&&(c=!1)}),c&&(Array.isArray(l)||(l=[l]),l.push(typeof a.style=="function"?a.style(u({ownerState:s},o,s)):a.style))}),l}return r}function Qe(e={}){const{themeId:t,defaultTheme:s=Ye,rootShouldForwardProp:o=G,slotShouldForwardProp:r=G}=e,i=d=>we(u({},d,{theme:D(u({},d,{defaultTheme:s,themeId:t}))}));return i.__mui_systemSx=!0,(d,l={})=>{Se(d,y=>y.filter(b=>!(b!=null&&b.__mui_systemSx)));const{name:a,slot:c,skipVariantsResolver:f,skipSx:p,overridesResolver:h=Ke(Je(c))}=l,g=A(l,Ue),S=f!==void 0?f:c&&c!=="Root"&&c!=="root"||!1,v=p||!1;let R,k=G;c==="Root"||c==="root"?k=o:c?k=r:qe(d)&&(k=void 0);const m=ke(d,u({shouldForwardProp:k,label:R},g)),w=y=>typeof y=="function"&&y.__emotion_real!==y||je(y)?b=>$(y,u({},b,{theme:D({theme:b.theme,defaultTheme:s,themeId:t})})):y,L=(y,...b)=>{let E=w(y);const P=b?b.map(w):[];a&&h&&P.push(C=>{const j=D(u({},C,{defaultTheme:s,themeId:t}));if(!j.components||!j.components[a]||!j.components[a].styleOverrides)return null;const I=j.components[a].styleOverrides,_={};return Object.entries(I).forEach(([he,me])=>{_[he]=$(me,u({},C,{theme:j}))}),h(C,_)}),a&&!S&&P.push(C=>{var j;const I=D(u({},C,{defaultTheme:s,themeId:t})),_=I==null||(j=I.components)==null||(j=j[a])==null?void 0:j.variants;return $({variants:_},u({},C,{theme:I}))}),v||P.push(i);const M=P.length-b.length;if(Array.isArray(y)&&M>0){const C=new Array(M).fill("");E=[...y,...C],E.raw=[...y.raw,...C]}const J=m(E,...P);return d.muiName&&(J.muiName=d.muiName),J};return m.withConfig&&(L.withConfig=m.withConfig),L}}const Xe=Qe();function Ze(e){const{theme:t,name:s,props:o}=e;return!t||!t.components||!t.components[s]||!t.components[s].defaultProps?o:Ce(t.components[s].defaultProps,o)}function et({props:e,name:t,defaultTheme:s,themeId:o}){let r=Te(s);return o&&(r=r[o]||r),Ze({theme:r,name:t,props:e})}const ue=x.createContext(null);function de(){return x.useContext(ue)}const tt=typeof Symbol=="function"&&Symbol.for,st=tt?Symbol.for("mui.nested"):"__THEME_NESTED__";function ot(e,t){return typeof t=="function"?t(e):u({},e,t)}function nt(e){const{children:t,theme:s}=e,o=de(),r=x.useMemo(()=>{const i=o===null?s:ot(o,s);return i!=null&&(i[st]=o!==null),i},[s,o]);return n.jsx(ue.Provider,{value:r,children:t})}const se={};function oe(e,t,s,o=!1){return x.useMemo(()=>{const r=e&&t[e]||t;if(typeof s=="function"){const i=s(r),d=e?u({},t,{[e]:i}):i;return o?()=>d:d}return e?u({},t,{[e]:s}):u({},t,s)},[e,t,s,o])}function rt(e){const{children:t,theme:s,themeId:o}=e,r=Re(se),i=de()||se,d=oe(o,r,s),l=oe(o,i,s,!0),a=d.direction==="rtl";return n.jsx(nt,{theme:l,children:n.jsx(Me.Provider,{value:d,children:n.jsx(Pe,{value:a,children:n.jsx(Le,{value:d==null?void 0:d.components,children:t})})})})}const at=["component","direction","spacing","divider","children","className","useFlexGap"],it=ne(),lt=Xe("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root});function ct(e){return et({props:e,name:"MuiStack",defaultTheme:it})}function ut(e,t){const s=x.Children.toArray(e).filter(Boolean);return s.reduce((o,r,i)=>(o.push(r),i<s.length-1&&o.push(x.cloneElement(t,{key:`separator-${i}`})),o),[])}const dt=e=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[e],ft=({ownerState:e,theme:t})=>{let s=u({display:"flex",flexDirection:"column"},Q({theme:t},W({values:e.direction,breakpoints:t.breakpoints.values}),o=>({flexDirection:o})));if(e.spacing){const o=Fe(t),r=Object.keys(t.breakpoints.values).reduce((a,c)=>((typeof e.spacing=="object"&&e.spacing[c]!=null||typeof e.direction=="object"&&e.direction[c]!=null)&&(a[c]=!0),a),{}),i=W({values:e.direction,base:r}),d=W({values:e.spacing,base:r});typeof i=="object"&&Object.keys(i).forEach((a,c,f)=>{if(!i[a]){const h=c>0?i[f[c-1]]:"column";i[a]=h}}),s=Ae(s,Q({theme:t},d,(a,c)=>e.useFlexGap?{gap:X(o,a)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${dt(c?i[c]:e.direction)}`]:X(o,a)}}))}return s=Ie(t.breakpoints,s),s};function ht(e={}){const{createStyledComponent:t=lt,useThemeProps:s=ct,componentName:o="MuiStack"}=e,r=()=>ae({root:["root"]},a=>ie(o,a),{}),i=t(ft);return x.forwardRef(function(a,c){const f=s(a),p=Ee(f),{component:h="div",direction:g="column",spacing:S=0,divider:v,children:R,className:k,useFlexGap:m=!1}=p,w=A(p,at),L={direction:g,spacing:S,useFlexGap:m},y=r();return n.jsx(i,u({as:h,ownerState:L,ref:c,className:re(y.root,k)},w,{children:v?ut(R,v):R}))})}const mt=["theme"];function pt(e){let{theme:t}=e,s=A(e,mt);const o=t[Z];let r=o||t;return typeof t!="function"&&(o&&!o.vars?r=u({},o,{vars:null}):t&&!t.vars&&(r=u({},t,{vars:null}))),n.jsx(rt,u({},s,{themeId:o?Z:void 0,theme:r}))}const gt=(e,t)=>u({WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",boxSizing:"border-box",WebkitTextSizeAdjust:"100%"},t&&!e.vars&&{colorScheme:e.palette.mode}),yt=e=>u({color:(e.vars||e).palette.text.primary},e.typography.body1,{backgroundColor:(e.vars||e).palette.background.default,"@media print":{backgroundColor:(e.vars||e).palette.common.white}}),xt=(e,t=!1)=>{var s;const o={};t&&e.colorSchemes&&Object.entries(e.colorSchemes).forEach(([d,l])=>{var a;o[e.getColorSchemeSelector(d).replace(/\s*&/,"")]={colorScheme:(a=l.palette)==null?void 0:a.mode}});let r=u({html:gt(e,t),"*, *::before, *::after":{boxSizing:"inherit"},"strong, b":{fontWeight:e.typography.fontWeightBold},body:u({margin:0},yt(e),{"&::backdrop":{backgroundColor:(e.vars||e).palette.background.default}})},o);const i=(s=e.components)==null||(s=s.MuiCssBaseline)==null?void 0:s.styleOverrides;return i&&(r=[r,i]),r};function vt(e){const t=Y({props:e,name:"MuiCssBaseline"}),{children:s,enableColorScheme:o=!1}=t;return n.jsxs(x.Fragment,{children:[n.jsx(Oe,{styles:r=>xt(r,o)}),s]})}const bt=ht({createStyledComponent:le("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root}),useThemeProps:e=>Y({props:e,name:"MuiStack"})});function St(e){return ie("MuiLink",e)}const kt=_e("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]),fe={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},jt=e=>fe[e]||e,wt=({theme:e,ownerState:t})=>{const s=jt(t.color),o=ee(e,`palette.${s}`,!1)||t.color,r=ee(e,`palette.${s}Channel`);return"vars"in e&&r?`rgba(${r} / 0.4)`:Ve(o,.4)},Ct=["className","color","component","onBlur","onFocus","TypographyClasses","underline","variant","sx"],Tt=e=>{const{classes:t,component:s,focusVisible:o,underline:r}=e,i={root:["root",`underline${ce(r)}`,s==="button"&&"button",o&&"focusVisible"]};return ae(i,St,t)},Rt=le(F,{name:"MuiLink",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,t[`underline${ce(s.underline)}`],s.component==="button"&&t.button]}})(({theme:e,ownerState:t})=>u({},t.underline==="none"&&{textDecoration:"none"},t.underline==="hover"&&{textDecoration:"none","&:hover":{textDecoration:"underline"}},t.underline==="always"&&u({textDecoration:"underline"},t.color!=="inherit"&&{textDecorationColor:wt({theme:e,ownerState:t})},{"&:hover":{textDecorationColor:"inherit"}}),t.component==="button"&&{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},[`&.${kt.focusVisible}`]:{outline:"auto"}})),Mt=x.forwardRef(function(t,s){const o=Y({props:t,name:"MuiLink"}),{className:r,color:i="primary",component:d="a",onBlur:l,onFocus:a,TypographyClasses:c,underline:f="always",variant:p="inherit",sx:h}=o,g=A(o,Ct),{isFocusVisibleRef:S,onBlur:v,onFocus:R,ref:k}=De(),[m,w]=x.useState(!1),L=$e(s,k),y=M=>{v(M),S.current===!1&&w(!1),l&&l(M)},b=M=>{R(M),S.current===!0&&w(!0),a&&a(M)},E=u({},o,{color:i,component:d,focusVisible:m,underline:f,variant:p}),P=Tt(E);return n.jsx(Rt,u({color:i,className:re(P.root,r),classes:c,component:d,onBlur:y,onFocus:b,ref:L,ownerState:E,variant:p,sx:[...Object.keys(fe).includes(i)?[]:[{color:i}],...Array.isArray(h)?h:[h]]},g))}),Pt=N(n.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),Lt=N(n.jsx("path",{d:"M20 7h-5V4c0-1.1-.9-2-2-2h-2c-1.1 0-2 .9-2 2v3H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2M9 12c.83 0 1.5.67 1.5 1.5S9.83 15 9 15s-1.5-.67-1.5-1.5S8.17 12 9 12m3 6H6v-.43c0-.6.36-1.15.92-1.39.64-.28 1.34-.43 2.08-.43s1.44.15 2.08.43c.55.24.92.78.92 1.39zm1-9h-2V4h2zm4.25 7.5h-2.5c-.41 0-.75-.34-.75-.75s.34-.75.75-.75h2.5c.41 0 .75.34.75.75s-.34.75-.75.75m0-3h-2.5c-.41 0-.75-.34-.75-.75s.34-.75.75-.75h2.5c.41 0 .75.34.75.75s-.34.75-.75.75"}),"BadgeRounded"),Et=N(n.jsx("path",{d:"M11.01 3.05C6.51 3.54 3 7.36 3 12c0 4.97 4.03 9 9 9 4.63 0 8.45-3.5 8.95-8 .09-.79-.78-1.42-1.54-.95-.84.54-1.84.85-2.91.85-2.98 0-5.4-2.42-5.4-5.4 0-1.06.31-2.06.84-2.89.45-.67-.04-1.63-.93-1.56"}),"DarkModeRounded"),Ft=N(n.jsx("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5M2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1m18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1M11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1m0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1M5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0z"}),"LightModeRounded"),At=()=>{const e=be(),{user:t}=q(l=>l.users),{loading:s,error:o}=q(l=>l.ui),r=async(l,a,c)=>{e(K(!0)),e(V(null));try{if(!c)throw new Error("User role is required for login");let f;switch(c.toLowerCase()){case"admin":f=O.LOGIN.ADMIN;break;case"teacher":f=O.LOGIN.TEACHER;break;case"student":f=O.LOGIN.STUDENT;break;default:throw new Error("Invalid user role")}const p=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l,password:a}),credentials:"include"}),h=p.headers.get("content-type");if(!p.ok){const S=h!=null&&h.includes("application/json")?(await p.json()).message||"Login failed":await p.text();throw new Error(`Login failed: ${S}`)}if(!(h!=null&&h.includes("application/json")))throw new Error("Invalid server response format");const g=await p.json();c.toLowerCase()==="student"&&g.data.student.isWithdrawn?console.warn("Student is withdrawn; no access token stored"):g.data.token?(sessionStorage.setItem("accessToken",g.data.token),console.log("Access token stored in sessionStorage")):console.warn("No access token found in response"),c.toLowerCase()==="student"?(e(B(g.data.student)),console.log("Logged in:",g.data.student)):c.toLowerCase()==="teacher"?(e(B(g.data.teacher)),console.log("Logged in:",g.data.teacher)):(e(B(g.data.user)),console.log("Logged in:",g.data.user))}catch(f){e(V(f.message)),console.error(f)}finally{e(K(!1))}},i=async()=>{if((t==null?void 0:t.role)==="student"&&(t!=null&&t.isWithdrawn)){console.warn("Student is withdrawn; skipping token refresh");return}try{const l=await fetch(O.REFRESH_TOKEN,{method:"POST",credentials:"include"}),a=l.headers.get("content-type");if(!l.ok){const f=a!=null&&a.includes("application/json")?(await l.json()).message||"Failed to refresh token":await l.text();throw new Error(`Failed to refresh access token: ${f}`)}if(!(a!=null&&a.includes("application/json")))throw new Error("Invalid refresh token response format");const c=await l.json();c.token?(sessionStorage.setItem("accessToken",c.token),console.log("Access token refreshed and stored in sessionStorage")):console.warn("No access token found in refresh response")}catch(l){e(V(l.message)),console.error(l)}};return x.useEffect(()=>{const l=setInterval(()=>{i()},84e4);return()=>clearInterval(l)},[]),{user:t,login:r,logout:async()=>{try{await fetch(O.LOGOUT,{method:"POST",credentials:"include"}),e(pe()),sessionStorage.removeItem("accessToken"),console.log("Access token removed from sessionStorage"),await ge("Messages"),console.log("Messages store deleted after logout.")}catch(l){e(V(l.message))}},loading:s,error:o}},It="/assets/signinBg-RilISOAr.jpeg",Ot="/assets/login_muslim_image-n9SwmIkJ.png",Bt=()=>{const{loading:e,error:t,login:s}=At(),[o,r]=x.useState(""),[i,d]=x.useState(""),[l,a]=x.useState(""),[c,f]=x.useState(!1),p=ye(),h=xe().pathname,g=q(m=>m.users.user);x.useEffect(()=>{g&&p("/dashboard")},[g,p]);const S=async m=>{if(m.preventDefault(),!o||!i||!l){alert("Please enter email, password, and select a role.");return}f(!0);try{await s(o,i,l)}catch(w){console.error("Error during login:",w)}finally{f(!1)}},[v,R]=x.useState("dark"),k=Ne({palette:{mode:v,...v==="light"?{background:{default:"#f5f5f5"},primary:{main:"#1976d2"},text:{primary:"#000000"}}:{background:{default:"#121212"},primary:{main:"#90caf9"},text:{primary:"#ffffff"}}}});return n.jsxs(pt,{theme:k,children:[n.jsx(vt,{}),n.jsxs(T,{sx:{display:"flex",justifyContent:"end",alignItems:"center",minHeight:"100vh",backgroundImage:`url(${v==="light"?It:Ot})`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",position:"relative"},children:[n.jsx(T,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.6)",opacity:v==="light"?.4:.2}}),n.jsxs(T,{sx:{width:{xs:"100%",md:"40%"},height:"100vh",backdropFilter:"blur(12px)",backgroundColor:v==="light"?"rgba(255, 255, 255, 0.2)":"rgba(18, 18, 18, 0.8)",p:4,display:"flex",flexDirection:"column",justifyContent:"space-between",zIndex:1},children:[n.jsxs(T,{sx:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[n.jsx(U,{onClick:()=>p(-1),color:"primary",children:n.jsx(Pt,{sx:{color:"#fff"}})}),n.jsx(U,{onClick:()=>R(m=>m==="light"?"dark":"light"),children:v==="light"?n.jsx(Et,{sx:{color:"#fff"}}):n.jsx(Ft,{})})]}),h==="/dashboard"&&n.jsx(T,{sx:{display:"flex",justifyContent:"center"},children:n.jsx(F,{variant:"h6",children:"You are not logged in, Kindly Login."})}),n.jsxs(T,{children:[n.jsx(T,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:n.jsxs(T,{sx:{display:"flex",alignItems:"center",gap:2},children:[n.jsx(U,{size:"small",color:"primary",children:n.jsx(Lt,{sx:{color:"#fff"}})}),n.jsx(F,{variant:"h6",children:"Crystal Land Academy"})]})}),n.jsx(F,{variant:"h4",sx:{mb:2},children:"Sign in"}),n.jsx("form",{onSubmit:S,children:n.jsxs(bt,{spacing:2,children:[n.jsxs(H,{fullWidth:!0,children:[n.jsx(Be,{id:"role-label",children:"Sign in as"}),n.jsxs(ze,{labelId:"role-label",value:l,label:"Sign in as",onChange:m=>a(m.target.value),required:!0,children:[n.jsx(z,{value:"student",children:"Student"}),n.jsx(z,{value:"teacher",children:"Teacher"}),n.jsx(z,{value:"admin",children:"Admin"})]})]}),n.jsx(H,{fullWidth:!0,children:n.jsx(te,{label:"Email",type:"email",value:o,onChange:m=>r(m.target.value),required:!0})}),n.jsx(H,{fullWidth:!0,children:n.jsx(te,{label:"Password",type:"password",value:i,onChange:m=>d(m.target.value),required:!0})}),t&&n.jsx(F,{color:"error",children:t}),n.jsx(ve,{type:"submit",variant:"contained",color:"primary",isLoading:c||e,fullWidth:!0,children:"Continue"}),n.jsx(Mt,{href:"/forgot-password",underline:"hover",children:"Forgot password?"})]})})]}),n.jsx(T,{sx:{textAlign:"center",mt:3},children:n.jsxs(F,{variant:"body2",children:["© Crystal Land Academy ",new Date().getFullYear()]})})]})]})]})};export{vt as C,Bt as S,pt as T,bt as a,Ze as g,At as u};
