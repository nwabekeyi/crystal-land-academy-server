import{j as e,r as i,a as _,e as D,y as U}from"./index-qmmqHzY5.js";import{T as Y}from"./table-BbIk8x_V.js";import{u as B}from"./useApi-CFpppkIv.js";import{r as K,M as F,t as q}from"./modal-Bx1kEpp4.js";import{D as O,G as o,h as J,E as Q}from"./index-BwtLsqef.js";import{c as X,w as u,T as s,y as Z,t as ee,z as te,j as ae}from"./TextField-Cs2SSotF.js";import{H as se}from"./Header-CzWZr2ph.js";import{u as ne,L as re}from"./useStudentData-CcSOAPFO.js";import{w as oe}from"./dasboardPagesContainer-CXO67BnC.js";import{A as ie}from"./confirmationModal-35_TUgti.js";import{C as ce}from"./CircularProgress-BakzznEt.js";import{u as le}from"./MenuItem-CyVMp_O5.js";import{I as de}from"./IconButton-DTIv2feH.js";import"./useMediaQuery-is2W_U8_.js";import"./index-B9CRSDbo.js";import"./loadingButton-C3v_gCSH.js";import"./useSlot-fCuBEx6y.js";const ue=X(e.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),me=({receipt:a})=>{const m=i.useRef(),x=async()=>{if(m.current)try{const d=await J(m.current,{useCORS:!0}),f=d.toDataURL("image/png"),p=new Q("portrait","px","a4"),g=p.internal.pageSize.getWidth(),y=d.height*g/d.width;p.addImage(f,"PNG",0,0,g,y),p.save(`receipt_${a.transactionId}.pdf`)}catch(d){console.error("Error generating PDF:",d)}};return e.jsxs(u,{ref:m,sx:{padding:"20px",maxWidth:"500px",margin:"auto",backgroundColor:"#fff",color:"#000",borderRadius:"10px",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.1)",fontFamily:"Arial, sans-serif"},children:[e.jsx(s,{variant:"h6",align:"center",gutterBottom:!0,children:"Crystal land academy"}),e.jsx(s,{variant:"subtitle2",align:"center",gutterBottom:!0,children:"Payment Receipt"}),e.jsx(O,{sx:{my:2}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{fontWeight:"bold",children:"Transaction ID:"})}),e.jsx(o,{item:!0,xs:6,align:"right",children:e.jsx(s,{children:a.transactionId})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{fontWeight:"bold",children:"Student Name:"})}),e.jsx(o,{item:!0,xs:6,align:"right",children:e.jsx(s,{children:a.userName})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{fontWeight:"bold",children:"Program:"})}),e.jsx(o,{item:!0,xs:6,align:"right",children:e.jsx(s,{children:a.program})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{fontWeight:"bold",children:"Amount Paid:"})}),e.jsx(o,{item:!0,xs:6,align:"right",children:e.jsxs(s,{children:["₦",a.amount.toFixed(2)]})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{fontWeight:"bold",children:"Status:"})}),e.jsx(o,{item:!0,xs:6,align:"right",children:e.jsx(s,{children:a.status})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{fontWeight:"bold",children:"Date:"})}),e.jsx(o,{item:!0,xs:6,align:"right",children:e.jsx(s,{children:a.date})})]}),e.jsx(O,{sx:{my:2}}),e.jsx(s,{variant:"body2",align:"center",children:"Thank you for your payment!"}),e.jsx(Z,{variant:"contained",color:"primary",fullWidth:!0,onClick:x,sx:{mt:2},children:"Download Receipt"})]})};var M={},pe=ee;Object.defineProperty(M,"__esModule",{value:!0});var H=M.default=void 0,he=pe(K()),xe=e;H=M.default=(0,he.default)((0,xe.jsx)("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4v-6h16zm0-10H4V6h16z"}),"Payment");const ge=({onSuccess:a=()=>{}})=>{const[m,x]=i.useState(!1),[d,f]=i.useState(!1),[p,g]=i.useState(""),{userId:y,studentId:$}=_(c=>c.users.user),I=le(),{callApi:S}=B(),w=()=>{f(!0)},j=()=>{f(!1)},R=()=>{A(),j()},A=async()=>{x(!0);try{const r=await(await fetch(D.PAYSTACK_INIT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:y,paymentAmount:parseFloat(p)})})).json();r&&r.payment_url&&r.reference&&window.PaystackPop.setup({key:"pk_test_8293ca0c4f5b0e4b8da1dad753cbc602cebade30",email:r.email,currency:"NGN",amount:r.amount*100,reference:r.reference,metadata:{userId:r.userId},onClose:function(){P(r.reference)},callback:function(T){const C=T.reference;P(C)}}).openIframe()}catch(c){console.error("Error initializing payment:",c)}finally{x(!1)}},P=async c=>{try{const b=await(await fetch(`${D.PAYSTACK_PAYMENT}/${c}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();if(b.status==="success"){g(""),a();const h=await S(`${D.USER}/${y}`,"GET");h&&h.student&&(I(U(h.student)),console.log(h.student))}else console.error("Verification failed:",b),console.log("Payment failed")}catch(r){console.error("Error verifying transaction:",r)}};return e.jsxs(u,{children:[e.jsx(ie,{icon:e.jsx(H,{}),disabled:m,onClick:w,content:m?e.jsx(ce,{size:24}):"Pay Now"}),e.jsx(F,{open:d,onClose:j,title:"Enter Payment Amount",onConfirm:R,confirmMessage:"Proceed with Payment",children:e.jsx(te,{label:"Amount (Naira)",type:"number",value:p,onChange:c=>g(c.target.value),fullWidth:!0})})]})},fe=()=>{const a=_(t=>t.users.user),{loading:m,data:x,callApi:d}=B(),[f,p]=i.useState([]),[g,y]=i.useState(0),[$,I]=i.useState(10),[S,w]=i.useState("date"),[j,R]=i.useState("asc"),[A,P]=i.useState(!1),[c,r]=i.useState(null),b=ae(),h=q(b.palette.mode),{outstandings:T}=ne();console.log(a);const{totalOutstanding:C,amountPaid:v}=T,k=C+v,W=k>0?v/k*100:0;i.useEffect(()=>{a!=null&&a.userId&&d(`${D.PAYMENT}/student/${a.userId}`,"GET")},[a==null?void 0:a.userId]),i.useEffect(()=>{if(!m&&x){const t=x.receipts.map((n,E)=>({id:E+1,transactionId:n.paymentDetails.transactionId,amount:n.paymentDetails.amount,status:n.paymentDetails.status,date:new Date(n.paymentDetails.timestamp).toLocaleDateString(),userName:`${n.userDetails.firstName} ${n.userDetails.lastName}`,program:n.userDetails.program}));p(t)}},[m,x]);const L=t=>{const n=S===t&&j==="asc";w(t),R(n?"desc":"asc")},G=t=>{r(t),P(!0)},z=async()=>{if(a!=null&&a.userId)try{const t=await d(`${D.PAYMENT}/student/${a.userId}`,"GET");if(t){const n=t.receipts.map((l,N)=>({id:N+1,transactionId:l.paymentDetails.transactionId,amount:l.paymentDetails.amount,status:l.paymentDetails.status,date:new Date(l.paymentDetails.timestamp).toLocaleDateString(),userName:`${l.userDetails.firstName} ${l.userDetails.lastName}`,program:l.userDetails.program}));p(l=>[...n,...l]);const E=n.reduce((l,N)=>l+N.amount,v),ye=C-E}}catch(t){console.error("Error fetching payment data:",t)}},V=[{id:"transactionId",label:"Transaction ID"},{id:"amount",label:"Amount (₦)",renderCell:t=>`₦${t.amount.toFixed(2)}`},{id:"status",label:"Status",renderCell:t=>t.status.charAt(0).toUpperCase()+t.status.slice(1)},{id:"date",label:"Date"},{id:"actions",label:"Actions",renderCell:t=>e.jsx(u,{display:"flex",gap:"10px",children:e.jsx(de,{onClick:()=>G(t),children:e.jsx(ue,{})})})}];return e.jsxs(u,{children:[e.jsx(se,{title:"Payment History",subtitle:"Overview of Payments Made"}),e.jsxs(u,{backgroundColor:h.primary[400],p:"20px",borderRadius:"4px",children:[e.jsx(s,{variant:"h5",fontWeight:"600",mb:"15px",children:"Payment Summary"}),e.jsxs(u,{mb:"20px",children:[e.jsxs(u,{sx:{display:"flex",alignItems:"end",marginBottom:"15px",justifyContent:"space-between",width:"100%"},children:[e.jsxs(u,{children:[e.jsxs(s,{variant:"h6",mb:"5px",children:["Total Amount Due: ₦",k.toFixed(2)]}),e.jsxs(s,{variant:"h6",mb:"5px",children:["Total Paid: ₦",v.toFixed(2)]}),e.jsxs(s,{variant:"h6",children:["Payment Percentage: ",W.toFixed(2),"%"]})]}),e.jsx(u,{children:e.jsxs(u,{children:[e.jsx(ge,{onSuccess:z})," "]})})]}),e.jsx(re,{variant:"determinate",value:W,sx:{height:10,borderRadius:5,backgroundColor:h.grey[300],"& .MuiLinearProgress-bar":{backgroundColor:h.greenAccent[500]}}})]}),e.jsx(Y,{columns:V,tableHeader:"Payment Records",data:f,sortBy:S,sortDirection:j,onSortChange:L,page:g,rowsPerPage:$,onPageChange:(t,n)=>y(n),hiddenColumnsSmallScreen:["status","transactionId"],onRowsPerPageChange:t=>I(parseInt(t.target.value,10)),onRowClick:t=>console.log("Row clicked:",t)}),e.jsx(F,{open:A,onClose:()=>P(!1),title:"Receipt Details",noConfirm:!0,children:c&&e.jsx(me,{receipt:c})})]})]})},We=oe(fe);export{We as default};
