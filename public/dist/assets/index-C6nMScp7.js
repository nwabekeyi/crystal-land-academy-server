import{r as o,j as t,a as Be,e as ce,H as he}from"./index-Cqf_02g-.js";import{r as Fe,t as ue,D as He,a as ze,b as Je,c as Ve,M as Z}from"./modal-DHHk_nL3.js";import{g as qe,a as Ke,u as Ye,_ as Ze,s as Ge,b as ge,d as Qe,e as Xe,T as f,a1 as et,Z as tt,$ as at,a0 as st,q as nt,j as pe,x as ae,v as U}from"./TextField-CTuTe783.js";import{M as me,u as ot}from"./MenuItem-Jxhsl5nH.js";import{S as G}from"./index-BTJAKZv4.js";import{H as rt}from"./Header-DzbEG90q.js";import{a as se,b as W,T as K}from"./table-D-PQDQOS.js";import{c as lt}from"./index-BL7cbZCj.js";import{d as it}from"./Edit-DS8OOCei.js";import{d as dt}from"./Visibility-7TOGXaQT.js";import{u as ne}from"./useApi-CG0k0pMk.js";import{I as Y}from"./IconButton-BC7LALcm.js";import{w as ct}from"./dasboardPagesContainer-F3CP2AQX.js";import"./confirmationModal-B6osjM9X.js";import"./CircularProgress-WQtbeDcs.js";import"./Alert-C0TSEmvr.js";import"./useSlot-Bq2cA_lW.js";import"./useMediaQuery-DK0lFkLQ.js";import"./index-j3Sz-YoR.js";import"./loadingButton-CNGXwwaA.js";import"./crystal-land-log-removebg-DVF-nlbN.js";function ht(r){return qe("MuiDialogContentText",r)}Ke("MuiDialogContentText",["root"]);const mt=["children","className"],ut=r=>{const{classes:s}=r,i=Xe({root:["root"]},ht,s);return ge({},s,i)},gt=Ge(f,{shouldForwardProp:r=>et(r)||r==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(r,s)=>s.root})({}),pt=o.forwardRef(function(s,n){const i=Ye({props:s,name:"MuiDialogContentText"}),{className:h}=i,c=Ze(i,mt),l=ut(c);return t.jsx(gt,ge({component:"p",variant:"body1",color:"text.secondary",ref:n,ownerState:c,className:Qe(l.root,h)},i,{classes:l}))}),xt=({label:r,options:s,onSelect:n})=>{const[i,h]=o.useState(""),c=l=>{const d=l.target.value;h(d),n(d)};return t.jsxs(tt,{sx:{width:"170px",paddingBottom:"2%"},variant:"outlined",children:[t.jsx(at,{id:`${r}-select-label`,children:r}),t.jsxs(st,{labelId:`${r}-select-label`,value:i,onChange:c,label:r,children:[t.jsx(me,{value:"",disabled:!0,children:`Select ${r}`}),s.map(l=>t.jsx(me,{value:l.value,children:l.label},l.value))]})]})},ft=()=>t.jsx(G,{role:"student"}),St=()=>t.jsx(G,{role:"teacher"}),bt=()=>t.jsx(G,{role:"admin"});var re={},Ct=nt;Object.defineProperty(re,"__esModule",{value:!0});var xe=re.default=void 0,wt=Ct(Fe()),At=t;xe=re.default=(0,wt.default)((0,At.jsx)("path",{d:"M8.65 5.82C9.36 4.72 10.6 4 12 4c2.21 0 4 1.79 4 4 0 1.4-.72 2.64-1.82 3.35zM20 17.17c-.02-1.1-.63-2.11-1.61-2.62-.54-.28-1.13-.54-1.77-.76zm1.19 4.02L2.81 2.81 1.39 4.22l8.89 8.89c-1.81.23-3.39.79-4.67 1.45-1 .51-1.61 1.54-1.61 2.66V20h13.17l2.61 2.61z"}),"PersonOff");const le=()=>{const r=ot(),s=Be(e=>e.adminData.usersData||{}),{students:n=[],teachers:i=[],admins:h=[]}=s,[c,l]=o.useState("All"),[d,m]=o.useState("All"),g=["All",...new Set(n.map(e=>{var a;return((a=e.currentClassLevel)==null?void 0:a.section)||"Unknown"}))],x=["All",...new Set(i.flatMap(e=>{var a;return(a=e.subject)==null?void 0:a.flatMap(p=>{var M;return((M=p.classLevelSubclasses)==null?void 0:M.map(te=>{var O;return((O=te.classLevel)==null?void 0:O.section)||"Unknown"}))||[]})}))],[b,w]=o.useState(""),[S,E]=o.useState("id"),[C,T]=o.useState("asc"),[Q,A]=o.useState(0),[y,N]=o.useState(20),[_,j]=o.useState(null),[D,k]=o.useState({}),[B,v]=o.useState(!1),[F,H]=o.useState(!1),[z,J]=o.useState(!1),[X,R]=o.useState(0),[V,P]=o.useState(!1),[q,u]=o.useState(!1),{callApi:L,loading:fe,data:Se,error:be}=ne(),{loading:Ce,error:we}=ne(),{callApi:Ae,loading:je,data:De,error:ve}=ne(),[Ut,Me]=o.useState(!1),[I,$]=o.useState(!1),ee=(e,a)=>a==="student"?n.find(p=>p.studentId===e):a==="teacher"?i.find(p=>p.teacherId===e):a==="admin"?h.find(p=>p._id===e):null,Ue=e=>{w(e),J(!0)};o.useEffect(()=>{$(!I)},[F,z]);const Te=e=>{T(S===e&&C==="asc"?"desc":"asc"),E(e)},ye=(e,a)=>{A(a)},Ne=e=>{N(parseInt(e.target.value,10)),A(0)},Ie=e=>{const a=ee(e.id,e.role);a&&(sessionStorage.setItem("selectedUser",JSON.stringify({...a,role:e.role})),k(a),v(!0))},ie=e=>{const a=ee(e.id,e.role);a&&(sessionStorage.setItem("selectedUser",JSON.stringify({...a,role:e.role})),k(a),u(!0))},We=()=>{u(!1),sessionStorage.removeItem("selectedUser")},de=e=>{const a=ee(e.id,e.role);a&&(sessionStorage.setItem("selectedUser",JSON.stringify({...a,role:e.role})),k(a),H(!0))},Ee=()=>{Me(!1)},ke=async()=>{const e=JSON.parse(sessionStorage.getItem("selectedUser"));if(!(!e||e.role!=="student"))try{const a=`${ce.STUDENTS}/withdraw/${e._id}`;await Ae(a,"PATCH",{},{Authorization:`Bearer ${sessionStorage.getItem("token")}`})&&(r(he({id:e.studentId,role:"student"})),sessionStorage.removeItem("selectedUser"),u(!1),$(!I))}catch(a){console.error("Error withdrawing student:",a),sessionStorage.setItem("confirmWithdrawModal","true"),u(!1),$(!I)}},Re=async()=>{const e=JSON.parse(sessionStorage.getItem("selectedUser"));if(e)try{const a={id:e.studentId||e.teacherId||e._id,role:e.role};await L(ce.USER,"DELETE",a),Se&&(r(he({id:a.id,role:a.role})),sessionStorage.removeItem("selectedUser"),sessionStorage.setItem("confirmModal","true"),v(!1),j(null),$(!I))}catch(a){console.error("Error deleting user:",a),sessionStorage.setItem("confirmModal","true"),$(!I)}},Pe=[{id:"sn",label:"S/N",width:90},{id:"id",label:"ID",width:100,renderCell:e=>t.jsx(f,{children:(e.role==="student"||e.role==="teacher",String(e.id))})},{id:"name",label:"Name",flex:1},{id:"email",label:"Email",flex:1},{id:"details",label:"Details",flex:1,renderCell:e=>e.role==="student"?`${e.classLevel||"N/A"} (${e.boardingStatus||"N/A"})`:e.role==="teacher"?e.subject||"N/A":"Admin"},{id:"createdAt",label:"Registered Date",flex:1},{id:"actions",label:"Actions",width:200,renderCell:e=>t.jsxs("div",{style:{display:"flex"},children:[t.jsx(Y,{onClick:()=>de(e),children:t.jsx(it,{})}),t.jsx(Y,{onClick:()=>Ie(e),children:t.jsx(lt,{})}),t.jsx(Y,{onClick:()=>{j(e),P(!0)},children:t.jsx(dt,{})}),e.role==="student"&&!e.isWithdrawn&&t.jsx(Y,{onClick:()=>ie(e),title:"Withdraw student",children:t.jsx(xe,{})})]})}],Le=Array.isArray(n)?n.filter(e=>!e.isWithdrawn).filter(e=>{var a;return c==="All"||((a=e.currentClassLevel)==null?void 0:a.section)===c}).map((e,a)=>({id:e.studentId??"N/A",sn:a+1,role:"student",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",classLevel:e.currentClassLevel?`${e.currentClassLevel.className} ${e.currentClassLevel.subclass}`:"N/A",boardingStatus:e.boardingStatus||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A",isWithdrawn:e.isWithdrawn||!1,_id:e._id})).sort((e,a)=>e.sn-a.sn):[],$e=Array.isArray(n)?n.filter(e=>e.isWithdrawn).filter(e=>{var a;return c==="All"||((a=e.currentClassLevel)==null?void 0:a.section)===c}).map((e,a)=>({id:e.studentId??"N/A",sn:a+1,role:"student",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",classLevel:e.currentClassLevel?`${e.currentClassLevel.className} ${e.currentClassLevel.subclass}`:"N/A",boardingStatus:e.boardingStatus||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A",isWithdrawn:e.isWithdrawn||!1,_id:e._id})).sort((e,a)=>e.sn-a.sn):[],Oe=Array.isArray(i)?i.filter(e=>{var a;return d==="All"||((a=e.subject)==null?void 0:a.some(p=>{var M;return(M=p.classLevelSubclasses)==null?void 0:M.some(te=>{var O;return((O=te.classLevel)==null?void 0:O.section)===d})}))}).map((e,a)=>{var p;return{id:e.teacherId||"N/A",sn:a+1,role:"teacher",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",subject:((p=e.subject)==null?void 0:p.map(M=>M.name).join(", "))||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"}}).sort((e,a)=>e.sn-a.sn):[],_e=Array.isArray(h)?h.map((e,a)=>({id:e._id||"N/A",sn:a+1,role:"admin",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"})).sort((e,a)=>e.sn-a.sn):[];return{studentData:Le,withdrawnStudentData:$e,teacherData:Oe,adminData:_e,selectedRole:b,setSelectedRole:w,sortBy:S,sortDirection:C,page:Q,rowsPerPage:y,selectedUser:_,setSelectedUser:j,editUserDetailsState:D,openDeleteModal:B,setOpenDeleteModal:v,editDialogOpen:F,setEditDialogOpen:H,signUpDialogOpen:z,setSignUpDialogOpen:J,viewUserDetails:V,setViewUserDetails:P,withdrawModalOpen:q,setWithdrawModalOpen:u,handleRoleSelect:Ue,handleSortChange:Te,handlePageChange:ye,handleRowsPerPageChange:Ne,handleEdit:de,handleDelete:Re,handleWithdraw:ke,handleWithdrawOpen:ie,handleWithdrawClose:We,handleConfirmationModalClose:Ee,columns:Pe,tabIndex:X,handleTabChange:(e,a)=>{R(a),A(0),l("All"),m("All")},loading:fe||Ce||je,deleteError:be,updateError:we,withdrawError:ve,withdrawData:De,rerender:I,studentSections:g,selectedStudentSection:c,setSelectedStudentSection:l,teacherSections:x,selectedTeacherSection:d,setSelectedTeacherSection:m}},oe=({confirm:r,buttonLabel:s,dialogTitle:n,dialogContent:i,scrollType:h="paper",actionText1:c="Cancel",actionText2:l="Confirm",open:d=!1,onClose:m,onConfirm:g,maxWidth:x="sm"})=>{const[b,w]=o.useState(h),S=o.useRef(null),E=pe(),C=ue(E.palette.mode);return o.useEffect(()=>{if(d){const{current:T}=S;T!==null&&T.focus()}},[d]),t.jsxs(o.Fragment,{children:[t.jsx(ae,{onClick:()=>m(),children:s}),t.jsxs(He,{open:d,onClose:m,scroll:b,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",maxWidth:x,fullWidth:!0,children:[t.jsx(ze,{id:"scroll-dialog-title",children:n}),t.jsx(Je,{dividers:b==="paper",children:t.jsx(pt,{id:"scroll-dialog-description",ref:S,tabIndex:-1,children:i})}),t.jsxs(Ve,{children:[t.jsx(ae,{sx:{color:C.redAccent[500],border:`solis 2px ${C.redAccent[500]}`},onClick:m,children:c}),r&&t.jsx(ae,{sx:{color:C.greenAccent[500],border:`solis 2px ${C.greenAccent[500]}`},onClick:g,children:l})]})]})]})},jt=({selectedRole:r,editDialogOpen:s,setEditDialogOpen:n,handleEdit:i})=>{const[h,c]=o.useState(null);return o.useEffect(()=>{const l=sessionStorage.getItem("selectedUser");if(l){const d=JSON.parse(l);console.log(d),c(d)}},[]),t.jsx(U,{children:t.jsx(oe,{buttonLabel:"Edit User",dialogTitle:"Edit User",dialogContent:h&&t.jsx(G,{role:r,selectedUser:h._id}),scrollType:"body",actionText1:"Cancel",actionText2:"Confirm",open:s,onClose:()=>n(!1),onConfirm:i})})},Dt=({open:r,onClose:s})=>{const{handleDelete:n,deleteData:i,rerender:h,deleteError:c}=le(),[l,d]=o.useState(!1);o.useEffect(()=>{const g=sessionStorage.getItem("confirmModal");g&&d(g)},[h]);const m=()=>{d(!1),sessionStorage.removeItem("confirmModal")};return t.jsxs(t.Fragment,{children:[t.jsx(Z,{open:r,onClose:s,title:"Confirm delete",onConfirm:n,children:t.jsxs("p",{children:["Confirm deletion of user."," ",t.jsx("span",{style:{color:"#EB433D",fontWeight:"900",fontSize:"large"},children:"Kindly note that this cannot be reversed"})]})}),t.jsx(Z,{open:l&&l,onClose:m,title:"Delete Confirmation",onConfirm:m,children:t.jsx("p",{children:i?"User successfully deleted":c})})]})},vt=({open:r,onClose:s,onConfirm:n,userName:i})=>{const{withdrawError:h,withdrawData:c,rerender:l}=le(),[d,m]=o.useState(!1);o.useEffect(()=>{const x=sessionStorage.getItem("confirmWithdrawModal");x&&m(x)},[l]);const g=()=>{m(!1),sessionStorage.removeItem("confirmWithdrawModal")};return t.jsxs(t.Fragment,{children:[t.jsx(Z,{open:r,onClose:s,title:"Confirm Student Withdrawal",onConfirm:()=>{n(),sessionStorage.setItem("confirmWithdrawModal","true")},children:t.jsxs("p",{children:["Are you sure you want to withdraw ",t.jsx("strong",{children:i}),"?"," ",t.jsx("span",{style:{color:"#EB433D",fontWeight:"900",fontSize:"large"},children:"This action will mark the student as withdrawn and remove them from their class and academic year."})]})}),t.jsx(Z,{open:d&&d,onClose:g,title:"Withdraw Confirmation",onConfirm:g,children:t.jsx("p",{children:c?"Student successfully withdrawn":h||"An error occurred"})})]})},Mt=()=>{const r=pe(),s=ue(r.palette.mode),{selectedUser:n,editDialogOpen:i,studentData:h,withdrawnStudentData:c,teacherData:l,adminData:d,selectedRole:m,setSelectedRole:g,sortBy:x,sortDirection:b,page:w,rowsPerPage:S,setEditDialogOpen:E,signUpDialogOpen:C,setSignUpDialogOpen:T,handleRoleSelect:Q,handleSortChange:A,handlePageChange:y,handleRowsPerPageChange:N,handleEdit:_,columns:j,tabIndex:D,handleTabChange:k,viewUserDetails:B,setViewUserDetails:v,openDeleteModal:F,setOpenDeleteModal:H,withdrawModalOpen:z,handleWithdraw:J,handleWithdrawClose:X,editUserDetailsState:R,studentSections:V,selectedStudentSection:P,setSelectedStudentSection:q}=le();return o.useEffect(()=>{n&&v(!0)},[n,v]),t.jsxs(U,{children:[t.jsx(rt,{title:"User Management",subtitle:"Manage users"}),t.jsx(xt,{label:"Add Users",options:[{value:"student",label:"Student"},{value:"teacher",label:"Teacher"},{value:"admin",label:"Admin"}],onSelect:Q}),t.jsx(U,{mt:2,children:t.jsxs(se,{value:D,onChange:k,"aria-label":"user role tabs",sx:{backgroundColor:s.primary[400],"& .MuiTabs-indicator":{backgroundColor:s.blueAccent[700]}},children:[t.jsx(W,{label:"Students",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:s.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:s.primary[400]}}),t.jsx(W,{label:"Withdrawn Students",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:s.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:s.primary[400]}}),t.jsx(W,{label:"Teachers",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:s.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:s.primary[400]}}),t.jsx(W,{label:"Admins",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:s.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:s.primary[400]}})]})}),D===0&&t.jsxs(U,{m:"20px 0 0 0",height:"75vh",children:[t.jsx(se,{value:P,onChange:(u,L)=>q(L),"aria-label":"student section tabs",sx:{backgroundColor:s.primary[400],"& .MuiTabs-indicator":{backgroundColor:s.blueAccent[700]}},children:V.map(u=>t.jsx(W,{label:u,value:u,sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:s.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:s.primary[400]}},u))}),t.jsx(K,{columns:j,tableHeader:"Student Management",data:h,sortBy:x,sortDirection:b,onSortChange:A,page:w,rowsPerPage:S,onPageChange:y,onRowsPerPageChange:N,onRowClick:()=>g("student"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})]}),D===1&&t.jsxs(U,{m:"20px 0 0 0",height:"75vh",children:[t.jsx(se,{value:P,onChange:(u,L)=>q(L),"aria-label":"withdrawn student section tabs",sx:{backgroundColor:s.primary[400],"& .MuiTabs-indicator":{backgroundColor:s.blueAccent[700]}},children:V.map(u=>t.jsx(W,{label:u,value:u,sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:s.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:s.primary[400]}},u))}),t.jsx(K,{columns:j,tableHeader:"Withdrawn Student Management",data:c,sortBy:x,sortDirection:b,onSortChange:A,page:w,rowsPerPage:S,onPageChange:y,onRowsPerPageChange:N,onRowClick:()=>g("student"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})]}),D===2&&t.jsx(U,{m:"20px 0 0 0",height:"75vh",children:t.jsx(K,{columns:j,tableHeader:"Teacher Management",data:l,sortBy:x,sortDirection:b,onSortChange:A,page:w,rowsPerPage:S,onPageChange:y,onRowsPerPageChange:N,onRowClick:()=>g("teacher"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})}),D===3&&t.jsx(U,{m:"20px 0 0 0",height:"75vh",children:t.jsx(K,{columns:j,tableHeader:"Admin Management",data:d,sortBy:x,sortDirection:b,onSortChange:A,page:w,rowsPerPage:S,onPageChange:y,onRowsPerPageChange:N,onRowClick:()=>g("admin"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})}),B&&n&&t.jsx(oe,{buttonLabel:"View User Details",dialogTitle:"User Details",dialogContent:t.jsxs(t.Fragment,{children:[t.jsxs(f,{children:["ID: ",n.id]}),t.jsxs(f,{children:["Name: ",`${n.name}`]}),t.jsxs(f,{children:["Email: ",n.email]}),n.role==="student"&&t.jsxs(t.Fragment,{children:[t.jsxs(f,{children:["Class: ",n.classLevel]}),t.jsxs(f,{children:["Boarding Status: ",n.boardingStatus]}),t.jsxs(f,{children:["Withdrawn: ",n.isWithdrawn?"Yes":"No"]})]}),n.role==="teacher"&&t.jsxs(f,{children:["Subject: ",n.subject]}),t.jsxs(f,{children:["Role: ",n.role]}),t.jsxs(f,{children:["Registered Date: ",n.createdAt]})]}),scrollType:"paper",actionText1:"Close",actionText2:"Edit",open:B,onClose:()=>v(!1),onAction2:()=>_(n)}),t.jsx(Dt,{open:F,onClose:()=>H(!1)}),t.jsx(jt,{selectedRole:m,editDialogOpen:i,setEditDialogOpen:E,handleEdit:_}),t.jsx(vt,{open:z,onClose:X,onConfirm:J,userName:R?`${R.firstName} ${R.lastName}`:""}),t.jsx(oe,{buttonLabel:"Sign Up",dialogTitle:"Sign Up User",dialogContent:m==="student"?t.jsx(ft,{}):m==="teacher"?t.jsx(St,{}):m==="admin"?t.jsx(bt,{}):null,scrollType:"body",actionText1:"Cancel",actionText2:"Confirm",open:C,onClose:()=>T(!1)})]})},Zt=ct(Mt);export{Zt as default};
