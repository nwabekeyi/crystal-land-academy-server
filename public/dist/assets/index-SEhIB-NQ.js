import{a as Ye,P as qe,r as i,e as le,N as ze,j as e,R as Ue,i as Je}from"./index-CikQMIxq.js";import{M as ce,t as Ke}from"./modal-DegES_uk.js";import{H as Qe}from"./Header-TreUcfEU.js";import{a as Xe,b as Ze,T as Ie}from"./table-BLDLF2xb.js";import{u as $e}from"./useApi-ClS9LJ9f.js";import{C as B}from"./customIconButton-yInW23qL.js";import{h as be,f as fe,i as es,j as ae,k as ss}from"./index.esm-e5pvfPBO.js";import{u as ts,M as ge}from"./MenuItem-wbOmOVuU.js";import{w as as}from"./dasboardPagesContainer-MS05gvgF.js";import{A as X}from"./confirmationModal-IVK2OKxs.js";import{c as oe,L as Be,a as Oe}from"./index-CBIszJhn.js";import{T as _,w as F,a1 as ye,z as y,x as Re,j as rs}from"./TextField-DBM3Kdjt.js";import"./IconButton-D4HzaP6M.js";import"./useMediaQuery-rMa90EY2.js";import"./index-C35jSBSo.js";import"./loadingButton-B7aR1mEr.js";import"./CircularProgress-D0-LNmPF.js";import"./useSlot-perXj4Tc.js";const ns=()=>{const f=ts(),{classLevels:u,academicYears:p}=Ye(qe),[o,r]=i.useState("section"),[h,M]=i.useState("asc"),[O,$]=i.useState(!1),[N,b]=i.useState("create"),[Y,E]=i.useState(null),[d,c]=i.useState({section:"Primary",name:"",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],description:"",academicYear:"",subclasses:[{letter:"A",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],timetables:[]}]}),[q,C]=i.useState(""),{data:j,loading:L,callApi:S}=$e(),{callApi:K,loading:re,error:I}=$e();i.useEffect(()=>{S(le.CLASS_LEVEL,"GET")},[S]),i.useEffect(()=>{j&&Array.isArray(j.data)&&(console.log("Fetched classLevels:",j.data),f(ze(j.data)))},[j,f]);const m=i.useCallback(s=>{o===s?M(h==="asc"?"desc":"asc"):(r(s),M("asc"))},[o,h]),v=i.useCallback((s,t=null)=>{var a,l;b(s),E(t),s==="create"?c({section:"Primary",name:"",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],description:"",academicYear:((a=p.find(x=>x.isCurrent))==null?void 0:a._id)||"",subclasses:[{letter:"A",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],timetables:[]}]}):t&&c({section:t.section||"Primary",name:t.name||"",feesPerTerm:t.feesPerTerm||[{termName:"1st Term",amount:0,description:""}],description:t.description||"",academicYear:((l=t.academicYear)==null?void 0:l._id)||"",subclasses:t.subclasses||[{letter:"A",feesPerTerm:t.feesPerTerm||[{termName:"1st Term",amount:0,description:""}],timetables:[]}]}),$(!0)},[p]),P=i.useCallback(s=>{const{name:t,value:a}=s.target;c(l=>({...l,[t]:a}))},[]),k=i.useCallback((s,t,a)=>{c(l=>{const x=[...l.feesPerTerm];return x[s]={...x[s],[t]:a},{...l,feesPerTerm:x}})},[]),D=i.useCallback((s,t,a,l)=>{c(x=>{const g=[...x.subclasses],R=[...g[s].feesPerTerm];return R[t]={...R[t],[a]:l},g[s]={...g[s],feesPerTerm:R},{...x,subclasses:g}})},[]),W=i.useCallback(()=>{c(s=>({...s,feesPerTerm:[...s.feesPerTerm,{termName:`${s.feesPerTerm.length+1} Term`,amount:0,description:""}]}))},[]),G=i.useCallback(s=>{c(t=>({...t,feesPerTerm:t.feesPerTerm.filter((a,l)=>l!==s)}))},[]),he=i.useCallback(s=>{c(t=>{const a=[...t.subclasses];return a[s]={...a[s],feesPerTerm:[...a[s].feesPerTerm,{termName:`${a[s].feesPerTerm.length+1} Term`,amount:0,description:""}]},{...t,subclasses:a}})},[]),de=i.useCallback((s,t)=>{c(a=>{const l=[...a.subclasses];return l[s]={...l[s],feesPerTerm:l[s].feesPerTerm.filter((x,g)=>g!==t)},{...a,subclasses:l}})},[]),Ce=i.useCallback((s,t,a,l)=>{c(x=>{const g=[...x.subclasses],R=g.findIndex(Pe=>Pe.letter===l);if(R===-1)return x;const ie=[...g[R].timetables];return ie[s]={...ie[s],[t]:a},g[R]={...g[R],timetables:ie},{...x,subclasses:g}})},[]),me=i.useCallback(s=>{c(t=>{const a=[...t.subclasses],l=a.findIndex(x=>x.letter===s);return l===-1?t:(a[l]={...a[subIndex],timetables:[...a[subIndex].timetables,{day:"Monday",startTime:"08:00",endTime:"09:00",subject:""}]},{...t,subclasses:a})})},[]),ue=i.useCallback((s,t)=>{c(a=>{const l=[...a.subclasses],x=l.findIndex(g=>g.letter===t);return x===-1?a:(l[x]={...l[subIndex],timetables:l[subIndex].timetables.filter((g,R)=>R!==s)},{...a,subclasses:l})})},[]),ne=i.useCallback(()=>d.section?d.name?d.academicYear?d.feesPerTerm.every(s=>s.termName&&s.amount>=0)?d.subclasses.every(s=>s.feesPerTerm.every(t=>t.termName&&t.amount>=0))?d.subclasses.some(s=>s.timetables.some(t=>!t.day||!t.startTime||!t.endTime||!t.subject))?"All timetable entries must have valid fields":"":"All subclass fees must have a term name and a valid amount":"All class fees must have a term name and a valid amount":"Academic year is required":"Class name is required":"Section is required",[d]),je=i.useCallback(async()=>{const s=ne();if(s){C(s);return}const t={section:d.section,name:d.name,description:d.description,academicYear:d.academicYear,feesPerTerm:d.feesPerTerm,subclasses:d.subclasses.map(a=>({letter:a.letter,feesPerTerm:a.feesPerTerm,timetables:a.timetables}))};try{N==="create"?await K(le.CLASS_LEVEL,"POST",t):N==="edit"?await K(`${le.CLASS_LEVEL}/${Y._id}`,"PATCH",t):N==="delete"&&await K(`${le.CLASS_LEVEL}/${Y._id}`,"DELETE"),S(le.CLASS_LEVEL,"GET"),$(!1),C("")}catch{C(I||"Failed to process request")}},[N,d,Y,K,S,I,ne]),pe=s=>{const t=new Date(s);return!isNaN(t.getTime())&&/^\d{4}-\d{2}-\d{2}$/.test(s)?t.toLocaleDateString(navigator.language||"en-US",{year:"numeric",month:"long",day:"numeric"}):s},H=i.useMemo(()=>Array.isArray(u)?u.map(s=>({...s,displayName:pe(s.name)})):[],[u]),Te=i.useMemo(()=>{const s={};return p.forEach(t=>{s[t._id]={Primary:H.filter(a=>{var l,x,g;return((l=a.academicYear)==null?void 0:l._id)===t._id&&(((x=a.section)==null?void 0:x.toLowerCase())==="primary"||((g=a.section)==null?void 0:g.toLowerCase())==="Primary")}),Secondary:H.filter(a=>{var l,x,g;return((l=a.academicYear)==null?void 0:l._id)===t._id&&(((x=a.section)==null?void 0:x.toLowerCase())==="secondary"||((g=a.section)==null?void 0:g.toLowerCase())==="Secondary")})},console.log(`Grouped data for year ${t._id}:`,s[t._id])}),s},[H,p]);return{tableProps:{columns:i.useMemo(()=>[{id:"sn",label:"S/N",width:90},{id:"section",label:"Section",flex:1},{id:"displayName",label:"Class Name",flex:1,renderCell:s=>s.displayName},{id:"studentsCount",label:"Students",flex:1,renderCell:s=>{var t;return((t=s.students)==null?void 0:t.length)||0}},{id:"academicYear",label:"Academic Year",flex:1,renderCell:s=>{var t;return((t=s.academicYear)==null?void 0:t.name)||"N/A"}},{id:"actions",label:"Actions",flex:1,renderCell:s=>e.jsxs(e.Fragment,{children:[e.jsx(B,{icon:e.jsx(be,{}),title:"View Class",onClick:()=>v("view",s),sx:{mx:.5}}),e.jsx(B,{icon:e.jsx(fe,{}),title:"Edit Class",onClick:()=>v("edit",s),sx:{mx:.5}}),e.jsx(B,{icon:e.jsx(es,{}),title:"Delete Class",onClick:()=>v("delete",s),sx:{mx:.5}})]})}],[v]),tableHeader:"Class Management",data:H,classLevels:Te,sortBy:o,sortDirection:h,onSortChange:m,onRowClick:s=>v("view",s),hiddenColumnsSmallScreen:["description"],hiddenColumnsTabScreen:[],academicYears:p},modalOpen:O,setModalOpen:$,modalMode:N,setModalMode:b,formData:d,setFormData:c,handleFormChange:P,handleFeesChange:k,handleSubclassFeesChange:D,addTermFee:W,removeTermFee:G,addSubclassTermFee:he,removeSubclassTermFee:de,handleTimetableChange:Ce,addTimetableEntry:me,removeTimetableEntry:ue,handleSubmit:je,error:q,loadingClasses:L,loadingSubmit:re,openModal:v,academicYears:p,selectedClass:Y}},is=({open:f,onClose:u,title:p,modalMode:o,setModal:r,formData:h,handleFormChange:M,handleFeesChange:O,handleSubclassFeesChange:$,addTermFee:N,removeTermFee:b,addSubclassTermFee:Y,removeSubclassTermFee:E,openTimetableModal:d,setStudentsModalOpen:c,setTeachersModalOpen:q,setFeesModalOpen:C,handleSubmit:j,error:L,loadingSubmit:S,academicYears:K,colors:re,theme:I})=>{const m=o==="view",v=o==="delete";return Ue.useEffect(()=>{console.log("ClassModal props:",{modalMode:o,setModal:typeof r})},[o,r]),e.jsx(ce,{open:f,onClose:u,title:p,onConfirm:j,confirmMessage:v?"Delete":"Save",noConfirm:m,styleProps:{padding:I.spacing(3)},children:v?e.jsx(_,{children:"Are you sure you want to delete this class level?"}):e.jsxs(F,{component:"form",sx:{display:"flex",flexDirection:"column",gap:2},children:[m&&e.jsx(X,{icon:e.jsx(fe,{}),content:"Edit",onClick:()=>{typeof r=="function"?r("edit"):console.error("setModal is not a function")},sx:{alignSelf:"flex-start",mb:2}}),e.jsxs(ye,{label:"Section",name:"section",value:h.section,onChange:M,fullWidth:!0,disabled:m,required:!0,children:[e.jsx(ge,{value:"Primary",children:"Primary"}),e.jsx(ge,{value:"Secondary",children:"Secondary"})]}),e.jsx(y,{label:"Class Name",name:"name",value:h.name,onChange:M,fullWidth:!0,disabled:m,required:!0}),e.jsx(ye,{label:"Academic Year",name:"academicYear",value:h.academicYear,onChange:M,fullWidth:!0,disabled:m,required:!0,children:K.map(P=>e.jsx(ge,{value:P._id,children:P.name},P._id))}),e.jsx(y,{label:"Description",name:"description",value:h.description,onChange:M,fullWidth:!0,disabled:m,multiline:!0,rows:3}),e.jsx(_,{variant:"h6",children:"Class Fees Per Term"}),h.feesPerTerm.map((P,k)=>e.jsxs(F,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(y,{label:"Term Name",value:P.termName,onChange:D=>O(k,"termName",D.target.value),disabled:m,required:!0}),e.jsx(y,{label:"Amount",type:"number",value:P.amount,onChange:D=>O(k,"amount",parseFloat(D.target.value)),disabled:m,required:!0}),e.jsx(y,{label:"Description",value:P.description,onChange:D=>O(k,"description",D.target.value),disabled:m}),!m&&e.jsx(B,{icon:e.jsx(oe,{}),title:"Remove Term Fee",onClick:()=>b(k),disabled:h.feesPerTerm.length===1})]},k)),!m&&e.jsx(B,{icon:e.jsx(ae,{}),title:"Add Term Fee",onClick:N,sx:{alignSelf:"flex-start"}}),e.jsx(_,{variant:"h6",children:"Subclasses"}),h.subclasses.map((P,k)=>e.jsxs(F,{sx:{border:`1px solid ${re.grey[500]}`,p:2,mb:2},children:[e.jsxs(_,{variant:"subtitle1",children:["Subclass ",P.letter]}),e.jsx(_,{variant:"subtitle2",children:"Fees Per Term"}),P.feesPerTerm.map((D,W)=>e.jsxs(F,{sx:{display:"flex",gap:2,alignItems:"center",mt:1},children:[e.jsx(y,{label:"Term Name",value:D.termName,onChange:G=>$(k,W,"termName",G.target.value),disabled:m,required:!0}),e.jsx(y,{label:"Amount",type:"number",value:D.amount,onChange:G=>$(k,W,"amount",parseFloat(G.target.value)),disabled:m,required:!0}),e.jsx(y,{label:"Description",value:D.description,onChange:G=>$(k,W,"description",G.target.value),disabled:m}),!m&&e.jsx(B,{icon:e.jsx(oe,{}),title:"Remove Term Fee",onClick:()=>E(k,W),disabled:P.feesPerTerm.length===1})]},W)),!m&&e.jsx(B,{icon:e.jsx(ae,{}),title:"Add Subclass Term Fee",onClick:()=>Y(k),sx:{mt:1}}),e.jsx(X,{icon:e.jsx(ss,{}),content:"View Timetable",onClick:()=>d("view",P),sx:{mt:1}})]},k)),m&&e.jsxs(F,{sx:{display:"flex",gap:2,mt:2},children:[e.jsx(X,{icon:e.jsx(be,{}),content:"View Students",onClick:()=>c(!0),sx:{mx:.5}}),e.jsx(X,{icon:e.jsx(be,{}),content:"View Teachers",onClick:()=>q(!0),sx:{mx:.5}}),e.jsx(X,{icon:e.jsx(be,{}),content:"View Fees",onClick:()=>C(!0),sx:{mx:.5}})]}),L&&e.jsx(_,{color:"error",children:L}),S&&e.jsx(_,{children:"Processing..."})]})})},ls=({open:f,onClose:u,students:p,theme:o})=>e.jsx(ce,{open:f,onClose:u,title:"Students",noConfirm:!0,styleProps:{padding:o.spacing(3)},children:p.length>0?e.jsx(Re,{children:p.map(r=>e.jsx(Be,{children:e.jsx(Oe,{primary:`${r.firstName} ${r.lastName}`,secondary:`Email: ${r.email}${r.phone?` | Phone: ${r.phone}`:""}`})},r._id))}):e.jsx(_,{children:"No students assigned to this class."})}),os=({open:f,onClose:u,teachers:p,theme:o})=>e.jsx(ce,{open:f,onClose:u,title:"Teachers",noConfirm:!0,styleProps:{padding:o.spacing(3)},children:p.length>0?e.jsx(Re,{children:p.map(r=>e.jsx(Be,{children:e.jsx(Oe,{primary:`${r.firstName} ${r.lastName}`,secondary:`Email: ${r.email}${r.phone?` | Phone: ${r.phone}`:""}`})},r._id))}):e.jsx(_,{children:"No teachers assigned to this class."})}),cs=({open:f,onClose:u,title:p,timetableMode:o,selectedSubclass:r,handleTimetableChange:h,addTimetableEntry:M,removeTimetableEntry:O,setTimetableMode:$,handleSubmit:N,error:b,theme:Y})=>e.jsx(ce,{open:f,onClose:u,title:p,onConfirm:o==="edit"?N:null,confirmMessage:"Save",noConfirm:o==="view",styleProps:{padding:Y.spacing(3)},children:e.jsxs(F,{sx:{display:"flex",flexDirection:"column",gap:2},children:[o==="view"&&e.jsx(X,{icon:e.jsx(fe,{}),content:"Edit Timetable",onClick:()=>$("edit"),sx:{alignSelf:"flex-start",mb:2}}),r==null?void 0:r.timetables.map((E,d)=>e.jsxs(F,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(ye,{label:"Day",value:E.day,onChange:c=>h(d,"day",c.target.value,r.letter),disabled:o==="view",required:!0,children:["Monday","Tuesday","Wednesday","Thursday","Friday"].map(c=>e.jsx(ge,{value:c,children:c},c))}),e.jsx(y,{label:"Start Time",type:"time",value:E.startTime,onChange:c=>h(d,"startTime",c.target.value,r.letter),disabled:o==="view",required:!0,InputLabelProps:{shrink:!0}}),e.jsx(y,{label:"End Time",type:"time",value:E.endTime,onChange:c=>h(d,"endTime",c.target.value,r.letter),disabled:o==="view",required:!0,InputLabelProps:{shrink:!0}}),e.jsx(y,{label:"Subject",value:E.subject,onChange:c=>h(d,"subject",c.target.value,r.letter),disabled:o==="view",required:!0}),o==="edit"&&e.jsx(B,{icon:e.jsx(oe,{}),title:"Remove Timetable Entry",onClick:()=>O(d,r.letter),disabled:r.timetables.length===1})]},d)),o==="edit"&&e.jsx(B,{icon:e.jsx(ae,{}),title:"Add Timetable Entry",onClick:()=>M(r.letter),sx:{alignSelf:"flex-start"}}),b&&e.jsx(_,{color:"error",children:b})]})}),ds=({open:f,onClose:u,formData:p,handleFeesChange:o,handleSubclassFeesChange:r,addTermFee:h,removeTermFee:M,addSubclassTermFee:O,removeSubclassTermFee:$,handleSubmit:N,isViewMode:b,setIsViewMode:Y,error:E,colors:d,theme:c})=>e.jsx(ce,{open:f,onClose:u,title:"View/Edit Fees",onConfirm:N,confirmMessage:"Save",noConfirm:b,styleProps:{padding:c.spacing(3)},children:e.jsxs(F,{sx:{display:"flex",flexDirection:"column",gap:2},children:[b&&e.jsx(X,{icon:e.jsx(fe,{}),content:"Edit Fees",onClick:()=>Y(!1),sx:{alignSelf:"flex-start",mb:2}}),e.jsx(_,{variant:"h6",children:"Class Fees Per Term"}),p.feesPerTerm.map((q,C)=>e.jsxs(F,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(y,{label:"Term Name",value:q.termName,onChange:j=>o(C,"termName",j.target.value),disabled:b,required:!0}),e.jsx(y,{label:"Amount",type:"number",value:q.amount,onChange:j=>o(C,"amount",parseFloat(j.target.value)),disabled:b,required:!0}),e.jsx(y,{label:"Description",value:q.description,onChange:j=>o(C,"description",j.target.value),disabled:b}),!b&&e.jsx(B,{icon:e.jsx(oe,{}),title:"Remove Term Fee",onClick:()=>M(C),disabled:p.feesPerTerm.length===1})]},C)),!b&&e.jsx(B,{icon:e.jsx(ae,{}),title:"Add Term Fee",onClick:h,sx:{alignSelf:"flex-start"}}),p.subclasses.map((q,C)=>e.jsxs(F,{sx:{border:`1px solid ${d.grey[500]}`,p:2,mt:2},children:[e.jsxs(_,{variant:"subtitle1",children:["Subclass ",q.letter," Fees"]}),q.feesPerTerm.map((j,L)=>e.jsxs(F,{sx:{display:"flex",gap:2,alignItems:"center",mt:1},children:[e.jsx(y,{label:"Term Name",value:j.termName,onChange:S=>r(C,L,"termName",S.target.value),disabled:b,required:!0}),e.jsx(y,{label:"Amount",type:"number",value:j.amount,onChange:S=>r(C,L,"amount",parseFloat(S.target.value)),disabled:b,required:!0}),e.jsx(y,{label:"Description",value:j.description,onChange:S=>r(C,L,"description",S.target.value),disabled:b}),!b&&e.jsx(B,{icon:e.jsx(oe,{}),title:"Remove Term Fee",onClick:()=>$(C,L),disabled:q.feesPerTerm.length===1})]},L)),!b&&e.jsx(B,{icon:e.jsx(ae,{}),title:"Add Subclass Term Fee",onClick:()=>O(C),sx:{mt:1}})]},C)),E&&e.jsx(_,{color:"error",children:E})]})});function ms(f){const{children:u,value:p,index:o,...r}=f;return e.jsx("div",{role:"tabpanel",hidden:p!==o,id:`academic-year-tabpanel-${o}`,"aria-labelledby":`academic-year-tab-${o}`,...r,children:p===o&&e.jsx(F,{sx:{p:3},children:u})})}const us=()=>{const f=rs(),u=Ke(f.palette.mode),{tableProps:p,modalOpen:o,setModalOpen:r,modalMode:h,setModalMode:M,formData:O,handleFormChange:$,handleFeesChange:N,handleSubclassFeesChange:b,addTermFee:Y,removeTermFee:E,addSubclassTermFee:d,removeSubclassTermFee:c,handleTimetableChange:q,addTimetableEntry:C,removeTimetableEntry:j,handleSubmit:L,error:S,loadingClasses:K,loadingSubmit:re,openModal:I,academicYears:m,selectedClass:v}=ns(),{usersData:P}=Ye(qe),[k,D]=i.useState(!1),[W,G]=i.useState(!1),[he,de]=i.useState(!1),[Ce,me]=i.useState(!1),[ue,ne]=i.useState("view"),[je,pe]=i.useState(!0),[H,Te]=i.useState(null),[ve,Se]=i.useState(0),[s,t]=i.useState(m.reduce((n,T)=>({...n,[T._id]:{page:0,rowsPerPage:5,sortBy:"section",sortDirection:"asc"}}),{}));i.useEffect(()=>{t(n=>m.reduce((A,w)=>({...A,[w._id]:n[w._id]||{page:0,rowsPerPage:5,sortBy:"section",sortDirection:"asc"}}),{}))},[m]);const a=v!=null&&v.students?P.students.filter(n=>v.students.includes(n._id)):[],l=v!=null&&v.teachers?P.teachers.filter(n=>v.teachers.includes(n._id)):[],x=(n,T)=>{ne(n),Te(T),de(!0)},g=()=>{pe(!0),me(!0)},R=(n,T)=>{Se(T)},ie=(n,T)=>{t(A=>({...A,[n]:{...A[n],page:T}}))},Pe=(n,T)=>{t(A=>({...A,[n]:{...A[n],page:0,rowsPerPage:parseInt(T.target.value,10)}}))},Ve=(n,T)=>{t(A=>{const w=A[n],Z=w.sortBy===T&&w.sortDirection==="asc"?"desc":"asc";return{...A,[n]:{...w,sortBy:T,sortDirection:Z}}})},Ge=n=>{const{page:T,rowsPerPage:A,sortBy:w,sortDirection:Z}=s[n]||{page:0,rowsPerPage:5,sortBy:"section",sortDirection:"asc"},ee=p.classLevels[n]||{Primary:[],Secondary:[]};console.log(`Data for year ${n}:`,ee);let z=[...ee.Primary||[]],se=[...ee.Secondary||[]];const ke=U=>U.length?U.sort((V,Q)=>{var Ne,Ee,Le,De,_e,Me;let J=V[w]??"",te=Q[w]??"";return w==="displayName"?(J=V.displayName??"",te=Q.displayName??""):w==="studentsCount"?(J=((Ne=V.students)==null?void 0:Ne.length)??0,te=((Ee=Q.students)==null?void 0:Ee.length)??0):w==="academicYear"?(J=((Le=V.academicYear)==null?void 0:Le.name)??"",te=((De=Q.academicYear)==null?void 0:De.name)??""):w==="section"&&(J=((_e=V.section)==null?void 0:_e.toLowerCase())==="primary"?0:1,te=((Me=Q.section)==null?void 0:Me.toLowerCase())==="secondary"?1:0),J<te?Z==="asc"?-1:1:J>te?Z==="asc"?1:-1:0}):U;z=ke(z),se=ke(se);let We=[...z,...se];const xe=T*A,He=We.slice(xe,xe+A);let Ae=1,we=1;if(T>0){const U=z.slice(0,xe).length,V=se.slice(0,xe).length;Ae=U+1,we=V+1}const Fe=He.map(U=>{var Q,J;let V;return((Q=U.section)==null?void 0:Q.toLowerCase())==="primary"?V=Ae++:((J=U.section)==null?void 0:J.toLowerCase())==="secondary"?V=we++:V=0,{...U,sn:V}});return console.log(`Paginated data for year ${n}:`,Fe),Fe};return e.jsxs(F,{children:[e.jsx(Qe,{title:"Class Management",subtitle:"Manage class levels and their details"}),e.jsxs(F,{sx:{mt:3,mb:3},children:[e.jsx(X,{icon:e.jsx(ae,{}),content:"Add Class",onClick:()=>I("create"),sx:{mb:2}}),K?e.jsx(Je,{}):e.jsx(F,{height:"75vh",sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{borderBottom:"none"},"& .MuiDataGrid-columnHeaders":{backgroundColor:u.blueAccent[700],borderBottom:"none"},"& .MuiDataGrid-virtualScroller":{backgroundColor:u.primary[400]},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:u.blueAccent[700]},"& .MuiCheckbox-root":{color:`${u.greenAccent[200]} !important`}},children:m.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{value:ve,onChange:R,"aria-label":"academic year tabs",sx:{backgroundColor:u.primary[400],"& .MuiTabs-indicator":{backgroundColor:u.blueAccent[700]}},children:m.map((n,T)=>e.jsx(Ze,{label:n.name,sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:u.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:u.primary[400]}},n._id))}),m.map((n,T)=>{var A,w,Z,ee;return e.jsx(ms,{value:ve,index:T,children:e.jsx(Ie,{...p,classLevels:Ge(n._id),tableHeader:`Classes for ${n.name}`,page:((A=s[n._id])==null?void 0:A.page)||0,rowsPerPage:((w=s[n._id])==null?void 0:w.rowsPerPage)||5,sortBy:((Z=s[n._id])==null?void 0:Z.sortBy)||"section",sortDirection:((ee=s[n._id])==null?void 0:ee.sortDirection)||"asc",onSortChange:z=>Ve(n._id,z),onPageChange:(z,se)=>ie(n._id,se),onRowsPerPageChange:z=>Pe(n._id,z)})},n._id)})]}):e.jsx(_,{children:"No academic years available"})})]}),e.jsx(is,{open:o,onClose:()=>r(!1),title:{create:"Create Class Level",edit:"Edit Class Level",view:"View Class Level",delete:"Delete Class Level"}[h],modalMode:h,setModal:M,formData:O,handleFormChange:$,handleFeesChange:N,handleSubclassFeesChange:b,addTermFee:Y,removeTermFee:E,addSubclassTermFee:d,removeSubclassTermFee:c,openTimetableModal:x,setStudentsModalOpen:D,setTeachersModalOpen:G,setFeesModalOpen:g,handleSubmit:L,error:S,loadingSubmit:re,academicYears:m,colors:u,theme:f}),e.jsx(ls,{open:k,onClose:()=>D(!1),students:a,theme:f}),e.jsx(os,{open:W,onClose:()=>G(!1),teachers:l,theme:f}),e.jsx(cs,{open:he,onClose:()=>de(!1),title:`${ue==="edit"?"Edit":"View"} Timetable for Subclass ${H==null?void 0:H.letter}`,timetableMode:ue,selectedSubclass:H,handleTimetableChange:q,addTimetableEntry:C,removeTimetableEntry:j,setTimetableMode:ne,handleSubmit:L,error:S,theme:f}),e.jsx(ds,{open:Ce,onClose:()=>me(!1),formData:O,handleFeesChange:N,handleSubclassFeesChange:b,addTermFee:Y,removeTermFee:E,addSubclassTermFee:d,removeSubclassTermFee:c,handleSubmit:L,isViewMode:je,setIsViewMode:pe,error:S,colors:u,theme:f})]})},Es=as(us);export{Es as default};
