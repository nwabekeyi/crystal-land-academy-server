import{a as We,O as He,r,e as se,M as Xe,j as e,R as Ze,i as Ie}from"./index-BdybpPeh.js";import{M as be,t as es,D as ss,a as ts,b as as,c as rs}from"./modal-DeXGtVHz.js";import{H as ns}from"./Header-BhSo-vTi.js";import{a as ls,b as is,T as os}from"./table-C8DwS9aK.js";import{u as Re}from"./useApi-BtG_FYeQ.js";import{C as q}from"./customIconButton-DEDTaYKJ.js";import{h as ve,e as De,g as cs,i as oe,j as ds}from"./index.esm-Ci8fDIK4.js";import{u as ms,M as ie}from"./MenuItem-DmfVB64U.js";import{w as us}from"./dasboardPagesContainer-eCulhxLH.js";import{A as X}from"./confirmationModal-v5YzOX-t.js";import{c as xe,L as Je,a as Ke}from"./index-BfcDX7Jl.js";import{v as A,T as P,a0 as Pe,y as w,w as Ue,j as ps,x as Ge}from"./TextField-kKLYiU0N.js";import"./IconButton-ngG_4x53.js";import"./useMediaQuery-BxgjEkmC.js";import"./index-D-9M-KGn.js";import"./loadingButton-BLWVx6oC.js";import"./CircularProgress-PAT3fSQ0.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-CLq4ah7Q.js";const xs=()=>{const j=ms(),{classLevels:u,academicYears:p}=We(He),[o,l]=r.useState("section"),[g,N]=r.useState("asc"),[B,$]=r.useState(!1),[_,f]=r.useState("create"),[Y,M]=r.useState(null),[m,c]=r.useState({section:"Primary",name:"",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],description:"",academicYear:"",subclasses:[{letter:"A",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],timetables:[]}]}),[O,C]=r.useState(""),[D,k]=r.useState(!1),[y,te]=r.useState(null),{data:G,loading:ce,callApi:d}=Re(),{callApi:T,loading:de,error:W}=Re();r.useEffect(()=>{d(se.CLASS_LEVEL,"GET")},[d]),r.useEffect(()=>{G&&Array.isArray(G.data)&&(console.log("Fetched classLevels:",G.data),j(Xe(G.data)))},[G,j]);const me=r.useCallback(s=>{o===s?N(g==="asc"?"desc":"asc"):(l(s),N("asc"))},[o,g]),x=r.useCallback((s,t=null)=>{var a,i;f(s),M(t),s==="create"?c({section:"Primary",name:"",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],description:"",academicYear:((a=p.find(b=>b.isCurrent))==null?void 0:a._id)||"",subclasses:[{letter:"A",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],timetables:[]}]}):t&&c({section:t.section||"Primary",name:t.name||"",feesPerTerm:t.feesPerTerm||[{termName:"1st Term",amount:0,description:""}],description:t.description||"",academicYear:((i=t.academicYear)==null?void 0:i._id)||"",subclasses:t.subclasses||[{letter:"A",feesPerTerm:t.feesPerTerm||[{termName:"1st Term",amount:0,description:""}],timetables:[]}]}),$(!0)},[p]),v=r.useCallback(s=>{te(s),k(!0)},[]),F=r.useCallback(()=>{te(null),k(!1)},[]),H=r.useCallback(async()=>{if(y)try{await T(`${se.CLASS_LEVEL}/${y._id}`,"DELETE"),d(se.CLASS_LEVEL,"GET"),C("")}catch{C(W||"Failed to delete class")}finally{F()}},[y,T,d,W,F]),J=r.useCallback(s=>{const{name:t,value:a}=s.target;c(i=>({...i,[t]:a}))},[]),ge=r.useCallback((s,t,a)=>{c(i=>{const b=[...i.feesPerTerm];return b[s]={...b[s],[t]:a},{...i,feesPerTerm:b}})},[]),ke=r.useCallback((s,t,a,i)=>{c(b=>{const h=[...b.subclasses],V=[...h[s].feesPerTerm];return V[t]={...V[t],[a]:i},h[s]={...h[s],feesPerTerm:V},{...b,subclasses:h}})},[]),fe=r.useCallback(()=>{c(s=>({...s,feesPerTerm:[...s.feesPerTerm,{termName:`${s.feesPerTerm.length+1} Term`,amount:0,description:""}]}))},[]),Ae=r.useCallback(s=>{c(t=>({...t,feesPerTerm:t.feesPerTerm.filter((a,i)=>i!==s)}))},[]),he=r.useCallback(s=>{c(t=>{const a=[...t.subclasses];return a[s]={...a[s],feesPerTerm:[...a[s].feesPerTerm,{termName:`${a[s].feesPerTerm.length+1} Term`,amount:0,description:""}]},{...t,subclasses:a}})},[]),Ce=r.useCallback((s,t)=>{c(a=>{const i=[...a.subclasses];return i[s]={...i[s],feesPerTerm:i[s].feesPerTerm.filter((b,h)=>h!==t)},{...a,subclasses:i}})},[]),je=r.useCallback((s,t,a,i)=>{c(b=>{const h=[...b.subclasses],V=h.findIndex(n=>n.letter===i);if(V===-1)return b;const pe=[...h[V].timetables];return pe[s]={...pe[s],[t]:a},h[V]={...h[V],timetables:pe},{...b,subclasses:h}})},[]),Ee=r.useCallback(s=>{c(t=>{const a=[...t.subclasses],i=a.findIndex(b=>b.letter===s);return i===-1?t:(a[i]={...a[subIndex],timetables:[...a[subIndex].timetables,{day:"Monday",startTime:"08:00",endTime:"09:00",subject:""}]},{...t,subclasses:a})})},[]),Te=r.useCallback((s,t)=>{c(a=>{const i=[...a.subclasses],b=i.findIndex(h=>h.letter===t);return b===-1?a:(i[b]={...i[subIndex],timetables:i[subIndex].timetables.filter((h,V)=>V!==s)},{...a,subclasses:i})})},[]),Z=r.useCallback(()=>m.section?m.name?m.academicYear?m.feesPerTerm.every(s=>s.termName&&s.amount>=0)?m.subclasses.every(s=>s.feesPerTerm.every(t=>t.termName&&t.amount>=0))?m.subclasses.some(s=>s.timetables.some(t=>!t.day||!t.startTime||!t.endTime||!t.subject))?"All timetable entries must have valid fields":"":"All subclass fees must have a term name and a valid amount":"All class fees must have a term name and a valid amount":"Academic year is required":"Class name is required":"Section is required",[m]),Le=r.useCallback(async()=>{const s=Z();if(s){C(s);return}const t={section:m.section,name:m.name,description:m.description,academicYear:m.academicYear,feesPerTerm:m.feesPerTerm,subclasses:m.subclasses.map(a=>({letter:a.letter,feesPerTerm:a.feesPerTerm,timetables:a.timetables}))};try{_==="create"?await T(se.CLASS_LEVEL,"POST",t):_==="edit"?await T(`${se.CLASS_LEVEL}/${Y._id}`,"PATCH",t):_==="delete"&&await T(`${se.CLASS_LEVEL}/${Y._id}`,"DELETE"),d(se.CLASS_LEVEL,"GET"),$(!1),C("")}catch{C(W||"Failed to process request")}},[_,m,Y,T,d,W,Z]),ye=s=>{const t=new Date(s);return!isNaN(t.getTime())&&/^\d{4}-\d{2}-\d{2}$/.test(s)?t.toLocaleDateString(navigator.language||"en-US",{year:"numeric",month:"long",day:"numeric"}):s},ae=r.useMemo(()=>Array.isArray(u)?u.map(s=>({...s,displayName:ye(s.name)})):[],[u]),I=r.useMemo(()=>{const s={};return p.forEach(t=>{s[t._id]={Primary:ae.filter(a=>{var i,b,h;return((i=a.academicYear)==null?void 0:i._id)===t._id&&(((b=a.section)==null?void 0:b.toLowerCase())==="primary"||((h=a.section)==null?void 0:h.toLowerCase())==="Primary")}),Secondary:ae.filter(a=>{var i,b,h;return((i=a.academicYear)==null?void 0:i._id)===t._id&&(((b=a.section)==null?void 0:b.toLowerCase())==="secondary"||((h=a.section)==null?void 0:h.toLowerCase())==="Secondary")})},console.log(`Grouped data for year ${t._id}:`,s[t._id])}),s},[ae,p]);return{tableProps:{columns:r.useMemo(()=>[{id:"sn",label:"S/N",width:90},{id:"section",label:"Section",flex:1},{id:"displayName",label:"Class Name",flex:1,renderCell:s=>s.displayName},{id:"studentsCount",label:"Students",flex:1,renderCell:s=>{var t;return((t=s.students)==null?void 0:t.length)||0}},{id:"academicYear",label:"Academic Year",flex:1,renderCell:s=>{var t;return((t=s.academicYear)==null?void 0:t.name)||"N/A"}},{id:"actions",label:"Actions",flex:1,renderCell:s=>e.jsxs(e.Fragment,{children:[e.jsx(q,{icon:e.jsx(ve,{}),title:"View Class",onClick:()=>x("view",s),sx:{mx:.5}}),e.jsx(q,{icon:e.jsx(De,{}),title:"Edit Class",onClick:()=>x("edit",s),sx:{mx:.5}}),e.jsx(q,{icon:e.jsx(cs,{}),title:"Delete Class",onClick:()=>v(s),sx:{mx:.5}})]})}],[x,v]),tableHeader:"Class Management",data:ae,classLevels:I,sortBy:o,sortDirection:g,onSortChange:me,hiddenColumnsSmallScreen:["description"],hiddenColumnsTabScreen:[],academicYears:p},modalOpen:B,setModalOpen:$,modalMode:_,setModalMode:f,formData:m,setFormData:c,handleFormChange:J,handleFeesChange:ge,handleSubclassFeesChange:ke,addTermFee:fe,removeTermFee:Ae,addSubclassTermFee:he,removeSubclassTermFee:Ce,handleTimetableChange:je,addTimetableEntry:Ee,removeTimetableEntry:Te,handleSubmit:Le,error:O,loadingClasses:ce,loadingSubmit:de,openModal:x,academicYears:p,selectedClass:Y,deleteConfirmOpen:D,classToDelete:y,handleDelete:H,closeDeleteConfirm:F}},bs=({open:j,onClose:u,title:p,modalMode:o,setModal:l,formData:g,handleFormChange:N,handleFeesChange:B,handleSubclassFeesChange:$,addTermFee:_,removeTermFee:f,addSubclassTermFee:Y,removeSubclassTermFee:M,openTimetableModal:m,setStudentsModalOpen:c,setTeachersModalOpen:O,setFeesModalOpen:C,handleSubmit:D,error:k,loadingSubmit:y,academicYears:te,colors:G,theme:ce})=>{const d=o==="view",T=o==="delete",de=["Kindergarten","Reception","Nursery 1","Nursery 2","Primary 1","Primary 2","Primary 3","Primary 4","Primary 5","Primary 6"],W=["JSS 1","JSS 2","JSS 3","SS 1","SS 2","SS 3"],me=g.section==="Primary"?de:g.section==="Secondary"?W:[];return Ze.useEffect(()=>{console.log("ClassModal props:",{modalMode:o,setModal:typeof l})},[o,l]),e.jsx(be,{open:j,onClose:u,title:p,onConfirm:D,confirmMessage:T?"Confirm Delete":"Save",cancelMessage:"Cancel",noConfirm:d,styleProps:{padding:ce.spacing(3)},children:T?e.jsxs(A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(P,{variant:"h6",color:"error",children:"Confirm Deletion"}),e.jsxs(P,{children:["Are you sure you want to delete the class ",e.jsx("strong",{children:g.name}),"? This action cannot be undone."]}),e.jsxs(A,{sx:{display:"flex",gap:2,justifyContent:"flex-end",mt:2},children:[e.jsx(Button,{variant:"outlined",color:"secondary",onClick:u,children:"Cancel"}),e.jsx(Button,{variant:"contained",color:"error",onClick:D,disabled:y,children:y?"Deleting...":"Confirm Delete"})]}),k&&e.jsx(P,{color:"error",children:k})]}):e.jsxs(A,{component:"form",sx:{display:"flex",flexDirection:"column",gap:2},children:[d&&e.jsx(X,{icon:e.jsx(De,{}),content:"Edit",onClick:()=>{typeof l=="function"?l("edit"):console.error("setModal is not a function")},sx:{alignSelf:"flex-start",mb:2}}),e.jsxs(Pe,{label:"Section",name:"section",value:g.section,onChange:x=>{N(x),N({target:{name:"name",value:""}})},fullWidth:!0,disabled:d,required:!0,children:[e.jsx(ie,{value:"Primary",children:"Primary"}),e.jsx(ie,{value:"Secondary",children:"Secondary"})]}),e.jsxs(Pe,{label:"Class Name",name:"name",value:g.name,onChange:N,fullWidth:!0,disabled:d||!g.section,required:!0,children:[e.jsx(ie,{value:"",disabled:!0,children:"Select a class"}),me.map(x=>e.jsx(ie,{value:x,children:x},x))]}),e.jsx(Pe,{label:"Academic Year",name:"academicYear",value:g.academicYear,onChange:N,fullWidth:!0,disabled:d,required:!0,children:te.map(x=>e.jsx(ie,{value:x._id,children:x.name},x._id))}),e.jsx(w,{label:"Description",name:"description",value:g.description,onChange:N,fullWidth:!0,disabled:d,multiline:!0,rows:3}),e.jsx(P,{variant:"h6",children:"Class Fees Per Term"}),g.feesPerTerm.map((x,v)=>e.jsxs(A,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(w,{label:"Term Name",value:x.termName,onChange:F=>B(v,"termName",F.target.value),disabled:d,required:!0}),e.jsx(w,{label:"Amount",type:"number",value:x.amount,onChange:F=>B(v,"amount",parseFloat(F.target.value)),disabled:d,required:!0}),e.jsx(w,{label:"Description",value:x.description,onChange:F=>B(v,"description",F.target.value),disabled:d}),!d&&e.jsx(q,{icon:e.jsx(xe,{}),title:"Remove Term Fee",onClick:()=>f(v),disabled:g.feesPerTerm.length===1})]},v)),!d&&e.jsx(q,{icon:e.jsx(oe,{}),title:"Add Term Fee",onClick:_,sx:{alignSelf:"flex-start"}}),e.jsx(P,{variant:"h6",children:"Subclasses"}),g.subclasses.map((x,v)=>e.jsxs(A,{sx:{border:`1px solid ${G.grey[500]}`,p:2,mb:2},children:[e.jsxs(P,{variant:"subtitle1",children:["Subclass ",x.letter]}),e.jsx(P,{variant:"subtitle2",children:"Fees Per Term"}),x.feesPerTerm.map((F,H)=>e.jsxs(A,{sx:{display:"flex",gap:2,alignItems:"center",mt:1},children:[e.jsx(w,{label:"Term Name",value:F.termName,onChange:J=>$(v,H,"termName",J.target.value),disabled:d,required:!0}),e.jsx(w,{label:"Amount",type:"number",value:F.amount,onChange:J=>$(v,H,"amount",parseFloat(J.target.value)),disabled:d,required:!0}),e.jsx(w,{label:"Description",value:F.description,onChange:J=>$(v,H,"description",J.target.value),disabled:d}),!d&&e.jsx(q,{icon:e.jsx(xe,{}),title:"Remove Term Fee",onClick:()=>M(v,H),disabled:x.feesPerTerm.length===1})]},H)),!d&&e.jsx(q,{icon:e.jsx(oe,{}),title:"Add Subclass Term Fee",onClick:()=>Y(v),sx:{mt:1}}),e.jsx(X,{icon:e.jsx(ds,{}),content:"View Timetable",onClick:()=>m("view",x),sx:{mt:1}})]},v)),d&&e.jsxs(A,{sx:{display:"flex",gap:2,mt:2},children:[e.jsx(X,{icon:e.jsx(ve,{}),content:"View Students",onClick:()=>c(!0),sx:{mx:.5}}),e.jsx(X,{icon:e.jsx(ve,{}),content:"View Teachers",onClick:()=>O(!0),sx:{mx:.5}}),e.jsx(X,{icon:e.jsx(ve,{}),content:"View Fees",onClick:()=>C(!0),sx:{mx:.5}})]}),k&&e.jsx(P,{color:"error",children:k}),y&&!T&&e.jsx(P,{children:"Processing..."})]})})},gs=({open:j,onClose:u,students:p,theme:o})=>e.jsx(be,{open:j,onClose:u,title:"Students",noConfirm:!0,styleProps:{padding:o.spacing(3)},children:p.length>0?e.jsx(Ue,{children:p.map(l=>e.jsx(Je,{children:e.jsx(Ke,{primary:`${l.firstName} ${l.lastName}`,secondary:`Email: ${l.email}${l.phone?` | Phone: ${l.phone}`:""}`})},l._id))}):e.jsx(P,{children:"No students assigned to this class."})}),fs=({open:j,onClose:u,teachers:p,theme:o})=>e.jsx(be,{open:j,onClose:u,title:"Teachers",noConfirm:!0,styleProps:{padding:o.spacing(3)},children:p.length>0?e.jsx(Ue,{children:p.map(l=>e.jsx(Je,{children:e.jsx(Ke,{primary:`${l.firstName} ${l.lastName}`,secondary:`Email: ${l.email}${l.phone?` | Phone: ${l.phone}`:""}`})},l._id))}):e.jsx(P,{children:"No teachers assigned to this class."})}),hs=({open:j,onClose:u,title:p,timetableMode:o,selectedSubclass:l,handleTimetableChange:g,addTimetableEntry:N,removeTimetableEntry:B,setTimetableMode:$,handleSubmit:_,error:f,theme:Y})=>e.jsx(be,{open:j,onClose:u,title:p,onConfirm:o==="edit"?_:null,confirmMessage:"Save",noConfirm:o==="view",styleProps:{padding:Y.spacing(3)},children:e.jsxs(A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[o==="view"&&e.jsx(X,{icon:e.jsx(De,{}),content:"Edit Timetable",onClick:()=>$("edit"),sx:{alignSelf:"flex-start",mb:2}}),l==null?void 0:l.timetables.map((M,m)=>e.jsxs(A,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(Pe,{label:"Day",value:M.day,onChange:c=>g(m,"day",c.target.value,l.letter),disabled:o==="view",required:!0,children:["Monday","Tuesday","Wednesday","Thursday","Friday"].map(c=>e.jsx(ie,{value:c,children:c},c))}),e.jsx(w,{label:"Start Time",type:"time",value:M.startTime,onChange:c=>g(m,"startTime",c.target.value,l.letter),disabled:o==="view",required:!0,InputLabelProps:{shrink:!0}}),e.jsx(w,{label:"End Time",type:"time",value:M.endTime,onChange:c=>g(m,"endTime",c.target.value,l.letter),disabled:o==="view",required:!0,InputLabelProps:{shrink:!0}}),e.jsx(w,{label:"Subject",value:M.subject,onChange:c=>g(m,"subject",c.target.value,l.letter),disabled:o==="view",required:!0}),o==="edit"&&e.jsx(q,{icon:e.jsx(xe,{}),title:"Remove Timetable Entry",onClick:()=>B(m,l.letter),disabled:l.timetables.length===1})]},m)),o==="edit"&&e.jsx(q,{icon:e.jsx(oe,{}),title:"Add Timetable Entry",onClick:()=>N(l.letter),sx:{alignSelf:"flex-start"}}),f&&e.jsx(P,{color:"error",children:f})]})}),Cs=({open:j,onClose:u,formData:p,handleFeesChange:o,handleSubclassFeesChange:l,addTermFee:g,removeTermFee:N,addSubclassTermFee:B,removeSubclassTermFee:$,handleSubmit:_,isViewMode:f,setIsViewMode:Y,error:M,colors:m,theme:c})=>e.jsx(be,{open:j,onClose:u,title:"View/Edit Fees",onConfirm:_,confirmMessage:"Save",noConfirm:f,styleProps:{padding:c.spacing(3)},children:e.jsxs(A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[f&&e.jsx(X,{icon:e.jsx(De,{}),content:"Edit Fees",onClick:()=>Y(!1),sx:{alignSelf:"flex-start",mb:2}}),e.jsx(P,{variant:"h6",children:"Class Fees Per Term"}),p.feesPerTerm.map((O,C)=>e.jsxs(A,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(w,{label:"Term Name",value:O.termName,onChange:D=>o(C,"termName",D.target.value),disabled:f,required:!0}),e.jsx(w,{label:"Amount",type:"number",value:O.amount,onChange:D=>o(C,"amount",parseFloat(D.target.value)),disabled:f,required:!0}),e.jsx(w,{label:"Description",value:O.description,onChange:D=>o(C,"description",D.target.value),disabled:f}),!f&&e.jsx(q,{icon:e.jsx(xe,{}),title:"Remove Term Fee",onClick:()=>N(C),disabled:p.feesPerTerm.length===1})]},C)),!f&&e.jsx(q,{icon:e.jsx(oe,{}),title:"Add Term Fee",onClick:g,sx:{alignSelf:"flex-start"}}),p.subclasses.map((O,C)=>e.jsxs(A,{sx:{border:`1px solid ${m.grey[500]}`,p:2,mt:2},children:[e.jsxs(P,{variant:"subtitle1",children:["Subclass ",O.letter," Fees"]}),O.feesPerTerm.map((D,k)=>e.jsxs(A,{sx:{display:"flex",gap:2,alignItems:"center",mt:1},children:[e.jsx(w,{label:"Term Name",value:D.termName,onChange:y=>l(C,k,"termName",y.target.value),disabled:f,required:!0}),e.jsx(w,{label:"Amount",type:"number",value:D.amount,onChange:y=>l(C,k,"amount",parseFloat(y.target.value)),disabled:f,required:!0}),e.jsx(w,{label:"Description",value:D.description,onChange:y=>l(C,k,"description",y.target.value),disabled:f}),!f&&e.jsx(q,{icon:e.jsx(xe,{}),title:"Remove Term Fee",onClick:()=>$(C,k),disabled:O.feesPerTerm.length===1})]},k)),!f&&e.jsx(q,{icon:e.jsx(oe,{}),title:"Add Subclass Term Fee",onClick:()=>B(C),sx:{mt:1}})]},C)),M&&e.jsx(P,{color:"error",children:M})]})});function js(j){const{children:u,value:p,index:o,...l}=j;return e.jsx("div",{role:"tabpanel",hidden:p!==o,id:`academic-year-tabpanel-${o}`,"aria-labelledby":`academic-year-tab-${o}`,...l,children:p===o&&e.jsx(A,{sx:{p:3},children:u})})}const Ts=()=>{const j=ps(),u=es(j.palette.mode),{tableProps:p,modalOpen:o,setModalOpen:l,modalMode:g,setModalMode:N,formData:B,handleFormChange:$,handleFeesChange:_,handleSubclassFeesChange:f,addTermFee:Y,removeTermFee:M,addSubclassTermFee:m,removeSubclassTermFee:c,handleTimetableChange:O,addTimetableEntry:C,removeTimetableEntry:D,handleSubmit:k,error:y,loadingClasses:te,loadingSubmit:G,openModal:ce,academicYears:d,selectedClass:T,deleteConfirmOpen:de,classToDelete:W,handleDelete:me,closeDeleteConfirm:x}=xs(),{usersData:v}=We(He),[F,H]=r.useState(!1),[J,ge]=r.useState(!1),[ke,fe]=r.useState(!1),[Ae,he]=r.useState(!1),[Ce,je]=r.useState("view"),[Ee,Te]=r.useState(!0),[Z,Le]=r.useState(null),[ye,ae]=r.useState(0),[I,ue]=r.useState(d.reduce((n,S)=>({...n,[S._id]:{page:0,rowsPerPage:5,sortBy:"section",sortDirection:"asc"}}),{}));r.useEffect(()=>{ue(n=>d.reduce((E,L)=>({...E,[L._id]:n[L._id]||{page:0,rowsPerPage:5,sortBy:"section",sortDirection:"asc"}}),{}))},[d]);const we=T!=null&&T.students?v.students.filter(n=>T.students.includes(n._id)):[],s=T!=null&&T.teachers?v.teachers.filter(n=>T.teachers.includes(n._id)):[],t=(n,S)=>{je(n),Le(S),fe(!0)},a=()=>{Te(!0),he(!0)},i=(n,S)=>{ae(S)},b=(n,S)=>{ue(E=>({...E,[n]:{...E[n],page:S}}))},h=(n,S)=>{ue(E=>({...E,[n]:{...E[n],page:0,rowsPerPage:parseInt(S.target.value,10)}}))},V=(n,S)=>{ue(E=>{const L=E[n],ee=L.sortBy===S&&L.sortDirection==="asc"?"desc":"asc";return{...E,[n]:{...L,sortBy:S,sortDirection:ee}}})},pe=n=>{const{page:S,rowsPerPage:E,sortBy:L,sortDirection:ee}=I[n]||{page:0,rowsPerPage:5,sortBy:"section",sortDirection:"asc"},re=p.classLevels[n]||{Primary:[],Secondary:[]};console.log(`Data for year ${n}:`,re);let K=[...re.Primary||[]],ne=[...re.Secondary||[]];const Fe=U=>U.length?U.sort((R,Q)=>{var $e,Ye,Oe,qe,Be,Ve;let z=R[L]??"",le=Q[L]??"";return L==="displayName"?(z=R.displayName??"",le=Q.displayName??""):L==="studentsCount"?(z=(($e=R.students)==null?void 0:$e.length)??0,le=((Ye=Q.students)==null?void 0:Ye.length)??0):L==="academicYear"?(z=((Oe=R.academicYear)==null?void 0:Oe.name)??"",le=((qe=Q.academicYear)==null?void 0:qe.name)??""):L==="section"&&(z=((Be=R.section)==null?void 0:Be.toLowerCase())==="primary"?0:1,le=((Ve=Q.section)==null?void 0:Ve.toLowerCase())==="secondary"?1:0),z<le?ee==="asc"?-1:1:z>le?ee==="asc"?1:-1:0}):U;K=Fe(K),ne=Fe(ne);let ze=[...K,...ne];const Se=S*E,Qe=ze.slice(Se,Se+E);let Ne=1,_e=1;if(S>0){const U=K.slice(0,Se).length,R=ne.slice(0,Se).length;Ne=U+1,_e=R+1}const Me=Qe.map(U=>{var Q,z;let R;return((Q=U.section)==null?void 0:Q.toLowerCase())==="primary"?R=Ne++:((z=U.section)==null?void 0:z.toLowerCase())==="secondary"?R=_e++:R=0,{...U,sn:R}});return console.log(`Paginated data for year ${n}:`,Me),Me};return e.jsxs(A,{children:[e.jsx(ns,{title:"Class Management",subtitle:"Manage class levels and their details"}),e.jsxs(A,{sx:{mt:3,mb:3},children:[e.jsx(X,{icon:e.jsx(oe,{}),content:"Add Class",onClick:()=>ce("create"),sx:{mb:2}}),te?e.jsx(Ie,{}):e.jsx(A,{height:"75vh",sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{borderBottom:"none"},"& .MuiDataGrid-columnHeaders":{backgroundColor:u.blueAccent[700],borderBottom:"none"},"& .MuiDataGrid-virtualScroller":{backgroundColor:u.primary[400]},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:u.blueAccent[700]},"& .MuiCheckbox-root":{color:`${u.greenAccent[200]} !important`}},children:d.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ls,{value:ye,onChange:i,"aria-label":"academic year tabs",sx:{backgroundColor:u.primary[400],"& .MuiTabs-indicator":{backgroundColor:u.blueAccent[700]}},children:d.map((n,S)=>e.jsx(is,{label:n.name,sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:u.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:u.primary[400]}},n._id))}),d.map((n,S)=>{var E,L,ee,re;return e.jsx(js,{value:ye,index:S,children:e.jsx(os,{...p,classLevels:pe(n._id),tableHeader:`Classes for ${n.name}`,page:((E=I[n._id])==null?void 0:E.page)||0,rowsPerPage:((L=I[n._id])==null?void 0:L.rowsPerPage)||5,sortBy:((ee=I[n._id])==null?void 0:ee.sortBy)||"section",sortDirection:((re=I[n._id])==null?void 0:re.sortDirection)||"asc",onSortChange:K=>V(n._id,K),onPageChange:(K,ne)=>b(n._id,ne),onRowsPerPageChange:K=>h(n._id,K)})},n._id)})]}):e.jsx(P,{children:"No academic years available"})})]}),e.jsx(bs,{open:o,onClose:()=>l(!1),title:{create:"Create Class Level",edit:"Edit Class Level",view:"View Class Level",delete:"Delete Class Level"}[g],modalMode:g,setModal:N,formData:B,handleFormChange:$,handleFeesChange:_,handleSubclassFeesChange:f,addTermFee:Y,removeTermFee:M,addSubclassTermFee:m,removeSubclassTermFee:c,openTimetableModal:t,setStudentsModalOpen:H,setTeachersModalOpen:ge,setFeesModalOpen:a,handleSubmit:k,error:y,loadingSubmit:G,academicYears:d,colors:u,theme:j}),e.jsx(gs,{open:F,onClose:()=>H(!1),students:we,theme:j}),e.jsx(fs,{open:J,onClose:()=>ge(!1),teachers:s,theme:j}),e.jsx(hs,{open:ke,onClose:()=>fe(!1),title:`${Ce==="edit"?"Edit":"View"} Timetable for Subclass ${Z==null?void 0:Z.letter}`,timetableMode:Ce,selectedSubclass:Z,handleTimetableChange:O,addTimetableEntry:C,removeTimetableEntry:D,setTimetableMode:je,handleSubmit:k,error:y,theme:j}),e.jsx(Cs,{open:Ae,onClose:()=>he(!1),formData:B,handleFeesChange:_,handleSubclassFeesChange:f,addTermFee:Y,removeTermFee:M,addSubclassTermFee:m,removeSubclassTermFee:c,handleSubmit:k,isViewMode:Ee,setIsViewMode:Te,error:y,colors:u,theme:j}),e.jsxs(ss,{open:de,onClose:x,"aria-labelledby":"delete-confirm-dialog-title","aria-describedby":"delete-confirm-dialog-description",children:[e.jsx(ts,{id:"delete-confirm-dialog-title",children:"Confirm Deletion"}),e.jsxs(as,{children:[e.jsxs(P,{id:"delete-confirm-dialog-description",children:["Are you sure you want to delete the class ",e.jsx("strong",{children:W==null?void 0:W.name}),"? This action cannot be undone."]}),y&&e.jsx(P,{color:"error",sx:{mt:2},children:y})]}),e.jsxs(rs,{children:[e.jsx(Ge,{onClick:x,color:"secondary",children:"Cancel"}),e.jsx(Ge,{onClick:me,color:"error",variant:"contained",disabled:G,children:G?"Deleting...":"Delete"})]})]})]})},Vs=us(Ts);export{Vs as default};
