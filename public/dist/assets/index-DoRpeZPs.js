import{j as e,r as d,f as z,D as Ne,i as Ve,a as de,E as ct,F as Et}from"./index-BgVW12L4.js";import{r as fe,t as O,M as ne}from"./modal-BA-eVLt_.js";import{c as Ae,a as kt,g as wt,u as Tt,_ as dt,K as ut,af as Ft,ap as Rt,$ as Mt,o as Lt,b as G,s as Ce,d as Se,h as mt,e as Ot,aq as Pt,ar as Nt,q as pe,j as P,v as l,T as a,w as De,y as _,a1 as $e,a2 as We,a3 as _e,x as ot}from"./TextField-NDbbILhh.js";import{H as It}from"./Header-CogA_8fZ.js";import{G as Be,L as Ee,a as ke,C as we,b as Te,A as ht,d as ye}from"./index-CjZWgTm8.js";import{t as xt}from"./nivo-pie-DayFCmia.js";import{p as gt}from"./nivo-line.es-DEtZMq9O.js";import{u as q}from"./useApi-TIUFMcqH.js";import{u as ft}from"./index-D41-9XSs.js";import{f as Ie,F as Ye,m as He,a as Ge,b as pt}from"./main-C3qW2AYZ.js";import{m as qe}from"./main-CikXAO9w.js";import{A as Ue}from"./Alert-D4LgS88T.js";import{I as Xe}from"./IconButton-4sz3Qd6x.js";import{X as zt}from"./nivo-bar-BUUPF7qO.js";import{u as it}from"./useMediaQuery-DmlQxk2V.js";import{w as $t}from"./dasboardPagesContainer-p6UpWRgj.js";import{C as jt}from"./confirmationModal-CMKhpNuH.js";import{C as Wt}from"./CircularProgress-ELwt6FEm.js";import{M as ae}from"./MenuItem-B4LKlkvK.js";import{A as xe}from"./actionButton-Bx_NG6Vl.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-DfBjlVf_.js";import"./isEqual-CHJkiDyc.js";import"./_baseIsEqual-CPX2ChVj.js";import"./_baseForOwn-h0lgWM6z.js";import"./loadingButton-DGhAAS35.js";import"./_baseSlice-z0Zd1-Ev.js";const _t={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"},Vt=Ae(e.jsx("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),Bt=Ae(e.jsx("path",{d:"M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"}),"StarBorder");function Yt(t){return wt("MuiRating",t)}const ge=kt("MuiRating",["root","sizeSmall","sizeMedium","sizeLarge","readOnly","disabled","focusVisible","visuallyHidden","pristine","label","labelEmptyValueActive","icon","iconEmpty","iconFilled","iconHover","iconFocus","iconActive","decimal"]),Ht=["value"],Gt=["className","defaultValue","disabled","emptyIcon","emptyLabelText","getLabelText","highlightSelectedOnly","icon","IconContainerComponent","max","name","onChange","onChangeActive","onMouseLeave","onMouseMove","precision","readOnly","size","value"];function qt(t){const s=t.toString().split(".")[1];return s?s.length:0}function ze(t,s){if(t==null)return t;const n=Math.round(t/s)*s;return Number(n.toFixed(qt(s)))}const Ut=t=>{const{classes:s,size:n,readOnly:i,disabled:o,emptyValueFocused:c,focusVisible:r}=t,j={root:["root",`size${mt(n)}`,o&&"disabled",r&&"focusVisible",i&&"readOnly"],label:["label","pristine"],labelEmptyValue:[c&&"labelEmptyValueActive"],icon:["icon"],iconEmpty:["iconEmpty"],iconFilled:["iconFilled"],iconHover:["iconHover"],iconFocus:["iconFocus"],iconActive:["iconActive"],decimal:["decimal"],visuallyHidden:["visuallyHidden"]};return Ot(j,Yt,s)},Xt=Ce("span",{name:"MuiRating",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:n}=t;return[{[`& .${ge.visuallyHidden}`]:s.visuallyHidden},s.root,s[`size${mt(n.size)}`],n.readOnly&&s.readOnly]}})(({theme:t,ownerState:s})=>G({display:"inline-flex",position:"relative",fontSize:t.typography.pxToRem(24),color:"#faaf00",cursor:"pointer",textAlign:"left",width:"min-content",WebkitTapHighlightColor:"transparent",[`&.${ge.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${ge.focusVisible} .${ge.iconActive}`]:{outline:"1px solid #999"},[`& .${ge.visuallyHidden}`]:_t},s.size==="small"&&{fontSize:t.typography.pxToRem(18)},s.size==="large"&&{fontSize:t.typography.pxToRem(30)},s.readOnly&&{pointerEvents:"none"})),vt=Ce("label",{name:"MuiRating",slot:"Label",overridesResolver:({ownerState:t},s)=>[s.label,t.emptyValueFocused&&s.labelEmptyValueActive]})(({ownerState:t})=>G({cursor:"inherit"},t.emptyValueFocused&&{top:0,bottom:0,position:"absolute",outline:"1px solid #999",width:"100%"})),Jt=Ce("span",{name:"MuiRating",slot:"Icon",overridesResolver:(t,s)=>{const{ownerState:n}=t;return[s.icon,n.iconEmpty&&s.iconEmpty,n.iconFilled&&s.iconFilled,n.iconHover&&s.iconHover,n.iconFocus&&s.iconFocus,n.iconActive&&s.iconActive]}})(({theme:t,ownerState:s})=>G({display:"flex",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest}),pointerEvents:"none"},s.iconActive&&{transform:"scale(1.2)"},s.iconEmpty&&{color:(t.vars||t).palette.action.disabled})),Kt=Ce("span",{name:"MuiRating",slot:"Decimal",shouldForwardProp:t=>Pt(t)&&t!=="iconActive",overridesResolver:(t,s)=>{const{iconActive:n}=t;return[s.decimal,n&&s.iconActive]}})(({iconActive:t})=>G({position:"relative"},t&&{transform:"scale(1.2)"}));function Qt(t){const s=dt(t,Ht);return e.jsx("span",G({},s))}function lt(t){const{classes:s,disabled:n,emptyIcon:i,focus:o,getLabelText:c,highlightSelectedOnly:r,hover:j,icon:u,IconContainerComponent:h,isActive:m,itemValue:g,labelProps:v,name:w,onBlur:D,onChange:p,onClick:E,onFocus:L,readOnly:A,ownerState:T,ratingValue:x,ratingValueRounded:C}=t,f=r?g===x:g<=x,b=g<=j,V=g<=o,U=g===C,B=ut(),N=e.jsx(Jt,{as:h,value:g,className:Se(s.icon,f?s.iconFilled:s.iconEmpty,b&&s.iconHover,V&&s.iconFocus,m&&s.iconActive),ownerState:G({},T,{iconEmpty:!f,iconFilled:f,iconHover:b,iconFocus:V,iconActive:m}),children:i&&!f?i:u});return A?e.jsx("span",G({},v,{children:N})):e.jsxs(d.Fragment,{children:[e.jsxs(vt,G({ownerState:G({},T,{emptyValueFocused:void 0}),htmlFor:B},v,{children:[N,e.jsx("span",{className:s.visuallyHidden,children:c(g)})]})),e.jsx("input",{className:s.visuallyHidden,onFocus:L,onBlur:D,onChange:p,onClick:E,disabled:n,value:g,id:B,type:"radio",name:w,checked:U})]})}const Zt=e.jsx(Vt,{fontSize:"inherit"}),en=e.jsx(Bt,{fontSize:"inherit"});function tn(t){return`${t} Star${t!==1?"s":""}`}const nn=d.forwardRef(function(s,n){const i=Tt({name:"MuiRating",props:s}),{className:o,defaultValue:c=null,disabled:r=!1,emptyIcon:j=en,emptyLabelText:u="Empty",getLabelText:h=tn,highlightSelectedOnly:m=!1,icon:g=Zt,IconContainerComponent:v=Qt,max:w=5,name:D,onChange:p,onChangeActive:E,onMouseLeave:L,onMouseMove:A,precision:T=1,readOnly:x=!1,size:C="medium",value:f}=i,b=dt(i,Gt),V=ut(D),[U,B]=Ft({controlled:f,default:c,name:"Rating"}),N=ze(U,T),Y=Rt(),[{hover:k,focus:Q},K]=d.useState({hover:-1,focus:-1});let F=N;k!==-1&&(F=k),Q!==-1&&(F=Q);const{isFocusVisibleRef:oe,onBlur:ie,onFocus:Z,ref:Re}=Mt(),[Me,me]=d.useState(!1),je=d.useRef(),Le=Lt(Re,je,n),ve=I=>{A&&A(I);const W=je.current,{right:X,left:be,width:le}=W.getBoundingClientRect();let ce;Y?ce=(X-I.clientX)/le:ce=(I.clientX-be)/le;let ee=ze(w*ce+T/2,T);ee=Nt(ee,T,w),K(se=>se.hover===ee&&se.focus===ee?se:{hover:ee,focus:ee}),me(!1),E&&k!==ee&&E(I,ee)},Oe=I=>{L&&L(I);const W=-1;K({hover:W,focus:W}),E&&k!==W&&E(I,W)},y=I=>{let W=I.target.value===""?null:parseFloat(I.target.value);k!==-1&&(W=k),B(W),p&&p(I,W)},$=I=>{I.clientX===0&&I.clientY===0||(K({hover:-1,focus:-1}),B(null),p&&parseFloat(I.target.value)===N&&p(I,null))},S=I=>{Z(I),oe.current===!0&&me(!0);const W=parseFloat(I.target.value);K(X=>({hover:X.hover,focus:W}))},H=I=>{if(k!==-1)return;ie(I),oe.current===!1&&me(!1);const W=-1;K(X=>({hover:X.hover,focus:W}))},[Dt,rt]=d.useState(!1),he=G({},i,{defaultValue:c,disabled:r,emptyIcon:j,emptyLabelText:u,emptyValueFocused:Dt,focusVisible:Me,getLabelText:h,icon:g,IconContainerComponent:v,max:w,precision:T,readOnly:x,size:C}),te=Ut(he);return e.jsxs(Xt,G({ref:Le,onMouseMove:ve,onMouseLeave:Oe,className:Se(te.root,o,x&&"MuiRating-readOnly"),ownerState:he,role:x?"img":null,"aria-label":x?h(F):null},b,{children:[Array.from(new Array(w)).map((I,W)=>{const X=W+1,be={classes:te,disabled:r,emptyIcon:j,focus:Q,getLabelText:h,highlightSelectedOnly:m,hover:k,icon:g,IconContainerComponent:v,name:V,onBlur:H,onChange:y,onClick:$,onFocus:S,ratingValue:F,ratingValueRounded:N,readOnly:x,ownerState:he},le=X===Math.ceil(F)&&(k!==-1||Q!==-1);if(T<1){const ce=Array.from(new Array(1/T));return e.jsx(Kt,{className:Se(te.decimal,le&&te.iconActive),ownerState:he,iconActive:le,children:ce.map((ee,se)=>{const Pe=ze(X-1+(se+1)*T,T);return e.jsx(lt,G({},be,{isActive:!1,itemValue:Pe,labelProps:{style:ce.length-1===se?{}:{width:Pe===F?`${(se+1)*T*100}%`:"0%",overflow:"hidden",position:"absolute"}}}),Pe)})},X)}return e.jsx(lt,G({},be,{isActive:le,itemValue:X}),X)}),!x&&!r&&e.jsxs(vt,{className:Se(te.label,te.labelEmptyValue),ownerState:he,children:[e.jsx("input",{className:te.visuallyHidden,value:"",id:`${V}-empty`,type:"radio",name:V,checked:N==null,onFocus:()=>rt(!0),onBlur:()=>rt(!1),onChange:y}),e.jsx("span",{className:te.visuallyHidden,children:u})]})]}))}),Je=Ae(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),Ke=Ae(e.jsx("path",{d:"M3 13h2v-2H3zm0 4h2v-2H3zm0-8h2V7H3zm4 4h14v-2H7zm0 4h14v-2H7zM7 7v2h14V7z"}),"List");var Qe={},sn=pe;Object.defineProperty(Qe,"__esModule",{value:!0});var Fe=Qe.default=void 0,an=sn(fe()),rn=e;Fe=Qe.default=(0,an.default)((0,rn.jsx)("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17zM12 3 1 9l11 6 9-4.91V17h2V9z"}),"School");var Ze={},on=pe;Object.defineProperty(Ze,"__esModule",{value:!0});var bt=Ze.default=void 0,ln=on(fe()),cn=e;bt=Ze.default=(0,ln.default)((0,cn.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7zm-8 2V5h2v6h1.17L12 13.17 9.83 11zm-6 7h14v2H5z"}),"DownloadOutlined");var et={},dn=pe;Object.defineProperty(et,"__esModule",{value:!0});var yt=et.default=void 0,un=dn(fe()),mn=e;yt=et.default=(0,un.default)((0,mn.jsx)("path",{d:"M12 12.75c1.63 0 3.07.39 4.24.9 1.08.48 1.76 1.56 1.76 2.73V18H6v-1.61c0-1.18.68-2.26 1.76-2.73 1.17-.52 2.61-.91 4.24-.91M4 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m1.13 1.1c-.37-.06-.74-.1-1.13-.1-.99 0-1.93.21-2.78.58C.48 14.9 0 15.62 0 16.43V18h4.5v-1.61c0-.83.23-1.61.63-2.29M20 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m4 3.43c0-.81-.48-1.53-1.22-1.85-.85-.37-1.79-.58-2.78-.58-.39 0-.76.04-1.13.1.4.68.63 1.46.63 2.29V18H24zM12 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3"}),"Groups");var tt={},hn=pe;Object.defineProperty(tt,"__esModule",{value:!0});var St=tt.default=void 0,xn=hn(fe()),gn=e;St=tt.default=(0,xn.default)((0,gn.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 14H4V8l8 5 8-5zm-8-7L4 6h16z"}),"MailOutline");var nt={},fn=pe;Object.defineProperty(nt,"__esModule",{value:!0});var At=nt.default=void 0,pn=fn(fe()),jn=e;At=nt.default=(0,pn.default)((0,jn.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const R=({children:t,noFlex:s,height:n,moreStyles:i={}})=>{const o=P(),c=O(o.palette.mode);return e.jsxs(l,{backgroundColor:c.primary[400],p:"20px",borderRadius:"10px",textAlign:"center",display:!s&&"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",sx:{height:n||"100%",boxShadow:o.palette.mode==="light"?"0px 2px 10px rgba(0, 0, 0, 0.1)":"0px 4px 12px rgba(0, 0, 0, 0.3)",...i},children:[t," "]})},st=({children:t,...s})=>e.jsxs(Be,{container:!0,spacing:2,...s,children:[t," "]}),J=({children:t})=>e.jsxs(Be,{container:!0,item:!0,xs:12,spacing:2,children:[t," "]}),M=({children:t,...s})=>e.jsxs(Be,{item:!0,xs:12,...s,children:[t," "]}),vn=({classLevels:t})=>{const s=P(),n=O(s.palette.mode);if(console.log("Class Levels Data:",t),!t||!Array.isArray(t)||t.length===0)return e.jsx(l,{children:e.jsx(a,{variant:"body1",align:"center",sx:{mt:2,color:n.grey[100]},children:"No class distribution data available for the current academic year"})});const i=r=>r&&typeof r=="object"&&r.name&&r.section&&r.academicYear&&typeof r.studentCount=="number",o=t.filter(r=>i(r)&&r.studentCount>0).map(r=>({id:r.name,label:`${r.name} (${r.section})`,value:r.studentCount,color:r.section==="Primary"?"rgba(75, 192, 192, 0.6)":"rgba(255, 159, 64, 0.6)"})),c=t.filter(i).map(r=>({id:r.id,label:`${r.name} (${r.section})`,studentCount:r.studentCount}));return e.jsxs(l,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,color:n.grey[100]},children:"Class Distribution (Students)"}),o.length===0?e.jsx(a,{variant:"body1",align:"center",sx:{color:n.grey[100]},children:"No active students to display in the current academic year"}):e.jsx("div",{style:{height:"350px"},children:e.jsx(xt,{data:o,theme:{axis:{domain:{line:{stroke:n.grey[100]}},legend:{text:{fill:n.grey[100]}},ticks:{line:{stroke:n.grey[100],strokeWidth:1},text:{fill:n.grey[100]}}},legends:{text:{fill:n.grey[100]}},tooltip:{container:{background:n.primary[400],color:n.grey[100],fontSize:12}}},margin:{top:40,right:80,bottom:80,left:80},innerRadius:.5,padAngle:.7,cornerRadius:3,activeOuterRadiusOffset:8,borderColor:{from:"color",modifiers:[["darker",.2]]},arcLinkLabelsSkipAngle:10,arcLinkLabelsTextColor:n.grey[100],arcLinkLabelsThickness:2,arcLinkLabelsColor:{from:"color"},enableArcLabels:!0,arcLabelsRadiusOffset:.4,arcLabelsSkipAngle:7,arcLabelsTextColor:{from:"color",modifiers:[["darker",2]]},colors:o.map(r=>r.color),defs:[{id:"dots",type:"patternDots",background:"inherit",color:"rgba(255, 255, 255, 0.3)",size:4,padding:1,stagger:!0},{id:"lines",type:"patternLines",background:"inherit",color:"rgba(255, 255, 255, 0.3)",rotation:-45,lineWidth:6,spacing:10}],legends:[{anchor:"bottom",direction:"row",justify:!1,translateX:0,translateY:56,itemsSpacing:0,itemWidth:100,itemHeight:18,itemTextColor:"#999",itemDirection:"left-to-right",itemOpacity:1,symbolSize:18,symbolShape:"circle",effects:[{on:"hover",style:{itemTextColor:"#000"}}]}]})}),e.jsx(l,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:c.length>0?c.map(r=>e.jsxs(a,{sx:{color:n.grey[100],fontSize:12,minWidth:120},children:[r.label,": ",r.studentCount," students"]},r.id)):e.jsx(a,{variant:"body1",align:"center",sx:{color:n.grey[100]},children:"No valid class distribution data to display for the current academic year"})})]})},at=()=>{var Y,k,Q,K;const[t,s]=d.useState(0),n=ft(),[i,o]=d.useState([]),[c,r]=d.useState([]),{loading:j,error:u}=q(),{loading:h,data:m,error:g,callApi:v}=q(),{loading:w,data:D,error:p,callApi:E}=q(),{loading:L,data:A,error:T,callApi:x}=q(),C=d.useCallback(()=>(console.log("Fetching financial data from:",z.FINANCIAL_DATA),v(z.FINANCIAL_DATA,"GET")),[v]),f=d.useCallback(()=>(console.log("Fetching outstanding fees from:",z.OUTSTANDING_FEES_DATA),E(z.OUTSTANDING_FEES_DATA,"GET")),[E]),b=d.useCallback(()=>(console.log("Fetching admin stats from:",z.ADMIN_DATA),x(z.ADMIN_DATA,"GET")),[x]);d.useEffect(()=>{const F=new AbortController;return(async()=>{await Promise.all([C(),f(),b()])})(),()=>{console.log("Cleaning up useAdminData API calls"),F.abort()}},[C,f,b]),d.useEffect(()=>{if(A){console.log("Raw Admin Stats Data:",A);const F=A.data||{};console.log("Processed Admin Stats Data:",F),o(F.classLevels||[]),s(F.unreadEnquiries||0)}T&&(console.error("Admin Stats Error:",T),n(Ne(T.message||"Failed to fetch admin stats.")))},[A,T,n]),d.useEffect(()=>{m&&(console.log("Raw Financial Data:",m),console.log("Processed Financial Data:",(m==null?void 0:m.data)||{})),g&&(console.error("Financial Data Error:",g),n(Ne(g.message||"Failed to fetch financial data.")))},[m,g,n]),d.useEffect(()=>{D&&(console.log("Raw Outstanding Fees Data:",D),console.log("Processed Outstanding Fees Data:",(D==null?void 0:D.data)||[])),p&&(console.error("Outstanding Fees Error:",p),n(Ne(p.message||"Failed to fetch outstanding fees data.")))},[D,p,n]);const V=d.useMemo(()=>{var ie;const F=((ie=A==null?void 0:A.data)==null?void 0:ie.enrollmentsPerAcademicYear)||[];return console.log("Enrollments Data:",F),{total:F.map(Z=>({id:`Total-${Z.academicYear}`,academicYear:Z.academicYear,value:Z.enrollmentCount})).filter(Z=>Z.value>0)}},[A]),U=d.useMemo(()=>i.map(F=>({id:F.id,name:F.name,section:F.section,academicYear:F.academicYear,studentCount:F.studentCount})),[i]);d.useEffect(()=>{console.log("Class Distribution Data:",U)},[U]);const B=d.useMemo(()=>{const F=(D==null?void 0:D.data)||[];return console.log("Memoized Outstanding Fees Data:",F),F},[D]),N=[u,g,p,T].find(F=>F)||null;return{usersData:{totalStudents:((Y=A==null?void 0:A.data)==null?void 0:Y.totalStudents)||0,totalTeachers:((k=A==null?void 0:A.data)==null?void 0:k.totalTeachers)||0,currentYearStudents:((Q=A==null?void 0:A.data)==null?void 0:Q.currentYearStudents)||0,topTeachers:((K=A==null?void 0:A.data)==null?void 0:K.topTeachers)||[]},unreadEnquiriesCount:t,classLevels:U,subjects:c,financialData:(m==null?void 0:m.data)||{primary:[],secondary:[]},outstandingFeesData:B,enrollmentData:V,financialDataLoading:h,financialDataError:g,outstandingFeesLoading:w,outstandingFeesError:p,adminStatsLoading:L,adminStatsError:T,enrollmentDataLoading:L,enrollmentDataError:T,loading:j||h||w||L,error:N,refetchFinancialData:C,refetchOutstandingFees:f,refetchAdminStats:b}},bn=({isCustomLineColors:t=!1,isDashboard:s=!1})=>{const n=P(),i=d.useMemo(()=>O(n.palette.mode),[n.palette.mode]),{financialData:o,financialDataLoading:c,financialDataError:r}=at();console.log(o);const j=m=>`hsl(${m*360/2%360}, 70%, 60%)`,u=d.useMemo(()=>{var v,w;const m=(o==null?void 0:o.data)||o||{primary:[],secondary:[]};return!((v=m.primary)!=null&&v.length)&&!((w=m.secondary)!=null&&w.length)?[]:["primary","secondary"].filter(D=>{var p;return(p=m[D])==null?void 0:p.length}).map((D,p)=>({id:D.charAt(0).toUpperCase()+D.slice(1),color:t?j(p):void 0,data:m[D].map(E=>({x:E.label.split(" ")[0],y:E.value||0}))}))},[o,t]),h=d.useMemo(()=>{var w,D;const m=(o==null?void 0:o.data)||o||{primary:[],secondary:[]},g=((w=m.primary)==null?void 0:w.reduce((p,E)=>p+(E.value||0),0))||0,v=((D=m.secondary)==null?void 0:D.reduce((p,E)=>p+(E.value||0),0))||0;return g+v},[o]);return c?e.jsx(l,{children:"Loading data..."}):r?e.jsxs(l,{children:["Error: ",r.message||"Failed to load financial data"]}):u.length?e.jsxs(l,{width:"98%",height:s?"300px":"400px",children:[e.jsxs(a,{variant:"subtitle1",sx:{mb:2,color:i.grey[100]},children:["Total Revenue: ₦",h.toLocaleString("en-NG")]}),e.jsx(gt,{data:u,animate:!0,motionConfig:"default",theme:{axis:{domain:{line:{stroke:i.grey[100]}},legend:{text:{fill:i.grey[100],fontSize:8}},ticks:{line:{stroke:i.grey[100],strokeWidth:1},text:{fill:i.grey[100],fontSize:8}}},legends:{text:{fill:i.grey[100],fontSize:8}},tooltip:{container:{background:i.primary[500],color:i.grey[100],fontSize:12},format:m=>`₦${m.toLocaleString("en-NG")}`}},colors:t?{datum:"color"}:{scheme:"nivo"},margin:{top:50,right:110,bottom:50,left:60},xScale:{type:"point"},yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:m=>`₦${m.toLocaleString("en-NG")}`,curve:"catmullRom",axisTop:null,axisRight:null,axisBottom:{tickSize:0,tickPadding:5,tickRotation:45,legend:s?void 0:"Academic Year",legendOffset:36,legendPosition:"middle"},axisLeft:{tickValues:5,tickSize:3,tickPadding:5,tickRotation:0,legend:s?void 0:"Revenue (₦)",legendOffset:-50,legendPosition:"middle",format:m=>`₦${m.toLocaleString("en-NG")}`},enableGridX:!1,enableGridY:!1,pointSize:8,pointColor:{theme:"background"},pointBorderWidth:2,pointBorderColor:{from:"serieColor"},enablePoints:!0,enablePointLabel:!0,pointLabel:"y",pointLabelYOffset:-12,useMesh:!0,legends:[{anchor:"bottom-right",direction:"column",justify:!1,translateX:100,translateY:0,itemsSpacing:0,itemDirection:"left-to-right",itemWidth:80,itemHeight:20,itemOpacity:.75,symbolSize:12,symbolShape:"circle",symbolBorderColor:"rgba(0, 0, 0, .5)",effects:[{on:"hover",style:{itemBackground:"rgba(0, 0, 0, .03)",itemOpacity:1}}]}]})]}):e.jsx(l,{children:"No financial data available."})},yn=()=>{const t=P(),s=O(t.palette.mode),{error:n,callApi:i}=q(),[o,c]=d.useState([]),[r,j]=d.useState(!1),[u,h]=d.useState(!1),[m,g]=d.useState(!1),[v,w]=d.useState(""),[D,p]=d.useState(!1),[E,L]=d.useState(!1),[A,T]=d.useState(null),[x,C]=d.useState({title:"",description:"",day:"",startDate:"",endDate:""}),[f,b]=d.useState(null),[V,U]=d.useState(null),[B,N]=d.useState(!1),[Y,k]=d.useState(null);d.useEffect(()=>{if(Y){const y=setTimeout(()=>k(null),5e3);return()=>clearTimeout(y)}},[Y]),d.useEffect(()=>{(async()=>{const $=await i(z.EVENT,"GET");if($){console.log("Fetched events:",$);const S=$.data.map(H=>({id:H._id,title:H.title,start:H.startDate,end:H.endDate,allDay:H.startDate===H.endDate}));c(S)}else k(n||"Failed to fetch events")})()},[i,n]);const Q=y=>{const $=new Date(y.startStr),S=new Date($.getTime()+60*60*1e3);U(y),C({title:"",description:"",day:Ie(y.start,{weekday:"long"}),startDate:$.toISOString(),endDate:S.toISOString()}),j(!0)},K=async()=>{if(!sessionStorage.getItem("accessToken")){k("Please log in to add events");return}if(!x.title||!x.description||!x.day||!x.startDate||!x.endDate){k("All fields are required");return}const $=await i(z.EVENT,"POST",{title:x.title,description:x.description,day:x.day,startDate:x.startDate,endDate:x.endDate});if($){const S=$.data;c([...o,{id:S._id,title:S.title,start:S.startDate,end:S.endDate,allDay:S.startDate===S.endDate}]),j(!1),C({title:"",description:"",day:"",startDate:"",endDate:""}),w("Event created successfully"),g(!0),k(null)}else{const S=n||"Failed to create event";S.includes("Authentication required")||S.includes("No token provided")||S.includes("Invalid or expired token")?k("Please log in again to add events"):S.includes("admin only")?k("Only admins can add events"):k(S)}},F=y=>{if(!o.find(H=>H.id===y.event.id))return;const S={_id:y.event.id,title:y.event.title,description:"",day:Ie(y.event.start,{weekday:"long"}),startDate:y.event.start.toISOString(),endDate:y.event.end?y.event.end.toISOString():y.event.start.toISOString()};console.log("Selected event:",S),T(S),p(!0)},oe=()=>{p(!1),b(A),h(!0)},ie=()=>{p(!1),L(!0)},Z=async()=>{if(!sessionStorage.getItem("accessToken")){k("Please log in to update events");return}if(!f.title||!f.description||!f.day||!f.startDate||!f.endDate){k("All fields are required");return}const $=await i(`${z.EVENT}/${f._id}`,"PATCH",{title:f.title,description:f.description,day:f.day,startDate:f.startDate,endDate:f.endDate});if($){const S=$.data;c(o.map(H=>H.id===S._id?{id:S._id,title:S.title,start:S.startDate,end:S.endDate,allDay:S.startDate===S.endDate}:H)),h(!1),b(null),w("Event edited successfully"),g(!0),k(null)}else{const S=n||"Failed to update event";S.includes("Authentication required")||S.includes("No token provided")||S.includes("Invalid or expired token")?k("Please log in again to update events"):S.includes("admin only")?k("Only admins can update events"):k(S)}},Re=async()=>{if(!sessionStorage.getItem("accessToken")){k("Please log in to delete events");return}if(await i(`${z.EVENT}/${A._id}`,"DELETE"))c(o.filter(S=>S.id!==A._id)),L(!1),T(null),w("Event deleted successfully"),g(!0),k(null);else{const S=n||"Failed to delete event";S.includes("Authentication required")||S.includes("No token provided")||S.includes("Invalid or expired token")?k("Please log in again to delete events"):S.includes("admin only")?k("Only admins can delete events"):k(S)}},Me=()=>{j(!1),C({title:"",description:"",day:"",startDate:"",endDate:""}),k(null)},me=()=>{h(!1),b(null),k(null)},je=()=>{p(!1),T(null)},Le=()=>{L(!1),T(null)},ve=()=>{g(!1),w("")},Oe=()=>{N(y=>!y)};return e.jsxs(l,{my:"10px",children:[Y&&e.jsx(Ue,{severity:"error",sx:{mb:2},onClose:()=>k(null),children:Y}),e.jsxs(l,{display:"flex",justifyContent:"center",flexDirection:"column",children:[e.jsxs(l,{flex:"1 1 20%",backgroundColor:s.primary[400],py:"15px",borderRadius:"4px",sx:{width:"100%",height:"75vh",overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(l,{display:"flex",alignItems:"center",marginBottom:"10px",children:[e.jsx(Xe,{onClick:Oe,sx:{backgroundColor:s.blueAccent[500],"&:hover":{backgroundColor:s.blueAccent[700]},padding:"10px",borderRadius:"50%"},children:B?e.jsx(Je,{}):e.jsx(Ke,{})}),e.jsx(a,{variant:"h6",sx:{marginLeft:"10px",fontWeight:"800"},children:B?"Hide Events":"Show Events"})]}),B&&e.jsx(a,{variant:"h4",sx:{marginBottom:"10px"},children:"Events"}),B&&e.jsx(De,{children:o.length===0?e.jsx(a,{children:"No events available"}):o.map(y=>e.jsx(Ee,{sx:{backgroundColor:s.blueAccent[500],margin:"10px 0",borderRadius:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(ke,{primary:y.title,secondary:e.jsx(a,{sx:{fontSize:"0.7em",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:Ie(y.start,{year:"numeric",month:"short",day:"numeric"})})})},y.id))})]}),e.jsx(l,{flex:"1 1 100%",sx:{width:"100%"},children:e.jsx(Ye,{height:"75vh",plugins:[He,Ge,pt,qe],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:"dayGridMonth",editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,select:Q,eventClick:F,events:o})})]}),e.jsx(ne,{open:r,onClose:Me,title:"Add Event",onConfirm:K,confirmText:"Create",cancelText:"Cancel",showCancel:!0,children:e.jsxs(l,{p:"20px",children:[e.jsx(_,{label:"Event Title",fullWidth:!0,value:x.title,onChange:y=>C({...x,title:y.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Description",fullWidth:!0,value:x.description,onChange:y=>C({...x,description:y.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Day",fullWidth:!0,value:x.day,InputProps:{readOnly:!0},sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Start Date",type:"datetime-local",fullWidth:!0,value:x.startDate.slice(0,16),onChange:y=>C({...x,startDate:new Date(y.target.value).toISOString()}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"End Date",type:"datetime-local",fullWidth:!0,value:x.endDate.slice(0,16),onChange:y=>C({...x,endDate:new Date(y.target.value).toISOString()}),sx:{marginBottom:"20px"}})]})}),e.jsx(ne,{open:u,onClose:me,title:"Edit Event",onConfirm:Z,confirmText:"Save",cancelText:"Cancel",showCancel:!0,children:e.jsxs(l,{p:"20px",children:[e.jsx(_,{label:"Event Title",fullWidth:!0,value:(f==null?void 0:f.title)||"",onChange:y=>b({...f,title:y.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Description",fullWidth:!0,value:(f==null?void 0:f.description)||"",onChange:y=>b({...f,description:y.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Day",fullWidth:!0,value:(f==null?void 0:f.day)||"",onChange:y=>b({...f,day:y.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Start Date",type:"datetime-local",fullWidth:!0,value:(f==null?void 0:f.startDate.slice(0,16))||"",onChange:y=>b({...f,startDate:new Date(y.target.value).toISOString()}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"End Date",type:"datetime-local",fullWidth:!0,value:(f==null?void 0:f.endDate.slice(0,16))||"",onChange:y=>b({...f,endDate:new Date(y.target.value).toISOString()}),sx:{marginBottom:"20px"}})]})}),e.jsx(ne,{open:D,onClose:je,title:`Manage Event: ${(A==null?void 0:A.title)||""}`,onConfirm:oe,confirmText:"Edit",onCancel:ie,cancelText:"Delete",showCancel:!0,children:e.jsx(l,{p:"20px",children:e.jsxs(a,{children:['Select an action for the event "',A==null?void 0:A.title,'".']})})}),e.jsx(ne,{open:E,onClose:Le,title:"Confirm Delete",onConfirm:Re,confirmText:"Confirm",cancelText:"Cancel",showCancel:!0,children:e.jsx(l,{p:"20px",children:e.jsxs(a,{children:['Do you want to delete the event "',A==null?void 0:A.title,'"?']})})}),e.jsx(ne,{open:m,onClose:ve,title:"Success",onConfirm:ve,confirmText:"OK",showCancel:!1,children:e.jsx(l,{p:"20px",children:e.jsx(a,{children:v})})})]})},Sn=({outstandingFeesData:t})=>{const s=P(),n=O(s.palette.mode);if(console.log("Outstanding Fees Data:",t),!t||!Array.isArray(t)||t.length===0)return e.jsx(l,{children:e.jsx(a,{variant:"body1",align:"center",sx:{mt:2},children:"No outstanding fees data available"})});const i=u=>u&&typeof u=="object"&&u.id&&u.label&&typeof u.value=="number",o=["rgba(75, 192, 192, 0.6)","rgba(255, 159, 64, 0.6)","rgba(153, 102, 255, 0.6)","rgba(60, 179, 113, 0.6)","rgba(100, 149, 237, 0.6)","rgba(255, 99, 132, 0.6)"],c=u=>{const h=Math.abs(u.split("").reduce((m,g)=>m+g.charCodeAt(0),0))%o.length;return o[h]},r=t.filter(u=>i(u)&&u.value>0).map(u=>({id:u.id,label:u.label,value:u.value,color:c(u.id)})),j=t.filter(i).map(u=>({id:u.id,label:u.label,value:u.value}));return e.jsxs(l,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,color:n.grey[100]},children:"Outstanding Fees by Academic Year"}),r.length===0?e.jsx(a,{variant:"body1",align:"center",children:"No outstanding fees to display"}):e.jsx("div",{style:{height:"350px"},children:e.jsx(xt,{data:r,theme:{axis:{domain:{line:{stroke:n.grey[100]}},legend:{text:{fill:n.grey[100]}},ticks:{line:{stroke:n.grey[100],strokeWidth:1},text:{fill:n.grey[100]}}},legends:{text:{fill:n.grey[100]}},tooltip:{container:{background:n.primary[400],color:n.grey[100],fontSize:12}}},margin:{top:40,right:80,bottom:80,left:80},innerRadius:.5,padAngle:.7,cornerRadius:3,activeOuterRadiusOffset:8,borderColor:{from:"color",modifiers:[["darker",.2]]},arcLinkLabelsSkipAngle:10,arcLinkLabelsTextColor:n.grey[100],arcLinkLabelsThickness:2,arcLinkLabelsColor:{from:"color"},arcLinkLabel:u=>u.data.label,enableArcLabels:!0,arcLabelsRadiusOffset:.4,arcLabelsSkipAngle:7,arcLabelsTextColor:{from:"color",modifiers:[["darker",2]]},arcLabelsText:u=>`₦${u.value.toLocaleString()}`,colors:r.map(u=>u.color),defs:[{id:"dots",type:"patternDots",background:"inherit",color:"rgba(255, 255, 255, 0.3)",size:4,padding:1,stagger:!0},{id:"lines",type:"patternLines",background:"inherit",color:"rgba(255, 255, 255, 0.3)",rotation:-45,lineWidth:6,spacing:10}],legends:[{anchor:"bottom",direction:"row",justify:!1,translateX:0,translateY:56,itemsSpacing:0,itemWidth:100,itemHeight:18,itemTextColor:"#999",itemDirection:"left-to-right",itemOpacity:1,symbolSize:18,symbolShape:"circle",effects:[{on:"hover",style:{itemTextColor:"#000"}}],data:r.map(u=>({id:u.id,label:u.label}))}]})}),e.jsx(l,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:j.length>0?j.map(u=>e.jsxs(a,{sx:{color:n.grey[100],fontSize:12,minWidth:120},children:[u.label,": ₦",u.value.toLocaleString()]},u.id)):e.jsx(a,{variant:"body1",align:"center",children:"No valid outstanding fees data to display"})})]})},An=({topTeachers:t})=>{const s=P(),n=O(s.palette.mode);console.log(t);const i=t&&Array.isArray(t)&&t.length>0?t.map(o=>({name:`${o.name}`.trim()||"Unnamed Teacher",subject:o.subject&&Array.isArray(o.subject)&&o.subject.length>0?o.subject[0].name:"No Subject",rating:o.rating||0})).sort((o,c)=>c.rating-o.rating).slice(0,5):[];return e.jsx(l,{sx:{height:"350px",overflowY:"auto"},children:i.length>0?e.jsx(De,{children:i.map((o,c)=>e.jsx(Ee,{sx:{backgroundColor:n.primary[400],mb:1,borderRadius:"4px"},children:e.jsx(ke,{primary:`${o.name} (${o.subject})`,secondary:`Rating: ${o.rating}/5`,sx:{color:n.grey[100]}})},c))}):e.jsx(l,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx(a,{color:n.grey[100],children:"No teachers available"})})})},Cn=()=>{var r;const t=P(),s=O(t.palette.mode),{enrollmentData:n,enrollmentDataLoading:i,enrollmentDataError:o}=at();if(i)return e.jsx(l,{children:"Loading..."});if(o)return e.jsxs(l,{children:["Error: ",o.message||"Failed to load data"]});if(!n||!((r=n.total)!=null&&r.length))return e.jsx(l,{children:"No enrollment data available."});const c=n.total.map(j=>({academicYear:j.academicYear,Total:j.value}));return console.log("Enrollment Chart Data:",c),e.jsxs(l,{height:"300px",children:[e.jsx(a,{variant:"h6",sx:{mb:1,color:s.grey[100],fontSize:"14px"},children:"Enrollment"}),e.jsx(zt,{data:c,keys:["Total"],indexBy:"academicYear",theme:{axis:{domain:{line:{stroke:s.grey[100]}},legend:{text:{fill:s.grey[100],fontSize:8}},ticks:{line:{stroke:s.grey[100],strokeWidth:1},text:{fill:s.grey[100],fontSize:8}}},legends:{text:{fill:s.grey[100],fontSize:8}},tooltip:{container:{background:s.primary[400],color:s.grey[100],fontSize:8}}},margin:{top:20,right:60,bottom:40,left:40},padding:.4,colors:{scheme:"nivo"},animate:!0,motionConfig:"default",axisTop:null,axisRight:null,axisBottom:{tickSize:3,tickPadding:3,tickRotation:45,legend:"Academic Year",legendPosition:"middle",legendOffset:30,truncateTickAt:0},axisLeft:{tickSize:3,tickPadding:3,tickRotation:0,legend:"Students",legendPosition:"middle",legendOffset:-30},labelSkipWidth:12,labelSkipHeight:12,labelTextColor:{from:"color",modifiers:[["darker",1.6]]},legends:[{dataFrom:"keys",anchor:"bottom-right",direction:"column",justify:!1,translateX:50,translateY:0,itemsSpacing:1,itemWidth:50,itemHeight:15,itemDirection:"left-to-right",itemOpacity:.85,symbolSize:12,effects:[{on:"hover",style:{itemOpacity:1}}]}]})]})},Dn=()=>{const t=P(),s=O(t.palette.mode),[n,i]=d.useState(!0),[o,c]=d.useState(0),[r,j]=d.useState(0),[u,h]=d.useState(0),[m,g]=d.useState(null),{usersData:v,unreadEnquiriesCount:w,classLevels:D,financialData:p,outstandingFeesData:E,enrollmentData:L,loading:A,error:T}=at();if(d.useEffect(()=>{v&&(i(!1),c(v.totalStudents||0),j(v.totalTeachers||0),h(v.currentYearStudents||0)),T&&g(T.message||"An error occurred while fetching data.")},[v,T]),n||A)return e.jsx(Ve,{});if(m)return e.jsx(l,{m:"20px",children:e.jsxs(a,{variant:"h4",color:"error",children:["Error: ",m]})});const x={mt:"15px",fontWeight:"bold"};return console.log(p),e.jsxs(l,{m:"20px",children:[e.jsx(a,{variant:"h3",fontWeight:"600",mb:"20px",children:"School Administration Dashboard"}),e.jsxs(st,{children:[e.jsxs(J,{children:[e.jsx(M,{sm:6,md:3,children:e.jsxs(R,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Students"}),e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(yt,{sx:{fontSize:"70px",color:s.blueAccent[200]}}),e.jsx(a,{variant:"h4",color:s.blueAccent[200],sx:x,children:`${o} students`}),e.jsx(a,{children:"Total active students"})]})]})}),e.jsx(M,{sm:6,md:3,children:e.jsxs(R,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Teachers"}),e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(Fe,{sx:{fontSize:"70px",color:s.blueAccent[200]}}),e.jsx(a,{variant:"h4",color:s.blueAccent[200],sx:x,children:`${r} teachers`}),e.jsx(a,{children:"Total teachers"})]})]})}),e.jsx(M,{sm:6,md:3,children:e.jsxs(R,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"New Students"}),e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(At,{sx:{fontSize:"70px",color:s.blueAccent[200]}}),e.jsx(a,{variant:"h4",color:s.blueAccent[200],sx:x,children:`${u} students`}),e.jsx(a,{children:"New students this academic year"})]})]})}),e.jsx(M,{sm:6,md:3,children:e.jsxs(R,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Unread Enquiries"}),e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(St,{sx:{fontSize:"70px",color:s.blueAccent[200]}}),e.jsx(a,{variant:"h4",color:s.blueAccent[200],sx:x,children:w}),e.jsx(a,{children:"Total unread enquiries"})]})]})})]}),e.jsxs(J,{children:[e.jsx(M,{md:8,children:e.jsxs(R,{noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"School Fees Data"}),e.jsx(l,{mt:"10px",children:e.jsx(bn,{financialData:p})})]})}),e.jsx(M,{md:4,children:e.jsxs(R,{noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Outstanding Payments"}),e.jsx(l,{mt:"10px",children:e.jsx(Sn,{outstandingFeesData:E})})]})})]}),e.jsxs(J,{children:[e.jsx(M,{md:4,children:e.jsxs(R,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",gutterBottom:!0,children:"Enrollment Stats"}),e.jsx(l,{mt:"10px",children:e.jsx(Cn,{enrollmentData:L})})]})}),e.jsx(M,{md:4,children:e.jsxs(R,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",gutterBottom:!0,children:"Top Teachers"}),e.jsx(l,{mt:"10px",children:e.jsx(An,{topTeachers:v.topTeachers})})]})}),e.jsx(M,{md:4,children:e.jsxs(R,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",gutterBottom:!0,children:"Class Distribution"}),e.jsx(l,{mt:"10px",children:e.jsx(vn,{classLevels:D})})]})})]}),e.jsx(J,{children:e.jsx(M,{md:12,children:e.jsxs(R,{noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"School Activities"}),e.jsx(l,{mt:"10px",children:e.jsx(yn,{})})]})})})]})]})},ue=({progress:t=.75,size:s=40})=>{const n=P(),i=O(n.palette.mode),o=t*360,r=(j=>j>=.75?i.greenAccent[400]:j>=.5?i.greenAccent[700]:i.redAccent[700])(t);return e.jsx(l,{sx:{background:`radial-gradient(${i.primary[400]} 55%, transparent 56%),
            conic-gradient(${r} 0deg ${o}deg, ${i.blueAccent[200]} ${o}deg 360deg),
            ${i.primary[400]}`,borderRadius:"50%",width:`${s}px`,height:`${s}px`}})},En=({progress:t})=>!t&&t!==0?e.jsx(a,{children:"No session progress data available"}):e.jsxs(l,{children:[e.jsx(a,{variant:"h6",fontWeight:"600",mb:"5px",children:"Session Progress"}),e.jsx(ue,{size:"125",progress:t/100}),e.jsxs(a,{variant:"body2",mt:"10px",children:["Academic year completion: ",t,"%"]})]}),kn=({attendance:t})=>!t&&t!==0?e.jsx(a,{children:"No attendance data available"}):e.jsxs(l,{children:[e.jsx(a,{variant:"h6",fontWeight:"600",mb:"5px",children:"Term Attendance"}),e.jsx(ue,{size:"125",progress:t/100}),e.jsxs(a,{variant:"body2",mt:"10px",children:["Current term attendance: ",t,"%"]})]}),wn=({feesStatus:t})=>t?e.jsxs(l,{children:[e.jsxs(a,{variant:"h6",fontWeight:"600",mb:"5px",children:["Fee Payment Status (",parseInt(t.percentagePaid),"%)"]}),e.jsx(ue,{size:"125",progress:t.percentagePaid/100}),e.jsxs(a,{variant:"body2",mt:"10px",children:["Outstanding Fees: $",t.totalOutstanding]})]}):e.jsx(a,{children:"No payment data available"});function Ct(){const t=ft(),s=de(h=>{var m;return(m=h.users.user)==null?void 0:m._id}),n=de(h=>{var m;return(m=h.users.user)==null?void 0:m.userId}),i=de(h=>h.adminData.currentAcademicYear),{callApi:o}=q(),[c,r]=d.useState({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:null}),j=d.useCallback(async()=>{if(!s){r({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:"Student ID not found. Please log in."});return}r(h=>({...h,loading:!0,error:null}));try{const h=await o(`${ct}/student-dashboard`,"GET");if(h&&h.status==="success"){const{data:m}=h;t(Et(m.currentAcademicYear||null)),r({sessionProgress:m.sessionProgress||0,termAttendance:m.termAttendance||0,feeStatus:m.feeStatus||{percentagePaid:0,totalOutstanding:0},nextClass:m.nextClass||null,missedClasses:m.missedClasses||[],subjectPerformance:m.subjectPerformance||null,allResources:m.allResources||[],assignments:m.assignments||[],timetable:m.timetable||[],loading:!1,error:null})}else r({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:(h==null?void 0:h.message)||"Failed to fetch student dashboard data"})}catch(h){r({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:h.message||"Failed to fetch student dashboard data"})}},[s,o,t]);return d.useEffect(()=>{j()},[j]),console.log(c),{...c,currentAcademicYear:i,formatDateToDDMMYYYY:h=>new Date(h).toLocaleDateString("en-GB"),userId:n}}const Tn=({nextClass:t})=>{const s=P(),n=O(s.palette.mode);return t?e.jsxs(l,{textAlign:"center",children:[e.jsx(a,{variant:"h6",fontWeight:"600",mb:"5px",children:"Next Class"}),e.jsxs(l,{children:[e.jsx(Fe,{sx:{fontSize:"30px",color:n.blueAccent[400]}}),e.jsx(a,{variant:"h6",children:t.subject.name}),e.jsx(a,{children:t.date}),e.jsx(a,{children:t.time}),e.jsxs(a,{children:["Location: ",t.location]})]})]}):e.jsx(a,{children:"No upcoming classes"})},Fn=({subjectPerformance:t})=>{const s=P(),n=O(s.palette.mode);return!t||t.length===0?e.jsx(a,{children:"No performance data available"}):e.jsx("div",{style:{height:"350px"},children:e.jsx(gt,{data:t,animate:!0,motionConfig:"default",theme:{axis:{domain:{line:{stroke:n.grey[100]}},legend:{text:{fill:n.grey[100],fontSize:8}},ticks:{line:{stroke:n.grey[100],strokeWidth:1},text:{fill:n.grey[100],fontSize:8}}},legends:{text:{fill:n.grey[100],fontSize:8}},tooltip:{container:{color:n.primary[500]}}},colors:{datum:"color"},margin:{top:50,right:110,bottom:50,left:60},xScale:{type:"point"},yScale:{type:"linear",min:0,max:100,stacked:!1,reverse:!1},yFormat:" >-.2f",curve:"catmullRom",axisTop:null,axisRight:null,axisBottom:{tickSize:0,tickPadding:5,tickRotation:0,legend:"Month",legendOffset:36,legendPosition:"middle"},axisLeft:{tickValues:5,tickSize:3,tickPadding:5,tickRotation:0,legend:"Score (%)",legendOffset:-40,legendPosition:"middle"},enableGridX:!1,enableGridY:!1,pointSize:8,pointColor:{theme:"background"},pointBorderWidth:1,pointBorderColor:{from:"serieColor"},pointLabelYOffset:-12,useMesh:!0,legends:[{anchor:"bottom-right",direction:"column",justify:!1,translateX:100,translateY:0,itemsSpacing:0,itemDirection:"left-to-right",itemWidth:80,itemHeight:20,itemOpacity:.75,symbolSize:12,symbolShape:"circle",symbolBorderColor:"rgba(0, 0, 0, .5)",effects:[{on:"hover",style:{itemBackground:"rgba(0, 0, 0, .03)",itemOpacity:1}}]}]})})},Rn=({missedClasses:t,formatDateToDDMMYYYY:s})=>{const n=P(),i=O(n.palette.mode),o=n.palette.mode==="light"?i.blueAccent[800]:i.greenAccent[600];return t?e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Missed Classes"}),t.length>0?t.map(c=>e.jsx(we,{sx:{mb:2},children:e.jsxs(Te,{sx:{backgroundColor:o,textAlign:"left"},children:[e.jsx(a,{variant:"h6",children:c.subject}),e.jsx(a,{children:s(c.date)}),e.jsx(a,{children:c.time}),e.jsxs(a,{children:["Location: ",c.location]})]})},c.id)):e.jsx(a,{children:"You attended all classes"})]}):e.jsx(a,{children:"No missed classes data available"})},Mn=()=>{const t=P(),s=O(t.palette.mode),{callApi:n}=q(),[i,o]=d.useState(null);d.useEffect(()=>{(async()=>{try{const h=await n(z.ANNOUNCEMENT,"GET");h&&h.data&&o(h.data)}catch(h){console.error("Error fetching announcements:",h)}})()},[]);const c=t.palette.mode==="light"?s.blueAccent[800]:s.greenAccent[600],j=i||[{id:"1",title:"End of Term Exams",message:"Exams start on July 1, 2025.",date:"2025-06-20"},{id:"2",title:"Sports Day",message:"Join us on July 15, 2025.",date:"2025-06-18"}];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Announcements"}),j.length>0?j.map(u=>e.jsx(we,{sx:{mb:2},children:e.jsxs(Te,{sx:{backgroundColor:c,textAlign:"left"},children:[e.jsx(a,{variant:"h6",children:u.title}),e.jsx(a,{variant:"body2",children:u.message}),e.jsx(a,{variant:"caption",color:"gray",children:u.date})]})},u.id)):e.jsx(a,{children:"No announcements available"})]})},Ln=()=>{const t=P(),s=O(t.palette.mode),{allResources:n}=Ct(),o=n||[{title:"Math Textbook",url:"https://example.com/math-textbook.pdf"},{title:"Science Notes",url:"https://example.com/science-notes.pdf"}],c=t.palette.mode==="light"?s.blueAccent[800]:s.greenAccent[600];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Useful Resources"}),o.length>0?o.map((r,j)=>e.jsx(we,{sx:{mb:2},children:e.jsxs(Te,{sx:{backgroundColor:c,textAlign:"left"},children:[e.jsx(a,{variant:"h6",children:r.title}),e.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",children:r.url})]})},j)):e.jsx(a,{children:"No Resources Available"})]})},On=()=>{const t=P(),s=O(t.palette.mode),{error:n,callApi:i}=q(),[o,c]=d.useState([]),[r,j]=d.useState(!1),[u,h]=d.useState(null);d.useEffect(()=>{if(u){const g=setTimeout(()=>h(null),5e3);return()=>clearTimeout(g)}},[u]),d.useEffect(()=>{(async()=>{const v=sessionStorage.getItem("accessToken"),w=v?{Authorization:`Bearer ${v}`}:{},D=await i(z.EVENT,"GET",null,w);if(D){console.log("Fetched events:",D);const p=D.data.map(E=>({id:E._id,title:E.title,start:E.startDate,end:E.endDate,allDay:E.startDate===E.endDate}));c(p)}else{const p=n||"Failed to fetch events";p.includes("Authentication required")||p.includes("No token provided")||p.includes("Invalid or expired token")?h("Please log in to view events"):h(p)}})()},[i,n]);const m=()=>{j(g=>!g)};return e.jsxs(l,{my:"10px",children:[u&&e.jsx(Ue,{severity:"error",sx:{mb:2},onClose:()=>h(null),children:u}),e.jsxs(l,{display:"flex",justifyContent:"center",flexDirection:"column",children:[e.jsxs(l,{flex:"1 1 20%",backgroundColor:s.primary[400],py:"15px",borderRadius:"4px",sx:{width:"100%",height:"70vh",overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(l,{display:"flex",alignItems:"center",marginBottom:"10px",children:[e.jsx(Xe,{onClick:m,sx:{backgroundColor:s.blueAccent[500],"&:hover":{backgroundColor:s.blueAccent[700]},padding:"10px",borderRadius:"50%"},children:r?e.jsx(Je,{}):e.jsx(Ke,{})}),e.jsx(a,{variant:"h6",sx:{marginLeft:"10px",fontWeight:"800"},children:r?"Hide Events":"Show Events"})]}),r&&e.jsx(a,{variant:"h4",sx:{marginBottom:"10px"},children:"Events"}),r&&e.jsx(De,{children:o.length===0?e.jsx(a,{children:"No events available"}):o.map(g=>e.jsx(Ee,{sx:{backgroundColor:s.blueAccent[500],margin:"10px 0",borderRadius:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(ke,{primary:g.title,secondary:e.jsx(a,{sx:{fontSize:"0.7em",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:new Date(g.start).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})})},g.id))})]}),e.jsx(l,{flex:"1 1 100%",sx:{width:"100%"},children:e.jsx(Ye,{height:"70vh",plugins:[He,Ge,qe],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:"dayGridMonth",editable:!1,selectable:!1,dayMaxEvents:!0,events:o})})]})]})},Pn=()=>{const t=P();O(t.palette.mode);const[s,n]=d.useState(!0),[i,o]=d.useState(null),{loading:c,error:r,sessionProgress:j,termAttendance:u,feeStatus:h,missedClasses:m,nextClass:g,subjectPerformance:v,allResources:w}=Ct();return d.useEffect(()=>{c||n(!1),r&&o(r.message||"An error occurred while fetching data.")},[c,r]),s||c?e.jsx(Ve,{}):i?e.jsx(l,{m:"20px",children:e.jsxs(a,{variant:"h4",color:"error",children:["Error: ",i]})}):e.jsxs(l,{m:"20px",children:[e.jsx(a,{variant:"h3",fontWeight:"600",mb:"20px",children:"Student Dashboard"}),e.jsxs(st,{children:[e.jsxs(J,{children:[e.jsx(M,{sm:6,md:3,children:e.jsx(R,{children:e.jsx(En,{progress:j})})}),e.jsx(M,{sm:6,md:3,children:e.jsx(R,{children:e.jsx(kn,{attendance:u})})}),e.jsx(M,{sm:6,md:3,children:e.jsx(R,{children:e.jsx(wn,{feesStatus:h})})}),e.jsx(M,{sm:6,md:3,children:e.jsx(R,{noFlex:!0,children:e.jsx(Tn,{nextClass:g})})})]}),e.jsxs(J,{children:[e.jsx(M,{md:8,children:e.jsxs(R,{height:"350px",noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",mb:"10px",children:"Subject Performance"}),e.jsx(Fn,{subjectPerformance:v})]})}),e.jsx(M,{md:4,children:e.jsx(R,{noFlex:!0,children:e.jsx(Rn,{missedClasses:m})})})]}),e.jsxs(J,{children:[e.jsx(M,{md:6,children:e.jsx(R,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx(Mn,{})})}),e.jsx(M,{md:6,children:e.jsx(R,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx(Ln,{allResources:w})})})]}),e.jsx(J,{children:e.jsx(M,{md:12,children:e.jsxs(R,{noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",mb:"10px",children:"School Activities"}),e.jsx(On,{})]})})})]})]})};function re(){const[t,s]=d.useState({termProgress:0,studentAttendance:0,assignmentSubmissionRate:{totalAssignmentRate:0},nextClass:null,topStudents:[],leastActiveStudents:[],loading:!1,error:null}),{callApi:n}=q(),i=de(c=>{var r;return(r=c.users.user)==null?void 0:r._id}),o=d.useCallback(async()=>{if(!i){s(c=>({...c,loading:!1,error:"Teacher ID not found. Please log in."}));return}s(c=>({...c,loading:!0,error:null}));try{const c=await n(`${ct}/teacher-dashboard/${i}`,"GET");if(c&&c.status==="success"){const{data:r}=c;s({termProgress:r.termProgress||0,studentAttendance:r.studentAttendance||0,assignmentSubmissionRate:r.assignmentSubmissionRate||{totalAssignmentRate:0},nextClass:r.nextClass||null,topStudents:r.topStudents||[],leastActiveStudents:r.leastActiveStudents||[],loading:!1,error:null})}else s(r=>({...r,loading:!1,error:(c==null?void 0:c.message)||"Failed to fetch teacher dashboard data"}))}catch(c){s(r=>({...r,loading:!1,error:c.message||"Failed to fetch teacher dashboard data"}))}},[i]);return d.useEffect(()=>{o()},[o]),console.log(t),t}const Nn=()=>{const t=P(),s=O(t.palette.mode),{termProgress:n}=re();return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Term Progress"}),e.jsx(l,{mt:"25px",children:n>0?e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:"125",progress:n/100}),e.jsx(a,{variant:"h5",color:s.blueAccent[500],sx:{mt:"15px"},children:`${n}% completed`}),e.jsx(a,{children:"Current term completion"})]}):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No term progress available."})})]})},In=()=>{const t=P(),s=O(t.palette.mode),{studentAttendance:n}=re();return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Student Attendance"}),e.jsx(l,{mt:"25px",children:n>0?e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:"125",progress:n/100}),e.jsx(a,{variant:"h5",color:s.blueAccent[500],sx:{mt:"15px"},children:`${n}% attendance rate`}),e.jsx(a,{children:"Average student attendance"})]}):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No attendance data available."})})]})},zn=()=>{const t=P(),s=O(t.palette.mode),{assignmentSubmissionRate:n}=re();return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Assignment Submissions"}),e.jsx(l,{mt:"25px",children:n&&n.totalAssignmentRate>0?e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:"125",progress:n.totalAssignmentRate/100}),e.jsx(a,{variant:"h5",color:s.blueAccent[500],sx:{mt:"15px"},children:`${n.totalAssignmentRate}% submission rate`}),e.jsx(a,{children:"Average assignment submission rate"})]}):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No submission data available."})})]})},$n=()=>{const t=P(),s=O(t.palette.mode),{nextClass:n}=re();return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",textAlign:"center",children:"Next Class"}),n?e.jsxs(l,{textAlign:"center",children:[e.jsx(Fe,{sx:{fontSize:"50px",color:s.blueAccent[500]}}),e.jsx(a,{variant:"h6",children:n.subject.name}),e.jsx(a,{children:n.date}),e.jsx(a,{children:n.time}),e.jsxs(a,{children:["Location: ",n.location]})]}):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No upcoming classes scheduled."})]})},Wn=()=>{const t=P(),s=O(t.palette.mode),{error:n,callApi:i}=q(),[o,c]=d.useState([]),[r,j]=d.useState(!1),[u,h]=d.useState(null);d.useEffect(()=>{if(u){const g=setTimeout(()=>h(null),5e3);return()=>clearTimeout(g)}},[u]),d.useEffect(()=>{(async()=>{const v=sessionStorage.getItem("accessToken"),w=v?{Authorization:`Bearer ${v}`}:{},D=await i(z.EVENT,"GET",null,w);if(D){console.log("Fetched events:",D);const p=D.data.map(E=>({id:E._id,title:E.title,start:E.startDate,end:E.endDate,allDay:E.startDate===E.endDate}));c(p)}else{const p=n||"Failed to fetch events";p.includes("Authentication required")||p.includes("No token provided")||p.includes("Invalid or expired token")?h("Please log in to view events"):h(p)}})()},[i,n]);const m=()=>{j(g=>!g)};return e.jsxs(l,{my:"10px",children:[u&&e.jsx(Ue,{severity:"error",sx:{mb:2},onClose:()=>h(null),children:u}),e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Event Calendar"}),e.jsxs(l,{display:"flex",justifyContent:"center",flexDirection:"column",children:[e.jsxs(l,{flex:"1 1 20%",backgroundColor:s.primary[400],py:"15px",borderRadius:"4px",sx:{width:"100%",height:"70vh",overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(l,{display:"flex",alignItems:"center",marginBottom:"10px",children:[e.jsx(Xe,{onClick:m,sx:{backgroundColor:s.blueAccent[500],"&:hover":{backgroundColor:s.blueAccent[700]},padding:"10px",borderRadius:"50%"},children:r?e.jsx(Je,{}):e.jsx(Ke,{})}),e.jsx(a,{variant:"h6",sx:{marginLeft:"10px",fontWeight:"800"},children:r?"Hide Events":"Show Events"})]}),r&&e.jsx(a,{variant:"h4",sx:{marginBottom:"10px"},children:"Events"}),r&&e.jsx(De,{children:o.length===0?e.jsx(a,{children:"No events available"}):o.map(g=>e.jsx(Ee,{sx:{backgroundColor:s.blueAccent[500],margin:"10px 0",borderRadius:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(ke,{primary:g.title,secondary:e.jsx(a,{sx:{fontSize:"0.7em",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:new Date(g.start).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})})},g.id))})]}),e.jsx(l,{flex:"1 1 100%",sx:{width:"100%"},children:e.jsx(Ye,{height:"70vh",plugins:[He,Ge,qe,pt],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:"dayGridMonth",editable:!1,selectable:!1,dayMaxEvents:!0,events:o})})]})]})},_n=()=>{const t=P(),s=O(t.palette.mode),{callApi:n}=q(),[i,o]=d.useState(null);d.useEffect(()=>{(async()=>{try{const h=await n(z.ANNOUNCEMENT,"GET");h&&h.data&&o(h.data)}catch(h){console.error("Error fetching announcements:",h)}})()},[n]);const c=t.palette.mode==="light"?s.blueAccent[800]:s.greenAccent[600],j=i||[{id:"1",title:"End of Term Exams",message:"Exams start on July 1, 2025.",date:"2025-06-20"},{id:"2",title:"Teachers Meeting",message:"Meeting on July 10, 2025.",date:"2025-06-18"}];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Announcements"}),j.length>0?j.map(u=>e.jsx(we,{sx:{mb:2},children:e.jsxs(Te,{sx:{backgroundColor:c,textAlign:"left"},children:[e.jsx(a,{variant:"h6",children:u.title}),e.jsx(a,{variant:"body2",children:u.message}),e.jsx(a,{variant:"caption",color:"gray",children:u.date})]})},u.id)):e.jsx(a,{children:"No announcements available"})]})},Vn=()=>{const t=P(),s=O(t.palette.mode),{topStudents:n}=re(),i=t.palette.mode==="light"?s.greenAccent[300]:s.primary[500];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Top Students by Performance"}),n&&n.length>0?n.map((o,c)=>e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"flex-start",mb:2,backgroundColor:i,p:"15px",borderRadius:"8px",sx:{boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx(ht,{src:o.profilePicture||"",alt:`${o.firstName} ${o.lastName}`,sx:{width:50,height:50,mr:2}}),e.jsxs(l,{children:[e.jsx(a,{variant:"h6",color:"white",children:`${o.firstName} ${o.lastName}`}),e.jsxs(a,{variant:"body2",color:"white",children:["Performance Score: ",o.performanceScore,"%"]})]})]},c)):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No top students available."})]})},Bn=()=>{const t=P(),s=O(t.palette.mode),{leastActiveStudents:n}=re(),i=t.palette.mode==="light"?s.greenAccent[300]:s.primary[500];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Least Active Students"}),n&&n.length>0?n.map((o,c)=>e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"flex-start",mb:2,backgroundColor:i,p:"15px",borderRadius:"8px",sx:{boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx(ht,{src:o.profilePicture||"",alt:`${o.firstName} ${o.lastName}`,sx:{width:50,height:50,mr:2}}),e.jsxs(l,{children:[e.jsx(a,{variant:"h6",color:"white",children:`${o.firstName} ${o.lastName}`}),e.jsxs(a,{variant:"body2",color:"white",children:["Activity Rate: ",o.activityRate,"%"]})]})]},c)):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No least active students available."})]})},Yn=()=>{const t=P();O(t.palette.mode),it(t.breakpoints.down("sm")),it(t.breakpoints.between("sm","md"));const[s,n]=d.useState(!0),[i,o]=d.useState(null),{loading:c,error:r}=re();return d.useEffect(()=>{c||n(!1),r&&o(r.message||"An error occurred while fetching data.")},[c,r]),s||c?e.jsx(Ve,{}):i?e.jsx(l,{m:"20px",children:e.jsxs(a,{variant:"h4",color:"error",children:["Error: ",i]})}):e.jsxs(l,{m:"20px",children:[e.jsx(a,{variant:"h3",fontWeight:"600",mb:"20px",children:"Teacher Dashboard"}),e.jsxs(st,{children:[e.jsxs(J,{children:[e.jsx(M,{sm:6,md:3,children:e.jsx(R,{children:e.jsx(Nn,{})})}),e.jsx(M,{sm:6,md:3,children:e.jsx(R,{children:e.jsx(In,{})})}),e.jsx(M,{sm:6,md:3,children:e.jsx(R,{children:e.jsx(zn,{})})}),e.jsx(M,{sm:6,md:3,children:e.jsx(R,{children:e.jsx($n,{})})})]}),e.jsxs(J,{children:[e.jsx(M,{md:8,children:e.jsx(R,{noFlex:!0,moreStyles:{height:"500px",overflowY:"auto"},children:e.jsx(Wn,{})})}),e.jsx(M,{md:4,children:e.jsx(R,{noFlex:!0,moreStyles:{height:"500px",overflowY:"auto"},children:e.jsx(_n,{})})})]}),e.jsxs(J,{children:[e.jsx(M,{md:6,children:e.jsx(R,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx(Vn,{})})}),e.jsx(M,{md:6,children:e.jsx(R,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx(Bn,{})})})]})]})]})},Hn=({openAnnouncementModal:t,setModalOpen:s})=>{const n=de(x=>x.users.user),[i,o]=d.useState({title:"",message:"",dueDate:"",targets:[{classLevel:"",subclass:""}]}),[c,r]=d.useState([]),{loading:j,callApi:u}=q(),[h,m]=d.useState(!1),[g,v]=d.useState(""),[w,D]=d.useState(!1);d.useEffect(()=>{if(!n||!n._id){v("User not authenticated. Please log in again."),m(!0);return}n.role==="teacher"&&t&&(async()=>{try{const C=await u(`${z.CLASS_LEVEL}/teacher/${n._id}`,"GET");C&&C.data?r(C.data.assignedClasses):(v("No assigned classes found."),m(!0))}catch(C){v("Failed to load assigned classes: "+C.message),m(!0)}})()},[t,n,u]);const p=x=>{const{name:C,value:f}=x.target;o(b=>({...b,[C]:f}))},E=(x,C,f)=>{const b=[...i.targets];b[x][C]=f,C==="classLevel"&&(b[x].subclass=""),o(V=>({...V,targets:b}))},L=()=>{o(x=>({...x,targets:[...x.targets,{classLevel:"",subclass:""}]}))},A=x=>{o(C=>({...C,targets:C.targets.filter((f,b)=>b!==x)}))},T=async()=>{if(!n||!n._id){v("User not authenticated. Please log in again."),m(!0);return}const{title:x,message:C,dueDate:f,targets:b}=i;if(!x||!C||!f){v("Please fill all required fields (title, message, due date)."),m(!0);return}if(n.role==="teacher"){if(b.length===0||b.some(N=>!N.classLevel||!N.subclass)){v("Please select at least one class level and subclass."),m(!0);return}for(const N of b){const Y=c.find(k=>k._id===N.classLevel);if(!Y){v(`Invalid class level: ${N.classLevel}`),m(!0);return}if(!Y.subclasses.some(k=>k.letter===N.subclass)){v(`Invalid subclass ${N.subclass} for class ${Y.name}`),m(!0);return}}}const V=f.includes("T")?f:`${f}T23:59:59.000Z`,U=n.role==="teacher"?{title:x,message:C,dueDate:V,createdBy:n._id,targets:b}:{title:x,message:C,dueDate:V,createdBy:n._id},B=n.role==="teacher"?`${z.ANNOUNCEMENT}/class`:`${z.ANNOUNCEMENT}/general`;try{const N=await u(B,"POST",U);N&&N.status==="success"?(o({title:"",message:"",dueDate:"",targets:[{classLevel:"",subclass:""}]}),v(""),s(!1),D(!0),m(!0)):(v(N.message||"Failed to submit announcement. Please try again."),m(!0))}catch(N){v(N.message||"Failed to submit announcement."),m(!0)}};return!n||!n._id?e.jsx(ne,{open:t,onClose:()=>s(!1),title:"Make Announcement",children:e.jsx(l,{sx:{display:"flex",justifyContent:"center",padding:2},children:e.jsx(Wt,{})})}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{open:t,onClose:()=>s(!1),title:"Make Announcement",onConfirm:T,children:e.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(_,{label:"Title",name:"title",value:i.title,onChange:p,fullWidth:!0,required:!0}),e.jsx(_,{label:"Message",name:"message",value:i.message,onChange:p,fullWidth:!0,multiline:!0,rows:4,required:!0}),e.jsx(_,{label:"Due Date",name:"dueDate",type:"datetime-local",value:i.dueDate,onChange:p,fullWidth:!0,InputLabelProps:{shrink:!0},required:!0}),n.role==="teacher"&&e.jsxs(e.Fragment,{children:[i.targets.map((x,C)=>{var f;return e.jsxs(l,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsxs($e,{fullWidth:!0,children:[e.jsx(We,{children:"Class Level"}),e.jsxs(_e,{name:`classLevel-${C}`,value:x.classLevel,onChange:b=>E(C,"classLevel",b.target.value),required:!0,children:[e.jsx(ae,{value:"",children:e.jsx("em",{children:"Select Class Level"})}),c.map(b=>e.jsxs(ae,{value:b._id,children:[b.section," ",b.name]},b._id))]})]}),e.jsxs($e,{fullWidth:!0,children:[e.jsx(We,{children:"Subclass"}),e.jsxs(_e,{name:`subclass-${C}`,value:x.subclass,onChange:b=>E(C,"subclass",b.target.value),required:!0,disabled:!x.classLevel,children:[e.jsx(ae,{value:"",children:e.jsx("em",{children:"Select Subclass"})}),x.classLevel&&((f=c.find(b=>b._id===x.classLevel))==null?void 0:f.subclasses.map(b=>e.jsx(ae,{value:b.letter,children:b.letter},b.letter)))]})]}),i.targets.length>1&&e.jsx(ot,{color:"error",onClick:()=>A(C),children:"Remove"})]},C)}),e.jsx(ot,{onClick:L,variant:"outlined",sx:{mt:1},children:"Add Another Class"})]})]})}),e.jsx(jt,{open:h,isLoading:j,onClose:()=>m(!1),title:"Announcement Submission",message:w?"Announcement submitted successfully!":g||"Could not submit announcement. Please try again."})]})},Gn=({openFeedbackModal:t,setModalOpen:s})=>{const[n,i]=d.useState(""),[o,c]=d.useState(""),[r,j]=d.useState(""),[u,h]=d.useState(""),{data:m,loading:g,error:v,callApi:w}=q(),[D,p]=d.useState(!1),E=async()=>{const L={name:n,role:o,date:r,comments:u};await w(z.FEEDBACKS,"POST",L),v?console.error("Error submitting feedback:",v):(p(!0),i(""),c(""),j(""),h(""))};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{open:t,onClose:()=>s(!1),title:"Send Feedback",onConfirm:E,children:e.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(_,{label:"Name",value:n,onChange:L=>i(L.target.value),fullWidth:!0,margin:"normal"}),e.jsxs($e,{fullWidth:!0,margin:"normal",children:[e.jsx(We,{children:"Role"}),e.jsxs(_e,{value:o,onChange:L=>c(L.target.value),children:[e.jsx(ae,{value:"Student",children:"Student"}),e.jsx(ae,{value:"Instructor",children:"Instructor"}),e.jsx(ae,{value:"Worker",children:"Worker"})]})]}),e.jsx(_,{label:"Date",type:"date",value:r,onChange:L=>j(L.target.value),fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0}}),e.jsx(_,{label:"Comments",value:u,onChange:L=>h(L.target.value),fullWidth:!0,margin:"normal",multiline:!0,rows:4})]})}),e.jsx(jt,{open:D,isLoading:g,onClose:()=>p(!1),title:"Feedback Confirmation",message:m?"Feedback submitted successfully!":"Could not submit feedback."})]})},qn=({home:t})=>{const[s,n]=d.useState(!1),[i,o]=d.useState(!1),c=P();O(c.palette.mode);const r=de(j=>j.users.user);return console.log("user:",r),!r||!r.firstName?e.jsx(l,{children:e.jsx(a,{children:"Loading user data..."})}):e.jsxs(l,{children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(It,{home:!0,title:r.firstName,subtitle:"Welcome to your dashboard"}),e.jsxs(l,{sx:{display:"flex",gap:"10px"},children:[r.role==="admin"&&e.jsxs(l,{sx:{display:"flex",flexDirection:{xs:"column",sm:"column",md:"row"},alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(xe,{icon:e.jsx(bt,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Download Reports"}),e.jsx(xe,{icon:e.jsx(ye,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Make announcement",onClick:()=>o(!0)})]}),r.role==="teacher"&&e.jsxs(l,{sx:{display:"flex",flexDirection:{xs:"column",sm:"column",md:"row"},alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(xe,{icon:e.jsx(ye,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Make announcement",onClick:()=>o(!0)}),e.jsx(xe,{icon:e.jsx(ye,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Submit Feedback",onClick:()=>n(!0)}),e.jsxs(l,{children:[e.jsx(nn,{sx:{fontSize:{xs:"1em",sm:"1.2em"}},value:r.rating,readOnly:!0,precision:.1}),e.jsxs(a,{variant:"h6",sx:{fontSize:{xs:"0.8em",sm:"1em"}},children:["Rating: ",r.rating]})]})]}),r.role==="student"&&e.jsx(l,{sx:{display:"flex",flexDirection:{xs:"column",sm:"column",md:"row"},alignItems:"center",justifyContent:"center",gap:"10px"},children:e.jsx(xe,{icon:e.jsx(ye,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Submit Feedback",onClick:()=>n(!0)})}),e.jsx(Hn,{openAnnouncementModal:i,setModalOpen:o}),e.jsx(Gn,{openFeedbackModal:s,setModalOpen:n})]})]}),r.role==="admin"||r.role==="superadmin"?e.jsx(Dn,{user:r}):r.role==="student"?e.jsx(Pn,{user:r}):r.role==="teacher"?e.jsx(Yn,{user:r}):null]})},Un=$t(qn),Ss=()=>e.jsx("div",{children:e.jsx(Un,{home:!0})});export{Ss as default};
