import{r as P,j as e}from"./index-pj4csjMx.js";import{M as V,t as ce}from"./modal-DLk5G-pL.js";import{H as de}from"./Header-DgiuZ9AO.js";import{a as ae,b as R,T as ne}from"./table-CYy185Xe.js";import{w as ue}from"./dasboardPagesContainer-VPbF8DwQ.js";import{C as ie}from"./accordion-DZZodzn5.js";import{v as x,T as r,y as re,a1 as he,a2 as be,a3 as ge,x as E,j as xe}from"./TextField-nY0Yhgij.js";import{L as le}from"./LinearProgress-DFj-7U9K.js";import{M as me}from"./MenuItem-BBZ-BCC-.js";import{G as oe}from"./index-yPFRd-aU.js";import"./IconButton-BgFdEAdd.js";import"./useMediaQuery-CJL06RsU.js";import"./index-yUwIHc-_.js";import"./loadingButton-CqVpuJvD.js";import"./CircularProgress-B7Fe9zn4.js";import"./useSlot-C9IJxz6s.js";import"./confirmationModal-DFIgAcnF.js";import"./useApi-CgK0isv2.js";import"./crystal-land-log-removebg-DVF-nlbN.js";const M={academicYears:[{_id:"year_1",name:"2023–2024"},{_id:"year_2",name:"2024–2025"}],classes:[{_id:"class_1",academicYearId:"year_2",section:"Primary",displayName:"Primary 1A",students:["stu_1","stu_2"],subjectsTaught:["Mathematics","English"]},{_id:"class_2",academicYearId:"year_2",section:"Secondary",displayName:"Secondary 1B",students:["stu_3"],subjectsTaught:["Science"]}],students:[{_id:"stu_1",firstName:"John",lastName:"Doe",subjects:[{name:"Mathematics",topics:[{topic:"Linear Equations",progress:80},{topic:"Quadratic Functions",progress:60}],overallProgress:70},{name:"English",topics:[{topic:"Grammar Basics",progress:90},{topic:"Literature Analysis",progress:50}],overallProgress:70}]},{_id:"stu_2",firstName:"Jane",lastName:"Smith",subjects:[{name:"Mathematics",topics:[{topic:"Linear Equations",progress:70},{topic:"Quadratic Functions",progress:40}],overallProgress:55}]},{_id:"stu_3",firstName:"Alice",lastName:"Brown",subjects:[{name:"Science",topics:[{topic:"Chemical Reactions",progress:85}],overallProgress:85}]}],testQuestions:[{id:"q_1",classId:"class_1",subject:"Mathematics",question:"What is the solution to 2x + 3 = 7?",options:["x = 1","x = 2","x = 3","x = 4"],correctAnswer:"x = 2"},{id:"q_2",classId:"class_1",subject:"English",question:'What is a synonym for "happy"?',options:["Sad","Joyful","Angry","Tired"],correctAnswer:"Joyful"},{id:"q_3",classId:"class_2",subject:"Science",question:"What gas do plants absorb during photosynthesis?",options:["Oxygen","Nitrogen","Carbon Dioxide","Hydrogen"],correctAnswer:"Carbon Dioxide"}],tests:[{id:"test_1",classId:"class_1",subject:"Mathematics",questionIds:["q_1"]},{id:"test_2",classId:"class_1",subject:"English",questionIds:["q_2"]},{id:"test_3",classId:"class_2",subject:"Science",questionIds:["q_3"]}],testScores:[{id:"score_1",testId:"test_1",studentId:"stu_1",score:80,date:"2024-09-20"},{id:"score_2",testId:"test_1",studentId:"stu_2",score:70,date:"2024-09-20"},{id:"score_3",testId:"test_2",studentId:"stu_1",score:90,date:"2024-09-21"},{id:"score_4",testId:"test_3",studentId:"stu_3",score:85,date:"2024-09-22"}]},pe=()=>{const[j,i]=P.useState(0),[s,o]=P.useState(0),[l,m]=P.useState({}),[f,C]=P.useState(!1),[p,S]=P.useState(!1),[D,d]=P.useState(!1),[h,y]=P.useState(null),[N,O]=P.useState(null),[$,F]=P.useState(M.testQuestions),[v,I]=P.useState({question:"",options:["","","",""],correctAnswer:""}),Q=[];return M.classes.forEach(t=>{t.subjectsTaught.forEach(a=>{const c=`${t._id}_${a}`;Q.push({id:c,classId:t._id,className:t.displayName,subject:a})})}),P.useEffect(()=>{const t={};Q.forEach(a=>{l[a.id]||(t[a.id]={page:0,rowsPerPage:5,sortBy:"name",sortDirection:"asc"})}),Object.keys(t).length>0&&m(a=>({...a,...t}))},[]),{mainTabValue:j,subjectTabValue:s,tabState:l,studentModalOpen:f,progressModalOpen:p,questionsModalOpen:D,selectedStudent:h,selectedTest:N,testQuestions:$,newQuestion:v,subjectClassPairs:Q,dummyData:M,handleMainTabChange:(t,a)=>{i(a),o(0)},handleSubjectTabChange:(t,a)=>{o(a)},handlePageChange:(t,a)=>{m(c=>({...c,[t]:{...c[t],page:a}}))},handleRowsPerPageChange:(t,a)=>{m(c=>({...c,[t]:{...c[t],page:0,rowsPerPage:parseInt(a.target.value,10)}}))},handleSortChange:(t,a)=>{m(c=>{const u=c[t],_=u.sortBy===a&&u.sortDirection==="asc"?"desc":"asc";return{...c,[t]:{...u,sortBy:a,sortDirection:_}}})},openStudentModal:t=>{y(t),C(!0)},openProgressModal:t=>{y(t),S(!0)},openQuestionsModal:t=>{O(t),d(!0)},handleQuestionInputChange:t=>{const{name:a,value:c}=t.target;I(u=>({...u,[a]:c}))},handleOptionChange:(t,a)=>{I(c=>{const u=[...c.options];return u[t]=a,{...c,options:u}})},handleAddQuestion:()=>{if(!v.question||!v.options.every(c=>c)||!v.correctAnswer){alert("Please fill all fields");return}const a={id:`q_${$.length+1}`,classId:N.classId,subject:N.subject,question:v.question,options:v.options,correctAnswer:v.correctAnswer};F([...$,a]),I({question:"",options:["","","",""],correctAnswer:""})},getTableDataForPair:(t,a,c)=>{const{page:u,rowsPerPage:_,sortBy:b,sortDirection:T}=l[t]||{page:0,rowsPerPage:5,sortBy:"name",sortDirection:"asc"},q=M.classes.find(g=>g._id===a);if(!q)return[];const te=M.students.filter(g=>q.students.includes(g._id)).map(g=>{var w;return{...g,className:q.displayName,section:q.section,subjectProgress:((w=g.subjects.find(A=>A.name===c))==null?void 0:w.overallProgress)||0,subjectsDisplay:c}});te.sort((g,w)=>{let A=g[b]??"",k=w[b]??"";return b==="name"?(A=`${g.firstName} ${g.lastName}`.toLowerCase(),k=`${w.firstName} ${w.lastName}`.toLowerCase()):b==="subjectProgress"?(A=g.subjectProgress,k=w.subjectProgress):b==="subjectsDisplay"&&(A=g.subjectsDisplay.toLowerCase(),k=w.subjectsDisplay.toLowerCase()),A<k?T==="asc"?-1:1:A>k?T==="asc"?1:-1:0});const L=u*_;return te.slice(L,L+_).map((g,w)=>({...g,sn:L+w+1,name:`${g.firstName} ${g.lastName}`}))},getTestScoresData:t=>{const a=M.tests.find(u=>u.classId===t.classId&&u.subject===t.subject);return a?M.testScores.filter(u=>u.testId===a.id).map((u,_)=>{const b=M.students.find(T=>T._id===u.studentId);return{sn:_+1,studentName:b?`${b.firstName} ${b.lastName}`:"Unknown",score:u.score,date:new Date(u.date).toLocaleDateString()}}):[]},setStudentModalOpen:C,setProgressModalOpen:S,setQuestionsModalOpen:d,setSelectedStudent:y,setSelectedTest:O,setNewQuestion:I}},je=({open:j,onClose:i,selectedStudent:s,colors:o})=>e.jsx(V,{open:j,onClose:i,title:`${(s==null?void 0:s.name)||"Student"} Details`,noConfirm:!0,children:s&&e.jsxs(x,{children:[e.jsxs(r,{variant:"h6",children:["Class: ",s.className||"N/A"]}),e.jsx(r,{variant:"h6",sx:{mt:2},children:"Subjects and Progress"}),(s.subjects||[]).length>0?s.subjects.map((l,m)=>{var C;const f=(s.subjects||[]).reduce((p,S)=>p+S.overallProgress,0)/(((C=s.subjects)==null?void 0:C.length)||1);return e.jsx(ie,{title:`${l.name} (${l.overallProgress.toFixed(2)}%)`,details:e.jsx(x,{children:l.topics.map((p,S)=>e.jsxs(x,{sx:{mb:2},children:[e.jsx(r,{variant:"body1",sx:{mb:1},children:p.topic}),e.jsx(le,{variant:"determinate",value:p.progress,sx:{height:10,borderRadius:5,backgroundColor:o.grey[300],"& .MuiLinearProgress-bar":{backgroundColor:o.greenAccent[500]}}}),e.jsxs(x,{sx:{mt:1},children:[e.jsxs(r,{variant:"body2",color:o.grey[100],children:[e.jsx("strong",{style:{color:o.blueAccent[200]},children:"Topic Progress:"})," ",p.progress.toFixed(2),"%"]}),e.jsxs(r,{variant:"body2",color:o.grey[100],children:[e.jsx("strong",{style:{color:o.blueAccent[200]},children:"Subject Overall Progress:"})," ",l.overallProgress.toFixed(2),"%"]}),e.jsxs(r,{variant:"body2",color:o.grey[100],children:[e.jsx("strong",{style:{color:o.blueAccent[200]},children:"Student Average Progress:"})," ",f.toFixed(2),"%"]})]})]},S))}),defaultExpanded:!1},m)}):e.jsx(r,{variant:"body1",children:"No subjects assigned"})]})}),fe=({open:j,onClose:i,selectedStudent:s,colors:o})=>e.jsx(V,{open:j,onClose:i,title:`Progress for ${(s==null?void 0:s.name)||"Student"}`,noConfirm:!0,children:s&&e.jsx(x,{display:"flex",flexDirection:"column",gap:"16px",children:(s.subjects||[]).length>0?s.subjects.map((l,m)=>e.jsxs(x,{children:[e.jsxs(r,{variant:"h6",mb:"15px",children:[l.name," (",l.overallProgress.toFixed(2),"%)"]}),l.topics.map((f,C)=>e.jsxs(x,{sx:{mb:2},children:[e.jsx(r,{variant:"body1",mb:"10px",children:f.topic}),e.jsx(le,{variant:"determinate",value:f.progress,sx:{height:"10px",borderRadius:"5px",backgroundColor:o.primary[300],"& .MuiLinearProgress-bar":{backgroundColor:o.greenAccent[500]}}}),e.jsxs(r,{variant:"body2",mt:"10px",children:["Progress: ",f.progress.toFixed(2),"%"]})]},C))]},m)):e.jsx(r,{variant:"body1",children:"No subjects available to display"})})}),Ce=({open:j,onClose:i,selectedTest:s,testQuestions:o,newQuestion:l,handleQuestionInputChange:m,handleOptionChange:f,handleAddQuestion:C,getTestScoresData:p,colors:S,TableComponent:D})=>e.jsx(V,{open:j,onClose:i,title:`Manage Test Questions for ${s==null?void 0:s.subject} (${(s==null?void 0:s.className)||"Class"})`,noConfirm:!0,children:s&&e.jsxs(x,{display:"flex",flexDirection:"column",gap:"16px",children:[e.jsxs(x,{children:[e.jsx(r,{variant:"h6",mb:"10px",children:"Add New Question"}),e.jsx(re,{label:"Question",name:"question",value:l.question,onChange:m,fullWidth:!0,multiline:!0,rows:2,sx:{mb:2}}),l.options.map((d,h)=>e.jsx(re,{label:`Option ${h+1}`,value:d,onChange:y=>f(h,y.target.value),fullWidth:!0,sx:{mb:2}},h)),e.jsxs(he,{fullWidth:!0,sx:{mb:2},children:[e.jsx(be,{id:"correct-answer-select-label",children:"Correct Answer"}),e.jsx(ge,{labelId:"correct-answer-select-label",name:"correctAnswer",value:l.correctAnswer,onChange:m,label:"Correct Answer",children:l.options.map((d,h)=>e.jsx(me,{value:d,disabled:!d,children:d||`Option ${h+1}`},h))})]}),e.jsx(E,{variant:"contained",color:"primary",onClick:C,sx:{mb:2},children:"Add Question"})]}),e.jsx(r,{variant:"h6",children:"Existing Questions"}),o.filter(d=>d.classId===s.classId&&d.subject===s.subject).length>0?o.filter(d=>d.classId===s.classId&&d.subject===s.subject).map((d,h)=>e.jsx(ie,{title:`Question ${h+1}: ${d.question}`,details:e.jsxs(x,{children:[e.jsxs(r,{variant:"body1",children:["Subject: ",d.subject]}),e.jsx(r,{variant:"body1",sx:{mt:1},children:"Options:"}),e.jsx("ul",{children:d.options.map((y,N)=>e.jsx("li",{children:e.jsxs(r,{variant:"body2",color:y===d.correctAnswer?S.greenAccent[500]:"inherit",children:[y,y===d.correctAnswer&&" (Correct)"]})},N))})]}),defaultExpanded:!1},d.id)):e.jsx(r,{children:"No questions set for this subject and class."}),e.jsx(r,{variant:"h6",sx:{mt:3},children:"Student Test Scores"}),p(s).length>0?e.jsx(D,{columns:[{id:"sn",label:"S/N",flex:.5},{id:"studentName",label:"Student Name",flex:2},{id:"score",label:"Score (%)",flex:1},{id:"date",label:"Date",flex:1}],tableHeader:`Scores for ${s.subject} (${s.className})`,data:p(s),page:0,rowsPerPage:5,sortBy:"studentName",sortDirection:"asc",hiddenColumnsSmallScreen:["date"]}):e.jsx(r,{children:"No test scores available for this subject and class."})]})});function W(j){const{children:i,value:s,index:o,...l}=j;return e.jsx("div",{role:"tabpanel",hidden:s!==o,id:`tabpanel-${o}`,"aria-labelledby":`tab-${o}`,...l,children:s===o&&e.jsx(x,{sx:{p:3},children:i})})}const ye=()=>{const j=xe(),i=ce(j.palette.mode),{mainTabValue:s,subjectTabValue:o,tabState:l,studentModalOpen:m,progressModalOpen:f,questionsModalOpen:C,selectedStudent:p,selectedTest:S,testQuestions:D,newQuestion:d,subjectClassPairs:h,handleMainTabChange:y,handleSubjectTabChange:N,handlePageChange:O,handleRowsPerPageChange:$,handleSortChange:F,openStudentModal:v,openProgressModal:I,openQuestionsModal:Q,handleQuestionInputChange:H,handleOptionChange:J,handleAddQuestion:G,getTableDataForPair:Y,getTestScoresData:z,setStudentModalOpen:U,setProgressModalOpen:K,setQuestionsModalOpen:X,setSelectedStudent:B,setSelectedTest:Z,setNewQuestion:ee}=pe(),se=[{id:"sn",label:"S/N",flex:.5},{id:"name",label:"Student Name",flex:2,renderCell:n=>e.jsx(r,{children:n.name})},{id:"className",label:"Class",flex:1,renderCell:n=>e.jsx(r,{children:n.className})},{id:"subjectProgress",label:"Subject Progress",flex:1,renderCell:n=>e.jsxs(r,{children:[n.subjectProgress.toFixed(2),"%"]})},{id:"actions",label:"Actions",flex:1,renderCell:n=>e.jsxs(x,{display:"flex",gap:"10px",children:[e.jsx(E,{variant:"contained",color:"primary",size:"small",onClick:()=>v(n),children:"View"}),e.jsx(E,{variant:"contained",color:"secondary",size:"small",onClick:()=>I(n),children:"Progress"})]})}];return e.jsxs(x,{children:[e.jsx(de,{title:"SUBJECT MANAGEMENT",subtitle:"Manage Subjects, Tests, and Exams"}),e.jsxs(x,{sx:{mt:3,mb:3},children:[e.jsxs(ae,{value:s,onChange:y,"aria-label":"main tabs",sx:{backgroundColor:i.primary[400],"& .MuiTabs-indicator":{backgroundColor:i.blueAccent[700]}},children:[e.jsx(R,{label:"Subjects",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:i.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:i.primary[400]}}),e.jsx(R,{label:"Tests",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:i.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:i.primary[400]}})]}),e.jsx(W,{value:s,index:0,children:h.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ae,{value:o,onChange:N,"aria-label":"subject class tabs",sx:{backgroundColor:i.primary[400],"& .MuiTabs-indicator":{backgroundColor:i.blueAccent[700]}},children:h.map(n=>e.jsx(R,{label:`${n.subject} (${n.className})`,sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:i.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:i.primary[400]}},n.id))}),h.map((n,t)=>{var a,c,u,_;return e.jsx(W,{value:o,index:t,children:e.jsx(ne,{columns:se,tableHeader:`${n.subject} Students for ${n.className}`,data:Y(n.id,n.classId,n.subject),page:((a=l[n.id])==null?void 0:a.page)||0,rowsPerPage:((c=l[n.id])==null?void 0:c.rowsPerPage)||5,sortBy:((u=l[n.id])==null?void 0:u.sortBy)||"name",sortDirection:((_=l[n.id])==null?void 0:_.sortDirection)||"asc",onSortChange:b=>F(n.id,b),onPageChange:(b,T)=>O(n.id,T),onRowsPerPageChange:b=>$(n.id,b),onRowClick:b=>console.log("Row clicked:",b),hiddenColumnsSmallScreen:["subjectProgress"]})},n.id)})]}):e.jsx(r,{children:"No subjects or classes assigned"})}),e.jsxs(W,{value:s,index:1,children:[e.jsx(r,{variant:"h5",sx:{mb:3},children:"Manage Test Questions"}),h.length>0?e.jsx(oe,{container:!0,spacing:2,children:h.map((n,t)=>e.jsx(oe,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(x,{p:2,borderRadius:"8px",boxShadow:2,bgcolor:i.primary[400],display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",children:[e.jsx(r,{variant:"h6",children:n.subject}),e.jsx(r,{variant:"body1",children:n.className}),e.jsx(E,{variant:"contained",color:"primary",onClick:()=>Q(n),children:"Manage Questions"})]})},t))}):e.jsx(r,{children:"No subjects or classes assigned"})]})]}),e.jsx(je,{open:m,onClose:()=>{U(!1),B(null)},selectedStudent:p,colors:i}),e.jsx(fe,{open:f,onClose:()=>{K(!1),B(null)},selectedStudent:p,colors:i}),e.jsx(Ce,{open:C,onClose:()=>{X(!1),Z(null),ee({question:"",options:["","","",""],correctAnswer:""})},selectedTest:S,testQuestions:D,newQuestion:d,handleQuestionInputChange:H,handleOptionChange:J,handleAddQuestion:G,getTestScoresData:z,colors:i,TableComponent:ne})]})},Re=ue(ye);export{Re as default};
