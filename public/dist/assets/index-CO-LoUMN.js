import{j as e,r as n,f as ee,a as ts,i as As}from"./index-Dia3dXnv.js";import{M as ke,t as ks,D as Ns,a as Ls,b as Ms,c as _s}from"./modal-CRceNtXl.js";import{H as Es}from"./Header-BKDrWR6o.js";import{a as Fs,b as Os,T as Rs}from"./table-BuC3jVNb.js";import{u as je}from"./useApi-CcDc2KeG.js";import{C as ae}from"./customIconButton-DgPKoi8g.js";import{l as Je,j as is,m as Ds,n as Te}from"./index-BV7VJBUd.js";import{w as ws}from"./dasboardPagesContainer-FR1z_d3q.js";import{A as ye}from"./actionButton-BwgkxJSG.js";import{A as _e,c as Ee,L as ns,a as os}from"./index-HCkcCK1E.js";import{a as Vs}from"./index-C7R-W1jd.js";import{c as Us,a as zs,g as Ws,u as Ys,_ as qs,o as Js,b as de,B as rs,d as Ae,s as cs,h as L,e as Is,i as ce,v as M,T as P,a3 as se,y as be,a1 as fe,a2 as xe,w as ds,x as Me,j as Bs}from"./TextField-CiACpH9R.js";import{M as w}from"./MenuItem-9u3wVos-.js";import"./IconButton-BeQuUMyU.js";import"./useMediaQuery-D2Chhg5w.js";import"./index-B_m23NjE.js";import"./loadingButton-Dn6lZ4mI.js";import"./CircularProgress-Du6yAQTu.js";import"./confirmationModal-CIDTnzxs.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-BVdpsmmF.js";const Gs=Us(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}),"Cancel");function Ks(s){return Ws("MuiChip",s)}const j=zs("MuiChip",["root","sizeSmall","sizeMedium","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","disabled","clickable","clickableColorPrimary","clickableColorSecondary","deletable","deletableColorPrimary","deletableColorSecondary","outlined","filled","outlinedPrimary","outlinedSecondary","filledPrimary","filledSecondary","avatar","avatarSmall","avatarMedium","avatarColorPrimary","avatarColorSecondary","icon","iconSmall","iconMedium","iconColorPrimary","iconColorSecondary","label","labelSmall","labelMedium","deleteIcon","deleteIconSmall","deleteIconMedium","deleteIconColorPrimary","deleteIconColorSecondary","deleteIconOutlinedColorPrimary","deleteIconOutlinedColorSecondary","deleteIconFilledColorPrimary","deleteIconFilledColorSecondary","focusVisible"]),Hs=["avatar","className","clickable","color","component","deleteIcon","disabled","icon","label","onClick","onDelete","onKeyDown","onKeyUp","size","variant","tabIndex","skipFocusWhenDisabled"],Zs=s=>{const{classes:r,disabled:v,size:o,color:p,iconColor:c,onDelete:E,clickable:A,variant:y}=s,J={root:["root",y,v&&"disabled",`size${L(o)}`,`color${L(p)}`,A&&"clickable",A&&`clickableColor${L(p)}`,E&&"deletable",E&&`deletableColor${L(p)}`,`${y}${L(p)}`],label:["label",`label${L(o)}`],avatar:["avatar",`avatar${L(o)}`,`avatarColor${L(p)}`],icon:["icon",`icon${L(o)}`,`iconColor${L(c)}`],deleteIcon:["deleteIcon",`deleteIcon${L(o)}`,`deleteIconColor${L(p)}`,`deleteIcon${L(y)}Color${L(p)}`]};return Is(J,Ks,r)},Qs=cs("div",{name:"MuiChip",slot:"Root",overridesResolver:(s,r)=>{const{ownerState:v}=s,{color:o,iconColor:p,clickable:c,onDelete:E,size:A,variant:y}=v;return[{[`& .${j.avatar}`]:r.avatar},{[`& .${j.avatar}`]:r[`avatar${L(A)}`]},{[`& .${j.avatar}`]:r[`avatarColor${L(o)}`]},{[`& .${j.icon}`]:r.icon},{[`& .${j.icon}`]:r[`icon${L(A)}`]},{[`& .${j.icon}`]:r[`iconColor${L(p)}`]},{[`& .${j.deleteIcon}`]:r.deleteIcon},{[`& .${j.deleteIcon}`]:r[`deleteIcon${L(A)}`]},{[`& .${j.deleteIcon}`]:r[`deleteIconColor${L(o)}`]},{[`& .${j.deleteIcon}`]:r[`deleteIcon${L(y)}Color${L(o)}`]},r.root,r[`size${L(A)}`],r[`color${L(o)}`],c&&r.clickable,c&&o!=="default"&&r[`clickableColor${L(o)})`],E&&r.deletable,E&&o!=="default"&&r[`deletableColor${L(o)}`],r[y],r[`${y}${L(o)}`]]}})(({theme:s,ownerState:r})=>{const v=s.palette.mode==="light"?s.palette.grey[700]:s.palette.grey[300];return de({maxWidth:"100%",fontFamily:s.typography.fontFamily,fontSize:s.typography.pxToRem(13),display:"inline-flex",alignItems:"center",justifyContent:"center",height:32,color:(s.vars||s).palette.text.primary,backgroundColor:(s.vars||s).palette.action.selected,borderRadius:32/2,whiteSpace:"nowrap",transition:s.transitions.create(["background-color","box-shadow"]),cursor:"unset",outline:0,textDecoration:"none",border:0,padding:0,verticalAlign:"middle",boxSizing:"border-box",[`&.${j.disabled}`]:{opacity:(s.vars||s).palette.action.disabledOpacity,pointerEvents:"none"},[`& .${j.avatar}`]:{marginLeft:5,marginRight:-6,width:24,height:24,color:s.vars?s.vars.palette.Chip.defaultAvatarColor:v,fontSize:s.typography.pxToRem(12)},[`& .${j.avatarColorPrimary}`]:{color:(s.vars||s).palette.primary.contrastText,backgroundColor:(s.vars||s).palette.primary.dark},[`& .${j.avatarColorSecondary}`]:{color:(s.vars||s).palette.secondary.contrastText,backgroundColor:(s.vars||s).palette.secondary.dark},[`& .${j.avatarSmall}`]:{marginLeft:4,marginRight:-4,width:18,height:18,fontSize:s.typography.pxToRem(10)},[`& .${j.icon}`]:de({marginLeft:5,marginRight:-6},r.size==="small"&&{fontSize:18,marginLeft:4,marginRight:-4},r.iconColor===r.color&&de({color:s.vars?s.vars.palette.Chip.defaultIconColor:v},r.color!=="default"&&{color:"inherit"})),[`& .${j.deleteIcon}`]:de({WebkitTapHighlightColor:"transparent",color:s.vars?`rgba(${s.vars.palette.text.primaryChannel} / 0.26)`:ce(s.palette.text.primary,.26),fontSize:22,cursor:"pointer",margin:"0 5px 0 -6px","&:hover":{color:s.vars?`rgba(${s.vars.palette.text.primaryChannel} / 0.4)`:ce(s.palette.text.primary,.4)}},r.size==="small"&&{fontSize:16,marginRight:4,marginLeft:-4},r.color!=="default"&&{color:s.vars?`rgba(${s.vars.palette[r.color].contrastTextChannel} / 0.7)`:ce(s.palette[r.color].contrastText,.7),"&:hover, &:active":{color:(s.vars||s).palette[r.color].contrastText}})},r.size==="small"&&{height:24},r.color!=="default"&&{backgroundColor:(s.vars||s).palette[r.color].main,color:(s.vars||s).palette[r.color].contrastText},r.onDelete&&{[`&.${j.focusVisible}`]:{backgroundColor:s.vars?`rgba(${s.vars.palette.action.selectedChannel} / calc(${s.vars.palette.action.selectedOpacity} + ${s.vars.palette.action.focusOpacity}))`:ce(s.palette.action.selected,s.palette.action.selectedOpacity+s.palette.action.focusOpacity)}},r.onDelete&&r.color!=="default"&&{[`&.${j.focusVisible}`]:{backgroundColor:(s.vars||s).palette[r.color].dark}})},({theme:s,ownerState:r})=>de({},r.clickable&&{userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:hover":{backgroundColor:s.vars?`rgba(${s.vars.palette.action.selectedChannel} / calc(${s.vars.palette.action.selectedOpacity} + ${s.vars.palette.action.hoverOpacity}))`:ce(s.palette.action.selected,s.palette.action.selectedOpacity+s.palette.action.hoverOpacity)},[`&.${j.focusVisible}`]:{backgroundColor:s.vars?`rgba(${s.vars.palette.action.selectedChannel} / calc(${s.vars.palette.action.selectedOpacity} + ${s.vars.palette.action.focusOpacity}))`:ce(s.palette.action.selected,s.palette.action.selectedOpacity+s.palette.action.focusOpacity)},"&:active":{boxShadow:(s.vars||s).shadows[1]}},r.clickable&&r.color!=="default"&&{[`&:hover, &.${j.focusVisible}`]:{backgroundColor:(s.vars||s).palette[r.color].dark}}),({theme:s,ownerState:r})=>de({},r.variant==="outlined"&&{backgroundColor:"transparent",border:s.vars?`1px solid ${s.vars.palette.Chip.defaultBorder}`:`1px solid ${s.palette.mode==="light"?s.palette.grey[400]:s.palette.grey[700]}`,[`&.${j.clickable}:hover`]:{backgroundColor:(s.vars||s).palette.action.hover},[`&.${j.focusVisible}`]:{backgroundColor:(s.vars||s).palette.action.focus},[`& .${j.avatar}`]:{marginLeft:4},[`& .${j.avatarSmall}`]:{marginLeft:2},[`& .${j.icon}`]:{marginLeft:4},[`& .${j.iconSmall}`]:{marginLeft:2},[`& .${j.deleteIcon}`]:{marginRight:5},[`& .${j.deleteIconSmall}`]:{marginRight:3}},r.variant==="outlined"&&r.color!=="default"&&{color:(s.vars||s).palette[r.color].main,border:`1px solid ${s.vars?`rgba(${s.vars.palette[r.color].mainChannel} / 0.7)`:ce(s.palette[r.color].main,.7)}`,[`&.${j.clickable}:hover`]:{backgroundColor:s.vars?`rgba(${s.vars.palette[r.color].mainChannel} / ${s.vars.palette.action.hoverOpacity})`:ce(s.palette[r.color].main,s.palette.action.hoverOpacity)},[`&.${j.focusVisible}`]:{backgroundColor:s.vars?`rgba(${s.vars.palette[r.color].mainChannel} / ${s.vars.palette.action.focusOpacity})`:ce(s.palette[r.color].main,s.palette.action.focusOpacity)},[`& .${j.deleteIcon}`]:{color:s.vars?`rgba(${s.vars.palette[r.color].mainChannel} / 0.7)`:ce(s.palette[r.color].main,.7),"&:hover, &:active":{color:(s.vars||s).palette[r.color].main}}})),Xs=cs("span",{name:"MuiChip",slot:"Label",overridesResolver:(s,r)=>{const{ownerState:v}=s,{size:o}=v;return[r.label,r[`label${L(o)}`]]}})(({ownerState:s})=>de({overflow:"hidden",textOverflow:"ellipsis",paddingLeft:12,paddingRight:12,whiteSpace:"nowrap"},s.variant==="outlined"&&{paddingLeft:11,paddingRight:11},s.size==="small"&&{paddingLeft:8,paddingRight:8},s.size==="small"&&s.variant==="outlined"&&{paddingLeft:7,paddingRight:7}));function ls(s){return s.key==="Backspace"||s.key==="Delete"}const us=n.forwardRef(function(r,v){const o=Ys({props:r,name:"MuiChip"}),{avatar:p,className:c,clickable:E,color:A="default",component:y,deleteIcon:J,disabled:B=!1,icon:R,label:F,onClick:O,onDelete:k,onKeyDown:z,onKeyUp:u,size:I="medium",variant:W="filled",tabIndex:V,skipFocusWhenDisabled:S=!1}=o,T=qs(o,Hs),ie=n.useRef(null),d=Js(ie,v),_=m=>{m.stopPropagation(),k&&k(m)},b=m=>{m.currentTarget===m.target&&ls(m)&&m.preventDefault(),z&&z(m)},N=m=>{m.currentTarget===m.target&&(k&&ls(m)?k(m):m.key==="Escape"&&ie.current&&ie.current.blur()),u&&u(m)},g=E!==!1&&O?!0:E,H=g||k?rs:y||"div",te=de({},o,{component:H,disabled:B,size:I,color:A,iconColor:n.isValidElement(R)&&R.props.color||A,onDelete:!!k,clickable:g,variant:W}),Z=Zs(te),re=H===rs?de({component:y||"div",focusVisibleClassName:Z.focusVisible},k&&{disableRipple:!0}):{};let ne=null;k&&(ne=J&&n.isValidElement(J)?n.cloneElement(J,{className:Ae(J.props.className,Z.deleteIcon),onClick:_}):e.jsx(Gs,{className:Ae(Z.deleteIcon),onClick:_}));let G=null;p&&n.isValidElement(p)&&(G=n.cloneElement(p,{className:Ae(Z.avatar,p.props.className)}));let me=null;return R&&n.isValidElement(R)&&(me=n.cloneElement(R,{className:Ae(Z.icon,R.props.className)})),e.jsxs(Qs,de({as:H,className:Ae(Z.root,c),disabled:g&&B?!0:void 0,onClick:O,onKeyDown:b,onKeyUp:N,ref:d,tabIndex:S&&B?-1:V,ownerState:te},re,T,{children:[G||me,e.jsx(Xs,{className:Ae(Z.label),ownerState:te,children:F}),ne]}))}),ea=({userId:s})=>{const[r,v]=n.useState(!1),[o,p]=n.useState("create"),[c,E]=n.useState(null),[A,y]=n.useState(!1),[J,B]=n.useState(!1),[R,F]=n.useState([]),[O,k]=n.useState({teachers:[],availableSubclasses:[],section:""}),[z,u]=n.useState(""),[I,W]=n.useState(!1),[V,S]=n.useState(null),[T,ie]=n.useState(""),[d,_]=n.useState([]),[b,N]=n.useState(0),[g,H]=n.useState(5),[te,Z]=n.useState(0),[re,ne]=n.useState([]),[G,me]=n.useState([]),[m,Y]=n.useState([]),[C,Q]=n.useState([]),{data:U,loading:$e,error:Ie,callApi:le}=je(),{data:pe,loading:Be,error:Ge,callApi:Fe}=je(),{data:ge,loading:Ke,error:He,callApi:Oe}=je(),{loading:Re,error:De,callApi:we}=je(),{loading:Ve,error:Ze,callApi:Se}=je(),{data:he,loading:Qe,error:Ue,callApi:ze}=je(),{loading:Ne,error:Xe,callApi:Le}=je();n.useEffect(()=>{(async()=>{try{await Fe(ee.ACADEMIC_YEARS,"GET"),await Oe(ee.SUBJECT,"GET")}catch(l){u(l.message||"Failed to fetch static data")}})()},[Fe,Oe]),n.useEffect(()=>{(pe==null?void 0:pe.status)==="success"&&me(Array.isArray(pe.data)?pe.data:[]),(ge==null?void 0:ge.status)==="success"&&Y(Array.isArray(ge.data)?ge.data:[])},[pe,ge]),n.useEffect(()=>{(async()=>{try{await ze(ee.TEACHERS,"GET")}catch(l){u(l.message||"Failed to fetch teachers")}})()},[ze]),n.useEffect(()=>{(he==null?void 0:he.status)==="success"&&Q(Array.isArray(he.data.data)?he.data.data:[])},[he]),n.useEffect(()=>{const a=new URLSearchParams({page:(b+1).toString(),limit:g.toString(),...T&&{section:T},...d.length>0&&{classLevels:d.join(",")}});(async()=>{try{await le(`${ee.CLASS_LEVEL}?${a.toString()}`,"GET")}catch(t){u(t.message||"Failed to fetch classes")}})()},[le,b,g,T,d]),n.useEffect(()=>{(U==null?void 0:U.status)==="success"&&(ne(Array.isArray(U.data.data)?U.data.data:[]),Z(U.data.totalPages||0))},[U]),n.useEffect(()=>{_([])},[T]),n.useEffect(()=>{b>=te&&te>0&&N(0)},[b,te,T,d]);const[D,X]=n.useState({section:"Primary",name:"",description:"",academicYear:"",subclasses:[],teachers:[]});n.useEffect(()=>{G.length>0&&!D.academicYear&&o==="create"&&X(a=>{var l;return{...a,academicYear:((l=G.find(t=>t.isCurrent))==null?void 0:l._id)||""}})},[G,D,o]);const oe=n.useMemo(()=>{const a="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");if(!c||!Array.isArray(c.subclasses))return a;const l=c.subclasses.map(t=>t.letter);return a.filter(t=>!l.includes(t))},[c]),es=n.useMemo(()=>{var l;if(!c||!Array.isArray(C))return[];const a=((l=c.teachers)==null?void 0:l.map(t=>t.teacherId.toString()))||[];return C.filter(t=>t._id&&!a.includes(t._id.toString()))},[C,c]),ue=n.useMemo(()=>!c||!m?[]:m.filter(a=>{var l;return(l=c.subjects)==null?void 0:l.some(t=>t.toString()===a._id.toString())}),[c,m]),ss=n.useCallback(()=>{var a,l;if(c){const t=["JSS","SS"].includes(c.section);k({teachers:((a=c.teachers)==null?void 0:a.map(i=>({teacherId:i.teacherId,firstName:i.firstName,lastName:i.lastName,assignments:t?c.subclasses.flatMap(h=>h.subjects.filter(x=>{var f;return(f=x.teachers)==null?void 0:f.includes(i.teacherId)}).map(x=>({subclassLetter:h.letter,subjectId:x.subject}))):[]})))||[],availableSubclasses:((l=c.subclasses)==null?void 0:l.map(i=>i.letter))||[],section:c.section}),y(!0)}else u("No class selected for teacher assignment")},[c]);n.useCallback(()=>{F([]),B(!0)},[]);const Pe=n.useCallback((a,l=null)=>{var t,i,h;if(p(a),E(l),a==="create")X({section:"Primary",name:"",description:"",academicYear:((t=G.find(x=>x.isCurrent))==null?void 0:t._id)||"",subclasses:[],teachers:[]});else if(l){const x=((i=l.teachers)==null?void 0:i.map(f=>({teacherId:f.teacherId||f._id,firstName:f.firstName,lastName:f.lastName})))||[];X({section:l.section||"Primary",name:l.name||"",description:l.description||"",academicYear:((h=l.academicYear)==null?void 0:h._id)||l.academicYear||"",subclasses:l.subclasses||[],teachers:x}),F([])}v(!0)},[G]),We=n.useCallback(a=>{S(a),W(!0)},[]),Ye=n.useCallback(()=>{S(null),W(!1)},[]),$=n.useCallback(async()=>{if(!V||!s){u("User not authenticated or no class selected for deletion");return}try{const a=await Se(`${ee.CLASS_LEVEL}/${V._id}`,"DELETE");if((a==null?void 0:a.status)==="success"){const l=new URLSearchParams({page:(b+1).toString(),limit:g.toString(),...T&&{section:T},...d.length>0&&{classLevels:d.join(",")}});await le(`${ee.CLASS_LEVEL}?${l.toString()}`,"GET"),u(""),Ye()}else u("Failed to delete class")}catch(a){u(a.message||"Failed to delete class")}},[V,s,Se,le,b,g,T,d]),K=n.useCallback(a=>{const{name:l,value:t}=a.target;X(i=>({...i,[l]:t}))},[]),Ce=n.useCallback((a,l,t,i=!1)=>{if(l==="letter"&&i&&!oe.includes(t)){u("Selected subclass letter is already in use or invalid");return}i?F(h=>{const x=[...h];return x[a]={...x[a],[l]:t},x}):X(h=>{const x=[...h.subclasses];return x[a]={...x[a],[l]:t},{...h,subclasses:x}})},[oe]),qe=n.useCallback((a,l,t,i,h=!1)=>{h?F(x=>{const f=[...x],q=[...f[a].feesPerTerm];return q[l]={...q[l],[t]:t==="amount"?parseFloat(i)||0:i},f[a]={...f[a],feesPerTerm:q},f}):X(x=>{const f=[...x.subclasses],q=[...f[a].feesPerTerm];return q[l]={...q[l],[t]:t==="amount"?parseFloat(i)||0:i},f[a]={...f[a],feesPerTerm:q},{...x,subclasses:f}})},[]),ms=n.useCallback((a=!1)=>{if(a&&oe.length===0){u("No available subclass letters");return}const l={letter:a&&oe[0]||"",feesPerTerm:[{termName:"1st Term",amount:0,description:""}]};a?F(t=>[...t,l]):X(t=>({...t,subclasses:[...t.subclasses,l]}))},[oe]),ps=n.useCallback((a,l=!1)=>{l?F(t=>{const i=[...t],x=["1st Term","2nd Term","3rd Term"].filter(f=>!i[a].feesPerTerm.some(q=>q.termName===f))[0]||`${i[a].feesPerTerm.length+1}st Term`;return i[a]={...i[a],feesPerTerm:[...i[a].feesPerTerm,{termName:x,amount:0,description:""}]},i}):X(t=>{const i=[...t.subclasses],x=["1st Term","2nd Term","3rd Term"].filter(f=>!i[a].feesPerTerm.some(q=>q.termName===f))[0]||`${i[a].feesPerTerm.length+1}st Term`;return i[a]={...i[a],feesPerTerm:[...i[a].feesPerTerm,{termName:x,amount:0,description:""}]},{...t,subclasses:i}})},[]),gs=n.useCallback((a,l,t=!1)=>{t?F(i=>{const h=[...i];return h[a]={...h[a],feesPerTerm:h[a].feesPerTerm.filter((x,f)=>f!==l)},h}):X(i=>{const h=[...i.subclasses];return h[a]={...h[a],feesPerTerm:h[a].feesPerTerm.filter((x,f)=>f!==l)},{...i,subclasses:h}})},[]),hs=n.useCallback((a,l=!1)=>{l?F(t=>t.filter((i,h)=>h!==a)):X(t=>({...t,subclasses:t.subclasses.filter((i,h)=>h!==a)}))},[]),bs=n.useCallback(async a=>{if(!a||!s)return u("User not authenticated or no class selected"),!1;if(!R.every(t=>t.letter.match(/^[A-Z]$/)))return u("All subclasses must have a single capital letter selected"),!1;if(!R.every(t=>oe.includes(t.letter)))return u("One or more selected subclass letters are already in use"),!1;if(!R.every(t=>t.feesPerTerm.every(i=>i.termName&&i.amount>=0)))return u("All subclass fees must have a term name and a valid amount"),!1;const l=R.map(t=>t.letter);if(new Set(l).size!==l.length)return u("Subclass letters must be unique within new subclasses"),!1;try{for(const i of R){const h={letter:i.letter,feesPerTerm:i.feesPerTerm};await Le(`${ee.CLASS_LEVEL}/${a}/add-subclass`,"POST",h)}const t=new URLSearchParams({page:(b+1).toString(),limit:g.toString(),...T&&{section:T},...d.length>0&&{classLevels:d.join(",")}});return await le(`${ee.CLASS_LEVEL}?${t.toString()}`,"GET"),B(!1),F([]),u(""),v(!1),!0}catch(t){return u(t.message||"Failed to add subclasses"),!1}},[R,s,Le,le,b,g,T,d,oe]),fs=n.useCallback(a=>{if(!a)return;const l=C.find(i=>i._id.toString()===a.toString());if(!l){u("Selected teacher not found");return}const t=(c==null?void 0:c.section)&&["JSS","SS"].includes(c.section.split(" ")[0]);k(i=>({...i,teachers:[...i.teachers,{teacherId:a,firstName:l.firstName,lastName:l.lastName,assignments:t?[]:void 0}]}))},[C,c]),xs=n.useCallback(a=>{if(!ue||ue.length===0){u("No subjects available for this class");return}k(l=>{const t=l.teachers.map(i=>{if(i.teacherId===a){const h=i.assignments.map(f=>f.subjectId),x=ue.find(f=>!h.includes(f._id));return x?{...i,assignments:[...i.assignments,{subclassLetter:l.availableSubclasses[0]||"",subjectId:x._id}]}:(u("No more subjects available to add for this teacher"),i)}return i});return{...l,teachers:t}})},[ue]),Ss=n.useCallback((a,l)=>{k(t=>{const i=t.teachers.map(h=>h.teacherId===a?{...h,assignments:h.assignments.filter((x,f)=>f!==l)}:h);return{...t,teachers:i}})},[]),Cs=n.useCallback((a,l,t,i)=>{k(h=>{const x=h.section&&["JSS","SS"].includes(h.section.split(" ")[0]);let f=[...h.teachers];return x&&typeof a=="string"&&l!==void 0&&t?f=f.map(q=>{if(q.teacherId===a){const ve=[...q.assignments];return ve[l]={...ve[l],[t]:i},{...q,assignments:ve}}return q}):!x&&Array.isArray(a)&&(f=a.map(q=>{const ve=C.find(Ps=>Ps._id.toString()===q.toString());return ve?{teacherId:q,firstName:ve.firstName,lastName:ve.lastName}:null}).filter(q=>q!==null)),{...h,teachers:f}})},[C]),vs=n.useCallback(async()=>{if(!c||!s){u("User not authenticated or no class selected");return}const a=["JSS","SS"].includes(c.section);if(a&&!O.teachers.some(l=>{var t;return((t=l.assignments)==null?void 0:t.length)>0})){u("At least one teacher must be assigned subjects for JSS/SS classes");return}if(a)for(const l of O.teachers)for(const t of l.assignments||[]){if(!t.subclassLetter||!O.availableSubclasses.includes(t.subclassLetter)){u("All assignments must have a valid subclass letter");return}if(!t.subjectId||!ue.some(i=>i._id.toString()===t.subjectId.toString())){u("All assigned subjects must belong to the class level");return}}try{const l={classId:c._id,teachers:O.teachers.map(i=>({teacherId:i.teacherId,firstName:i.firstName,lastName:i.lastName,assignments:a?i.assignments:void 0}))},t=await we(`${ee.CLASS_LEVEL}/${c._id}/assign-teachers`,"PATCH",l);if((t==null?void 0:t.status)==="success"){const i=new URLSearchParams({page:(b+1).toString(),limit:g.toString(),...T&&{section:T},...d.length>0&&{classLevels:d.join(",")}});await le(`${ee.CLASS_LEVEL}?${i.toString()}`,"GET"),y(!1),u("")}else u("Failed to assign teachers")}catch(l){u(l.message||"Failed to assign teachers")}},[c,s,O,we,le,b,g,T,d,ue]),js=n.useCallback(a=>{_(a),N(0)},[]),ys=n.useCallback(a=>{const l=a.map(t=>{const i=C.find(h=>h._id.toString()===t.toString());return i?{teacherId:t,firstName:i.firstName,lastName:i.lastName}:null}).filter(t=>t!==null);X(t=>({...t,teachers:l}))},[C]),as=n.useCallback(()=>{var a;if(!s)return"User not authenticated. Please log in.";if(!D.section)return"Section is required";if(!D.name)return"Class name is required";if(!D.academicYear)return"Academic year is required";if(D.subclasses.length>0){if(!D.subclasses.every(t=>t.letter.match(/^[A-Z]$/)))return"All subclasses must have a single capital letter selected";if(!D.subclasses.every(t=>t.feesPerTerm.every(i=>i.termName&&i.amount>=0)))return"All subclass fees must have a term name and a valid amount";const l=D.subclasses.map(t=>t.letter);if(new Set(l).size!==l.length)return"Subclass letters must be unique";if(o==="edit"&&c){const t=((a=c.subclasses)==null?void 0:a.map(i=>i.letter))||[];if(D.subclasses.some(i=>t.includes(i.letter)))return"One or more subclass letters are already in use"}}return D.teachers.length>0&&!D.teachers.every(l=>l.teacherId&&l.firstName&&l.lastName&&C.some(t=>t._id.toString()===l.teacherId.toString()))?"All teachers must have valid ID, first name, last name, and exist in the system":""},[D,s,C,o,c]),Ts=n.useCallback(async()=>{const a=as();if(a){u(a);return}const l={section:D.section,name:D.name,description:D.description,academicYear:D.academicYear,teachers:D.teachers,subclasses:D.subclasses,createdBy:s};try{let t;if(o==="create"?t=await Se(ee.CLASS_LEVEL,"POST",l):o==="edit"&&(t=await Se(`${ee.CLASS_LEVEL}/${c._id}`,"PATCH",l)),(t==null?void 0:t.status)==="success"){const i=new URLSearchParams({page:(b+1).toString(),limit:g.toString(),...T&&{section:T},...d.length>0&&{classLevels:d.join(",")}});await le(`${ee.CLASS_LEVEL}?${i.toString()}`,"GET"),v(!1),u("")}else u("Failed to process class submission")}catch(t){u(t.message||"Failed to process request")}},[o,D,c,Se,as,s,le,b,g,T,d]),$s=n.useMemo(()=>Array.isArray(re)?re.map((a,l)=>{var t,i,h,x;return{...a,sn:l+1+b*g,displayName:a.name,studentsCount:((t=a.students)==null?void 0:t.length)||0,teachersCount:((i=a.teachers)==null?void 0:i.length)||0,academicYearName:((h=G.find(f=>f._id===a.academicYear))==null?void 0:h._id)||"N/A",subclassesCount:((x=a.subclasses)==null?void 0:x.length)||0}}):[],[re,G,b,g]);return{tableProps:{columns:n.useMemo(()=>[{id:"sn",label:"S/N",width:90},{id:"displayName",label:"Class Name",flex:1,renderCell:a=>a.displayName},{id:"studentsCount",label:"Students",flex:1,renderCell:a=>a.studentsCount},{id:"teachersCount",label:"Teachers",flex:1,renderCell:a=>a.teachersCount},{id:"subclassesCount",label:"Subclasses",flex:1,renderCell:a=>a.subclassesCount},{id:"actions",label:"Actions",flex:1,renderCell:a=>e.jsxs(e.Fragment,{children:[e.jsx(ae,{icon:e.jsx(Je,{}),title:"View Class",onClick:()=>Pe("view",a),sx:{mx:.5}}),e.jsx(ae,{icon:e.jsx(is,{}),title:"Edit Class",onClick:()=>Pe("edit",a),sx:{mx:.5}}),e.jsx(ae,{icon:e.jsx(Ds,{}),title:"Delete Class",onClick:()=>We(a),sx:{mx:.5}})]})}],[Pe,We]),tableHeader:"Class Management",data:$s,sortBy:"displayName",sortDirection:"asc",onSortChange:()=>{},hiddenColumnsSmallScreen:["description"],hiddenColumnsTabScreen:[],academicYears:G},modalOpen:r,setModalOpen:v,modalMode:o,setModalMode:p,formData:D,setFormData:X,handleFormChange:K,handleSubclassChange:Ce,handleSubclassFeesChange:qe,addSubclass:ms,addSubclassTermFee:ps,removeSubclassTermFee:gs,removeSubclass:hs,handleTeacherChange:ys,handleSubmit:Ts,error:Ie||Ge||He||Ze||De||Ue||Xe||z,loading:$e||Be||Ke||Ve||Re||Qe||Ne,openModal:Pe,academicYears:G,classLevels:re,subjects:m,allTeachers:C,availableTeachers:es,availableSubclassLetters:oe,selectedClass:c,deleteConfirmOpen:I,classToDelete:V,handleDelete:$,closeDeleteConfirm:Ye,loadingSubmit:Ve,sectionFilter:T,setSectionFilter:ie,classLevelsFilter:d,setClassLevelsFilter:_,handleClassLevelsFilterChange:js,page:b,setPage:N,rowsPerPage:g,setRowsPerPage:H,totalPages:te,assignTeachersModalOpen:A,setAssignTeachersModalOpen:y,assignTeachersFormData:O,handleTeacherSelect:fs,handleAssignTeachersChange:Cs,handleAssignTeachers:vs,handleAddSubjectToTeacher:xs,handleRemoveSubjectFromTeacher:Ss,openAssignTeachersModal:ss,loadingAssignTeachers:Re,subclassesModalOpen:J,setSubclassesModalOpen:B,newSubclasses:R,handleAddSubclasses:bs,loadingAddSubclass:Ne,classLevelSubjects:ue}},sa=Array.from({length:26},(s,r)=>String.fromCharCode(65+r)),aa=({open:s,onClose:r,title:v,modalMode:o,setModalMode:p,formData:c,handleFormChange:E,handleSubclassChange:A,handleSubclassFeesChange:y,addSubclass:J,addSubclassTermFee:B,removeSubclassTermFee:R,removeSubclass:F,handleTeacherChange:O,setStudentsModalOpen:k,setTeachersModalOpen:z,setFeesModalOpen:u,setAssignTeachersModalOpen:I,setSubclassesModalOpen:W,handleSubmit:V,error:S,loadingSubmit:T,academicYears:ie,usersData:d,subjects:_,colors:b,theme:N})=>{const g=o==="view",H=o==="delete",te=o==="edit",Z=o==="create",re=["Kindergarten","Reception","Nursery 1","Nursery 2","Primary 1","Primary 2","Primary 3","Primary 4","Primary 5","Primary 6"],ne=["JSS 1","JSS 2","JSS 3","SS 1","SS 2","SS 3"],G=c.section==="Primary"?re:ne,me=m=>{const Y=d.teachers.find(C=>C._id.toString()===m.toString());return Y?`${Y.firstName} ${Y.lastName}`:"Unknown"};return e.jsx(ke,{open:s,onClose:r,title:v,onConfirm:V,confirmMessage:H?"Confirm Delete":"Save",cancelMessage:"Cancel",noConfirm:g,styleProps:{padding:N.spacing(3)},children:H?e.jsxs(M,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(P,{variant:"h6",color:"error",children:"Confirm Deletion"}),e.jsxs(P,{children:["Are you sure you want to delete the class ",e.jsx("strong",{children:c.name}),"? This action cannot be undone."]}),S&&e.jsx(P,{color:"error",children:S})]}):e.jsxs(M,{component:"form",sx:{display:"flex",flexDirection:"column",gap:2},children:[g&&e.jsx(ye,{icon:e.jsx(is,{}),content:"Edit",onClick:()=>p("edit"),sx:{alignSelf:"flex-start",mb:2}}),e.jsxs(se,{label:"Section",name:"section",value:c.section,onChange:m=>{E(m),E({target:{name:"name",value:""}})},fullWidth:!0,disabled:g,required:!0,children:[e.jsx(w,{value:"Primary",children:"Primary"}),e.jsx(w,{value:"Secondary",children:"Secondary"})]}),e.jsxs(se,{label:"Class Name",name:"name",value:c.name,onChange:E,fullWidth:!0,disabled:g||!c.section,required:!0,children:[e.jsx(w,{value:"",disabled:!0,children:"Select a class"}),G.map(m=>e.jsx(w,{value:m,children:m},m))]}),e.jsxs(se,{label:"Academic Year",name:"academicYear",value:c.academicYear,onChange:E,fullWidth:!0,disabled:g,required:!0,children:[e.jsx(w,{value:"",disabled:!0,children:"Select an academic year"}),ie.map(m=>e.jsx(w,{value:m._id,children:m.name},m._id))]}),e.jsx(be,{label:"Description",name:"description",value:c.description,onChange:E,fullWidth:!0,disabled:g,multiline:!0,rows:3}),e.jsxs(fe,{fullWidth:!0,children:[e.jsx(xe,{children:"Teachers"}),e.jsx(se,{multiple:!0,value:c.teachers.map(m=>m.teacherId),onChange:m=>O(m.target.value),disabled:g,renderValue:m=>e.jsx(M,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:m.map(Y=>{var C;return e.jsx(us,{avatar:e.jsx(_e,{src:((C=d.teachers.find(Q=>Q._id===Y))==null?void 0:C.profilePictureUrl)||""}),label:me(Y)},Y)})}),children:d.teachers.length>0?d.teachers.map(m=>e.jsx(w,{value:m._id,sx:{display:"flex",alignItems:"center"},children:e.jsxs(M,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(_e,{src:m.profilePictureUrl||"",alt:`${m.firstName} ${m.lastName}`,sx:{width:32,height:32}}),e.jsx(P,{variant:"body1",children:`${m.firstName} ${m.lastName}`})]})},m._id)):e.jsx(w,{disabled:!0,children:"No teachers available"})})]}),Z&&e.jsxs(e.Fragment,{children:[e.jsx(P,{variant:"subtitle1",sx:{mt:2},children:"Subclasses"}),c.subclasses.map((m,Y)=>e.jsxs(M,{sx:{border:`1px solid ${b.grey[500]}`,p:2,mb:2},children:[e.jsxs(M,{sx:{display:"flex",gap:2,alignItems:"center",mb:2},children:[e.jsxs(fe,{fullWidth:!0,children:[e.jsx(xe,{children:"Subclass Letter"}),e.jsxs(se,{value:m.letter,onChange:C=>A(Y,"letter",C.target.value),required:!0,disabled:g,children:[e.jsx(w,{value:"",disabled:!0,children:"Select a letter"}),sa.filter(C=>!c.subclasses.some((Q,U)=>Q.letter===C&&U!==Y)).map(C=>e.jsx(w,{value:C,children:C},C))]})]}),e.jsx(ae,{icon:e.jsx(Ee,{}),title:"Remove Subclass",onClick:()=>F(Y)})]}),e.jsx(P,{variant:"subtitle2",children:"Fees Per Term"}),m.feesPerTerm.map((C,Q)=>e.jsxs(M,{sx:{display:"flex",gap:2,alignItems:"center",mt:1},children:[e.jsx(se,{label:"Term Name",value:C.termName,onChange:U=>y(Y,Q,"termName",U.target.value),required:!0,disabled:g,children:["1st Term","2nd Term","3rd Term"].filter(U=>!m.feesPerTerm.some($e=>$e.termName===U&&$e!==C)).map(U=>e.jsx(w,{value:U,children:U},U))}),e.jsx(be,{label:"Amount",type:"number",value:C.amount,onChange:U=>y(Y,Q,"amount",U.target.value),required:!0,disabled:g}),e.jsx(be,{label:"Description",value:C.description,onChange:U=>y(Y,Q,"description",U.target.value),disabled:g}),e.jsx(ae,{icon:e.jsx(Ee,{}),title:"Remove Term Fee",onClick:()=>R(Y,Q),disabled:m.feesPerTerm.length===1||g})]},Q)),e.jsx(ae,{icon:e.jsx(Te,{}),title:"Add Term Fee",onClick:()=>B(Y),sx:{mt:1},disabled:g})]},Y)),e.jsx(ae,{icon:e.jsx(Te,{}),title:"Add Subclass",onClick:()=>J(),sx:{mt:1},disabled:c.subclasses.length>=26})]}),te&&e.jsx(ye,{icon:e.jsx(Te,{}),content:"Add Subclasses",onClick:W,sx:{mt:2}}),g&&e.jsxs(M,{sx:{display:"flex",gap:2,mt:2},children:[e.jsx(ye,{icon:e.jsx(Je,{}),content:"View Students",onClick:()=>k(!0),sx:{mx:.5}}),e.jsx(ye,{icon:e.jsx(Je,{}),content:"View Teachers",onClick:()=>z(!0),sx:{mx:.5}}),e.jsx(ye,{icon:e.jsx(Je,{}),content:"View Fees",onClick:()=>u(!0),sx:{mx:.5}}),e.jsx(ye,{icon:e.jsx(Vs,{}),content:"Assign Teachers",onClick:()=>I(!0),sx:{mx:.5}})]}),S&&e.jsx(P,{color:"error",children:S}),T&&!H&&e.jsx(P,{children:"Processing..."})]})})},ta=({open:s,onClose:r,students:v,theme:o})=>e.jsx(ke,{open:s,onClose:r,title:"Students",noConfirm:!0,styleProps:{padding:o.spacing(3)},children:v.length>0?e.jsx(ds,{children:v.map(p=>e.jsx(ns,{children:e.jsx(os,{primary:`${p.firstName} ${p.lastName}`,secondary:`Email: ${p.email}${p.phone?` | Phone: ${p.phone}`:""}`})},p._id))}):e.jsx(P,{children:"No students assigned to this class."})}),ra=({open:s,onClose:r,teachers:v,theme:o})=>e.jsx(ke,{open:s,onClose:r,title:"Teachers",noConfirm:!0,styleProps:{padding:o.spacing(3)},children:v.length>0?e.jsx(ds,{children:v.map(p=>e.jsx(ns,{children:e.jsxs(M,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(_e,{src:p.profilePictureUrl||"",alt:`${p.firstName} ${p.lastName}`,sx:{width:32,height:32}}),e.jsx(os,{primary:`${p.firstName} ${p.lastName}`,secondary:`Email: ${p.email}${p.phone?` | Phone: ${p.phone}`:""}`})]})},p._id||p.teacherId))}):e.jsx(P,{children:"No teachers assigned to this class."})}),la=({open:s,onClose:r,formData:v,handleSubclassFeesChange:o,addSubclassTermFee:p,removeSubclassTermFee:c,handleSubmit:E,isViewMode:A,setIsViewMode:y,error:J,colors:B,theme:R})=>e.jsx(ke,{open:s,onClose:r,title:"View Fees",onConfirm:E,confirmMessage:"Save",noConfirm:A,styleProps:{padding:R.spacing(3)},children:e.jsxs(M,{sx:{display:"flex",flexDirection:"column",gap:2},children:[v.subclasses.map((F,O)=>e.jsxs(M,{sx:{border:`1px solid ${B.grey[500]}`,p:2,mt:2},children:[e.jsxs(P,{variant:"subtitle1",children:["Subclass ",F.letter," Fees"]}),F.feesPerTerm.map((k,z)=>e.jsxs(M,{sx:{display:"flex",gap:2,alignItems:"center",mt:1},children:[e.jsx(be,{label:"Term Name",value:k.termName,onChange:u=>o(O,z,"termName",u.target.value),disabled:A,required:!0}),e.jsx(be,{label:"Amount",type:"number",value:k.amount,onChange:u=>o(O,z,"amount",parseFloat(u.target.value)),disabled:A,required:!0}),e.jsx(be,{label:"Description",value:k.description,onChange:u=>o(O,z,"description",u.target.value),disabled:A}),!A&&e.jsx(ae,{icon:e.jsx(Ee,{}),title:"Remove Term Fee",onClick:()=>c(O,z),disabled:F.feesPerTerm.length===1})]},z)),!A&&e.jsx(ae,{icon:e.jsx(Te,{}),title:"Add Subclass Term Fee",onClick:()=>p(O),sx:{mt:1}})]},O)),J&&e.jsx(P,{color:"error",children:J})]})}),ia=({open:s,onClose:r,classId:v,formData:o,usersData:p,subjects:c,classLevelSubjects:E,handleTeacherSelect:A,handleAssignTeachersChange:y,handleAssignTeachers:J,handleAddSubjectToTeacher:B,handleRemoveSubjectFromTeacher:R,error:F,loading:O,theme:k,selectedClass:z})=>{const u=z&&(z.name.includes("JSS")||z.name.includes("SS")),[I,W]=n.useState(""),V=d=>{const _=p.teachers.find(b=>b._id.toString()===d.toString());return _?`${_.firstName} ${_.lastName}`:"Unknown"},S=d=>{const _=c.find(b=>b._id.toString()===d.toString());return _?_.name:"Unknown"},T=p.teachers.filter(d=>!o.teachers.some(_=>_.teacherId===d._id)),ie=d=>{const _=d.target.value;_&&(A(_),W(""))};return e.jsx(ke,{open:s,onClose:r,title:"Assign Teachers",onConfirm:J,confirmMessage:"Assign",cancelMessage:"Cancel",styleProps:{padding:k.spacing(3)},children:e.jsxs(M,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(fe,{fullWidth:!0,sx:{mb:2},children:[e.jsx(xe,{children:"Select Teacher"}),e.jsxs(se,{value:I,onChange:ie,label:"Select Teacher",children:[e.jsx(w,{value:"",disabled:!0,children:"Select a teacher"}),T.length>0?T.map(d=>e.jsx(w,{value:d._id,sx:{display:"flex",alignItems:"center"},children:e.jsxs(M,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(_e,{src:d.profilePictureUrl||"",alt:`${d.firstName} ${d.lastName}`,sx:{width:32,height:32}}),e.jsx(P,{variant:"body1",children:`${d.firstName} ${d.lastName}`})]})},d._id)):e.jsx(w,{disabled:!0,children:"No available teachers"})]})]}),u?e.jsx(e.Fragment,{children:o.teachers.length>0?o.teachers.map((d,_)=>e.jsxs(M,{sx:{border:`1px solid ${k.palette.divider}`,p:2,mb:2},children:[e.jsxs(M,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(P,{variant:"subtitle1",children:V(d.teacherId)}),e.jsx(Me,{variant:"outlined",color:"error",onClick:()=>y(o.teachers.filter(b=>b.teacherId!==d.teacherId).map(b=>b.teacherId)),children:"Remove Teacher"})]}),e.jsx(P,{variant:"subtitle2",sx:{mt:1},children:"Assign Subjects for Subclasses"}),E.length===0?e.jsx(P,{color:"error",children:"No subjects assigned to this class. Add subjects in the class settings."}):o.availableSubclasses.length===0?e.jsx(P,{color:"error",children:"No subclasses defined for this class. Add subclasses first."}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{variant:"outlined",onClick:()=>B(d.teacherId),sx:{mb:2},disabled:!E.length||!o.availableSubclasses.length,children:"Add Subject"}),d.assignments&&d.assignments.length>0?d.assignments.map((b,N)=>e.jsxs(M,{sx:{mb:2},children:[e.jsxs(fe,{fullWidth:!0,sx:{mt:1},children:[e.jsx(xe,{children:"Subclass"}),e.jsx(se,{value:b.subclassLetter||"",onChange:g=>y(d.teacherId,N,"subclassLetter",g.target.value),children:o.availableSubclasses.map(g=>e.jsx(w,{value:g,children:g},g))})]}),e.jsxs(fe,{fullWidth:!0,sx:{mt:1},children:[e.jsx(xe,{children:"Subject"}),e.jsx(se,{value:b.subjectId||"",onChange:g=>y(d.teacherId,N,"subjectId",g.target.value),renderValue:g=>S(g),children:E.map(g=>e.jsx(w,{value:g._id,children:g.name},g._id))})]}),e.jsx(Me,{variant:"outlined",color:"error",onClick:()=>R(d.teacherId,N),sx:{mt:1},children:"Remove Subject"})]},N)):e.jsx(P,{children:"No subjects assigned to this teacher."})]})]},_)):e.jsx(P,{children:"No teachers selected. Please select a teacher to assign subjects."})}):e.jsxs(M,{children:[e.jsx(P,{children:"Assigned Teachers:"}),o.teachers.length>0?e.jsx(M,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:o.teachers.map(d=>{var _;return e.jsx(us,{avatar:e.jsx(_e,{src:((_=p.teachers.find(b=>b._id===d.teacherId))==null?void 0:_.profilePictureUrl)||""}),label:V(d.teacherId),onDelete:()=>y(o.teachers.filter(b=>b.teacherId!==d.teacherId).map(b=>b.teacherId))},d.teacherId)})}):e.jsx(P,{children:"No teachers assigned."})]}),F&&e.jsx(P,{color:"error",children:F}),O&&e.jsx(P,{children:"Assigning..."})]})})},na=({availableSubclassLetters:s,open:r,onClose:v,newSubclasses:o,handleSubclassChange:p,handleSubclassFeesChange:c,addSubclass:E,addSubclassTermFee:A,removeSubclassTermFee:y,removeSubclass:J,handleAddSubclasses:B,classId:R,error:F,loading:O,colors:k,theme:z})=>e.jsx(ke,{open:r,onClose:v,title:"Add Subclasses",onConfirm:()=>B(R),confirmMessage:"Add Subclasses",cancelMessage:"Cancel",styleProps:{padding:z.spacing(3)},children:e.jsxs(M,{sx:{display:"flex",flexDirection:"column",gap:2},children:[o.map((u,I)=>e.jsxs(M,{sx:{border:`1px solid ${k.grey[500]}`,p:2,mb:2},children:[e.jsxs(M,{sx:{display:"flex",gap:2,alignItems:"center",mb:2},children:[e.jsxs(fe,{fullWidth:!0,children:[e.jsx(xe,{children:"Subclass Letter"}),e.jsxs(se,{value:u.letter,onChange:W=>p(I,"letter",W.target.value,!0),required:!0,children:[e.jsx(w,{value:"",disabled:!0,children:"Select a letter"}),s.map(W=>e.jsx(w,{value:W,disabled:o.some((V,S)=>V.letter===W&&S!==I),children:W},W))]})]}),e.jsx(ae,{icon:e.jsx(Ee,{}),title:"Remove Subclass",onClick:()=>J(I,!0)})]}),e.jsx(P,{variant:"subtitle2",children:"Fees Per Term"}),u.feesPerTerm.map((W,V)=>e.jsxs(M,{sx:{display:"flex",gap:2,alignItems:"center",mt:1},children:[e.jsx(se,{label:"Term Name",value:W.termName,onChange:S=>c(I,V,"termName",S.target.value,!0),required:!0,children:["1st Term","2nd Term","3rd Term"].filter(S=>!u.feesPerTerm.some(T=>T.termName===S&&T!==W)).map(S=>e.jsx(w,{value:S,children:S},S))}),e.jsx(be,{label:"Amount",type:"number",value:W.amount,onChange:S=>c(I,V,"amount",S.target.value,!0),required:!0}),e.jsx(be,{label:"Description",value:W.description,onChange:S=>c(I,V,"description",S.target.value,!0)}),e.jsx(ae,{icon:e.jsx(Ee,{}),title:"Remove Term Fee",onClick:()=>y(I,V,!0),disabled:u.feesPerTerm.length===1})]},V)),e.jsx(ae,{icon:e.jsx(Te,{}),title:"Add Term Fee",onClick:()=>A(I,!0),sx:{mt:1}})]},I)),e.jsx(ae,{icon:e.jsx(Te,{}),title:"Add Subclass",onClick:()=>E(!0),sx:{mt:1},disabled:o.length>=26}),F&&e.jsx(P,{color:"error",children:F}),O&&e.jsx(P,{children:"Adding..."})]})});function oa(s){const{children:r,value:v,index:o,...p}=s;return e.jsx("div",{role:"tabpanel",hidden:v!==o,id:`academic-year-tabpanel-${o}`,"aria-labelledby":`academic-year-tab-${o}`,...p,children:v===o&&e.jsx(M,{sx:{p:3},children:r})})}const ca=()=>{const s=Bs(),r=ks(s.palette.mode),{usersData:v}=ts($=>$.adminData),o=ts($=>{var K;return(K=$.users.user)==null?void 0:K._id}),{tableProps:p,loadingAddSubclass:c,modalOpen:E,setModalOpen:A,modalMode:y,setModalMode:J,formData:B,handleFormChange:R,handleSubclassChange:F,handleSubclassFeesChange:O,addSubclass:k,addSubclassTermFee:z,removeSubclassTermFee:u,removeSubclass:I,handleTeacherChange:W,handleSubmit:V,error:S,loading:T,openModal:ie,academicYears:d,subjects:_,allTeachers:b,selectedClass:N,deleteConfirmOpen:g,classToDelete:H,handleDelete:te,closeDeleteConfirm:Z,loadingSubmit:re,sectionFilter:ne,setSectionFilter:G,classLevelsFilter:me,handleClassLevelsFilterChange:m,page:Y,setPage:C,rowsPerPage:Q,setRowsPerPage:U,totalPages:$e,assignTeachersModalOpen:Ie,setAssignTeachersModalOpen:le,assignTeachersFormData:pe,handleTeacherSelect:Be,handleAssignTeachersChange:Ge,handleAssignTeachers:Fe,handleAddSubjectToTeacher:ge,handleRemoveSubjectFromTeacher:Ke,openAssignTeachersModal:He,loadingAssignTeachers:Oe,subclassesModalOpen:Re,setSubclassesModalOpen:De,newSubclasses:we,handleAddSubclasses:Ve,setClassLevelsFilter:Ze,availableSubclassLetters:Se,classLevelSubjects:he}=ea({userId:o}),[Qe,Ue]=n.useState(!1),[ze,Ne]=n.useState(!1),[Xe,Le]=n.useState(!1),[D,X]=n.useState(0),oe=N!=null&&N.students?v.students.filter($=>N.students.some(K=>K.toString()===$._id)):[],es=N!=null&&N.teachers?b.filter($=>N.teachers.some(K=>{var Ce;return((Ce=K.teacherId)==null?void 0:Ce.toString())===$._id||K.toString()===$._id})):[],ue=ne==="Primary"?["Kindergarten","Reception","Nursery 1","Nursery 2","Primary 1","Primary 2","Primary 3","Primary 4","Primary 5","Primary 6"]:ne==="Secondary"?["JSS 1","JSS 2","JSS 3","SS 1","SS 2","SS 3"]:["Kindergarten","Reception","Nursery 1","Nursery 2","Primary 1","Primary 2","Primary 3","Primary 4","Primary 5","Primary 6","JSS 1","JSS 2","JSS 3","SS 1","SS 2","SS 3"],ss=()=>{Le(!0)},Pe=($,K)=>{X(K),C(0),Ze([])},We=($,K)=>{C(K)},Ye=$=>{U(parseInt($.target.value,10)),C(0)};return e.jsxs(M,{children:[e.jsx(Es,{title:"Class Management",subtitle:"Manage class levels and their details"}),e.jsxs(M,{sx:{mt:3,mb:3},children:[e.jsxs(M,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(ye,{icon:e.jsx(Te,{}),content:"Add Class",onClick:()=>ie("create")}),e.jsxs(fe,{sx:{minWidth:120},children:[e.jsx(xe,{children:"Section"}),e.jsxs(se,{value:ne,onChange:$=>G($.target.value),label:"Section",children:[e.jsx(w,{value:"",children:"All Sections"}),e.jsx(w,{value:"Primary",children:"Primary"}),e.jsx(w,{value:"Secondary",children:"Secondary"})]})]}),e.jsxs(fe,{sx:{minWidth:200},children:[e.jsx(xe,{children:"Class Levels"}),e.jsxs(se,{multiple:!0,value:me,onChange:$=>m($.target.value),label:"Class Levels",children:[e.jsx(w,{value:"",disabled:!0,children:"Select Class Levels"}),ue.map($=>e.jsx(w,{value:$,children:$},$))]})]})]}),T?e.jsx(As,{}):S&&S!=="Cannot read properties of null (reading 'data')"?e.jsx(P,{color:"error",children:S}):e.jsx(M,{height:"75vh",sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{borderBottom:"none"},"& .MuiDataGrid-columnHeaders":{backgroundColor:r.blueAccent[700],borderBottom:"none"},"& .MuiDataGrid-virtualScroller":{backgroundColor:r.primary[400]},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:r.blueAccent[700]},"& .MuiCheckbox-root":{color:`${r.greenAccent[200]} !important`}},children:d.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Fs,{value:D,onChange:Pe,"aria-label":"academic year tabs",variant:"scrollable",scrollButtons:"auto",sx:{backgroundColor:r.primary[400],"& .MuiTabs-indicator":{backgroundColor:r.blueAccent[700]}},children:d.map(($,K)=>e.jsx(Os,{label:$.name,sx:{color:"white !important",textTransform:"none",fontWeight:"bold",minWidth:160,width:160,"&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:r.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:r.primary[400]}},$._id))}),d.map(($,K)=>e.jsx(oa,{value:D,index:K,children:e.jsx(Rs,{...p,data:p.data.filter(Ce=>{var qe;return Ce.academicYear===$._id||((qe=Ce.academicYear)==null?void 0:qe._id)===$._id}),tableHeader:`Classes for ${$.name}`,page:Y,rowsPerPage:Q,count:$e*Q,onPageChange:We,onRowsPerPageChange:Ye})},$._id))]}):e.jsx(P,{children:"No academic years available"})})]}),e.jsx(aa,{open:E,onClose:()=>A(!1),title:{create:"Create Class Level",edit:"Edit Class Level",view:"View Class Level",delete:"Delete Class Level"}[y],modalMode:y,setModalMode:J,formData:B,handleFormChange:R,handleSubclassChange:F,handleSubclassFeesChange:O,addSubclass:k,addSubclassTermFee:z,removeSubclassTermFee:u,removeSubclass:I,handleTeacherChange:W,setStudentsModalOpen:Ue,setTeachersModalOpen:Ne,setFeesModalOpen:ss,setAssignTeachersModalOpen:He,setSubclassesModalOpen:()=>De(!0),handleSubmit:V,error:S,loadingSubmit:re,academicYears:d,usersData:{teachers:b},subjects:_,colors:r,theme:s}),e.jsx(ta,{open:Qe,onClose:()=>Ue(!1),students:oe,theme:s}),e.jsx(ra,{open:ze,onClose:()=>Ne(!1),teachers:es,theme:s}),e.jsx(la,{open:Xe,onClose:()=>Le(!1),formData:B,handleSubclassFeesChange:O,addSubclassTermFee:z,removeSubclassTermFee:u,handleSubmit:V,isViewMode:y==="view",setIsViewMode:J,error:S,colors:r,theme:s}),e.jsx(ia,{selectedClass:N,open:Ie,onClose:()=>le(!1),classId:N==null?void 0:N._id,formData:pe,usersData:{teachers:b},subjects:_,classLevelSubjects:he,handleTeacherSelect:Be,handleAssignTeachersChange:Ge,handleAssignTeachers:Fe,handleAddSubjectToTeacher:ge,handleRemoveSubjectFromTeacher:Ke,error:S,loading:Oe,theme:s}),e.jsx(na,{availableSubclassLetters:Se,open:Re,onClose:()=>De(!1),newSubclasses:we,handleSubclassChange:F,handleSubclassFeesChange:O,addSubclass:k,addSubclassTermFee:z,removeSubclassTermFee:u,removeSubclass:I,handleAddSubclasses:Ve,classId:N==null?void 0:N._id,error:S,loading:c,colors:r,theme:s}),e.jsxs(Ns,{open:g,onClose:Z,"aria-labelledby":"delete-confirm-dialog-title","aria-describedby":"delete-confirm-dialog-description",children:[e.jsx(Ls,{id:"delete-confirm-dialog-title",children:"Confirm Deletion"}),e.jsxs(Ms,{children:[e.jsxs(P,{id:"delete-confirm-dialog-description",children:["Are you sure you want to delete the class ",e.jsx("strong",{children:H==null?void 0:H.name}),"? This action cannot be undone."]}),S&&e.jsx(P,{color:"error",sx:{mt:2},children:S})]}),e.jsxs(_s,{children:[e.jsx(Me,{onClick:Z,color:"secondary",children:"Cancel"}),e.jsx(Me,{onClick:te,color:"error",variant:"contained",disabled:re,children:re?"Deleting...":"Delete"})]})]})]})},Ea=ws(ca);export{Ea as default};
