import{r as s,j as e,f as N,i as z}from"./index-Dia3dXnv.js";import{t as Ye,D as ys,a as vs,b as Ds,c as Ns,M as G}from"./modal-CRceNtXl.js";import{a1 as Ts,a2 as Is,a3 as Ms,j as Ze,x as Ge,T as P,v as H}from"./TextField-CiACpH9R.js";import{M as Qe}from"./MenuItem-9u3wVos-.js";import{S as ve}from"./index-7TdqMqnp.js";import{H as ks}from"./Header-BKDrWR6o.js";import{a as Fs,b as He,T as qe}from"./table-BuC3jVNb.js";import{u as es}from"./useApi-CcDc2KeG.js";import{c as Os,U as $s}from"./index-HCkcCK1E.js";import{d as _s}from"./Edit-CKFPe8ZI.js";import{d as Ws}from"./Visibility-Dd9vuZcD.js";import{I as Ve}from"./IconButton-BeQuUMyU.js";import{w as Rs}from"./dasboardPagesContainer-FR1z_d3q.js";import{A as ue}from"./actionButton-BwgkxJSG.js";import"./confirmationModal-CIDTnzxs.js";import"./CircularProgress-Du6yAQTu.js";import"./Alert-DzwxKnjn.js";import"./useSlot-BVdpsmmF.js";import"./useMediaQuery-D2Chhg5w.js";import"./index-B_m23NjE.js";import"./loadingButton-Dn6lZ4mI.js";import"./crystal-land-log-removebg-DVF-nlbN.js";const se=({label:o,options:b,onSelect:w})=>{const[A,c]=s.useState(""),u=p=>{const d=p.target.value;c(d),w(d)};return e.jsxs(Ts,{sx:{width:"170px",paddingBottom:"2%"},variant:"outlined",children:[e.jsx(Is,{id:`${o}-select-label`,children:o}),e.jsxs(Ms,{labelId:`${o}-select-label`,value:A,onChange:u,label:o,children:[e.jsx(Qe,{value:"",disabled:!0,children:`Select ${o}`}),b.map(p=>e.jsx(Qe,{value:p.value,children:p.label},p.value))]})]})},Ps=()=>e.jsx(ve,{role:"student"}),Ls=()=>e.jsx(ve,{role:"teacher"}),Bs=()=>e.jsx(ve,{role:"admin"}),Xe=({confirm:o,buttonLabel:b,dialogTitle:w,dialogContent:A,scrollType:c="paper",actionText1:u="Cancel",actionText2:p="Confirm",open:d=!1,onClose:r,onConfirm:t,maxWidth:a="md"})=>{const[U,M]=s.useState(c),h=s.useRef(null),_=Ze(),E=Ye(_.palette.mode);return s.useEffect(()=>{if(d){const{current:W}=h;W!==null&&W.focus()}},[d]),e.jsx(s.Fragment,{children:e.jsxs(ys,{open:d,onClose:r,scroll:U,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",maxWidth:a,fullWidth:!0,children:[e.jsx(vs,{id:"scroll-dialog-title",children:w}),e.jsx(Ds,{dividers:U==="paper",children:e.jsx("div",{id:"scroll-dialog-description",ref:h,tabIndex:-1,children:A})}),e.jsxs(Ns,{children:[e.jsx(Ge,{sx:{color:E.redAccent[500],border:`solid 2px ${E.redAccent[500]}`},onClick:r,children:u}),o&&p&&e.jsx(Ge,{sx:{color:E.greenAccent[500],border:`solid 2px ${E.greenAccent[500]}`},onClick:t,children:p})]})]})})},Js=(o,b,w,A,c)=>{const{callApi:u,loading:p}=es(),d=s.useRef(!0),[r,t]=s.useState({section:"",className:"All",boardingStatus:"All",status:"All"}),[a,U]=s.useState({section:"",className:"All",isSuspended:"All",isWithdrawn:"All"}),[M,h]=s.useState("All"),[_,E]=s.useState("All"),[W,j]=s.useState([]),[Q,y]=s.useState([]),[X,O]=s.useState([]),[$,T]=s.useState(null),[te,L]=s.useState(["All","JSS 1","Primary 3","Primary 5","Primary 6"]),ne=["All","JSS 1","Primary 3","Primary 5","Primary 6"],F=["All","Primary","Secondary"],Y=["All","Primary","Secondary"],B=["All","Boarder","Day Student"],q=["All","Active","Suspended","Withdrawn"],V=["All","Active","Suspended","Withdrawn"];s.useEffect(()=>{console.log("Syncing selectedStudentSection:",r.section||"All"),h(r.section||"All")},[r.section]),s.useEffect(()=>{console.log("Syncing selectedTeacherSection:",a.section||"All"),E(a.section||"All")},[a.section]);const ae=s.useCallback((i,x)=>{console.log("handleStudentFilterChange:",{key:i,value:x}),t(f=>{let D={...f};return i==="status"?D={...D,status:x}:D={...D,[i]:x==="All"?"":x,...i==="section"&&{className:"All"}},console.log("New student filters:",D),D}),i==="section"&&h(x)},[]),Z=s.useCallback((i,x)=>{console.log("handleTeacherFilterChange:",{key:i,value:x}),U(f=>{let D={...f};return i==="status"?D={...D,isSuspended:x==="Suspended"?"true":x==="Active"?"false":"",isWithdrawn:x==="Withdrawn"?"true":x==="Active"?"false":""}:D={...D,[i]:x==="All"?"":x,...i==="section"&&{className:"All"}},console.log("New teacher filters:",D),D}),i==="section"&&E(x)},[]),J=s.useCallback(async()=>{console.log("fetchStudentsData studentFilters:",r);try{const i={page:b+1,limit:c};r.section&&r.section!=="All"&&(i.section=r.section),r.className&&r.className!=="All"&&(i.className=r.className),r.boardingStatus&&r.boardingStatus!=="All"&&(i.boardingStatus=r.boardingStatus),r.status==="Withdrawn"?i.isWithdrawn="true":r.status==="Suspended"?i.isSuspended="true":r.status==="Active"&&(i.isWithdrawn="false",i.isSuspended="false");const x=new URLSearchParams(i).toString();console.log("Calling fetchStudentsData with params:",i);const f=await u(`${N.STUDENTS}?${x}`,"GET");if(console.log("fetchStudentsData response:",f),f&&f.status==="success")j(f.data||[]),L(["All",...f.classLevels||[]]),T(null);else throw new Error((f==null?void 0:f.message)||"Failed to fetch students")}catch(i){console.error("Error fetching students:",i),d.current&&(j([]),T(i.message||"Failed to fetch students"))}},[u,b,c,r]),m=s.useCallback(async()=>{console.log("fetchTeachersData teacherFilters:",a);try{const i={page:w+1,limit:c};a.section&&a.section!=="All"&&(i.section=a.section),a.className&&a.className!=="All"&&(i.className=a.className),a.isSuspended&&a.isSuspended!=="All"&&(i.isSuspended=a.isSuspended),a.isWithdrawn&&a.isWithdrawn!=="All"&&(i.isWithdrawn=a.isWithdrawn);const x=new URLSearchParams(i).toString();console.log("Calling fetchTeachersData with params:",i);const f=await u(`${N.TEACHERS}?${x}`,"GET");if(console.log("fetchTeachersData response:",f),f&&f.status==="success")y(f.data.data||[]),T(null);else throw new Error((f==null?void 0:f.message)||"Failed to fetch teachers")}catch(i){console.error("Error fetching teachers:",i),d.current&&(y([]),T(i.message||"Failed to fetch teachers"))}},[u,w,c,a]),C=s.useCallback(async()=>{try{const i={page:A+1,limit:c},x=new URLSearchParams(i).toString();console.log("Calling fetchAdminsData with params:",i);const f=await u(`${N.ADMINS}?${x}`,"GET");if(console.log("fetchAdminsData response:",f),f&&f.status==="success")O(f.data||[]),T(null);else throw new Error((f==null?void 0:f.message)||"Failed to fetch admins")}catch(i){console.error("Error fetching admins:",i),d.current&&(O([]),T(i.message||"Failed to fetch admins"))}},[u,A,c]),S=s.useCallback(()=>{console.log("Fetching data for tab:",o),o===0?(console.log("Calling fetchStudentsData"),J()):o===1?(console.log("Calling fetchTeachersData"),m()):o===2&&(console.log("Calling fetchAdminsData"),C())},[o,J,m,C]);return s.useEffect(()=>(console.log("useUserDataFetch useEffect triggered with tabIndex:",o,"studentFilters:",r,"teacherFilters:",a),S(),()=>{console.log("Cleaning up useUserDataFetch"),d.current=!1}),[S]),{fetchData:S,studentsData:{students:W},teachersData:{teachers:Q},adminsData:{admins:X},studentsLoading:p&&o===0,teachersLoading:p&&o===1,adminsLoading:p&&o===2,studentsError:$&&o===0?$:null,teachersError:$&&o===1?$:null,adminsError:$&&o===2?$:null,students:W,teachers:Q,admins:X,setStudents:j,setTeachers:y,setAdmins:O,studentFilters:r,teacherFilters:a,handleStudentFilterChange:ae,handleTeacherFilterChange:Z,studentSections:F,teacherSections:Y,studentClassNames:te,teacherClassNames:ne,boardingStatuses:B,studentStatuses:q,teacherStatuses:V,selectedStudentSection:M,setSelectedStudentSection:h,selectedTeacherSection:_,setSelectedTeacherSection:E}},Hs=(o,b,w,A,c,u,p)=>{const{callApi:d}=es(),[r,t]=s.useState(!1),[a,U]=s.useState(!1),[M,h]=s.useState(!1),[_,E]=s.useState(!1),[W,j]=s.useState(!1),[Q,y]=s.useState(null),[X,O]=s.useState(null),[$,T]=s.useState(null),[te,L]=s.useState(null),[ne,F]=s.useState(null),Y=s.useCallback((m,C)=>{let S=[];return C==="student"?S=b||[]:C==="teacher"?S=w||[]:C==="admin"&&(S=A||[]),S.find(i=>i._id===m)||null},[b,w,A]),B=s.useCallback(async m=>{t(!0),y(null);try{if(!m||!m._id||!m.role)throw new Error("Invalid user data");const C=m.role==="student"?`${N.DELETE_STUDENT}/${m._id}`:m.role==="teacher"?`${N.DELETE_TEACHER}/${m._id}`:`${N.ADMINS}/${m._id}`,S=await d(C,"DELETE");console.log("Delete response:",S),sessionStorage.setItem("deleteResult",JSON.stringify(S)),o()}catch(C){y(C.message||"Failed to delete user")}finally{t(!1)}},[d,o]),q=s.useCallback(async m=>{U(!0),O(null);try{if(!m||!m._id||!m.role)throw new Error("Invalid user data");const C=m.role==="student"?`${N.WITHDRAW_STUDENT}/${m._id}`:`${N.WITHDRAW_TEACHER}/${m._id}`,S=await d(C,"PATCH");console.log("Withdraw response:",S),sessionStorage.setItem("withdrawResult",JSON.stringify(S)),o()}catch(C){O(C.message||"Failed to withdraw user")}finally{U(!1)}},[d,o]),V=s.useCallback(async m=>{h(!0),T(null);try{if(!m||!m._id||!m.role)throw new Error("Invalid user data");const C=m.role==="student"?`${N.SUSPEND_STUDENT}/${m._id}`:`${N.SUSPEND_TEACHER}/${m._id}`,S=await d(C,"PATCH");console.log("Suspend response:",S),sessionStorage.setItem("suspendResult",JSON.stringify(S)),o()}catch(C){T(C.message||"Failed to suspend user")}finally{h(!1)}},[d,o]),ae=s.useCallback(async m=>{E(!0),L(null);try{if(!m||!m._id||!m.role)throw new Error("Invalid user data");const C=m.role==="student"?`${N.UNSUSPEND_STUDENT}/${m._id}`:`${N.UNSUSPEND_TEACHER}/${m._id}`,S=await d(C,"PATCH");console.log("Unsuspend response:",S),sessionStorage.setItem("unsuspendResult",JSON.stringify(S)),o()}catch(C){L(C.message||"Failed to unsuspend user")}finally{E(!1)}},[d,o]),Z=s.useCallback(async(m,C)=>{j(!0),F(null);try{const S=C==="student"?N.STUDENTS:C==="teacher"?N.TEACHERS:N.ADMINS,i=await d(S,"POST",{...m,role:C});console.log("Add user response:",i),sessionStorage.setItem("addUserResult",JSON.stringify(i)),o()}catch(S){F(S.message||"Failed to add user")}finally{j(!1)}},[d,o]),J=s.useCallback(async(m,C,S)=>{j(!0),F(null);try{const i=S==="student"?`${N.STUDENTS}/${m}`:S==="teacher"?`${N.TEACHERS}/update/${m}`:`${N.ADMINS}/${m}`,x=await d(i,"PATCH",{...C,role:S});console.log("Update user response:",x),sessionStorage.setItem("updateUserResult",JSON.stringify(x)),S==="student"?await c():S==="teacher"?await u():S==="admin"&&await p()}catch(i){F(i.message||"Failed to update user")}finally{j(!1)}},[d,c,u,p]);return{locateUserByIdAndRole:Y,handleDelete:B,handleWithdraw:q,handleSuspend:V,handleUnsuspend:ae,handleAddUser:Z,handleUpdateUser:J,deleteLoading:r,withdrawLoading:a,suspendLoading:M,unsuspendLoading:_,addUserLoading:W,deleteError:Q,withdrawError:X,suspendError:$,unsuspendError:te,addUserError:ne}},qs=(o,b,w,A,c)=>{const u=[{id:"sn",label:"S/N",width:90},{id:"_id",label:"ID",width:100,renderCell:t=>e.jsx(P,{children:String(t._id)})},{id:"name",label:"Name",flex:1},{id:"email",label:"Email",flex:1},{id:"details",label:"Details",flex:1,renderCell:t=>t.role==="student"?`${t.classLevel||"N/A"} (${t.boardingStatus||"N/A"})`:t.role==="teacher"&&t.subject||"N/A"},{id:"createdAt",label:"Registered Date",flex:1},{id:"actions",label:"Actions",width:200,renderCell:t=>e.jsxs("div",{style:{display:"flex"},children:[e.jsx(Ve,{onClick:()=>b({_id:t._id,role:t.role}),disabled:c,children:e.jsx(_s,{})}),e.jsx(Ve,{onClick:()=>w({_id:t._id,role:t.role}),disabled:c,children:e.jsx(Os,{})}),e.jsx(Ve,{onClick:()=>A({_id:t._id,role:t.role}),disabled:c,children:e.jsx(Ws,{})})]})}],p=Array.isArray(o.students)?o.students.map(t=>{var a;return{_id:t._id,sn:t.sn,role:"student",name:`${t.firstName||""} ${t.lastName||""}`.trim()||"N/A",email:t.email||"N/A",classLevel:((a=t.currentClassLevel)==null?void 0:a.className)||"N/A",boardingStatus:t.boardingStatus||"N/A",createdAt:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A",isWithdrawn:t.isWithdrawn||!1,isSuspended:t.isSuspended||!1,rowStyle:t.isSuspended?{backgroundColor:"#FFCDD2",color:"red"}:{}}}).sort((t,a)=>t.sn-a.sn):[],d=Array.isArray(o.teachers)?o.teachers.map(t=>{var a;return{_id:t._id,sn:t.sn,role:"teacher",name:`${t.firstName||""} ${t.lastName||""}`.trim()||"N/A",email:t.email||"N/A",subject:Array.isArray(t.subject)&&t.subject.length>0?t.subject.map(U=>U.name).join(", "):"N/A",classLevel:((a=t.currentClassLevel)==null?void 0:a.className)||"N/A",createdAt:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A",isWithdrawn:t.isWithdrawn||!1,isSuspended:t.isSuspended||!1,rowStyle:t.isSuspended?{backgroundColor:"#FFCDD2",color:"red"}:{}}}).sort((t,a)=>t.sn-a.sn):[],r=Array.isArray(o.admins)?o.admins.map((t,a)=>({_id:t._id,sn:t.sn||a+1,role:"admin",name:`${t.firstName||""} ${t.lastName||""}`.trim()||"N/A",email:t.email||"N/A",createdAt:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A",rowStyle:{}})).sort((t,a)=>t.sn-a.sn):[];return{columns:u,studentData:p,teacherData:d,adminData:r}},le=()=>{const[o,b]=s.useState(0),[w,A]=s.useState(0),[c,u]=s.useState(0),[p,d]=s.useState(0),[r,t]=s.useState(20),[a,U]=s.useState(""),[M,h]=s.useState("sn"),[_,E]=s.useState("asc"),[W,j]=s.useState(null),[Q,y]=s.useState({}),[X,O]=s.useState(!1),[$,T]=s.useState(!1),[te,L]=s.useState(!1),[ne,F]=s.useState(!1),[Y,B]=s.useState(!1),[q,V]=s.useState(!1),[ae,Z]=s.useState(!1),{fetchData:J,studentsData:m,teachersData:C,adminsData:S,studentsLoading:i,teachersLoading:x,adminsLoading:f,studentsError:D,teachersError:ee,adminsError:De,students:v,teachers:re,admins:ie,setStudents:me,setTeachers:ge,setAdmins:he,studentFilters:Se,teacherFilters:pe,handleStudentFilterChange:fe,handleTeacherFilterChange:Ne,studentSections:Te,teacherSections:Ie,studentClassNames:Me,teacherClassNames:R,boardingStatuses:I,teacherStatuses:oe,selectedStudentSection:de,setSelectedStudentSection:ke,selectedTeacherSection:Fe,setSelectedTeacherSection:Oe,studentStatuses:$e,fetchStudentsData:_e,fetchTeachersData:Ce,fetchAdminsData:We}=Js(o,w,c,p,r),{locateUserByIdAndRole:k,handleDelete:be,handleWithdraw:xe,handleSuspend:Ae,handleUnsuspend:K,handleAddUser:l,handleUpdateUser:Ke,deleteLoading:ce,withdrawLoading:we,suspendLoading:Ue,unsuspendLoading:je,addUserLoading:Ee,deleteError:Re,withdrawError:Pe,suspendError:Le,unsuspendError:Be,addUserError:Je}=Hs(J,v,re,ie,_e,Ce,We);s.useEffect(()=>{var n,g,ye,ze;!ce&&!Re&&((n=sessionStorage.getItem("deleteResult"))!=null&&n.includes("success"))&&(O(!1),j(null),y({}),sessionStorage.removeItem("selectedUser"),sessionStorage.removeItem("deleteResult"),sessionStorage.removeItem("confirmModal")),!we&&!Pe&&((g=sessionStorage.getItem("withdrawResult"))!=null&&g.includes("success"))&&(T(!1),j(null),y({}),sessionStorage.removeItem("selectedUser"),sessionStorage.removeItem("withdrawResult"),sessionStorage.removeItem("confirmWithdrawModal")),!Ue&&!Le&&((ye=sessionStorage.getItem("suspendResult"))!=null&&ye.includes("success"))&&(L(!1),j(null),y({}),sessionStorage.removeItem("selectedUser"),sessionStorage.removeItem("suspendResult"),sessionStorage.removeItem("confirmSuspendModal")),!je&&!Be&&((ze=sessionStorage.getItem("unsuspendResult"))!=null&&ze.includes("success"))&&(F(!1),j(null),y({}),sessionStorage.removeItem("selectedUser"),sessionStorage.removeItem("unsuspendResult"),sessionStorage.removeItem("confirmUnsuspendModal")),!Ee&&!Je&&!q&&(V(!1),U(""))},[ce,we,Ue,je,Ee,Re,Pe,Le,Be,Je,q]);const ss=s.useCallback(n=>{const g=k(n._id,n.role);g&&(j({_id:n._id,role:n.role}),Z(!0),sessionStorage.setItem("selectedUser",JSON.stringify({...g,role:n.role})))},[k]),{columns:ts,studentData:ns,teacherData:as,adminData:os}=qs({students:m.students,teachers:C.teachers,admins:S.admins},n=>{const g=k(n._id,n.role);g&&(y(g),U(n.role),B(!0),sessionStorage.setItem("selectedUser",JSON.stringify({...g,role:n.role})))},n=>{const g=k(n._id,n.role);g&&(y(g),j({_id:n._id,role:n.role}),O(!0),sessionStorage.setItem("selectedUser",JSON.stringify({...g,role:n.role})))},ss,i||x||f||ce||we||Ue||je||Ee),ls=s.useCallback(n=>{U(n),V(!0)},[]),rs=s.useCallback(n=>{E(M===n&&_==="asc"?"desc":"asc"),h(n)},[M,_]),is=s.useCallback((n,g)=>{A(g)},[]),ds=s.useCallback((n,g)=>{u(g)},[]),cs=s.useCallback((n,g)=>{d(g)},[]),us=s.useCallback(n=>{t(parseInt(n.target.value,10)),A(0),u(0),d(0)},[]),ms=s.useCallback(n=>{const g=k(n._id,n.role);g&&(y(g),T(!0),j({_id:n._id,role:n.role}),sessionStorage.setItem("selectedUser",JSON.stringify({...g,role:n.role})))},[k]),gs=s.useCallback(()=>{T(!1),sessionStorage.removeItem("withdrawResult"),sessionStorage.removeItem("confirmWithdrawModal"),sessionStorage.removeItem("selectedUser"),j(null),y({})},[]),hs=s.useCallback(n=>{const g=k(n._id,n.role);g&&(y(g),L(!0),j({_id:n._id,role:n.role}),sessionStorage.setItem("selectedUser",JSON.stringify({...g,role:n.role})))},[k]),Ss=s.useCallback(()=>{L(!1),sessionStorage.removeItem("suspendResult"),sessionStorage.removeItem("confirmSuspendModal"),sessionStorage.removeItem("selectedUser"),j(null),y({})},[]),ps=s.useCallback(n=>{const g=k(n._id,n.role);g&&(n.role==="student"||n.role==="teacher")&&(y(g),F(!0),j({_id:n._id,role:n.role}),sessionStorage.setItem("selectedUser",JSON.stringify({...g,role:n.role})))},[k]),fs=s.useCallback(()=>{F(!1),sessionStorage.removeItem("unsuspendResult"),sessionStorage.removeItem("confirmUnsuspendModal"),sessionStorage.removeItem("selectedUser"),j(null),y({})},[]),Cs=s.useCallback((n,g)=>{b(g),A(0),u(0),d(0),J()},[J]),bs=s.useCallback(n=>{const g=k(n._id,n.role);g&&(y(g),U(n.role),B(!0),sessionStorage.setItem("selectedUser",JSON.stringify({...g,role:n.role})))},[k]),xs=s.useCallback(n=>{console.log("onDelete user:",n),n&&be(n)},[be]),As=s.useCallback(n=>{n&&xe(n)},[xe]),ws=s.useCallback(n=>{n&&Ae(n)},[Ae]),Us=s.useCallback(n=>{n&&K(n)},[K]),js=s.useCallback((n,g)=>{l(n,g)},[l]),Es=s.useCallback((n,g,ye)=>{Ke(n,g,ye),B(!1),j(null),y({}),sessionStorage.removeItem("selectedUser")},[Ke]);return{studentData:ns,teacherData:as,adminData:os,selectedRole:a,setSelectedRole:U,sortBy:M,sortDirection:_,studentPage:w,teacherPage:c,adminPage:p,rowsPerPage:r,selectedUser:W,setSelectedUser:j,editUserDetailsState:Q,openDeleteModal:X,setOpenDeleteModal:O,editDialogOpen:Y,setEditDialogOpen:B,signUpDialogOpen:q,setSignUpDialogOpen:V,handleRoleSelect:ls,handleSortChange:rs,handleStudentPageChange:is,handleTeacherPageChange:ds,handleAdminPageChange:cs,handleRowsPerPageChange:us,handleEdit:bs,onDelete:xs,onWithdraw:As,onSuspend:ws,onUnsuspend:Us,handleWithdrawOpen:ms,handleWithdrawClose:gs,handleSuspendOpen:hs,handleSuspendClose:Ss,handleUnsuspendOpen:ps,handleUnsuspendClose:fs,onAddUser:js,onUpdateUser:Es,columns:ts,tabIndex:o,handleTabChange:Cs,loading:i||x||f||ce||we||Ue||je||Ee,studentsError:D,teachersError:ee,adminsError:De,deleteError:Re,withdrawError:Pe,suspendError:Le,unsuspendError:Be,addUserError:Je,studentSections:Te,teacherSections:Ie,studentClassNames:Me,teacherClassNames:R,boardingStatuses:I,teacherStatuses:oe,selectedStudentSection:de,setSelectedStudentSection:ke,selectedTeacherSection:Fe,setSelectedTeacherSection:Oe,studentFilters:Se,teacherFilters:pe,handleStudentFilterChange:fe,handleTeacherFilterChange:Ne,students:v,teachers:re,admins:ie,setStudents:me,setTeachers:ge,setAdmins:he,viewUserDetails:ae,setViewUserDetails:Z,locateUserByIdAndRole:k,withdrawModalOpen:$,suspendModalOpen:te,unsuspendModalOpen:ne,studentStatuses:$e,deleteLoading:ce}},Vs=({selectedRole:o,editDialogOpen:b,setEditDialogOpen:w,handleUpdateUser:A,userDetails:c})=>{const{loading:u}=le(),[p,d]=s.useState(c||{});return s.useEffect(()=>{d(c||{})},[c]),e.jsx(G,{open:b,onClose:()=>{w(!1),sessionStorage.removeItem("selectedUser")},title:"Edit User",confirmMessage:"Confirm",onConfirm:()=>{p&&(c!=null&&c._id)&&A(c._id,p,o)},disabled:u,children:e.jsxs("div",{style:{position:"relative"},children:[u&&e.jsx(z,{}),c?e.jsx(ve,{role:o,selectedUser:c,onChange:r=>d(r)}):e.jsx(P,{children:"No user selected for editing."})]})})},Ks=({open:o,onClose:b,onConfirm:w})=>{const{deleteLoading:A,loading:c,selectedUser:u}=le(),[p,d]=s.useState(!1);s.useEffect(()=>{sessionStorage.getItem("confirmModal")&&d(!0)},[o]);const r=()=>{d(!1),sessionStorage.removeItem("confirmModal"),sessionStorage.removeItem("deleteResult")},t=JSON.parse(sessionStorage.getItem("deleteResult")||"{}");return e.jsxs(e.Fragment,{children:[e.jsx(G,{open:o,onClose:b,title:"Confirm Delete",onConfirm:()=>{w(u),sessionStorage.setItem("confirmModal","true")},confirmMessage:"Confirm",disabled:A||c,children:e.jsxs("div",{style:{position:"relative"},children:[c&&e.jsx(z,{}),e.jsxs(P,{children:["Confirm deletion of user."," ",e.jsx("span",{style:{color:"#EB433D",fontWeight:"900",fontSize:"large"},children:"Kindly note that this cannot be reversed"})]})]})}),e.jsx(G,{open:p,onClose:r,title:"Delete Confirmation",onConfirm:r,confirmMessage:"OK",disabled:c,children:e.jsxs("div",{style:{position:"relative"},children:[c&&e.jsx(z,{}),e.jsx(P,{children:(t==null?void 0:t.status)==="success"?"User successfully deleted":(t==null?void 0:t.message)||"An error occurred"})]})})]})},zs=({open:o,onClose:b,onConfirm:w,userName:A})=>{var U;const{withdrawLoading:c,loading:u}=le(),[p,d]=s.useState(!1),r=((U=JSON.parse(sessionStorage.getItem("selectedUser")))==null?void 0:U.role)||"user";s.useEffect(()=>{sessionStorage.getItem("confirmWithdrawModal")&&d(!0)},[o]);const t=()=>{d(!1),sessionStorage.removeItem("confirmWithdrawModal"),sessionStorage.removeItem("withdrawResult")},a=JSON.parse(sessionStorage.getItem("withdrawResult")||"{}");return e.jsxs(e.Fragment,{children:[e.jsx(G,{open:o,onClose:b,title:`Confirm ${r.charAt(0).toUpperCase()+r.slice(1)} Withdrawal`,onConfirm:()=>{w(),sessionStorage.setItem("confirmWithdrawModal","true")},confirmMessage:"Confirm",disabled:c||u,children:e.jsxs("div",{style:{position:"relative"},children:[u&&e.jsx(z,{}),e.jsxs(P,{children:["Are you sure you want to withdraw ",e.jsx("strong",{children:A}),"?"," ",e.jsxs("span",{style:{color:"#EB433D",fontWeight:"900",fontSize:"large"},children:["This action will mark the ",r," as withdrawn and remove them from their class and academic year."]})]})]})}),e.jsx(G,{open:p,onClose:t,title:"Withdraw Confirmation",onConfirm:t,confirmMessage:"OK",disabled:u,children:e.jsxs("div",{style:{position:"relative"},children:[u&&e.jsx(z,{}),e.jsx(P,{children:(a==null?void 0:a.status)==="success"?`${r.charAt(0).toUpperCase()+r.slice(1)} successfully withdrawn`:(a==null?void 0:a.message)||"An error occurred"})]})})]})},Gs=({open:o,onClose:b,onConfirm:w,userName:A})=>{var U;const{suspendLoading:c,loading:u}=le(),[p,d]=s.useState(!1),r=((U=JSON.parse(sessionStorage.getItem("selectedUser")))==null?void 0:U.role)||"user";s.useEffect(()=>{sessionStorage.getItem("confirmSuspendModal")&&d(!0)},[o]);const t=()=>{d(!1),sessionStorage.removeItem("confirmSuspendModal"),sessionStorage.removeItem("suspendResult")},a=JSON.parse(sessionStorage.getItem("suspendResult")||"{}");return e.jsxs(e.Fragment,{children:[e.jsx(G,{open:o,onClose:b,title:`Confirm ${r.charAt(0).toUpperCase()+r.slice(1)} Suspension`,onConfirm:()=>{w(),sessionStorage.setItem("confirmSuspendModal","true")},confirmMessage:"Confirm",disabled:c||u,children:e.jsxs("div",{style:{position:"relative"},children:[u&&e.jsx(z,{}),e.jsxs(P,{children:["Are you sure you want to suspend ",e.jsx("strong",{children:A}),"?"," ",e.jsxs("span",{style:{color:"#EB433D",fontWeight:"900",fontSize:"large"},children:["This action will mark the ",r," as suspended."]})]})]})}),e.jsx(G,{open:p,onClose:t,title:"Suspend Confirmation",onConfirm:t,confirmMessage:"OK",disabled:u,children:e.jsxs("div",{style:{position:"relative"},children:[u&&e.jsx(z,{}),e.jsx(P,{children:(a==null?void 0:a.status)==="success"?`${r.charAt(0).toUpperCase()+r.slice(1)} successfully suspended`:(a==null?void 0:a.message)||"An error occurred"})]})})]})},Qs=({open:o,onClose:b,onConfirm:w,userName:A})=>{var U;const{unsuspendLoading:c,loading:u}=le(),[p,d]=s.useState(!1),r=((U=JSON.parse(sessionStorage.getItem("selectedUser")))==null?void 0:U.role)||"user";s.useEffect(()=>{sessionStorage.getItem("confirmUnsuspendModal")&&d(!0)},[o]);const t=()=>{d(!1),sessionStorage.removeItem("confirmUnsuspendModal"),sessionStorage.removeItem("unsuspendResult")},a=JSON.parse(sessionStorage.getItem("unsuspendResult")||"{}");return e.jsxs(e.Fragment,{children:[e.jsx(G,{open:o,onClose:b,title:`Confirm ${r.charAt(0).toUpperCase()+r.slice(1)} Unsuspension`,onConfirm:()=>{w(),sessionStorage.setItem("confirmUnsuspendModal","true")},confirmMessage:"Confirm",disabled:c||u,children:e.jsxs("div",{style:{position:"relative"},children:[u&&e.jsx(z,{}),e.jsxs(P,{children:["Are you sure you want to unsuspend ",e.jsx("strong",{children:A}),"?"," ",e.jsxs("span",{style:{color:"#4CAF50",fontWeight:"900",fontSize:"large"},children:["This action will mark the ",r," as active."]})]})]})}),e.jsx(G,{open:p,onClose:t,title:"Unsuspend Confirmation",onConfirm:t,confirmMessage:"OK",disabled:u,children:e.jsxs("div",{style:{position:"relative"},children:[u&&e.jsx(z,{}),e.jsx(P,{children:(a==null?void 0:a.status)==="success"?`${r.charAt(0).toUpperCase()+r.slice(1)} successfully unsuspended`:(a==null?void 0:a.message)||"An error occurred"})]})})]})},Xs=()=>{const o=Ze(),b=Ye(o.palette.mode),{studentData:w,teacherData:A,adminData:c,selectedRole:u,setSelectedRole:p,sortBy:d,sortDirection:r,studentPage:t,teacherPage:a,adminPage:U,rowsPerPage:M,selectedUser:h,setSelectedUser:_,editUserDetailsState:E,openDeleteModal:W,setOpenDeleteModal:j,editDialogOpen:Q,setEditDialogOpen:y,signUpDialogOpen:X,setSignUpDialogOpen:O,handleRoleSelect:$,handleSortChange:T,handleStudentPageChange:te,handleTeacherPageChange:L,handleAdminPageChange:ne,handleRowsPerPageChange:F,handleEdit:Y,onDelete:B,onWithdraw:q,onSuspend:V,onUnsuspend:ae,handleWithdrawOpen:Z,handleWithdrawClose:J,handleSuspendOpen:m,handleSuspendClose:C,handleUnsuspendOpen:S,handleUnsuspendClose:i,onAddUser:x,onUpdateUser:f,columns:D,tabIndex:ee,handleTabChange:De,loading:v,studentsError:re,teachersError:ie,adminsError:me,deleteError:ge,withdrawError:he,suspendError:Se,unsuspendError:pe,addUserError:fe,studentSections:Ne,teacherSections:Te,selectedStudentSection:Ie,selectedTeacherSection:Me,studentFilters:R,teacherFilters:I,handleStudentFilterChange:oe,handleTeacherFilterChange:de,studentClassNames:ke,teacherClassNames:Fe,boardingStatuses:Oe,studentStatuses:$e,teacherStatuses:_e,viewUserDetails:Ce,setViewUserDetails:We,locateUserByIdAndRole:k,withdrawModalOpen:be,suspendModalOpen:xe,unsuspendModalOpen:Ae}=le(),K=h?k(h._id,h.role):null;return e.jsxs(H,{sx:{position:"relative"},children:[e.jsx(ks,{title:"User Management",subtitle:"Manage users"}),e.jsx(se,{label:"Add Users",options:[{value:"student",label:"Student"},{value:"teacher",label:"Teacher"},{value:"admin",label:"Admin"}],onSelect:$}),e.jsx(H,{mt:2,children:e.jsxs(Fs,{value:ee,onChange:De,"aria-label":"user role tabs",sx:{backgroundColor:b.primary[400],"& .MuiTabs-indicator":{backgroundColor:b.blueAccent[700]}},children:[e.jsx(He,{label:"Students",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:b.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:b.primary[400]}}),e.jsx(He,{label:"Teachers",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:b.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:b.primary[400]}}),e.jsx(He,{label:"Admins",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:b.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:b.primary[400]}})]})}),ee===0&&e.jsxs(H,{sx:{display:"flex",gap:2,mt:2,flexWrap:"wrap"},children:[e.jsx(se,{label:"Section",options:Ne.map(l=>({value:l,label:l})),value:Ie,onSelect:l=>oe("section",l),disabled:v}),e.jsx(se,{label:"Class",options:ke.map(l=>({value:l,label:l})),value:(R==null?void 0:R.className)||"All",onSelect:l=>oe("className",l),disabled:v}),e.jsx(se,{label:"Boarding Status",options:Oe.map(l=>({value:l,label:l})),value:(R==null?void 0:R.boardingStatus)||"All",onSelect:l=>oe("boardingStatus",l),disabled:v}),e.jsx(se,{label:"Status",options:$e.map(l=>({vigilant:l,label:l})),value:(R==null?void 0:R.status)||"All",onSelect:l=>oe("status",l),disabled:v})]}),ee===1&&e.jsxs(H,{sx:{display:"flex",gap:2,mt:2,flexWrap:"wrap"},children:[e.jsx(se,{label:"Section",options:Te.map(l=>({value:l,label:l})),value:Me,onSelect:l=>de("section",l),disabled:v}),e.jsx(se,{label:"Class",options:Fe.map(l=>({value:l,label:l})),value:(I==null?void 0:I.className)||"All",onSelect:l=>de("className",l),disabled:v}),e.jsx(se,{label:"Status",options:_e.map(l=>({value:l,label:l})),value:(I==null?void 0:I.isSuspended)==="true"?"Suspended":(I==null?void 0:I.isWithdrawn)==="true"?"Withdrawn":(I==null?void 0:I.isSuspended)==="false"&&(I==null?void 0:I.isWithdrawn)==="false"?"Active":"All",onSelect:l=>de("status",l),disabled:v})]}),ee===0&&e.jsx(H,{m:"20px 0 0 0",height:"75vh",children:e.jsx(qe,{columns:D,tableHeader:"Student Management",data:w,sortBy:d,sortDirection:r,onSortChange:T,page:t,rowsPerPage:M,onPageChange:te,onRowsPerPageChange:F,hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"],count:w.length,getRowStyle:l=>l.rowStyle,getColumnStyle:l=>{switch(l){case"id":return{backgroundColor:"#E0F7FA"};case"name":return{backgroundColor:"#F0F4C3"};case"email":return{backgroundColor:"#FFECB3"};case"details":return{backgroundColor:"#BBDEFB"};case"createdAt":return{backgroundColor:"#C8E6C9"};case"actions":return{backgroundColor:"#FFCCBC"};default:return{}}},disabled:v})}),ee===1&&e.jsx(H,{m:"20px 0 0 0",height:"75vh",children:e.jsx(qe,{columns:D,tableHeader:"Teacher Management",data:A,sortBy:d,sortDirection:r,onSortChange:T,page:a,rowsPerPage:M,onPageChange:L,onRowsPerPageChange:F,hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"],count:A.length,getRowStyle:l=>l.rowStyle,getColumnStyle:l=>{switch(l){case"id":return{backgroundColor:"#E0F7FA"};case"name":return{backgroundColor:"#F0F4C3"};case"email":return{backgroundColor:"#FFECB3"};case"details":return{backgroundColor:"#BBDEFB"};case"createdAt":return{backgroundColor:"#C8E6C9"};case"actions":return{backgroundColor:"#FFCCBC"};default:return{}}},disabled:v})}),ee===2&&e.jsx(H,{m:"20px 0 0 0",height:"75vh",children:e.jsx(qe,{columns:D,tableHeader:"Admin Management",data:c,sortBy:d,sortDirection:r,onSortChange:T,page:U,rowsPerPage:M,onPageChange:ne,onRowsPerPageChange:F,hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"],count:c.length,getRowStyle:l=>l.rowStyle||{},getColumnStyle:l=>{switch(l){case"id":return{backgroundColor:"#E0F7FA"};case"name":return{backgroundColor:"#F0F4C3"};case"email":return{backgroundColor:"#FFECB3"};case"details":return{backgroundColor:"#BBDEFB"};case"createdAt":return{backgroundColor:"#C8E6C9"};case"actions":return{backgroundColor:"#FFCCBC"};default:return{}}},disabled:v})}),Ce&&h&&K&&e.jsx(Xe,{buttonLabel:"View User Details",dialogTitle:"User Details",dialogContent:e.jsxs(H,{children:[e.jsx($s,{userDetails:{...K,role:h.role}}),!K.isWithdrawn&&e.jsxs(H,{mt:2,display:"flex",gap:2,children:[(h.role==="student"||h.role==="teacher")&&(K.isSuspended&&(h.role==="student"||h.role==="teacher")?e.jsx(ue,{content:`Unsuspend ${h.role}`,onClick:()=>S(h),disabled:v}):e.jsx(ue,{content:`Suspend ${h.role.charAt(0).toUpperCase()+h.role.slice(1)}`,onClick:()=>m(h),disabled:v})),(h.role==="student"||h.role==="teacher")&&e.jsx(ue,{content:`Withdraw ${h.role.charAt(0).toUpperCase()+h.role.slice(1)}`,onClick:()=>Z(h),disabled:v}),e.jsx(ue,{content:"Edit User",onClick:()=>Y(h),disabled:v}),e.jsx(ue,{content:"Delete User",onClick:()=>{sessionStorage.setItem("selectedUser",JSON.stringify(K)),setEditUserDetailsState(K),j(!0)},disabled:v})]})]}),scrollType:"paper",actionText1:"Close",actionText2:"Edit",open:Ce,onClose:()=>{We(!1),_(null),sessionStorage.removeItem("selectedUser")},onAction2:()=>Y(h),disabled:v}),e.jsx(Ks,{open:W,onClose:()=>{j(!1),sessionStorage.removeItem("selectedUser"),sessionStorage.removeItem("confirmModal"),sessionStorage.removeItem("deleteResult")},onConfirm:()=>B(h)}),e.jsx(zs,{open:be,onClose:J,onConfirm:()=>q(h),userName:E?`${E.firstName} ${E.lastName}`:""}),e.jsx(Gs,{open:xe,onClose:C,onConfirm:()=>V(h),userName:E?`${E.firstName} ${E.lastName}`:""}),e.jsx(Qs,{open:Ae,onClose:i,onConfirm:()=>ae(h),userName:E?`${E.firstName} ${E.lastName}`:""}),e.jsx(Vs,{selectedRole:u,editDialogOpen:Q,setEditDialogOpen:l=>{y(l),l||sessionStorage.removeItem("selectedUser")},handleUpdateUser:f,userDetails:E}),e.jsx(Xe,{buttonLabel:"Sign Up",dialogTitle:"Sign Up User",dialogContent:u==="student"?e.jsx(Ps,{onSubmit:l=>x(l,"student"),disabled:v}):u==="teacher"?e.jsx(Ls,{onSubmit:l=>x(l,"teacher"),disabled:v}):u==="admin"?e.jsx(Bs,{onSubmit:l=>x(l,"admin"),disabled:v}):null,scrollType:"body",actionText1:"Cancel",actionText2:"Confirm",open:X,onClose:()=>{O(!1),p("")},onAction2:()=>{},disabled:v}),(re||ie||me||ge||he||Se||pe||fe)&&e.jsx(H,{mt:2,children:e.jsx(P,{color:"error",children:re||ie||me||ge||he||Se||pe||fe})})]})},xt=Rs(Xs);export{xt as default};
