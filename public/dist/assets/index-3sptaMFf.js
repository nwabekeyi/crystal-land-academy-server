import{j as e,r as o,a as O,e as A,o as B}from"./index-6D99QuFG.js";import{T as F}from"./table-2XcwMuqL.js";import{r as H,M as _,t as L}from"./modal-DqZ7eHOa.js";import{D as N,G as s,h as V,E as $}from"./index-WimI5LkW.js";import{c as z,v as d,T as a,x as G,q as J,y as U,j as q}from"./TextField-DNCAtP8T.js";import{H as K}from"./Header-DW_Gm6l8.js";import{w as X}from"./dasboardPagesContainer-D1f2Z2L2.js";import{u as Y}from"./useApi-l6Ih029s.js";import{A as Q}from"./confirmationModal-DgvI5Ut6.js";import{C as Z}from"./CircularProgress-C-UCLo1M.js";import{u as ee}from"./MenuItem-CWg5t3XM.js";import{L as te}from"./LinearProgress-CkIfijur.js";import{I as ae}from"./IconButton-S8eDekGk.js";import"./useMediaQuery--ElqwYi4.js";import"./index-xdteryru.js";import"./loadingButton-CXLrw9-F.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-ivDgNzIL.js";const ne=z(e.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),se=({receipt:r})=>{const i=o.useRef(),u=async()=>{if(i.current)try{const l=await V(i.current,{useCORS:!0}),x=l.toDataURL("image/png"),m=new $("portrait","px","a4"),p=m.internal.pageSize.getWidth(),g=l.height*p/l.width;m.addImage(x,"PNG",0,0,p,g),m.save(`receipt_${r.transactionId}.pdf`)}catch(l){console.error("Error generating PDF:",l)}};return e.jsxs(d,{ref:i,sx:{padding:"20px",maxWidth:"500px",margin:"auto",backgroundColor:"#fff",color:"#000",borderRadius:"10px",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.1)",fontFamily:"Arial, sans-serif"},children:[e.jsx(a,{variant:"h6",align:"center",gutterBottom:!0,children:"Crystal land academy"}),e.jsx(a,{variant:"subtitle2",align:"center",gutterBottom:!0,children:"Payment Receipt"}),e.jsx(N,{sx:{my:2}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:6,children:e.jsx(a,{fontWeight:"bold",children:"Transaction ID:"})}),e.jsx(s,{item:!0,xs:6,align:"right",children:e.jsx(a,{children:r.transactionId})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(a,{fontWeight:"bold",children:"Student Name:"})}),e.jsx(s,{item:!0,xs:6,align:"right",children:e.jsx(a,{children:r.userName})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(a,{fontWeight:"bold",children:"Program:"})}),e.jsx(s,{item:!0,xs:6,align:"right",children:e.jsx(a,{children:r.program})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(a,{fontWeight:"bold",children:"Amount Paid:"})}),e.jsx(s,{item:!0,xs:6,align:"right",children:e.jsxs(a,{children:["₦",r.amount.toFixed(2)]})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(a,{fontWeight:"bold",children:"Status:"})}),e.jsx(s,{item:!0,xs:6,align:"right",children:e.jsx(a,{children:r.status})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(a,{fontWeight:"bold",children:"Date:"})}),e.jsx(s,{item:!0,xs:6,align:"right",children:e.jsx(a,{children:r.date})})]}),e.jsx(N,{sx:{my:2}}),e.jsx(a,{variant:"body2",align:"center",children:"Thank you for your payment!"}),e.jsx(G,{variant:"contained",color:"primary",fullWidth:!0,onClick:u,sx:{mt:2},children:"Download Receipt"})]})};var T={},re=J;Object.defineProperty(T,"__esModule",{value:!0});var E=T.default=void 0,oe=re(H()),ie=e;E=T.default=(0,oe.default)((0,ie.jsx)("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4v-6h16zm0-10H4V6h16z"}),"Payment");const ce=({onSuccess:r=()=>{}})=>{const[i,u]=o.useState(!1),[l,x]=o.useState(!1),[m,p]=o.useState(""),{userId:g,studentId:v}=O(c=>c.users.user),R=ee(),{callApi:j}=Y(),D=()=>{x(!0)},P=()=>{x(!1)},b=()=>{S(),P()},S=async()=>{u(!0);try{const n=await(await fetch(A.PAYSTACK_INIT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:g,paymentAmount:parseFloat(m)})})).json();n&&n.payment_url&&n.reference&&window.PaystackPop.setup({key:"pk_test_8293ca0c4f5b0e4b8da1dad753cbc602cebade30",email:n.email,currency:"NGN",amount:n.amount*100,reference:n.reference,metadata:{userId:n.userId},onClose:function(){C(n.reference)},callback:function(w){const I=w.reference;C(I)}}).openIframe()}catch(c){console.error("Error initializing payment:",c)}finally{u(!1)}},C=async c=>{try{const f=await(await fetch(`${A.PAYSTACK_PAYMENT}/${c}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();if(f.status==="success"){p(""),r();const h=await j(`${A.USER}/${g}`,"GET");h&&h.student&&(R(B(h.student)),console.log(h.student))}else console.error("Verification failed:",f),console.log("Payment failed")}catch(n){console.error("Error verifying transaction:",n)}};return e.jsxs(d,{children:[e.jsx(Q,{icon:e.jsx(E,{}),disabled:i,onClick:D,content:i?e.jsx(Z,{size:24}):"Pay Now"}),e.jsx(_,{open:l,onClose:P,title:"Enter Payment Amount",onConfirm:b,confirmMessage:"Proceed with Payment",children:e.jsx(U,{label:"Amount (Naira)",type:"number",value:m,onChange:c=>p(c.target.value),fullWidth:!0})})]})},k={receipts:[{id:1,transactionId:"TXN_001",amount:5e4,status:"success",date:"2025-06-01",userName:"John Doe",program:"Secondary Education"},{id:2,transactionId:"TXN_002",amount:75e3,status:"success",date:"2025-06-05",userName:"John Doe",program:"Secondary Education"},{id:3,transactionId:"TXN_003",amount:1e5,status:"failed",date:"2025-06-10",userName:"John Doe",program:"Secondary Education"}],outstandings:{totalOutstanding:15e4,amountPaid:125e3}},le=()=>{const r=q(),i=L(r.palette.mode),[u,l]=o.useState(k.receipts),[x,m]=o.useState(0),[p,g]=o.useState(10),[v,R]=o.useState("date"),[j,D]=o.useState("asc"),[P,b]=o.useState(!1),[S,C]=o.useState(null),{totalOutstanding:c,amountPaid:n}=k.outstandings,f=c+n,h=n/f*100,w=t=>{const y=v===t&&j==="asc";R(t),D(y?"desc":"asc")},I=t=>{C(t),b(!0)},M=()=>{const t={id:u.length+1,transactionId:`TXN_${String(u.length+1).padStart(3,"0")}`,amount:5e4,status:"success",date:new Date().toLocaleDateString(),userName:"John Doe",program:"Secondary Education"};l(y=>[t,...y])},W={columns:[{id:"id",label:"S/N",flex:.5,renderCell:t=>e.jsx(a,{children:t.id})},{id:"transactionId",label:"Transaction ID",flex:1,renderCell:t=>e.jsx(a,{children:String(t.transactionId||"N/A")})},{id:"amount",label:"Amount (₦)",flex:1,renderCell:t=>e.jsxs(a,{children:["₦",(t.amount/100).toFixed(2)]})},{id:"status",label:"Status",flex:1,renderCell:t=>e.jsx(a,{children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})},{id:"date",label:"Date",flex:1,renderCell:t=>e.jsx(a,{children:t.date||"N/A"})},{id:"actions",label:"Actions",flex:1,renderCell:t=>e.jsx(d,{display:"flex",gap:"10px",children:e.jsx(ae,{onClick:()=>I(t),children:e.jsx(ne,{})})})}],tableHeader:"Payment Records",data:u,sortBy:v,sortDirection:j,onSortChange:w,page:x,rowsPerPage:p,onPageChange:(t,y)=>m(y),onRowsPerPageChange:t=>g(parseInt(t.target.value,10)),onRowClick:t=>console.log("Row clicked:",t),hiddenColumnsSmallScreen:["status","transactionId"]};return e.jsxs(d,{children:[e.jsx(K,{title:"Payment History",subtitle:"Overview of Payments Made"}),e.jsxs(d,{backgroundColor:i.primary[400],p:"20px",borderRadius:"4px",children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Payment Summary"}),e.jsxs(d,{mb:"20px",children:[e.jsxs(d,{sx:{display:"flex",alignItems:"end",marginBottom:"15px",justifyContent:"space-between",width:"100%"},children:[e.jsxs(d,{children:[e.jsxs(a,{variant:"h6",mb:"5px",children:["Total Amount Due: ₦",(f/100).toFixed(2)]}),e.jsxs(a,{variant:"h6",mb:"5px",children:["Total Paid: ₦",(n/100).toFixed(2)]}),e.jsxs(a,{variant:"h6",children:["Payment Percentage: ",h.toFixed(2),"%"]})]}),e.jsx(d,{children:e.jsx(ce,{onSuccess:M})})]}),e.jsx(te,{variant:"determinate",value:h,sx:{height:10,borderRadius:5,backgroundColor:i.grey[300],"& .MuiLinearProgress-bar":{backgroundColor:i.greenAccent[500]}}})]}),e.jsx(F,{...W}),e.jsx(_,{open:P,onClose:()=>b(!1),title:"Receipt Details",noConfirm:!0,children:S&&e.jsx(se,{receipt:S})})]})]})},Ae=X(le);export{Ae as default};
