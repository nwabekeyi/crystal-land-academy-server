import{r as s,a as _,j as t,n as X}from"./index-22HUb1_z.js";import{t as Z,M as N}from"./modal-CFzM2TvC.js";import{T as ee}from"./table-iQGSzLj8.js";import{j as te,w as b,A as R,T as Q,y as $e,z as O}from"./constants-BJW4J9P5.js";import{u as C}from"./useApi-BivKV4bK.js";import{H as oe}from"./Header-CXtHvVsg.js";import{C as se,A as H}from"./confirmationModal-BxJ-28ob.js";import{C as W}from"./customIconButton-PDrFBAUO.js";import{d as Re}from"./Edit-C8fyuzwg.js";import{A as Be,a as Oe}from"./index-dxrUZtLq.js";import{d as Ne}from"./Visibility-CAQTlKmU.js";import{w as Ue}from"./dasboardPagesContainer-qh7jt9JW.js";import"./IconButton-xWupQFdG.js";import"./useMediaQuery-vabypUKQ.js";import"./index-DF2Knd0X.js";import"./loadingButton-DUprIo-A.js";import"./MenuItem-38XN_-vW.js";import"./useSlot-Bb0ot7dQ.js";const He=()=>{const[m,A]=s.useState([]),[r,T]=s.useState("date"),[D,o]=s.useState("asc"),[S,a]=s.useState(0),[u,M]=s.useState(5),p=_(n=>n.users.user),f=p==null?void 0:p.cohort,E=f?`${R.TIMETABLE}/${f}`:null,w=te();Z(w.palette.mode);const{loading:y,data:h,callApi:P}=C();s.useEffect(()=>{E&&P(E,"GET")},[E,P]),s.useEffect(()=>{h&&A(h)},[h]);const I=n=>{var v;return(v=n==null?void 0:n.attendance)==null?void 0:v.includes(p.userId)},i=m.map(n=>({...n,attended:I(n)?"Yes":"No"})),c=[{id:"date",label:"Date"},{id:"location",label:"Location"},{id:"time",label:"Time"},{id:"topic",label:"Topic"},{id:"attended",label:"Attended"}],j=n=>{o(r===n&&D==="asc"?"desc":"asc"),T(n)},g=n=>{a(n)},L=n=>{M(parseInt(n.target.value,10))},k=n=>{console.log(n)};return t.jsxs(b,{py:"20px",children:[t.jsx(oe,{title:"TIME TABLE",subtitle:"Overview of Schedule"}),y?t.jsx(X,{}):t.jsx(b,{children:t.jsx(ee,{columns:c,tableHeader:"Schedule",data:i,sortBy:r,sortDirection:D,onSortChange:j,page:S,rowsPerPage:u,onPageChange:g,onRowsPerPageChange:L,onRowClick:k})})]})},We=({openAttendanceModal:m,handleAttendanceModalClose:A,timeTable:r,cohortName:T})=>{const[D,o]=s.useState([]),[S,a]=s.useState(!1),{loading:u,error:M,callApi:p}=C(),{loading:f,error:E,callApi:w,data:y}=C();s.useEffect(()=>{(async()=>{const c=await p(`${R.COHORT}/students/${T}`);c&&c.students&&o(c.students),a(!0)})()},[T]);const h=()=>{a(!1)},P=async i=>{const c={studentId:i,cohortName:T,timeTableId:r.id};await w(R.MARK_ATTENDANCE,"PATCH",c)},I=i=>{var c;return(c=r==null?void 0:r.attendance)==null?void 0:c.includes(i)};return t.jsxs(N,{open:m,onClose:A,title:"Mark Attendance",noConfirm:!0,confirmMessage:"Attendance",children:[u?t.jsx(X,{}):D.map(i=>t.jsxs(b,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,p:2,borderRadius:"4px",border:"1px solid #ccc",children:[t.jsxs(b,{display:"flex",alignItems:"center",children:[t.jsx(Be,{src:i.profilePicture,alt:i.firstName,sx:{width:48,height:48,mr:2}}),t.jsxs(Q,{variant:"h6",children:[i.firstName," ",i.lastName]})]}),t.jsx($e,{variant:"contained",color:"primary",onClick:()=>P(i.userId),disabled:I(i.userId)||f,children:I(i.userId)?"Attendance Marked":f?"Marking...":"Mark Attendance"})]},i.userId)),t.jsx(se,{open:S,onClose:h,title:"Confirmation marked attendance",isLoading:f,message:y.message}),M&&t.jsx(Q,{color:"error",children:M})]})},_e=()=>{const m=te();Z(m.palette.mode);const[A,r]=s.useState(!1),[T,D]=s.useState(!1),[o,S]=s.useState(null),[a,u]=s.useState({date:"",course:"",time:"",location:"",topic:""}),[M,p]=s.useState(0),[f,E]=s.useState(10),[w,y]=s.useState("date"),[h,P]=s.useState("asc"),[I,i]=s.useState(null),[c,j]=s.useState([]),[g,L]=s.useState(!1),[k,n]=s.useState(!1),[v,F]=s.useState(!1),[ae,ne]=s.useState(""),[ie,G]=s.useState(!1),[K,le]=s.useState(!1),[Ge,re]=s.useState(!1),z=_(e=>e.users.user),U=z.cohort,$=`${R.TIMETABLE}/${U}`;console.log(U);const ce=()=>{g===!0&&L(!1),k===!0&&n(!1)},de=e=>{F(!0),ne(e)},ue=e=>{F(!1)},{loading:Ke,data:ze,error:Ve,callApi:pe}=C(),{loading:Ye,error:qe,callApi:me}=C(),{loading:fe,data:Je,error:V,callApi:he}=C(),{loading:ge,data:Qe,error:xe,callApi:Ce}=C(),{loading:Xe,data:Ae,error:Ze,callApi:Te}=C();s.useEffect(()=>{(async()=>{if($){const l=await me($,"GET");j(l)}})()},[]);const Y=(e,l)=>{if(!e||!l)return"Invalid Date";const x=new Date(e).toISOString().split("T")[0],d=new Date(`${x}T${l}`);return isNaN(d)?"Invalid Date":d},De=[{id:"date",label:"Date",renderCell:e=>Y(e.date,e.time).toLocaleDateString()},{id:"time",label:"Time"},{id:"location",label:"Location"},{id:"topic",label:"Topic"},{id:"actions",label:"Actions",renderCell:e=>{const d=Y(e.date,e.time)<=new Date,ve=e.done;return le(ve),re(d),t.jsxs(b,{sx:{px:0},children:[t.jsx(W,{onClick:()=>je(e),icon:t.jsx(Re,{})}),t.jsx(W,{onClick:()=>Ee(e),icon:t.jsx(Ne,{})}),t.jsx(W,{onClick:()=>we(e),icon:t.jsx(Oe,{})})]})}}],q=()=>r(!0),B=()=>{r(!1),u({date:"",course:"",time:"",location:"",topic:""}),S(null)},Se=()=>D(!0),J=()=>{D(!1),i(null)},je=e=>{S(e),u({date:e.date||"",time:e.time||"",location:e.location||"",topic:e.topic||"",course:e.course||""}),q()},be=async()=>{if(o){const e={date:a.date,time:a.time,location:a.location,topic:a.topic,course:a.course};await he(`${$}/${o.id}`,"PUT",e)&&j(x=>x.map(d=>d.id===o.id?{...d,...e}:d)),n(!0),B()}},Me=async()=>{if(o){const e={cohortName:U,entryId:o.id};await Te(R.MARK_TIMETABLE,"PATCH",e)&&j(x=>x.map(d=>d.id===o.id?{...d,done:!0}:d)),n(!0),B()}};console.log(Ae);const Ee=e=>{S(e),G(!0)},we=e=>{i(e),Se()},Pe=async()=>{o&&(await Ce(`${$}/${o.id}`,"DELETE")?j(l=>l.filter(x=>x.id!==o.id)):L(!0),J(),L(!0))},ke=async()=>{const e={date:a.date,time:a.time,location:a.location,topic:a.topic,course:a.course},l=await pe($,"POST",e);l&&j(l.timetable),B()},ye=e=>{P(w===e&&h==="asc"?"desc":"asc"),y(e)},Ie=(e,l)=>{p(l)},Le=e=>{E(+e.target.value),p(0)};return t.jsxs(b,{children:[t.jsx(oe,{title:"TIME TABLE",subtitle:"Overview of Weekly Schedule"}),t.jsx(H,{onClick:q,content:"Add Schedule"}),t.jsx(ee,{columns:De,data:c,page:M,rowsPerPage:f,onSortChange:ye,sortBy:w,sortDirection:h,onPageChange:Ie,onRowsPerPageChange:Le,hiddenColumnsSmallScreen:["topic","location"]}),t.jsxs(N,{open:A,onClose:B,title:o?"Edit Schedule":"Add Schedule",onConfirm:o?be:ke,confirmMessage:o?"Update":"Add",children:[t.jsx(O,{fullWidth:!0,name:"date",label:"Date",type:"date",value:a.date,onChange:e=>u({...a,date:e.target.value}),sx:{mb:"15px"},InputLabelProps:{shrink:!0}}),t.jsx(O,{fullWidth:!0,name:"time",label:"Time",type:"time",value:a.time,onChange:e=>u({...a,time:e.target.value}),sx:{mb:"15px"},InputLabelProps:{shrink:!0}}),t.jsx(O,{fullWidth:!0,name:"location",label:"Location",value:a.location,onChange:e=>u({...a,location:e.target.value}),sx:{mb:"15px"}}),t.jsx(O,{fullWidth:!0,name:"topic",label:"Topic",value:a.topic,onChange:e=>u({...a,topic:e.target.value}),sx:{mb:"15px"}})]}),t.jsxs(N,{open:ie,onClose:()=>G(!1),title:"Assignment Details",noConfirm:!0,children:[t.jsxs(b,{children:[t.jsxs("p",{children:["Topic: ",o==null?void 0:o.topic]}),t.jsxs("p",{children:["Date: ",o==null?void 0:o.date]}),t.jsxs("p",{children:["Time: ",o==null?void 0:o.time]}),t.jsxs("p",{children:["Location: ",o==null?void 0:o.location]})]}),t.jsx(H,{onClick:()=>de(o),content:"Mark Attendance",sx:{width:"120px"}}),t.jsx(H,{onClick:()=>Me(),content:K?"Schedule completed":"Mark as done",sx:{width:"120px",mx:1},disable:K})]}),t.jsx(N,{open:T,onClose:J,title:"Delete Schedule",onConfirm:Pe,confirmMessage:"Delete",children:"Are you sure you want to delete this schedule?"}),t.jsx(se,{open:g||k,onClose:ce,title:g?"Delete Confirmation":"Update confirmation",isLoading:g?ge:fe,message:g?"Time Table successfully deleted":k?V:g&&xe||k&&V?"Could not update time table, something went wrong":"something went wrong"}),t.jsx(We,{openAttendanceModal:v,cohortName:z.cohort,timeTable:ae,handleAttendanceModalClose:ue})]})},Fe=()=>{const m=_(r=>r.users.user),A=m.role;return t.jsx("div",{children:A==="student"?t.jsx(He,{}):t.jsx(_e,{babtechUser:m})})},Ct=Ue(Fe);export{Ct as default};
