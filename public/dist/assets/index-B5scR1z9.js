import{r,j as o,e as ke,a as qe,N as Le,f as se}from"./index-BO-TmkzE.js";import{M as Q}from"./modal-CG0C6vpP.js";import{u as ne}from"./useApi-bPe3HYn1.js";import{C as Ne}from"./accordion-M8ImoQcF.js";import{g as X,a as K,u as le,_ as Z,az as $e,aA as Be,b as M,s as F,d as J,e as ee,c as ce,a4 as ue,aa as Oe,h as Y,i as Pe,af as Ge,o as Fe,K as ze,T as i,v,x as W}from"./TextField-CigEBK4R.js";import{D as Ae,G as V}from"./index-BJVcWxQk.js";import{S as _e,F as De}from"./FormControlLabel-BxlChcGd.js";import"./IconButton-DnpiNGo6.js";import"./useSlot-DtaxXO1z.js";import"./confirmationModal-DjrrgVpa.js";import"./CircularProgress-oo0vmEJK.js";import"./MenuItem-Cm8_Zc8l.js";import"./index-nsUM-GnQ.js";import"./loadingButton-CiJH9dFC.js";import"./crystal-land-log-removebg-DVF-nlbN.js";function Ue(t){return X("MuiFormGroup",t)}K("MuiFormGroup",["root","row","error"]);const Qe=["className","row"],We=t=>{const{classes:e,row:s,error:n}=t;return ee({root:["root",s&&"row",n&&"error"]},Ue,e)},Ve=F("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,s.row&&e.row]}})(({ownerState:t})=>M({display:"flex",flexDirection:"column",flexWrap:"wrap"},t.row&&{flexDirection:"row"})),Ye=r.forwardRef(function(e,s){const n=le({props:e,name:"MuiFormGroup"}),{className:l,row:u=!1}=n,j=Z(n,Qe),d=$e(),a=Be({props:n,muiFormControl:d,states:["error"]}),S=M({},n,{row:u,error:a.error}),h=We(S);return o.jsx(Ve,M({className:J(h.root,l),ownerState:S,ref:s},j))}),He=ce(o.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),Xe=ce(o.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),Ke=F("span",{name:"MuiRadioButtonIcon",shouldForwardProp:ue})({position:"relative",display:"flex"}),Ze=F(He,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),Je=F(Xe,{name:"MuiRadioButtonIcon"})(({theme:t,ownerState:e})=>M({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest})},e.checked&&{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}));function de(t){const{checked:e=!1,classes:s={},fontSize:n}=t,l=M({},t,{checked:e});return o.jsxs(Ke,{className:s.root,ownerState:l,children:[o.jsx(Ze,{fontSize:n,className:s.background,ownerState:l}),o.jsx(Je,{fontSize:n,className:s.dot,ownerState:l})]})}const me=r.createContext(void 0);function eo(){return r.useContext(me)}function oo(t){return X("MuiRadio",t)}const re=K("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),to=["checked","checkedIcon","color","icon","name","onChange","size","className"],so=t=>{const{classes:e,color:s,size:n}=t,l={root:["root",`color${Y(s)}`,n!=="medium"&&`size${Y(n)}`]};return M({},e,ee(l,oo,e))},no=F(_e,{shouldForwardProp:t=>ue(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,s.size!=="medium"&&e[`size${Y(s.size)}`],e[`color${Y(s.color)}`]]}})(({theme:t,ownerState:e})=>M({color:(t.vars||t).palette.text.secondary},!e.disableRipple&&{"&:hover":{backgroundColor:t.vars?`rgba(${e.color==="default"?t.vars.palette.action.activeChannel:t.vars.palette[e.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:Pe(e.color==="default"?t.palette.action.active:t.palette[e.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},e.color!=="default"&&{[`&.${re.checked}`]:{color:(t.vars||t).palette[e.color].main}},{[`&.${re.disabled}`]:{color:(t.vars||t).palette.action.disabled}}));function ro(t,e){return typeof e=="object"&&e!==null?t===e:String(t)===String(e)}const ae=o.jsx(de,{checked:!0}),ie=o.jsx(de,{}),ao=r.forwardRef(function(e,s){var n,l;const u=le({props:e,name:"MuiRadio"}),{checked:j,checkedIcon:d=ae,color:a="primary",icon:S=ie,name:h,onChange:g,size:R="medium",className:w}=u,I=Z(u,to),C=M({},u,{color:a,size:R}),y=so(C),b=eo();let m=j;const N=Oe(g,b&&b.onChange);let E=h;return b&&(typeof m>"u"&&(m=ro(b.value,u.value)),typeof E>"u"&&(E=b.name)),o.jsx(no,M({type:"radio",icon:r.cloneElement(S,{fontSize:(n=ie.props.fontSize)!=null?n:R}),checkedIcon:r.cloneElement(d,{fontSize:(l=ae.props.fontSize)!=null?l:R}),ownerState:C,classes:y,name:E,checked:m,onChange:N,ref:s,className:J(y.root,w)},I))});function io(t){return X("MuiRadioGroup",t)}K("MuiRadioGroup",["root","row","error"]);const lo=["actions","children","className","defaultValue","name","onChange","value"],co=t=>{const{classes:e,row:s,error:n}=t;return ee({root:["root",s&&"row",n&&"error"]},io,e)},uo=r.forwardRef(function(e,s){const{actions:n,children:l,className:u,defaultValue:j,name:d,onChange:a,value:S}=e,h=Z(e,lo),g=r.useRef(null),R=co(e),[w,I]=Ge({controlled:S,default:j,name:"RadioGroup"});r.useImperativeHandle(n,()=>({focus:()=>{let m=g.current.querySelector("input:not(:disabled):checked");m||(m=g.current.querySelector("input:not(:disabled)")),m&&m.focus()}}),[]);const C=Fe(s,g),y=ze(d),b=r.useMemo(()=>({name:y,onChange(m){I(m.target.value),a&&a(m,m.target.value)},value:w}),[y,a,I,w]);return o.jsx(me.Provider,{value:b,children:o.jsx(Ye,M({role:"radiogroup",ref:C,className:J(R.root,u)},h,{children:l}))})}),mo=(t,e,s)=>{const[n,l]=r.useState(0);return r.useEffect(()=>{if(!s||t===0)return;if(n<=0){e();return}const d=setInterval(()=>{l(a=>a-1)},1e3);return()=>clearInterval(d)},[n,e,s,t]),{timeLeft:n,formatTime:()=>{const d=Math.floor(n/60),a=n%60;return`${d.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},resetTimer:d=>{l(d*60)}}},xo=()=>{const t=ke(),{classLevelId:e,currentClassLevel:s,_id:n}=qe(c=>c.users.user||{}),l=(s==null?void 0:s.subclass)||null,u=r.useContext(Le).navigator,[j,d]=r.useState([]),[a,S]=r.useState(null),[h,g]=r.useState(0),[R,w]=r.useState({}),[I,C]=r.useState(!1),[y,b]=r.useState(!1),[m,N]=r.useState(!1),[E,$]=r.useState(!1),[f,k]=r.useState(!1),[T,q]=r.useState(null),[z,p]=r.useState(null),[x,xe]=r.useState(null),{data:O,loading:fe,error:A,callApi:oe}=ne(),{data:P,loading:pe,error:_,callApi:he}=ne();r.useEffect(()=>{if(!f)return;const c=H=>{H.preventDefault(),H.returnValue="",D()},B=()=>{document.visibilityState==="hidden"&&D()},L=()=>{$(!0),window.history.pushState(null,null,window.location.pathname)},Te=u.push;return u.push=(...H)=>{$(!0)},window.addEventListener("beforeunload",c),document.addEventListener("visibilitychange",B),window.addEventListener("popstate",L),()=>{window.removeEventListener("beforeunload",c),document.removeEventListener("visibilitychange",B),window.removeEventListener("popstate",L),u.push=Te}},[f,u]),r.useEffect(()=>{if(e&&l){const c=`${se.STUDENT_EXAM}/questions?classLevelId=${e}&subclassLetter=${l}`;oe(c,"GET")}else d([]),U("Missing class level ID or subclass letter")},[e,l,oe]),r.useEffect(()=>{var c;(c=O==null?void 0:O.data)!=null&&c.subjects&&d(O.data.subjects||[]),A&&U(A)},[O,A]),r.useEffect(()=>{(P==null?void 0:P.status)==="success"&&(p(P.data.score),N(!0),k(!1),G(),t("/dashboard/CBTExams")),_&&(U(_.message||"Failed to submit exam result"),k(!1),G(),t("/dashboard/CBTExams"))},[P,_]);const G=()=>{S(null),k(!1),g(0),w({}),p(null),q(null),C(!1),b(!1),N(!1),$(!1),te(0)},be=c=>{q(c),C(!0)},ge=()=>{q(null),C(!1)},ve=()=>{T&&(G(),S(T),k(!0),g(0),w({[T.examId]:{}}),te(T.duration),C(!1),q(null))},{timeLeft:Se,formatTime:Ce,resetTimer:te}=mo((a==null?void 0:a.duration)||0,()=>{a&&f&&D()},f),je=(c,B)=>{!a||!f||w(L=>({...L,[a.examId]:{...L[a.examId],[c]:B}}))},Re=()=>{a&&f&&h<a.questions.length-1&&g(h+1)},we=()=>{f&&h>0&&g(h-1)},D=()=>{if(!a||!f||!n)return;const c=Object.entries(R[a.examId]||{}).map(([B,L])=>({questionId:B,selectedOption:L}));if(c.length===0){U("No answers provided");return}he(se.EXAM_RESULTS,"POST",{examId:a.examId,answeredQuestions:c})},Me=()=>{G(),t("/dashboard/CBTExams")},ye=()=>{f&&b(!0)},Ie=()=>{b(!1)},Ee=()=>{$(!1)},U=c=>{d([]),G(),xe(c)};return{subjects:j,selectedExam:a,currentQuestionIndex:h,examAnswers:R,loading:fe||pe,error:x||A||_,isStartModalOpen:I,isSubmitModalOpen:y,isScoreModalOpen:m,isLeaveModalOpen:E,examScore:z,timeLeft:Se,formatTime:Ce,openStartModal:be,closeStartModal:ge,startExam:ve,handleOptionSelect:je,handleNext:Re,handlePrevious:we,openSubmitModal:ye,closeSubmitModal:Ie,handleSubmit:D,pendingExam:T,closeScoreModal:Me,isExamStarted:f,handleLeaveModalClose:Ee}},To=()=>{var q,z;const{subjects:t,selectedExam:e,currentQuestionIndex:s,examAnswers:n,loading:l,error:u,isStartModalOpen:j,isSubmitModalOpen:d,isScoreModalOpen:a,isLeaveModalOpen:S,examScore:h,formatTime:g,openStartModal:R,closeStartModal:w,startExam:I,handleOptionSelect:C,handleNext:y,handlePrevious:b,openSubmitModal:m,closeSubmitModal:N,closeScoreModal:E,handleSubmit:$,pendingExam:f,handleLeaveModalClose:k}=xo();if(l)return o.jsx(i,{sx:{mt:4,textAlign:"center"},children:"Loading exams..."});if(u)return o.jsx(i,{color:"error",sx:{mt:4,textAlign:"center"},children:u});const T=((q=e==null?void 0:e.questions)==null?void 0:q.reduce((p,x)=>p+(x.score||0),0))??0;return o.jsx(v,{component:"main",sx:{minHeight:"100vh",p:{xs:2,md:4},bgcolor:"#0f1720",color:"#fff"},children:o.jsxs(v,{sx:{maxWidth:1200,mx:"auto"},children:[o.jsx(i,{variant:"h4",sx:{mb:3,fontWeight:700,color:"#fff"},children:"Computer-Based Test"}),e?o.jsxs(v,{children:[o.jsxs(v,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",gap:2},children:[o.jsxs(v,{children:[o.jsx(i,{variant:"h5",sx:{fontWeight:700,color:"#fff"},children:e.examName}),o.jsxs(i,{sx:{color:"#94a3b8"},children:[e.examType," • ",e.questions.length," question",e.questions.length!==1?"s":""]})]}),o.jsxs(v,{sx:{display:"flex",gap:1,alignItems:"center"},children:[o.jsxs(v,{sx:{px:2,py:1,borderRadius:2,bgcolor:"#0b1220",border:"1px solid rgba(255,255,255,0.06)"},children:[o.jsx(i,{variant:"subtitle1",sx:{fontWeight:600},children:"Time Left"}),o.jsx(i,{variant:"h6",sx:{fontWeight:700},children:g()})]}),o.jsxs(v,{sx:{textAlign:"right"},children:[o.jsxs(i,{variant:"body2",sx:{color:"#94a3b8"},children:["Question ",s+1," of ",e.questions.length]}),o.jsxs(i,{variant:"body2",sx:{color:"#94a3b8"},children:["Total Points: ",T]})]})]})]}),o.jsx(Ae,{sx:{borderColor:"rgba(255,255,255,0.04)",mb:3}}),e.questions.length>0&&o.jsxs(v,{sx:{p:{xs:2,md:3},borderRadius:2,bgcolor:"#0f1724",boxShadow:"0 6px 20px rgba(2,6,23,0.6)",border:"1px solid rgba(255,255,255,0.03)"},children:[o.jsx(i,{variant:"subtitle2",sx:{color:"#94a3b8",mb:1},children:e.questions[s].sn?`#${e.questions[s].sn}`:`Q${s+1}`}),o.jsx(i,{variant:"h6",sx:{mb:2,fontWeight:700,color:"#fff"},children:e.questions[s].question}),o.jsxs(i,{variant:"body2",sx:{color:"#94a3b8",mb:2},children:["(",e.questions[s].score," points)"]}),o.jsx(uo,{"aria-label":`question-${e.questions[s]._id}`,name:`question-${e.questions[s]._id}`,value:((z=n[e.examId])==null?void 0:z[e.questions[s]._id])||"",onChange:p=>C(e.questions[s]._id,p.target.value),children:["optionA","optionB","optionC","optionD"].map(p=>{const x=e.questions[s][p];return x?o.jsx(De,{value:p,control:o.jsx(ao,{sx:{color:"rgba(255,255,255,0.7)","&.Mui-checked":{color:"#60a5fa"}}}),label:o.jsx(i,{sx:{color:"#e6eef8"},children:x}),sx:{my:1}},p):null})})]}),o.jsxs(V,{container:!0,spacing:2,sx:{mt:3},children:[o.jsx(V,{item:!0,children:o.jsx(W,{variant:"outlined",onClick:b,disabled:s===0,sx:{color:"#fff",borderColor:"rgba(255,255,255,0.12)"},children:"Previous"})}),o.jsx(V,{item:!0,children:s<e.questions.length-1?o.jsx(W,{variant:"contained",color:"primary",onClick:y,children:"Next"}):o.jsx(W,{variant:"contained",color:"success",onClick:m,children:"Submit Exam"})}),o.jsx(V,{item:!0,xs:!0,children:o.jsx(i,{sx:{color:"#94a3b8",mt:1},children:"The exam will auto-submit if you switch tabs or close the browser."})})]}),o.jsx(Q,{open:d,onClose:N,onConfirm:$,title:"Submit Exam",confirmText:"Submit",showCancel:!0,cancelText:"Cancel",children:o.jsx(i,{children:"Are you sure you want to submit? This cannot be undone."})})]}):o.jsx(o.Fragment,{children:t.length===0?o.jsx(i,{sx:{mt:4,textAlign:"center",color:"#cbd5e1"},children:"No exams available for your class."}):t.map(p=>o.jsx(Ne,{title:p.subjectName,details:o.jsx(v,{children:p.exams.map(x=>o.jsxs(v,{sx:{mb:2,p:2,borderRadius:2,bgcolor:"#071426",border:"1px solid rgba(255,255,255,0.04)"},children:[o.jsxs(i,{variant:"h6",sx:{color:"#fff"},children:[x.examName," ",o.jsxs(i,{component:"span",sx:{color:"#94a3b8"},children:["(",x.examType,")"]})]}),o.jsxs(i,{sx:{color:"#93c5fd",mt:.5},children:["Date: ",new Date(x.examDate).toLocaleDateString()]}),o.jsxs(i,{sx:{color:"#94a3b8"},children:["Time: ",x.examTime," • Duration: ",x.duration," min • Questions: ",x.questions.length]}),o.jsx(v,{sx:{mt:1},children:o.jsx(W,{variant:"contained",color:"primary",onClick:()=>R(x),children:"Start Exam"})})]},x.examId))})},p.subjectId))}),o.jsx(Q,{open:j,onClose:w,onConfirm:I,title:"Start Exam",confirmText:"Start",showCancel:!0,cancelText:"Cancel",children:o.jsxs(i,{children:["Are you sure you want to start this exam? You will have ",(f==null?void 0:f.duration)??"the specified"," minutes to complete it."]})}),o.jsxs(Q,{open:a,onClose:E,onConfirm:E,title:"Exam Results",confirmText:"OK",showCancel:!1,children:[o.jsx(i,{sx:{mb:1},children:"You have completed the exam."}),o.jsxs(i,{sx:{fontWeight:700,fontSize:20},children:["Score: ",h??0," / ",T]})]}),o.jsx(Q,{open:S,onClose:k,onConfirm:k,title:"Cannot Leave Exam",confirmText:"OK",showCancel:!1,children:o.jsx(i,{children:"You cannot leave this page. Please stay to complete the exam."})})]})})};export{To as default};
