import{r,f as E,j as e,a as Bs}from"./index-BGLh42TJ.js";import{u as D}from"./useApi-DN8WZFPX.js";import{M as ue,t as Ws}from"./modal-DfySOKQn.js";import{C as ze}from"./accordion-CYZnIIDj.js";import{v as L,T as u,y as _,a1 as Q,a2 as O,a3 as q,x as X,j as Ps}from"./TextField-IhUWfT1k.js";import{G as x}from"./index-1nOsHyls.js";import{M as S}from"./MenuItem-CxDLM7qu.js";import"./IconButton-D8odhYXc.js";import"./useSlot-DcScONqL.js";import"./confirmationModal-CidaOsZI.js";import"./CircularProgress-C2yr_0Gq.js";import"./index-BZ5_ktoT.js";import"./loadingButton-C3VBQU3Q.js";import"./crystal-land-log-removebg-DVF-nlbN.js";const Us=({userId:T})=>{const[F,c]=r.useState(""),[n,C]=r.useState(""),[h,W]=r.useState([]),[b,z]=r.useState(""),[fe,P]=r.useState(!1),[f,l]=r.useState(!1),[m,U]=r.useState(!1),[Y,H]=r.useState(!1),[me,w]=r.useState(!1),[R,he]=r.useState(!1),[pe,G]=r.useState(""),[Ae,Me]=r.useState(""),[Ee,V]=r.useState(null),[j,$]=r.useState(null),[I,J]=r.useState([]),[k,a]=r.useState({question:"",optionA:"",optionB:"",optionC:"",optionD:"",correctAnswer:"",score:""}),[i,A]=r.useState({name:"",description:"",subject:"",classLevel:"",passMark:"",totalMark:"",duration:"",examDate:"",examTime:"",examType:"test",academicTerm:"",academicYear:"",startDate:"",startTime:"",subclassLetter:[]}),[K,Z]=r.useState([]),[xe,Fe]=r.useState([]),[Te,Ye]=r.useState([]),[je,Be]=r.useState([]),[ee,se]=r.useState([]),[We,te]=r.useState(""),[ye,Pe]=r.useState({}),[Ue,y]=r.useState(""),[ae,Se]=r.useState({startDate:"",startTime:""}),{data:re,loading:$e,error:ke,callApi:Ne}=D(),{data:M,loading:Le,error:be,callApi:d}=D(),{data:N,loading:De,error:g,callApi:Ge}=D(),{data:we,loading:us,error:Xe,callApi:ms}=D(),{data:oe,loading:hs,error:He,callApi:ps}=D(),{data:ne,loading:xs,error:Ve,callApi:Ie}=D(),{data:le,loading:js,error:Je,callApi:Ke}=D(),{data:Ce,loading:gs,error:Ze,callApi:_e}=D(),{data:Qe,loading:fs,error:es,callApi:Ss}=D(),{data:Oe,loading:bs,error:ss,callApi:Cs}=D(),{data:ie,loading:vs,error:ts,callApi:As}=D(),{data:ce,loading:Ms,error:as,callApi:Es}=D(),{data:ve,loading:Ts,error:rs,callApi:os}=D(),{data:de,loading:ys,error:ns,callApi:ls}=D(),{data:ge,loading:Ds,error:Re,callApi:is}=D();r.useEffect(()=>{T?(Ne(`${E.CLASS_LEVEL}/admin/no-sensitive-data`,"GET"),Ie(E.CURRENT_ACADEMIC_TERM,"GET"),Ke(E.ACADEMIC_YEARS,"GET")):(y("User not authenticated"),console.error("Fetch initial data failed: User not authenticated"))},[Ne,Ie,Ke,T]),r.useEffect(()=>{if(T&&n&&b){const s=`${E.ADMIN_EXAM}?classLevel=${n}&academicYear=${b}${h.length>0?`&subclassLetter[]=${h.join("&subclassLetter[]=")}`:""}`;d(s,"GET"),console.log(`Fetching exams with query: ${s}`)}},[d,T,n,h,b]),r.useEffect(()=>{if(T&&n){const s=`${E.SUBJECT}/subclass/filter?classLevel=${n}${h.length>0?`&subclassLetter[]=${h.join("&subclassLetter[]=")}`:""}`;is(s,"GET"),console.log(`Fetching subjects for subclass with query: ${s}`)}else se([]),te("")},[is,T,n,h]),r.useEffect(()=>{if(re!=null&&re.data){const s=re.data.data||[];Be(s.map(t=>{var o;return{_id:t._id,name:t.name,displayName:t.name,subclasses:((o=t.subclasses)==null?void 0:o.map(p=>p.letter))||[],section:t.section||"",isSSClass:["SS 1","SS 2","SS 3"].includes(t.name)}})),console.log("Classes:",s)}},[re]),r.useEffect(()=>{var s;ne!=null&&ne.data&&(Fe(Array.isArray(ne.data)?ne.data:[ne.data]),console.log("Academic Terms:",ne.data)),le!=null&&le.data&&(Ye(le.data||[]),console.log("Academic Years:",le.data),!b&&((s=le.data)==null?void 0:s.length)>0&&z(le.data[0]._id))},[ne,le,b]),r.useEffect(()=>{if(M!=null&&M.data){const s=Array.isArray(M.data)?M.data:M.data.exams||M.data.data||[];Z(s),console.log("Exams set:",s)}else(M==null?void 0:M.status)==="success"&&!M.data&&(Z([]),console.log("Exams set to empty array: No data returned"))},[M]),r.useEffect(()=>{if(ge!=null&&ge.data){const s=Array.isArray(ge.data)?ge.data:ge.data.subjects||[];se(s.map(t=>{var o;return{_id:t._id,name:((o=t.name)==null?void 0:o.name)||"Unknown Subject"}})),te(s.length===0?"No subjects found for this class/subclass":""),console.log("Subjects for subclass:",s)}Re&&(te(`Failed to fetch subjects: ${Re}`),se([]))},[ge,Re]),r.useEffect(()=>{if(M!=null&&M.data){const s=[...new Set(M.data.map(t=>{var o;return(o=t.subject)==null?void 0:o._id}).filter(Boolean))];console.log("Unique subject IDs:",s),s.forEach(t=>{ye[t]||(ls(`${E.SUBJECT}/${t}`,"GET"),console.log(`Fetching subject name for ID: ${t}`))})}},[M,ls,ye]),r.useEffect(()=>{de!=null&&de.data&&(Pe(s=>({...s,[de.data._id]:de.data.name})),console.log("Subject Name:",de.data._id,de.data.name))},[de]),r.useEffect(()=>{Ce!=null&&Ce.data&&(J(Ce.data||[]),console.log("Questions:",Ce.data))},[Ce]),r.useEffect(()=>{if(((we==null?void 0:we.status)==="success"||(oe==null?void 0:oe.status)==="success"||(ce==null?void 0:ce.status)==="success")&&n&&b){const s=`${E.ADMIN_EXAM}?classLevel=${n}&academicYear=${b}${h.length>0?`&subclassLetter[]=${h.join("&subclassLetter[]=")}`:""}`;d(s,"GET"),console.log(`Refreshing exams with query: ${s}`)}if((N==null?void 0:N.status)==="success"&&(N!=null&&N.data)){const s=N.data;if(Z(t=>[...t.filter(p=>p._id!==s._id),s]),G("Exam created successfully"),w(!0),console.log("New exam added to state:",s),n&&b){const t=`${E.ADMIN_EXAM}?classLevel=${n}&academicYear=${b}${h.length>0?`&subclassLetter[]=${h.join("&subclassLetter[]=")}`:""}`;d(t,"GET"),console.log(`Refreshing exams after create with query: ${t}`)}}((Qe==null?void 0:Qe.status)==="success"||(Oe==null?void 0:Oe.status)==="success"||(ie==null?void 0:ie.status)==="success")&&(_e(`${E.ADMIN_EXAM}/${j==null?void 0:j._id}/questions`,"GET"),console.log(`Refreshing questions for exam ${j==null?void 0:j._id}`))},[N,we,oe,ce,Qe,Oe,ie,d,_e,n,h,b,j]),r.useEffect(()=>{(oe==null?void 0:oe.status)==="success"&&(G("Exam deleted successfully"),w(!0)),(ie==null?void 0:ie.status)==="success"&&(G("Question deleted successfully"),w(!0)),(ce==null?void 0:ce.status)==="success"&&(G("Exam approved successfully"),w(!0))},[oe,ie,ce]),r.useEffect(()=>{j!=null&&j._id&&(_e(`${E.ADMIN_EXAM}/${j._id}/questions`,"GET"),os(`${E.ADMIN_EXAM}/${j._id}/scores`,"GET"),console.log(`Fetching questions and scores for exam ${j._id}`))},[j,_e,os]),r.useEffect(()=>{const t=[ke,be&&`Failed to fetch exams: ${be}`,Ve,Je,g,Xe&&`Failed to update exam: ${Xe}`,He,Ze,es,ss,ts,as,rs,ns].filter(Boolean).join("; ")||"";y(t),console.error("API Errors:",t)},[ke,be,Ve,Je,g,Xe,He,Ze,es,ss,ts,as,rs,ns]);const _s=s=>{const{name:t,value:o}=s.target;Se(p=>({...p,[t]:o})),console.log("Approval input change:",t,o)},$s=async s=>{console.log(ae);try{const t=K.find(v=>v._id===s);if(!t){y("Selected exam not found"),console.error("Exam approve error: Exam not found",s);return}$(t);let o=I;if(!o||o.length===0||(j==null?void 0:j._id)!==s){const v=await _e(`${E.ADMIN_EXAM}/${s}/questions`,"GET");o=(v==null?void 0:v.data)||[],console.log(`Fetched questions for exam ${s}:`,o),J(o)}const p=o.reduce((v,B)=>v+(Number(B.score)||0),0);if(p!==Number(t.totalMark)){Me(`Total score of questions (${p}) does not match the exam’s total mark (${t.totalMark}).`),he(!0),console.error("Score mismatch:",{totalQuestionScores:p,examTotalMark:t.totalMark});return}G("Please provide start date and time to approve this exam."),V(()=>async()=>{if(!ae.startDate||!ae.startTime){y("Start date and time are required for approval"),console.error("Exam approve error: Missing start date or time");return}try{await Es(`${E.ADMIN_EXAM}/${s}/approve`,"PATCH",{startDate:ae.startDate,startTime:ae.startTime}),H(!1),Se({startDate:"",startTime:""}),G("Exam approved successfully"),w(!0),console.log("Exam approved:",s)}catch(v){y(v.message||"Failed to approve exam"),H(!1),console.error("Exam approve error:",v.message)}}),H(!0)}catch(t){y(t.message||"Failed to process exam approval"),console.error("Exam approve error:",t.message)}},ks=r.useCallback(()=>!ee||!n?(console.log("No subjects: subjectsForSubclass or selectedClass missing",{subjectsForSubclass:ee,selectedClass:n}),[]):(console.log(`Subjects for class ${n}${h.length>0?`, subclass ${h.join(", ")}`:""}:`,ee),ee),[ee,n,h]),Ns=r.useCallback((s,t)=>{const o=K.filter(p=>{var v;return p.classLevel===s&&((v=p.subject)==null?void 0:v._id)===t&&p.academicYear===b&&(h.length===0||h.some(B=>p.subclassLetter.includes(B)))});return console.log(`Filtered exams for class ${s}, subject ${t}${h.length>0?`, subclass ${h.join(", ")}`:""}, academic year ${b}:`,o),o},[K,h,b]),Ls=r.useCallback(s=>{if(!(ve!=null&&ve.data)||!s)return console.log("No test scores: testScoresData or exam missing",{testScoresData:ve,exam:s}),[];const t=ve.data.map((o,p)=>{var v,B;return{sn:p+1,studentName:`${((v=o.student)==null?void 0:v.firstName)||""} ${((B=o.student)==null?void 0:B.lastName)||""}`,score:o.score,date:new Date(o.date).toLocaleDateString()}});return console.log("Test scores for exam",s==null?void 0:s._id,":",t),t},[ve]),ws=r.useCallback(()=>{const s=[...new Set(je.map(t=>t.section))].filter(Boolean);return console.log("Sections:",s),s.sort()},[je]),Qs=r.useCallback(s=>{const t=je.filter(o=>o.section===s);return console.log("Classes for section",s,":",t),t},[je]),Os=s=>{c(s.target.value),C(""),W([]),$(null),Z([]),se([]),te(""),console.log("Selected section:",s.target.value)},qs=s=>{C(s.target.value),W([]),$(null),Z([]),se([]),te(""),console.log("Selected class:",s.target.value)},Fs=s=>{W(s.target.value),$(null),console.log("Selected subclass:",s.target.value)},Ys=s=>{z(s.target.value),$(null),Z([]),console.log("Selected academic year:",s.target.value)},cs=r.useCallback((s,t)=>{C(s),W(t||[]),se([]),te(""),console.log("Modal class/subclass change:",s,t)},[]);return{selectedSection:F,selectedClass:n,subclassLetter:h,selectedAcademicYear:b,questionsModalOpen:fe,examModalOpen:f,deleteConfirmModalOpen:m,approveConfirmModalOpen:Y,successModalOpen:me,scoreMismatchModalOpen:R,confirmationMessage:pe,confirmationAction:Ee,scoreMismatchMessage:Ae,selectedExam:j,questions:I,newQuestion:k,newExam:i,exams:K,academicTerms:xe,academicYears:Te,classes:je,subjectsForSubclass:ee,subjectsError:We,subjectNames:ye,error:Ue,approveExamData:ae,handleApproveInputChange:_s,loading:$e||Le||xs||js||gs||De||us||hs||fs||bs||vs||Ms||Ts||ys||Ds,getSections:ws,getClassesForSection:Qs,getSubjectsForClass:ks,getExamsForSubject:Ns,getTestScoresData:Ls,handleSectionChange:Os,handleClassChange:qs,handleSubclassChange:Fs,handleAcademicYearChange:Ys,handleClassOrSubclassChange:cs,openQuestionsModal:s=>{$(s),P(!0),console.log("Opening questions modal for exam:",s._id)},openExamModal:(s=null)=>{var t,o,p,v;s?($(s),A({_id:s._id,name:s.name,description:s.description,subject:((t=s.subject)==null?void 0:t._id)||"",classLevel:s.classLevel,passMark:s.passMark,totalMark:s.totalMark,duration:s.duration,examDate:s.examDate?s.examDate.split("T")[0]:"",examTime:s.examTime,examType:s.examType,academicTerm:s.academicTerm,academicYear:s.academicYear,startDate:s.startDate?s.startDate.split("T")[0]:"",startTime:s.startTime||"",subclassLetter:s.subclassLetter||[]})):($(null),A({name:"",description:"",subject:"",classLevel:n||"",passMark:"",totalMark:"",duration:"",examDate:"",examTime:"",examType:"test",academicTerm:((o=xe.find(B=>B.isCurrent))==null?void 0:o._id)||((p=xe[0])==null?void 0:p._id)||"",academicYear:b||((v=Te[0])==null?void 0:v._id)||"",startDate:"",startTime:"",subclassLetter:h||[]})),l(!0),console.log("Opening exam modal, exam:",s)},handleQuestionInputChange:s=>{const{name:t,value:o}=s.target;a(p=>({...p,[t]:o})),console.log("Question input change:",t,o)},handleOptionChange:(s,t)=>{a(o=>{const p=[o.optionA,o.optionB,o.optionC,o.optionD];return p[s]=t,{...o,optionA:p[0],optionB:p[1],optionC:p[2],optionD:p[3]}}),console.log("Option change:",s,t)},handleAddQuestion:async()=>{const s={question:k.question,optionA:k.optionA,optionB:k.optionB,optionC:k.optionC,optionD:k.optionD,correctAnswer:k.correctAnswer,score:Number(k.score)};try{return await Ss(`${E.ADMIN_EXAM}/${j._id}/questions`,"POST",s),a({question:"",optionA:"",optionB:"",optionC:"",optionD:"",correctAnswer:"",score:""}),console.log("Question added"),Promise.resolve()}catch(t){throw console.error("Question add error:",t.message),new Error(t.message||"Failed to add question")}},handleUpdateQuestion:async(s,t)=>{try{return await Cs(`${E.ADMIN_EXAM}/${j._id}/questions/${s}`,"PATCH",{question:t.question,optionA:t.optionA,optionB:t.optionB,optionC:t.optionC,optionD:t.optionD,correctAnswer:t.correctAnswer,score:Number(t.score)}),console.log("Question updated:",s),Promise.resolve()}catch(o){throw console.error("Question update error:",o.message),new Error(o.message||"Failed to update question")}},handleDeleteQuestion:async s=>{try{return await As(`${E.ADMIN_EXAM}/${j._id}/questions/${s}`,"DELETE"),U(!1),console.log("Question deleted:",s),Promise.resolve()}catch(t){throw y(t.message||"Failed to delete question"),U(!1),console.error("Question delete error:",t.message),new Error(t.message)}},handleApproveExam:$s,handleExamInputChange:s=>{const{name:t,value:o}=s.target;A(p=>({...p,[t]:o})),console.log("Exam input change:",t,o),(t==="classLevel"||t==="subclassLetter")&&cs(t==="classLevel"?o:i.classLevel,t==="subclassLetter"?o:i.subclassLetter)},handleSaveExam:async()=>{var v,B,ds;const s=Number(i.totalMark),t=Number(i.passMark),o=Number(i.duration),p={name:i.name,description:i.description,subject:i.subject,classLevel:i.classLevel,passMark:t,totalMark:s,duration:o,examDate:i.examDate,examTime:i.examTime,examType:i.examType,academicTerm:i.academicTerm,academicYear:i.academicYear,startDate:i.startDate||null,startTime:i.startTime||null,subclassLetter:i.subclassLetter,createdBy:T};try{return j?(await ms(`${E.ADMIN_EXAM}/${j._id}`,"PATCH",p),console.log("Exam updated:",j._id)):(await Ge(E.ADMIN_EXAM,"POST",p),console.log("Exam created")),l(!1),A({name:"",description:"",subject:"",classLevel:n||"",passMark:"",totalMark:"",duration:"",examDate:"",examTime:"",examType:"test",academicTerm:((v=xe.find(qe=>qe.isCurrent))==null?void 0:v._id)||((B=xe[0])==null?void 0:B._id)||"",academicYear:b||((ds=Te[0])==null?void 0:ds._id)||"",startDate:"",startTime:"",subclassLetter:[]}),$(null),Promise.resolve()}catch(qe){throw console.error("Exam save error:",qe.message),new Error(qe.message||"Failed to save exam")}},handleDeleteExam:async s=>{try{return await ps(`${E.ADMIN_EXAM}/${s}`,"DELETE"),U(!1),console.log("Exam deleted:",s),Promise.resolve()}catch(t){throw y(t.message||"Failed to delete exam"),U(!1),console.error("Exam delete error:",t.message),new Error(t.message)}},setQuestionsModalOpen:P,setExamModalOpen:l,setDeleteConfirmModalOpen:U,setApproveConfirmModalOpen:H,setSuccessModalOpen:w,setScoreMismatchModalOpen:he}},Gs=({open:T,onClose:F,selectedExam:c,questions:n,newQuestion:C,handleQuestionInputChange:h,handleOptionChange:W,handleAddQuestion:b,handleUpdateQuestion:z,handleDeleteQuestion:fe,getTestScoresData:P,colors:f})=>{const[l,m]=r.useState(null),[U,Y]=r.useState(""),[H,me]=r.useState(!1),[w,R]=r.useState(null),[he,pe]=r.useState(!1),[G,Ae]=r.useState(""),Me=a=>{R(a),me(!0)},Ee=()=>{w&&(fe(w),me(!1),R(null))},V=()=>{if(!l.question||!l.optionA||!l.optionB||!l.optionC||!l.optionD||!l.correctAnswer||!l.score){Y("Please fill all question fields, including score");return}const a=Number(l.score);if(a<=0){Y("Score must be greater than zero");return}if(n.filter(A=>A._id!==l._id).reduce((A,K)=>A+(Number(K.score)||0),0)+a>c.totalMark){Y("Total score for questions cannot exceed exam’s total mark");return}if(![l.optionA,l.optionB,l.optionC,l.optionD].includes(l.correctAnswer)){Y("Correct answer must match one of the provided options");return}z(l._id,{question:l.question,optionA:l.optionA,optionB:l.optionB,optionC:l.optionC,optionD:l.optionD,correctAnswer:l.correctAnswer,score:a}).then(()=>{pe(!0),Ae("Question updated successfully"),m(null),Y("")})},j=()=>{m(null),Y("")},$=n.reduce((a,i)=>a+(Number(i.score)||0),0),I=c?c.totalMark-$:0,J=n.map((a,i)=>({id:a._id,sn:i+1,_id:a._id,question:a.question,correctAnswer:a.correctAnswer,score:a.score,optionA:a.optionA,optionB:a.optionB,optionC:a.optionC,optionD:a.optionD}));console.log("AdminQuestionsModal - Questions Data:",J);const k=c?P(c).map((a,i)=>({id:a._id,sn:i+1,studentName:a.studentName,score:a.score,date:a.date})):[];return console.log("AdminQuestionsModal - Test Scores Data:",k),e.jsx(ue,{open:T,onClose:()=>{F(),m(null),Y(""),pe(!1)},title:c?`Manage Questions for ${c.name} (${c.subclassLetter.join(", ")})`:"Manage Questions",noConfirm:!0,children:e.jsxs(L,{sx:{p:2},children:[U&&e.jsx(u,{color:"error",sx:{mb:2},children:U}),c&&e.jsxs(u,{sx:{mb:2,color:"#000"},children:["Total Marks: ",c.totalMark," | Current Total: ",$," | Remaining:"," ",I]}),e.jsx(u,{variant:"h6",sx:{mb:2,color:"#000"},children:"Add New Question"}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(_,{fullWidth:!0,label:"Question",name:"question",value:C.question,onChange:h,variant:"outlined"})}),["optionA","optionB","optionC","optionD"].map((a,i)=>e.jsx(x,{item:!0,xs:6,children:e.jsx(_,{fullWidth:!0,label:`Option ${i+1}`,value:C[a],onChange:A=>W(i,A.target.value),variant:"outlined"})},i)),e.jsx(x,{item:!0,xs:6,children:e.jsxs(Q,{fullWidth:!0,children:[e.jsx(O,{children:"Correct Answer"}),e.jsxs(q,{name:"correctAnswer",value:C.correctAnswer,onChange:h,label:"Correct Answer",children:[e.jsx(S,{value:"",children:e.jsx("em",{children:"Select correct answer"})}),[C.optionA,C.optionB,C.optionC,C.optionD].map((a,i)=>e.jsx(S,{value:a,disabled:!a,children:a||`Option ${i+1}`},i))]})]})}),e.jsx(x,{item:!0,xs:6,children:e.jsx(_,{fullWidth:!0,label:"Score",name:"score",type:"number",value:C.score,onChange:h,variant:"outlined",inputProps:{min:1,max:I}})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(X,{variant:"contained",color:"primary",onClick:b,children:"Add Question"})})]}),l&&e.jsxs(L,{sx:{mt:4},children:[e.jsx(u,{variant:"h6",sx:{mb:2,color:"#000"},children:"Edit Question"}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(_,{fullWidth:!0,label:"Question",value:l.question||"",onChange:a=>m({...l,question:a.target.value}),variant:"outlined"})}),["optionA","optionB","optionC","optionD"].map((a,i)=>e.jsx(x,{item:!0,xs:6,children:e.jsx(_,{fullWidth:!0,label:`Option ${i+1}`,value:l[a]||"",onChange:A=>m({...l,[a]:A.target.value}),variant:"outlined"})},i)),e.jsx(x,{item:!0,xs:6,children:e.jsxs(Q,{fullWidth:!0,children:[e.jsx(O,{children:"Correct Answer"}),e.jsxs(q,{value:l.correctAnswer||"",onChange:a=>m({...l,correctAnswer:a.target.value}),label:"Correct Answer",children:[e.jsx(S,{value:"",children:e.jsx("em",{children:"Select correct answer"})}),[l.optionA,l.optionB,l.optionC,l.optionD].map((a,i)=>e.jsx(S,{value:a,disabled:!a,children:a||`Option ${i+1}`},i))]})]})}),e.jsx(x,{item:!0,xs:6,children:e.jsx(_,{fullWidth:!0,label:"Score",type:"number",value:l.score||"",onChange:a=>m({...l,score:a.target.value}),variant:"outlined",inputProps:{min:1,max:I+(Number(l.score)||0)}})}),e.jsxs(x,{item:!0,xs:12,children:[e.jsx(X,{variant:"contained",color:"primary",onClick:V,children:"Save Changes"}),e.jsx(X,{variant:"outlined",color:"secondary",onClick:j,sx:{ml:2},children:"Cancel"})]})]})]}),e.jsx(ze,{title:"Existing Questions",details:e.jsxs(L,{sx:{p:2,minHeight:"100px"},children:[e.jsx(u,{variant:"h6",sx:{mb:2,color:"#000"},children:"Questions"}),J.length>0?J.map(a=>{var i,A;return e.jsxs(L,{sx:{mb:2,p:2,border:`1px solid ${((i=f==null?void 0:f.primary)==null?void 0:i[200])||"#ccc"}`,borderRadius:"4px",backgroundColor:((A=f==null?void 0:f.primary)==null?void 0:A[400])||"#f5f5f5",color:"#000"},children:[e.jsxs(u,{children:[e.jsx("strong",{children:"S/N:"})," ",a.sn]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Question:"})," ",a.question]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Option A:"})," ",a.optionA]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Option B:"})," ",a.optionB]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Option C:"})," ",a.optionC]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Option D:"})," ",a.optionD]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Correct Answer:"})," ",a.correctAnswer]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Score:"})," ",a.score]}),e.jsxs(L,{display:"flex",gap:"10px",sx:{mt:1},children:[e.jsx(X,{variant:"contained",color:"secondary",size:"small",onClick:()=>m(a),children:"Edit"}),e.jsx(X,{variant:"contained",color:"error",size:"small",onClick:()=>Me(a._id),children:"Delete"})]})]},a._id)}):e.jsx(u,{color:"#000",children:"No questions available for this exam."})]}),colors:f,defaultExpanded:!0}),e.jsx(ze,{title:"Test Scores",details:e.jsxs(L,{sx:{p:2,minHeight:"100px"},children:[e.jsx(u,{variant:"h6",sx:{mb:2,color:"#000"},children:"Scores"}),k.length>0?k.map(a=>{var i,A;return e.jsxs(L,{sx:{mb:2,p:2,border:`1px solid ${((i=f==null?void 0:f.primary)==null?void 0:i[200])||"#ccc"}`,borderRadius:"4px",backgroundColor:((A=f==null?void 0:f.primary)==null?void 0:A[400])||"#f5f5f5",color:"#000"},children:[e.jsxs(u,{children:[e.jsx("strong",{children:"S/N:"})," ",a.sn]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Student Name:"})," ",a.studentName]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Score:"})," ",a.score]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Date:"})," ",a.date]})]},a.id)}):e.jsx(u,{color:"#000",children:"No test scores available for this exam."})]}),colors:f,defaultExpanded:!0}),e.jsx(ue,{open:H,onClose:()=>me(!1),title:"Confirm Delete Question",confirmText:"Delete",onConfirm:Ee,showCancel:!0,cancelText:"Cancel",children:e.jsx(u,{children:"Are you sure you want to delete this question?"})}),e.jsx(ue,{open:he,onClose:()=>pe(!1),title:"Success",noConfirm:!0,children:e.jsx(u,{children:G})})]})})},Xs=({open:T,onClose:F,newExam:c,handleExamInputChange:n,handleSaveExam:C,classes:h,subjects:W,academicTerms:b,academicYears:z,colors:fe,isEditing:P})=>{const f=h.find(m=>m._id===c.classLevel),l=(f==null?void 0:f.isSSClass)||!1;return e.jsx(ue,{open:T,onClose:F,title:P?"Edit Exam":"Create New Exam",onConfirm:C,confirmText:P?"Save Changes":"Create Exam",showCancel:!0,cancelText:"Cancel",children:e.jsx(L,{children:e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(_,{fullWidth:!0,label:"Exam Name",name:"name",value:c.name,onChange:n,variant:"outlined",required:!0})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(_,{fullWidth:!0,label:"Description",name:"description",value:c.description,onChange:n,variant:"outlined",multiline:!0,rows:3,required:!0})}),e.jsx(x,{item:!0,xs:12,children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(O,{children:"Class"}),e.jsxs(q,{name:"classLevel",value:c.classLevel,onChange:n,label:"Class",children:[e.jsx(S,{value:"",children:e.jsx("em",{children:"Select a class"})}),h.map(m=>e.jsx(S,{value:m._id,children:m.displayName},m._id))]})]})}),c.classLevel&&e.jsx(x,{item:!0,xs:12,children:e.jsxs(Q,{fullWidth:!0,required:l,children:[e.jsx(O,{children:"Subclass"}),e.jsxs(q,{multiple:l,name:"subclassLetter",value:c.subclassLetter,onChange:n,label:"Subclass",renderValue:m=>m.join(", "),children:[e.jsx(S,{value:"",disabled:l,children:e.jsx("em",{children:l?"Select subclasses":"No subclasses"})}),((f==null?void 0:f.subclasses)||[]).map(m=>e.jsx(S,{value:m,children:m},m))]})]})}),e.jsx(x,{item:!0,xs:12,children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(O,{children:"Subject"}),e.jsxs(q,{name:"subject",value:c.subject,onChange:n,label:"Subject",children:[e.jsx(S,{value:"",children:e.jsx("em",{children:"Select a subject"})}),W.map(m=>e.jsx(S,{value:m._id,children:m.name},m._id))]})]})}),e.jsx(x,{item:!0,xs:6,children:e.jsx(_,{fullWidth:!0,label:"Pass Mark",name:"passMark",type:"number",value:c.passMark,onChange:n,variant:"outlined",required:!0,inputProps:{max:c.totalMark||100,min:0}})}),e.jsx(x,{item:!0,xs:6,children:e.jsx(_,{fullWidth:!0,label:"Total Mark",name:"totalMark",type:"number",value:c.totalMark,onChange:n,variant:"outlined",required:!0,inputProps:{max:100,min:0}})}),e.jsx(x,{item:!0,xs:6,children:e.jsx(_,{fullWidth:!0,label:"Duration (minutes)",name:"duration",type:"number",value:c.duration,onChange:n,variant:"outlined",required:!0,inputProps:{min:1}})}),e.jsx(x,{item:!0,xs:6,children:e.jsx(_,{fullWidth:!0,label:"Exam Date",name:"examDate",type:"date",value:c.examDate,onChange:n,variant:"outlined",InputLabelProps:{shrink:!0},required:!0})}),e.jsx(x,{item:!0,xs:6,children:e.jsx(_,{fullWidth:!0,label:"Exam Time",name:"examTime",type:"time",value:c.examTime,onChange:n,variant:"outlined",InputLabelProps:{shrink:!0},required:!0})}),e.jsx(x,{item:!0,xs:6,children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(O,{children:"Exam Type"}),e.jsxs(q,{name:"examType",value:c.examType,onChange:n,label:"Exam Type",children:[e.jsx(S,{value:"test",children:"Test"}),e.jsx(S,{value:"exam",children:"Exam"})]})]})}),e.jsx(x,{item:!0,xs:6,children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(O,{children:"Academic Term"}),e.jsxs(q,{name:"academicTerm",value:c.academicTerm,onChange:n,label:"Academic Term",children:[e.jsx(S,{value:"",children:e.jsx("em",{children:"Select a term"})}),b.length>0?b.map(m=>e.jsx(S,{value:m._id,children:m.name},m._id)):e.jsx(S,{value:"",disabled:!0,children:e.jsx("em",{children:"No academic terms available"})})]})]})}),e.jsx(x,{item:!0,xs:6,children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(O,{children:"Academic Year"}),e.jsxs(q,{name:"academicYear",value:c.academicYear,onChange:n,label:"Academic Year",children:[e.jsx(S,{value:"",children:e.jsx("em",{children:"Select a year"})}),z.map(m=>e.jsx(S,{value:m._id,children:m.name},m._id))]})]})})]})})})},Rs=({open:T,onClose:F,onConfirm:c,message:n,approveExamData:C,handleApproveInputChange:h})=>e.jsx(ue,{open:T,onClose:F,title:"Approve Exam",confirmText:"Approve",onConfirm:c,showCancel:!0,cancelText:"Cancel",children:e.jsxs(L,{children:[e.jsx(u,{sx:{mb:2,color:"#000"},children:n}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(_,{fullWidth:!0,label:"Start Date",name:"startDate",type:"date",value:C.startDate,onChange:h,variant:"outlined",InputLabelProps:{shrink:!0},required:!0})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(_,{fullWidth:!0,label:"Start Time",name:"startTime",type:"time",value:C.startTime,onChange:h,variant:"outlined",InputLabelProps:{shrink:!0},required:!0})})]})]})}),gt=()=>{var Le,be;const T=Bs(d=>{var N;return(N=d.users)==null?void 0:N.user._id}),{selectedSection:F,selectedClass:c,subclassLetter:n,selectedAcademicYear:C,questionsModalOpen:h,examModalOpen:W,approveConfirmModalOpen:b,successModalOpen:z,scoreMismatchModalOpen:fe,confirmationMessage:P,confirmationAction:f,selectedExam:l,questions:m,newQuestion:U,newExam:Y,exams:H,academicTerms:me,academicYears:w,classes:R,error:he,approveExamData:pe,handleApproveInputChange:G,scoreMismatchMessage:Ae,getSections:Me,getClassesForSection:Ee,getSubjectsForClass:V,getExamsForSubject:j,getTestScoresData:$,handleSectionChange:I,handleClassChange:J,handleSubclassChange:k,handleAcademicYearChange:a,openQuestionsModal:i,openExamModal:A,handleQuestionInputChange:K,handleOptionChange:Z,handleAddQuestion:xe,handleUpdateQuestion:Fe,handleDeleteQuestion:Te,handleApproveExam:Ye,handleExamInputChange:je,handleSaveExam:Be,handleDeleteExam:ee,setQuestionsModalOpen:se,setExamModalOpen:We,setApproveConfirmModalOpen:te,setSuccessModalOpen:ye,setScoreMismatchModalOpen:Pe}=Us({userId:T}),Ue=Ps(),y=Ws(Ue.palette.mode),[ae,Se]=r.useState(!1),[re,$e]=r.useState(null),ke=d=>{$e(d),Se(!0)},Ne=()=>{re&&(ee(re),Se(!1),$e(null))},M=c?(Le=R.find(d=>d._id===c))==null?void 0:Le.isSSClass:!1;return console.log("AdminExamManagement - User ID:",T),console.log("AdminExamManagement - Exams:",H),console.log("AdminExamManagement - Selected Class:",c),console.log("AdminExamManagement - Subjects:",V(c)),console.log("AdminExamManagement - Subclass Letter:",n),console.log("AdminExamManagement - Academic Year:",C),console.log("AdminExamManagement - Classes:",R),console.log("AdminExamManagement - Colors:",y),e.jsxs(L,{m:"20px",children:[e.jsx(u,{variant:"h4",sx:{mb:2,color:"#000"},children:"Admin Exam Management"}),he&&e.jsx(u,{color:"error",sx:{mb:2},children:he}),e.jsxs(Q,{sx:{minWidth:200,mb:2},children:[e.jsx(O,{children:"Select Academic Year"}),e.jsxs(q,{value:C,onChange:a,children:[e.jsx(S,{value:"",children:e.jsx("em",{children:"Select an academic year"})}),w.map(d=>e.jsx(S,{value:d._id,children:d.name},d._id))]})]}),e.jsxs(Q,{sx:{minWidth:200,mb:2,ml:2},children:[e.jsx(O,{children:"Select Section"}),e.jsxs(q,{value:F,onChange:I,children:[e.jsx(S,{value:"",children:e.jsx("em",{children:"Select a section"})}),Me().map(d=>e.jsx(S,{value:d,children:d},d))]})]}),F&&e.jsxs(Q,{sx:{minWidth:200,mb:2,ml:2},children:[e.jsx(O,{children:"Select Class"}),e.jsxs(q,{value:c,onChange:J,children:[e.jsx(S,{value:"",children:e.jsx("em",{children:"Select a class"})}),Ee(F).map(d=>e.jsx(S,{value:d._id,children:d.displayName},d._id))]})]}),c&&e.jsxs(Q,{sx:{minWidth:200,mb:2,ml:2},children:[e.jsx(O,{children:"Select Subclass"}),e.jsxs(q,{multiple:M,value:n,onChange:k,renderValue:d=>d.join(", "),children:[e.jsx(S,{value:"",disabled:!M,children:e.jsx("em",{children:M?"Select subclasses":"No subclasses"})}),(((be=R.find(d=>d._id===c))==null?void 0:be.subclasses)||[]).map(d=>e.jsx(S,{value:d,children:d},d))]})]}),e.jsx(X,{variant:"contained",color:"primary",onClick:()=>A(),sx:{mb:2,ml:2},disabled:!c||!C,children:"Create New Exam"}),c&&C?V(c).length>0?V(c).map(d=>{const N=j(c,d._id);console.log(`Rendering accordion for subject ${d._id} (${d.name}):`,N);const De=N.map((g,Ge)=>({id:g._id,sn:Ge+1,_id:g._id,name:g.name,description:g.description,examType:g.examType,totalMark:g.totalMark,passMark:g.passMark,examStatus:g.examStatus,subclassLetter:g.subclassLetter.join(", ")}));return console.log(`Table data for subject ${d._id} (${d.name}):`,De),e.jsx(ze,{title:d.name,colors:y,defaultExpanded:!1,details:e.jsxs(L,{sx:{p:2},children:[e.jsxs(u,{variant:"h6",sx:{mb:2,color:"#000"},children:["Exams for ",d.name,n.length>0?` (${n.join(", ")})`:""]}),De.length>0?De.map(g=>e.jsxs(L,{sx:{mb:2,p:2,border:`1px solid ${y.primary[200]}`,borderRadius:"4px",backgroundColor:y.primary[400],color:"#000"},children:[e.jsxs(u,{children:[e.jsx("strong",{children:"S/N:"})," ",g.sn]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Exam Name:"})," ",g.name]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Description:"})," ",g.description]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Type:"})," ",g.examType]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Total Mark:"})," ",g.totalMark]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Pass Mark:"})," ",g.passMark]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Status:"})," ",g.examStatus]}),e.jsxs(u,{children:[e.jsx("strong",{children:"Subclasses:"})," ",g.subclassLetter]}),e.jsxs(L,{display:"flex",gap:"10px",sx:{mt:1},children:[e.jsx(X,{variant:"contained",color:"primary",size:"small",onClick:()=>i(g),disabled:g.examStatus==="approved",children:"Manage Questions"}),e.jsx(X,{variant:"contained",color:"secondary",size:"small",onClick:()=>A(g),children:"Edit"}),e.jsx(X,{variant:"contained",color:"error",size:"small",onClick:()=>ke(g._id),children:"Delete"}),g.examStatus==="approved"?e.jsx(u,{color:"success.main",children:"Exam has been approved"}):e.jsx(X,{variant:"contained",color:"success",size:"small",onClick:()=>Ye(g._id),children:"Approve"})]})]},g._id)):e.jsxs(u,{color:"#000",children:["No exams available for ",d.name,n.length>0?` (${n.join(", ")})`:"","."]})]})},d._id)}):e.jsxs(u,{color:"#000",children:["No exams yet for this class",n.length>0?` (${n.join(", ")})`:"","."]}):e.jsx(u,{color:"#000",children:"Please select a class, subclass, and academic year to view exams"}),e.jsx(ue,{open:ae,onClose:()=>Se(!1),title:"Confirm Delete Exam",confirmText:"Delete",onConfirm:Ne,showCancel:!0,cancelText:"Cancel",children:e.jsx(u,{children:"Are you sure you want to delete this exam?"})}),e.jsx(Rs,{open:b,onClose:()=>{te(!1),setApproveExamData({startDate:"",startTime:""})},onConfirm:f,message:P,approveExamData:pe,handleApproveInputChange:G}),e.jsx(ue,{open:z,onClose:()=>ye(!1),title:"Success",noConfirm:!0,children:e.jsx(u,{children:P})}),e.jsx(ue,{open:fe,onClose:()=>Pe(!1),title:"Score Mismatch",noConfirm:!0,children:e.jsx(u,{children:Ae})}),e.jsx(Gs,{open:h,onClose:()=>{se(!1),setSelectedExam(null)},selectedExam:l,questions:m,newQuestion:U,handleQuestionInputChange:K,handleOptionChange:Z,handleAddQuestion:xe,handleUpdateQuestion:Fe,handleDeleteQuestion:Te,getTestScoresData:$,colors:y}),e.jsx(Xs,{open:W,onClose:()=>{We(!1),setSelectedExam(null)},newExam:Y,handleExamInputChange:je,handleSaveExam:Be,classes:R,subjects:V(c),academicTerms:me,academicYears:w,colors:y,isEditing:!!l})]})};export{gt as default};
