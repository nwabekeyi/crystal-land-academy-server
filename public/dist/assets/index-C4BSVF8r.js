var Ee=Object.defineProperty;var ve=(a,r,i)=>r in a?Ee(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i;var xe=(a,r,i)=>ve(a,typeof r!="symbol"?r+"":r,i);import{j as e,r as u,a as he,e as F,i as ke,R as Ie}from"./index-CmongNqj.js";import{u as ne}from"./useApi-DRHDw2QR.js";import{H as Ye}from"./Header-C-IOg9fy.js";import{t as je,M as pe}from"./modal-DOkj5b5S.js";import{c as fe,a as Fe,g as Me,u as Pe,_ as Re,b as te,s as _e,d as $e,h as se,e as Be,a4 as Ne,i as Oe,j as Se,v as j,T as v,P as ze,y as K,x as Ae,a1 as Le,a2 as qe,a3 as Ue}from"./TextField-BRCl01nD.js";import{A as Ge,G as de}from"./index-DlEtA_4g.js";import{T as We}from"./table-POZbbwRY.js";import{S as He,F as ye}from"./FormControlLabel-Y2j__1_d.js";import{M as Ve}from"./MenuItem-CBa9F7RL.js";import{A as Te}from"./confirmationModal-DmU1e-AI.js";import{j as Qe,k as Je,l as Ke}from"./index-CYDaGODW.js";import{I as ue}from"./IconButton-BxixnWx-.js";import{w as Xe}from"./dasboardPagesContainer-Dlct0AZS.js";import"./index-Cdxudna_.js";import"./loadingButton-Cu9NSFum.js";import"./CircularProgress-CJ7ctfkv.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-Ctrqk4ly.js";import"./useMediaQuery-GijD3KK4.js";const Ze=fe(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),et=fe(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),tt=fe(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function at(a){return Me("MuiCheckbox",a)}const me=Fe("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),rt=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],nt=a=>{const{classes:r,indeterminate:i,color:n,size:f}=a,A={root:["root",i&&"indeterminate",`color${se(n)}`,`size${se(f)}`]},l=Be(A,at,r);return te({},r,l)},st=_e(He,{shouldForwardProp:a=>Ne(a)||a==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(a,r)=>{const{ownerState:i}=a;return[r.root,i.indeterminate&&r.indeterminate,r[`size${se(i.size)}`],i.color!=="default"&&r[`color${se(i.color)}`]]}})(({theme:a,ownerState:r})=>te({color:(a.vars||a).palette.text.secondary},!r.disableRipple&&{"&:hover":{backgroundColor:a.vars?`rgba(${r.color==="default"?a.vars.palette.action.activeChannel:a.vars.palette[r.color].mainChannel} / ${a.vars.palette.action.hoverOpacity})`:Oe(r.color==="default"?a.palette.action.active:a.palette[r.color].main,a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},r.color!=="default"&&{[`&.${me.checked}, &.${me.indeterminate}`]:{color:(a.vars||a).palette[r.color].main},[`&.${me.disabled}`]:{color:(a.vars||a).palette.action.disabled}})),ot=e.jsx(et,{}),ct=e.jsx(Ze,{}),it=e.jsx(tt,{}),we=u.forwardRef(function(r,i){var n,f;const A=Pe({props:r,name:"MuiCheckbox"}),{checkedIcon:l=ot,color:S="primary",icon:g=ct,indeterminate:k=!1,indeterminateIcon:Y=it,inputProps:x,size:o="medium",className:_}=A,E=Re(A,rt),$=k?Y:g,O=k?Y:l,B=te({},A,{color:S,indeterminate:k,size:o}),T=nt(B);return e.jsx(st,te({type:"checkbox",inputProps:te({"data-indeterminate":k},x),icon:u.cloneElement($,{fontSize:(n=$.props.fontSize)!=null?n:o}),checkedIcon:u.cloneElement(O,{fontSize:(f=O.props.fontSize)!=null?f:o}),ownerState:B,ref:i,className:$e(T.root,_)},E,{classes:T}))}),lt=()=>{const[a,r]=u.useState(""),[i,n]=u.useState(""),[f,A]=u.useState([]),l=he(Y=>Y.users.user),{loading:S,data:g,callApi:k}=ne();return u.useEffect(()=>{k(F.COURSES,"GET")},[]),u.useEffect(()=>{if(g&&g.courses){const Y=g.courses.find(x=>x.courseName===l.program);Y&&(r(Y.courseName),n(Y.duration),A(Y.curriculum||[]))}},[g]),{courseName:a,courseDuration:i,curriculum:f,loading:S}},dt=()=>{const a=Se(),r=je(a.palette.mode),{courseDuration:i,courseName:n,curriculum:f,loading:A}=lt();return e.jsxs(j,{children:[e.jsx(Ye,{title:n||"Primary 2",subtitle:`${i||0} months`}),A?e.jsx(ke,{}):f&&f.length>0?e.jsxs(j,{children:[e.jsx(v,{variant:"h2",gutterBottom:!0,children:"Curriculum"}),e.jsx(j,{sx:{width:"100%"},children:f.map((l,S)=>e.jsxs(ze,{elevation:3,sx:{backgroundColor:r.primary[400],color:r.blueAccent[500],p:3,mb:2,display:"flex",alignItems:"flex-start",gap:2,borderRadius:"12px",boxShadow:"0 3px 10px rgba(0, 0, 0, 0.1)"},children:[e.jsx(Ge,{sx:{bgcolor:r.primary[500],width:40,height:40,fontSize:"18px",color:"white"},children:S+1}),e.jsxs(j,{children:[e.jsxs(v,{variant:"h3",sx:{color:r.blueAccent[200]},children:[l.topic||"No topic available"," "]}),e.jsxs(v,{variant:"body1",color:"textSecondary",sx:{mb:1},children:[l.description||"No description available"," "]}),e.jsxs(v,{variant:"body1",sx:{fontStyle:"italic"},children:["Duration: ",l.duration||"Unknown"," "]}),e.jsxs(v,{variant:"h6",sx:{color:r.blueAccent[200]},children:["Resources: ",Array.isArray(l.resources)?l.resources.join(", "):"No resources available"]})]})]},l._id||S))})]}):e.jsx(v,{variant:"body1",color:"textSecondary",children:"No curriculum available."})]})},ut=({userId:a})=>{const r={id:"",name:"",fromYear:"",toYear:"",isCurrent:!1},i={academicYearId:"",terms:[{name:"1st Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1},{name:"2nd Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1},{name:"3rd Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1}]},[n,f]=u.useState(r),[A,l]=u.useState(i),[S,g]=u.useState({name:"",fromYear:"",toYear:"",general:""}),[k,Y]=u.useState({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]}),[x,o]=u.useState(!1),[_,E]=u.useState(!1),{data:$,loading:O,error:B,callApi:T}=ne(),{data:z,loading:H,error:V,callApi:M}=ne(),{loading:q,callApi:P}=ne();u.useEffect(()=>{T(F.ACADEMIC_YEARS,"GET"),M(F.CURRENT_ACADEMIC_YEAR,"GET")},[T,M]);const Q=($==null?void 0:$.data)||[],I=(z==null?void 0:z.data)||null,U=u.useCallback(s=>{const{name:p,value:d,type:C,checked:h}=s.target,t=C==="checkbox"?h:d;f(c=>({...c,[p]:t})),g(c=>({...c,[p]:"",general:""}))},[]),J=u.useCallback(async s=>{var p,d;if(!a)return g(C=>({...C,general:"User not authenticated. Please log in."})),!1;try{E(!0),g(h=>({...h,general:""}));const C=await P(`${F.ACADEMIC_YEARS}/${s}`,"DELETE");if(!C||C.status!=="success")throw new Error((C==null?void 0:C.message)||"Failed to delete academic year");return await T(F.ACADEMIC_YEARS,"GET"),(I==null?void 0:I._id)===s&&await M(F.CURRENT_ACADEMIC_YEAR,"GET"),!0}catch(C){const h=((d=(p=C.response)==null?void 0:p.data)==null?void 0:d.message)||C.message||"Failed to delete academic year";return g(t=>({...t,general:h})),!1}finally{E(!1)}},[a,P,T,M,I]),G=u.useCallback((s,p,d=!1)=>{const{name:C,value:h,type:t,checked:c}=s.target,D=t==="checkbox"?c:h;l(b=>{const w=[...b.terms];return w[p]={...w[p],[C]:D,createdBy:a},d&&D&&w.forEach((W,le)=>{le!==p&&(W.isCurrent=!1)}),{...b,terms:w}}),Y(b=>({...b,terms:b.terms.map((w,W)=>W===p?{...w,[C]:""}:w),general:""}))},[a]),N=u.useCallback(()=>{const{name:s,fromYear:p,toYear:d,isCurrent:C}=n,h={name:"",fromYear:"",toYear:"",general:""};if(s.trim()?/^\d{4}\/\d{4}$/.test(s.trim())||(h.name="Name must be in format YYYY/YYYY (e.g., 2024/2025)"):h.name="Academic year name is required",p.trim()||(h.fromYear="From year is required"),d.trim()||(h.toYear="To year is required"),p&&d&&new Date(p)>=new Date(d)&&(h.toYear="To year must be after from year"),p&&d){const t=new Date(p),c=new Date(d),D=365*24*60*60*1e3;c-t<D&&(h.general="Academic year must span at least one year")}if(C&&p&&d){const t=new Date,c=new Date;c.setMonth(t.getMonth()+1);const D=new Date(p),b=new Date(d);D>c&&(h.fromYear="Current academic year cannot start more than one month in the future"),b<t&&(h.toYear="Current academic year cannot end in the past")}return g(h),!h.name&&!h.fromYear&&!h.toYear&&!h.general},[n]),X=u.useCallback(()=>{const{terms:s,academicYearId:p}=A,d={general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]};p||(d.general="Academic year ID is required"),(!s||s.length!==3||!s.every(t=>["1st Term","2nd Term","3rd Term"].includes(t.name)))&&(d.general="Exactly three terms (1st Term, 2nd Term, 3rd Term) are required"),s.filter(t=>t.isCurrent).length>1&&(d.general="Only one term can be set as current");const h=Array.from({length:10},(t,c)=>`${c+1} month${c+1>1?"s":""}`);s.forEach((t,c)=>{if(t.description.trim()||(d.terms[c].description="Description is required"),(!t.duration||!h.includes(t.duration))&&(d.terms[c].duration="Duration must be between 1 and 10 months"),t.startDate||(d.terms[c].startDate="Start date is required"),t.endDate||(d.terms[c].endDate="End date is required"),t.startDate&&t.endDate&&new Date(t.startDate)>=new Date(t.endDate)&&(d.terms[c].endDate="End date must be after start date"),t.isCurrent&&t.startDate&&t.endDate){const D=new Date,b=new Date;b.setMonth(D.getMonth()+1);const w=new Date(t.startDate),W=new Date(t.endDate);w>b&&(d.terms[c].startDate=`Term ${t.name} cannot be current: start date is more than one month in the future`),W<D&&(d.terms[c].endDate=`Term ${t.name} cannot be current: end date is in the past`)}});for(let t=0;t<s.length;t++)for(let c=t+1;c<s.length;c++)s[t].startDate&&s[t].endDate&&s[c].startDate&&s[c].endDate&&new Date(s[t].startDate)<=new Date(s[c].endDate)&&new Date(s[c].startDate)<=new Date(s[t].endDate)&&(d.terms[c].startDate=`Terms ${s[t].name} and ${s[c].name} have overlapping dates`);return Y(d),!d.general&&d.terms.every(t=>!t.description&&!t.duration&&!t.startDate&&!t.endDate)},[A]),L=u.useCallback(async()=>{var t,c;if(!N())return!1;if(!a)return g(D=>({...D,general:"User not authenticated. Please log in."})),!1;const{name:s,fromYear:p,toYear:d,isCurrent:C}=n,h={name:s,fromYear:new Date(p).toISOString(),toYear:new Date(d).toISOString(),isCurrent:C,createdBy:a,academicTerms:[],students:[],teachers:[]};try{E(!0),g(b=>({...b,name:"",fromYear:"",toYear:"",general:""}));const D=await P(F.ACADEMIC_YEARS,"POST",h);if(!D||D.status!=="success")throw new Error((D==null?void 0:D.message)||"Failed to create academic year");return await T(F.ACADEMIC_YEARS,"GET"),C&&await M(F.CURRENT_ACADEMIC_YEAR,"GET"),f(r),o(!1),!0}catch(D){const b=((c=(t=D.response)==null?void 0:t.data)==null?void 0:c.message)||D.message||"Failed to create academic year";return g(w=>({...w,general:b})),!1}finally{E(!1)}},[n,a,P,T,M]),y=u.useCallback(async()=>{var C,h;if(!X())return!1;if(!a)return Y(t=>({...t,general:"User not authenticated. Please log in."})),!1;const{terms:s,academicYearId:p}=A,d={academicYearId:p,terms:s.map(t=>({...t,startDate:t.startDate?new Date(t.startDate).toISOString():void 0,endDate:t.endDate?new Date(t.endDate).toISOString():void 0,createdBy:a}))};try{E(!0),Y(c=>({...c,general:"",terms:c.terms.map(()=>({description:"",duration:"",startDate:"",endDate:""}))}));const t=await P(F.ACADEMIC_TERM,"POST",d);if(!t||t.status!=="success")throw new Error((t==null?void 0:t.message)||"Failed to create academic term");return await T(F.ACADEMIC_YEARS,"GET"),l(i),!0}catch(t){const c=((h=(C=t.response)==null?void 0:C.data)==null?void 0:h.message)||t.message||"Failed to create academic term";return Y(D=>({...D,general:c})),!1}finally{E(!1)}},[A,a,P,T]),ae=u.useCallback(async()=>{var c,D;if(!N())return!1;const{id:s,name:p,fromYear:d,toYear:C,isCurrent:h}=n;if(!a)return g(b=>({...b,general:"User not authenticated. Please log in."})),!1;const t={name:p,fromYear:new Date(d).toISOString(),toYear:new Date(C).toISOString(),isCurrent:h,createdBy:a};try{E(!0),g(w=>({...w,name:"",fromYear:"",toYear:"",general:""}));const b=await P(`${F.ACADEMIC_YEARS}/${s}`,"PATCH",t);if(!b||b.status!=="success")throw new Error((b==null?void 0:b.message)||"Failed to update academic year");return await T(F.ACADEMIC_YEARS,"GET"),(h||(I==null?void 0:I._id)===s)&&await M(F.CURRENT_ACADEMIC_YEAR,"GET"),f(r),o(!1),!0}catch(b){const w=((D=(c=b.response)==null?void 0:c.data)==null?void 0:D.message)||b.message||"Failed to update academic year";return g(W=>({...W,general:w})),!1}finally{E(!1)}},[n,a,P,T,M,I]),re=u.useCallback(async()=>x?await ae():await L(),[x,L,ae]),oe=u.useCallback(s=>{f({id:s._id,name:s.name,fromYear:s.fromYear.split("T")[0],toYear:s.toYear.split("T")[0],isCurrent:s.isCurrent}),o(!0),g({name:"",fromYear:"",toYear:"",general:""})},[]),ce=u.useCallback(s=>{l({...i,academicYearId:s,terms:i.terms.map(p=>({...p,createdBy:a}))}),Y({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]})},[a,i]),ie=u.useCallback(()=>{f(r),g({name:"",fromYear:"",toYear:"",general:""}),o(!1)},[]),ge=u.useCallback(()=>{l(defaultTermValues),Y({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]})},[]);return{setFormValues:f,formValues:n,handleChange:U,handleTermChange:G,handleSubmit:re,handleCreateAcademicTerm:y,startEdit:oe,startAddTerm:ce,editMode:x,setEditMode:o,academicYears:Q,currentAcademicYear:I,loading:O||H||q,error:B||V||S.general?{...S,general:B||V||S.general}:S,termError:k,isSubmitting:_,resetForm:ie,resetTermForm:ge,termFormValues:A,handleDeleteAcademicYear:J}},mt=({open:a,onClose:r,handleSubmit:i,error:n={},editMode:f=!1,userId:A,formValues:l,handleChange:S,isSubmitting:g=!1})=>{const k=new Date().toISOString().split("T")[0],Y=()=>{if(!l.fromYear)return k;const o=new Date(l.fromYear);return o.setFullYear(o.getFullYear()+1),o.toISOString().split("T")[0]},x=async o=>{o.preventDefault(),console.log("Form submission attempted with values:",l);try{await i(l)?(console.log("Submission successful"),r()):console.log("Submission failed, handleSubmit returned false")}catch(_){console.error("Submission error:",_)}};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            opacity: 1;
          }
          input[type="date"] {
            color-scheme: light;
          }
        `}),e.jsx(pe,{open:a,onClose:r,title:f?"Edit Academic Year":"Add Academic Year",noConfirm:!0,children:e.jsxs(j,{component:"form",onSubmit:x,children:[e.jsx(j,{mb:2,children:e.jsx(K,{label:"Academic Year Name (e.g., 2024/2025)",name:"name",value:l.name||"",onChange:S,fullWidth:!0,required:!0,error:!!n.name,helperText:n.name||"Format: YYYY/YYYY (e.g., 2024/2025)"})}),e.jsx(j,{mb:2,children:e.jsx(K,{label:"From Year",name:"fromYear",type:"date",value:l.fromYear||"",onChange:S,fullWidth:!0,required:!0,error:!!n.fromYear,helperText:n.fromYear,InputLabelProps:{shrink:!0},inputProps:{min:k}})}),e.jsx(j,{mb:2,children:e.jsx(K,{label:"To Year",name:"toYear",type:"date",value:l.toYear||"",onChange:S,fullWidth:!0,required:!0,error:!!n.toYear,helperText:n.toYear,InputLabelProps:{shrink:!0},inputProps:{min:Y()}})}),e.jsx(j,{mb:2,children:e.jsx(ye,{control:e.jsx(we,{checked:l.isCurrent||!1,onChange:S,name:"isCurrent",color:"primary"}),label:"Set as Current Academic Year"})}),n.general&&e.jsx(v,{variant:"caption",color:"error",mb:2,children:n.general}),e.jsx(Ae,{type:"submit",variant:"contained",color:"primary",disabled:g,fullWidth:!0,children:g?"Submitting...":f?"Update Academic Year":"Submit"})]})})]})},ht=({open:a,onClose:r,handleSubmit:i,error:n={},userId:f,formValues:A,handleChange:l,isSubmitting:S=!1})=>{const g=new Date().toISOString().split("T")[0],k=async x=>{x.preventDefault();try{await i()&&r()}catch(o){console.error("Submission error:",o)}},Y=Array.from({length:10},(x,o)=>`${o+1} month${o+1>1?"s":""}`);return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            opacity: 1;
          }
          input[type="date"] {
            color-scheme: light;
          }
        `}),e.jsx(pe,{open:a,onClose:r,title:"Add Academic Term",noConfirm:!0,children:e.jsxs(j,{component:"form",onSubmit:k,children:[A.terms.map((x,o)=>{var _,E,$,O,B,T,z,H,V,M,q,P,Q,I,U,J,G,N,X,L;return e.jsxs(j,{mb:3,sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(v,{variant:"h6",children:x.name}),e.jsx(j,{mb:2,children:e.jsx(K,{label:"Term Name",name:"name",value:x.name||"",onChange:y=>l(y,o),fullWidth:!0,required:!0,disabled:!0,error:!!((E=(_=n.terms)==null?void 0:_[o])!=null&&E.name),helperText:(O=($=n.terms)==null?void 0:$[o])==null?void 0:O.name})}),e.jsx(j,{mb:2,children:e.jsx(K,{label:"Description",name:"description",value:x.description||"",onChange:y=>l(y,o),fullWidth:!0,required:!0,error:!!((T=(B=n.terms)==null?void 0:B[o])!=null&&T.description),helperText:(H=(z=n.terms)==null?void 0:z[o])==null?void 0:H.description})}),e.jsx(j,{mb:2,children:e.jsxs(Le,{fullWidth:!0,required:!0,error:!!((M=(V=n.terms)==null?void 0:V[o])!=null&&M.duration),children:[e.jsx(qe,{id:`duration-label-${o}`,children:"Duration"}),e.jsx(Ue,{labelId:`duration-label-${o}`,name:"duration",value:x.duration||"3 months",onChange:y=>l(y,o),label:"Duration",children:Y.map(y=>e.jsx(Ve,{value:y,children:y},y))}),((P=(q=n.terms)==null?void 0:q[o])==null?void 0:P.duration)&&e.jsx(v,{variant:"caption",color:"error",children:n.terms[o].duration})]})}),e.jsx(j,{mb:2,children:e.jsx(K,{label:"Start Date",name:"startDate",type:"date",value:x.startDate||"",onChange:y=>l(y,o),fullWidth:!0,required:!0,error:!!((I=(Q=n.terms)==null?void 0:Q[o])!=null&&I.startDate),helperText:(J=(U=n.terms)==null?void 0:U[o])==null?void 0:J.startDate,InputLabelProps:{shrink:!0},inputProps:{min:g}})}),e.jsx(j,{mb:2,children:e.jsx(K,{label:"End Date",name:"endDate",type:"date",value:x.endDate||"",onChange:y=>l(y,o),fullWidth:!0,required:!0,error:!!((N=(G=n.terms)==null?void 0:G[o])!=null&&N.endDate),helperText:(L=(X=n.terms)==null?void 0:X[o])==null?void 0:L.endDate,InputLabelProps:{shrink:!0},inputProps:{min:x.startDate||g}})}),e.jsx(j,{mb:2,children:e.jsx(ye,{control:e.jsx(we,{checked:x.isCurrent||!1,onChange:y=>l(y,o,!0),name:"isCurrent",color:"primary"}),label:"Set as Current Term"})})]},x.name)}),n.general&&e.jsx(v,{variant:"caption",color:"error",mb:2,children:n.general}),e.jsx(Ae,{type:"submit",variant:"contained",color:"primary",disabled:S,fullWidth:!0,children:S?"Submitting...":"Submit"})]})})]})};class pt extends Ie.Component{constructor(){super(...arguments);xe(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(i){return{hasError:!0,error:i}}componentDidCatch(i,n){console.error("Error caught by boundary:",i,n)}render(){var i;return this.state.hasError?e.jsxs(j,{sx:{p:3,textAlign:"center"},children:[e.jsx(v,{variant:"h5",color:"error",children:"Something went wrong."}),e.jsx(v,{variant:"body1",mt:2,children:((i=this.state.error)==null?void 0:i.message)||"An unexpected error occurred."}),e.jsx(Te,{content:"Reload",onClick:()=>window.location.reload(),sx:{mt:2}})]}):this.props.children}}const ft=()=>{var Ce,De,be;const a=Se(),r=je(a.palette.mode),i=he(m=>{var R;return(R=m.users.user)==null?void 0:R._id})||"",{academicYears:n,currentAcademicYear:f,loading:A,error:l,termError:S,handleSubmit:g,handleCreateAcademicTerm:k,handleDeleteAcademicYear:Y,startEdit:x,startAddTerm:o,editMode:_,setEditMode:E,formValues:$,termFormValues:O,handleChange:B,handleTermChange:T,isSubmitting:z,resetForm:H,resetTermForm:V}=ut({userId:i}),[M,q]=u.useState(!1),[P,Q]=u.useState(!1),[I,U]=u.useState(!1),[J,G]=u.useState(null),[N,X]=u.useState("name"),[L,y]=u.useState("asc"),[ae,re]=u.useState(0),[oe,ce]=u.useState(5),[ie,ge]=u.useState(""),s=[{id:"sn",label:"S/N"},{id:"name",label:"Name"},{id:"fromYear",label:"From Year"},{id:"toYear",label:"To Year"},{id:"isCurrent",label:"Current"},{id:"studentCount",label:"Students"},{id:"teacherCount",label:"Teachers"},{id:"actions",label:"Actions"}],p=n.map((m,R)=>{var Z,ee;return{sn:R+1,id:m._id,name:m.name,fromYear:new Date(m.fromYear).toLocaleDateString(),toYear:new Date(m.toYear).toLocaleDateString(),isCurrent:m.isCurrent?"Yes":"No",studentCount:((Z=m.students)==null?void 0:Z.length)||0,teacherCount:((ee=m.teachers)==null?void 0:ee.length)||0,actions:e.jsxs(j,{children:[e.jsx(ue,{onClick:()=>{console.log("EditIcon clicked for academicYearId:",m._id),d(m)},children:e.jsx(Qe,{})}),e.jsx(ue,{onClick:()=>{console.log("AddCircleIcon clicked for academicYearId:",m._id),C(m._id)},children:e.jsx(Je,{})}),e.jsx(ue,{onClick:()=>{console.log("DeleteIcon clicked for academicYearId:",m._id),h(m._id)},children:e.jsx(Ke,{})})]})}}),d=m=>{console.log("handleEdit called with year:",m._id),x(m),q(!0)},C=m=>{console.log("handleAddTerm called with academicYearId:",m);try{o(m),Q(!0)}catch(R){console.error("Error in handleAddTerm:",R)}},h=m=>{G(m),U(!0)},t=async()=>{J&&await Y(J)&&(U(!1),G(null))},c=()=>{U(!1),G(null)},D=m=>{const R=N===m&&L==="asc";X(m),y(R?"desc":"asc")},b=(m,R)=>{re(R)},w=m=>{ce(parseInt(m.target.value,10)),re(0)},le=[...p.filter(m=>m.name.toLowerCase().includes(ie.toLowerCase()))].sort((m,R)=>{const Z=m[N],ee=R[N];return L==="asc"?Z>ee?1:-1:Z<ee?1:-1});return e.jsx(pt,{children:e.jsxs(de,{container:!0,children:[e.jsx(de,{item:!0,xs:12,children:e.jsx(Ye,{title:"Academics Management",subtitle:"Manage Academic Sessions"})}),e.jsx(de,{item:!0,xs:12,children:A?e.jsx(j,{children:"Loading..."}):l.general?e.jsx(j,{sx:{color:"red"},children:l.general}):e.jsxs(e.Fragment,{children:[e.jsxs(j,{sx:{mb:3,p:2,backgroundColor:r.primary[400],borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(j,{children:[e.jsx(v,{variant:"h5",color:r.grey[100],children:"Current Academic Year"}),f?e.jsxs(v,{variant:"body1",color:r.grey[100],children:[f.name," (",new Date(f.fromYear).toLocaleDateString()," -"," ",new Date(f.toYear).toLocaleDateString(),") |"," ",((Ce=f.students)==null?void 0:Ce.length)||0," Students,"," ",((De=f.teachers)==null?void 0:De.length)||0," Teachers,"," ",((be=f.academicTerms)==null?void 0:be.length)||0," Terms"]}):e.jsx(v,{variant:"body1",color:r.redAccent[500],children:"No current academic year set."})]}),e.jsx(Te,{onClick:()=>{q(!0),E(!1),H()},content:"Add Academic Year"})]}),e.jsx(mt,{open:M,onClose:()=>{q(!1),E(!1),H()},handleSubmit:g,error:l,editMode:_,userId:i,formValues:$,handleChange:B,isSubmitting:z}),e.jsx(ht,{open:P,onClose:()=>{Q(!1),V()},handleSubmit:k,error:S,userId:i,formValues:O,handleChange:T,isSubmitting:z,academicYears:n}),e.jsx(pe,{open:I,onClose:c,title:"Confirm Deletion",noConfirm:!1,confirmText:"Delete",onConfirm:t,cancelText:"Cancel",children:e.jsx(v,{children:"Are you sure you want to delete this academic year? This action cannot be undone."})}),e.jsx(We,{columns:s,tableHeader:"Academic Years",data:le,sortBy:N,sortDirection:L,onSortChange:D,page:ae,rowsPerPage:oe,onPageChange:b,onRowsPerPageChange:w,hiddenColumnsSmallScreen:["fromYear","toYear","studentCount","teacherCount","actions"],hiddenColumnsTabScreen:["studentCount","teacherCount"]})]})})]})})},gt=()=>{const a=he(r=>r.users.user.role);return console.log(a),e.jsx("div",{children:a==="teacher"?e.jsx(dt,{}):e.jsx(ft,{})})},$t=Xe(gt);export{$t as default};
