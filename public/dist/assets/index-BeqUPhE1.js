import{r as a,f as _,j as e,a as L}from"./index-DYB9vdJh.js";import{t as R,M as O}from"./modal-Dt9KnTX1.js";import{H as F}from"./Header-AXN3siQS.js";import{C as P}from"./accordion-JCiF7Q3f.js";import{w as D}from"./dasboardPagesContainer-D4ZABES0.js";import{u as $}from"./useApi-BEUY4qmG.js";import{j as E,M as H,v as h,T as l,x as I}from"./TextField-Dq7C8pjc.js";import{C as B}from"./CircularProgress-pT4wBbD6.js";import"./IconButton-Dp3Riz_a.js";import"./index-H39KJanZ.js";import"./confirmationModal-CAE5W3-f.js";import"./MenuItem-BsLcltYv.js";import"./index-DG_QlDDe.js";import"./loadingButton-BBKAh30x.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-DWslFdTP.js";const J=j=>{const{loading:s,error:b,callApi:p}=$(),[c,u]=a.useState([]),[i,k]=a.useState({}),f=a.useRef(!0),{loading:S,error:w,callApi:g}=$(),T=a.useCallback(async(x,n)=>x?x.name:(console.warn("No subjectId provided in getSubjectName"),"Unknown Subject"),[g,i]),v=async x=>{try{const n=`${_.CURRICULUM}/teacher/${x}`;console.log(`Fetching curricula for teacher ID: ${x}`);const d=await p(n,"GET");if(d&&d.status==="success"&&f.current){console.log("Curricula API response:",JSON.stringify(d.data,null,2));const A=await Promise.all(d.data.map(async m=>{var M,t,o;const C=((M=m.subjectId)==null?void 0:M.name)||m.subjectId;console.log(`Processing curriculum ID ${m._id}, using subjectId: ${C}`);const y=await T(C,()=>f.current);return{_id:m._id,subject:y,subjectId:C,classLevel:((t=m.classLevelId)==null?void 0:t.name)||"Unknown Class",classLevelId:(o=m.classLevelId)==null?void 0:o._id,topics:m.topics.map((r,U)=>({_id:r._id||`topic_${U}`,topic:r.topic||"Untitled Topic",description:r.description||"No description available",resources:r.resources||[],isCompleted:r.isCompleted||!1})),completionRate:m.completionRate||0}}));console.log("Transformed curricula:",JSON.stringify(A,null,2)),u(A)}return d}catch(n){throw console.error("Error fetching curricula:",n.message),console.error("Error details:",n),new Error(n.message||"Failed to fetch curricula")}},N=async(x,n)=>{try{return await p(`${_.CURRICULUM}/${x}/topics/${n}/complete`,"PATCH")}catch(d){throw new Error(d.message||"Failed to mark topic as completed")}};return a.useEffect(()=>()=>{f.current=!1},[j]),{loading:s||S,error:b||w,curricula:c,fetchTeacherCurricula:v,markTopicAsCompleted:N,subjectNamesCache:i}},W=({open:j,onClose:s,onConfirm:b,curriculumId:p,topic:c})=>{const u=E(),i=R(u.palette.mode);return e.jsx(H,{open:j,onClose:s,children:e.jsxs(h,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:i.primary[400],p:4,borderRadius:1},children:[e.jsx(l,{variant:"h6",sx:{mb:2,color:i.grey[100]},children:"Mark Topic as Completed"}),e.jsxs(l,{sx:{mb:2,color:i.grey[100]},children:['Are you sure you want to mark the topic "',c==null?void 0:c.topic,'" as completed?']}),e.jsxs(h,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[e.jsx(I,{onClick:s,sx:{mr:1,color:i.grey[100]},children:"Cancel"}),e.jsx(I,{variant:"contained",onClick:()=>b(p,c._id),sx:{bgcolor:i.greenAccent[500]},children:"Confirm"})]})]})})},G=({open:j,onClose:s,message:b,isSuccess:p})=>{const c=E(),u=R(c.palette.mode);return e.jsx(O,{open:j,onClose:s,title:p?"Success":"Error",confirmText:"OK",showCancel:!1,styleProps:{backgroundColor:u.primary[400],borderRadius:"8px",width:"400px",margin:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:e.jsx(l,{sx:{mb:2,color:u.grey[100]},children:b})})},K=()=>{const j=E(),s=R(j.palette.mode),{loading:b,error:p,curricula:c,fetchTeacherCurricula:u,markTopicAsCompleted:i}=J(),{user:k}=L(t=>t.users),f=k==null?void 0:k._id,[S,w]=a.useState(!1),[g,T]=a.useState(null),[v,N]=a.useState(null),[x,n]=a.useState(!1),[d,A]=a.useState(""),[m,C]=a.useState(!0),y=(t,o=!0)=>{A(t),C(o),n(!0)};a.useEffect(()=>{f&&u(f)},[f]);const M=async(t,o)=>{try{const r=await i(t,o);r.status==="success"?(y("Topic marked as completed"),await u(f)):y(r.message||"Failed to mark topic as completed",!1)}catch(r){y(r.message||"Failed to mark topic as completed",!1)}};return e.jsxs(h,{sx:{p:3},children:[e.jsx(F,{title:"Teacher Curriculum Management",subtitle:"View and mark topics as completed for your assigned subjects"}),b?e.jsx(h,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(B,{color:"primary"})}):p?e.jsx(l,{variant:"body1",color:s.redAccent[500],sx:{mt:2},children:p}):c.length>0?c.map(t=>e.jsxs(h,{sx:{mb:4},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(l,{variant:"h2",sx:{color:s.blueAccent[200],fontWeight:"bold"},children:[t.subject," (",t.classLevel,")"]}),e.jsxs(l,{sx:{color:s.grey[100]},children:["Completion Rate: ",t.completionRate.toFixed(2),"%"]})]}),t.topics.length>0?t.topics.map((o,r)=>e.jsx(h,{sx:{mb:1},children:e.jsx(P,{title:`${r+1}. ${o.topic}`,details:e.jsxs(h,{children:[e.jsx(l,{variant:"body1",color:s.grey[100],sx:{mb:1},children:o.description||"No description available"}),e.jsxs(l,{variant:"body1",sx:{color:s.blueAccent[200]},children:["Resources:"," ",Array.isArray(o.resources)?o.resources.join(", "):"No resources available"]}),e.jsxs(l,{variant:"body1",sx:{color:o.isCompleted?s.greenAccent[500]:s.redAccent[500]},children:["Status: ",o.isCompleted?"Completed":"Not Completed"]}),!o.isCompleted&&e.jsx(h,{sx:{mt:2},children:e.jsx(I,{onClick:()=>{T(t),N(o),w(!0)},sx:{color:s.greenAccent[500]},children:"Mark Complete"})})]}),defaultExpanded:!1})},o._id||"")):e.jsxs(l,{variant:"body1",color:s.grey[100],children:["No topics available for ",t.subject,"."]})]},t._id)):e.jsx(l,{variant:"body1",color:s.grey[100],children:"No curricula available for your subjects."}),e.jsx(W,{open:S,onClose:()=>w(!1),onConfirm:M,curriculumId:g==null?void 0:g._id,topic:v}),e.jsx(G,{open:x,onClose:()=>n(!1),message:d,isSuccess:m})]})},ie=D(K);export{ie as default};
