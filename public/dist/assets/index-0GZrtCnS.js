var Qe=Object.defineProperty;var Je=(a,r,m)=>r in a?Qe(a,r,{enumerable:!0,configurable:!0,writable:!0,value:m}):a[r]=m;var Pe=(a,r,m)=>Je(a,typeof r!="symbol"?r+"":r,m);import{j as e,r as c,a as ke,f as _,i as Ke,R as Xe}from"./index-CIScX54F.js";import{u as Te}from"./useApi-uVIcg3lr.js";import{H as ze}from"./Header-D8IA577C.js";import{t as Ue,M as Ie}from"./modal-Bd79Xm9G.js";import{c as _e,a as Ze,g as et,u as tt,_ as at,b as Ce,s as rt,d as nt,h as Se,e as st,a4 as ot,i as it,j as qe,v as w,T as k,P as ct,y as le,x as We,a1 as $e,a2 as Be,a3 as Ne,M as lt}from"./TextField-CZuLzl2E.js";import{A as dt,G as ye}from"./index-CxSpOSMj.js";import{T as Oe}from"./table-B56sVY_E.js";import{S as mt,F as Ge}from"./FormControlLabel-teC4KeD2.js";import{M as Le}from"./MenuItem-CNcsPEK9.js";import{A as ve}from"./actionButton-YKPAvrHZ.js";import{j as ut,k as ht,l as pt,m as ft}from"./index--7xoSaqJ.js";import{I as Ye}from"./IconButton-Dl6X1a01.js";import{w as Dt}from"./dasboardPagesContainer-DdeC4KVC.js";import"./confirmationModal-DzpjYeCc.js";import"./CircularProgress-DnqEq3f4.js";import"./index-l7GPTq0F.js";import"./loadingButton-BnkWMuOr.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-CpSlXh6x.js";import"./useMediaQuery-B6ur4llP.js";const gt=_e(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),Ct=_e(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),bt=_e(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function xt(a){return et("MuiCheckbox",a)}const Ee=Ze("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),Yt=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],Tt=a=>{const{classes:r,indeterminate:m,color:i,size:D}=a,b={root:["root",m&&"indeterminate",`color${Se(i)}`,`size${Se(D)}`]},p=st(b,xt,r);return Ce({},r,p)},St=rt(mt,{shouldForwardProp:a=>ot(a)||a==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(a,r)=>{const{ownerState:m}=a;return[r.root,m.indeterminate&&r.indeterminate,r[`size${Se(m.size)}`],m.color!=="default"&&r[`color${Se(m.color)}`]]}})(({theme:a,ownerState:r})=>Ce({color:(a.vars||a).palette.text.secondary},!r.disableRipple&&{"&:hover":{backgroundColor:a.vars?`rgba(${r.color==="default"?a.vars.palette.action.activeChannel:a.vars.palette[r.color].mainChannel} / ${a.vars.palette.action.hoverOpacity})`:it(r.color==="default"?a.palette.action.active:a.palette[r.color].main,a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},r.color!=="default"&&{[`&.${Ee.checked}, &.${Ee.indeterminate}`]:{color:(a.vars||a).palette[r.color].main},[`&.${Ee.disabled}`]:{color:(a.vars||a).palette.action.disabled}})),At=e.jsx(Ct,{}),jt=e.jsx(gt,{}),wt=e.jsx(bt,{}),He=c.forwardRef(function(r,m){var i,D;const b=tt({props:r,name:"MuiCheckbox"}),{checkedIcon:p=At,color:y="primary",icon:x=jt,indeterminate:I=!1,indeterminateIcon:A=wt,inputProps:M,size:E="medium",className:U}=b,G=at(b,Yt),V=I?A:x,F=I?A:p,$=Ce({},b,{color:y,indeterminate:I,size:E}),Q=Tt($);return e.jsx(St,Ce({type:"checkbox",inputProps:Ce({"data-indeterminate":I},M),icon:c.cloneElement(V,{fontSize:(i=V.props.fontSize)!=null?i:E}),checkedIcon:c.cloneElement(F,{fontSize:(D=F.props.fontSize)!=null?D:E}),ownerState:$,ref:m,className:nt(Q.root,U)},G,{classes:Q}))}),yt=()=>{const[a,r]=c.useState(""),[m,i]=c.useState(""),[D,b]=c.useState([]),p=ke(A=>A.users.user),{loading:y,data:x,callApi:I}=Te();return c.useEffect(()=>{I(_.COURSES,"GET")},[]),c.useEffect(()=>{if(x&&x.courses){const A=x.courses.find(M=>M.courseName===p.program);A&&(r(A.courseName),i(A.duration),b(A.curriculum||[]))}},[x]),{courseName:a,courseDuration:m,curriculum:D,loading:y}},Et=()=>{const a=qe(),r=Ue(a.palette.mode),{courseDuration:m,courseName:i,curriculum:D,loading:b}=yt();return e.jsxs(w,{children:[e.jsx(ze,{title:i||"Primary 2",subtitle:`${m||0} months`}),b?e.jsx(Ke,{}):D&&D.length>0?e.jsxs(w,{children:[e.jsx(k,{variant:"h2",gutterBottom:!0,children:"Curriculum"}),e.jsx(w,{sx:{width:"100%"},children:D.map((p,y)=>e.jsxs(ct,{elevation:3,sx:{backgroundColor:r.primary[400],color:r.blueAccent[500],p:3,mb:2,display:"flex",alignItems:"flex-start",gap:2,borderRadius:"12px",boxShadow:"0 3px 10px rgba(0, 0, 0, 0.1)"},children:[e.jsx(dt,{sx:{bgcolor:r.primary[500],width:40,height:40,fontSize:"18px",color:"white"},children:y+1}),e.jsxs(w,{children:[e.jsxs(k,{variant:"h3",sx:{color:r.blueAccent[200]},children:[p.topic||"No topic available"," "]}),e.jsxs(k,{variant:"body1",color:"textSecondary",sx:{mb:1},children:[p.description||"No description available"," "]}),e.jsxs(k,{variant:"body1",sx:{fontStyle:"italic"},children:["Duration: ",p.duration||"Unknown"," "]}),e.jsxs(k,{variant:"h6",sx:{color:r.blueAccent[200]},children:["Resources: ",Array.isArray(p.resources)?p.resources.join(", "):"No resources available"]})]})]},p._id||y))})]}):e.jsx(k,{variant:"body1",color:"textSecondary",children:"No curriculum available."})]})},vt=({userId:a})=>{const r={id:"",name:"",fromYear:"",toYear:"",isCurrent:!1},m={academicYearId:"",academicTermId:"",terms:[{name:"1st Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1,_id:""},{name:"2nd Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1,_id:""},{name:"3rd Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1,_id:""}]},[i,D]=c.useState(r),[b,p]=c.useState(m),[y,x]=c.useState({name:"",fromYear:"",toYear:"",general:""}),[I,A]=c.useState({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]}),[M,E]=c.useState(!1),[U,G]=c.useState(!1),[V,F]=c.useState(!1),[$,Q]=c.useState({}),[de,u]=c.useState(!1),[f,J]=c.useState(null),{data:L,loading:me,error:K,callApi:R}=Te(),{data:X,loading:ue,error:Z,callApi:B}=Te(),{loading:ae,callApi:P}=Te(),q=c.useCallback(async n=>{u(!0),J(null);try{const l=await P(`${_.ACADEMIC_TERM}/year/${n}`,"GET");if(!l||l.status!=="success")throw new Error((l==null?void 0:l.message)||"Failed to fetch academic terms");Q(o=>({...o,[n]:l.data}))}catch(l){J(l.message||"Failed to fetch academic terms")}finally{u(!1)}},[P]);c.useEffect(()=>{R(_.ACADEMIC_YEARS,"GET"),B(_.CURRENT_ACADEMIC_YEAR,"GET")},[R,B]);const W=(L==null?void 0:L.data)||[],N=(X==null?void 0:X.data)||null,ee=c.useCallback(n=>{const{name:l,value:o,type:g,checked:h}=n.target,Y=g==="checkbox"?h:o;D(T=>({...T,[l]:Y})),x(T=>({...T,[l]:"",general:""}))},[]),he=c.useCallback(async n=>{var l,o;if(!a)return x(g=>({...g,general:"User not authenticated. Please log in."})),!1;try{F(!0),x(h=>({...h,general:""}));const g=await P(`${_.ACADEMIC_YEARS}/${n}`,"DELETE");if(!g||g.status!=="success")throw new Error((g==null?void 0:g.message)||"Failed to delete academic year");return await R(_.ACADEMIC_YEARS,"GET"),(N==null?void 0:N._id)===n&&await B(_.CURRENT_ACADEMIC_YEAR,"GET"),Q(h=>{const Y={...h};return delete Y[n],Y}),!0}catch(g){const h=((o=(l=g.response)==null?void 0:l.data)==null?void 0:o.message)||g.message||"Failed to delete academic year";return x(Y=>({...Y,general:h})),!1}finally{F(!1)}},[a,P,R,B,N]),re=c.useCallback((n,l,o=!1)=>{const{name:g,value:h,type:Y,checked:T}=n.target,s=Y==="checkbox"?T:h;p(C=>{const S=[...C.terms];return S[l]={...S[l],[g]:s,createdBy:a},o&&s&&S.forEach((O,z)=>{z!==l&&(O.isCurrent=!1)}),{...C,terms:S}}),A(C=>({...C,terms:C.terms.map((S,O)=>O===l?{...S,[g]:""}:S),general:""}))},[a]),ie=c.useCallback(()=>{const{name:n,fromYear:l,toYear:o,isCurrent:g}=i,h={name:"",fromYear:"",toYear:"",general:""};if(n.trim()?/^\d{4}\/\d{4}$/.test(n.trim())||(h.name="Name must be in format YYYY/YYYY (e.g., 2024/2025)"):h.name="Academic year name is required",l.trim()||(h.fromYear="From year is required"),o.trim()||(h.toYear="To year is required"),l&&o&&new Date(l)>=new Date(o)&&(h.toYear="To year must be after from year"),l&&o){const Y=new Date(l),T=new Date(o),s=365*24*60*60*1e3;T-Y<s&&(h.general="Academic year must span at least one year")}if(g&&l&&o){const Y=new Date,T=new Date;T.setMonth(Y.getMonth()+1);const s=new Date(l),C=new Date(o);s>T&&(h.fromYear="Current academic year cannot start more than one month in the future"),C<Y&&(h.toYear="Current academic year cannot end in the past")}return x(h),!h.name&&!h.fromYear&&!h.toYear&&!h.general},[i]),pe=c.useCallback(()=>{var O,z;const{terms:n,academicYearId:l}=b,o={general:"",terms:n.map(()=>({description:"",duration:"",startDate:"",endDate:""}))};l||(o.general="Academic year ID is required");const g=((z=(O=$[l])==null?void 0:O[0])==null?void 0:z.terms)||[],h=n.filter(t=>t.description||t.startDate||t.endDate||t._id);(U?g.length:h.length)>3&&(o.general="Cannot have more than three terms per academic year");const T=W.find(t=>t._id===l),s=T?new Date(T.toYear):null;n.filter(t=>t.isCurrent).length>1&&(o.general="Only one term can be set as current");const S=Array.from({length:10},(t,j)=>`${j+1} month${j+1>1?"s":""}`);n.forEach((t,j)=>{if((t.description||t.startDate||t.endDate||t._id)&&!t.description.trim()&&(o.terms[j].description="Description is required"),(t.description||t.startDate||t.endDate||t._id)&&(!t.duration||!S.includes(t.duration))&&(o.terms[j].duration="Duration must be between 1 and 10 months"),(t.description||t.endDate||t._id)&&!t.startDate&&(o.terms[j].startDate="Start date is required"),(t.description||t.startDate||t._id)&&!t.endDate&&(o.terms[j].endDate="End date is required"),t.startDate&&t.endDate&&new Date(t.startDate)>=new Date(t.endDate)&&(o.terms[j].endDate="End date must be after start date"),s&&t.endDate&&new Date(t.endDate)>s&&(o.terms[j].endDate=`End date for ${t.name} cannot exceed academic year end date (${s.toLocaleDateString()})`),t.isCurrent&&t.startDate&&t.endDate){const De=new Date,ge=new Date;ge.setMonth(De.getMonth()+1);const be=new Date(t.startDate),xe=new Date(t.endDate);be>ge&&(o.terms[j].startDate=`Term ${t.name} cannot be current: start date is more than one month in the future`),xe<De&&(o.terms[j].endDate=`Term ${t.name} cannot be current: end date is in the past`)}});for(let t=0;t<n.length;t++)for(let j=t+1;j<n.length;j++)n[t].startDate&&n[t].endDate&&n[j].startDate&&n[j].endDate&&new Date(n[t].startDate)<=new Date(n[j].endDate)&&new Date(n[j].startDate)<=new Date(n[t].endDate)&&(o.terms[j].startDate=`Terms ${n[t].name} and ${n[j].name} have overlapping dates`);return A(o),!o.general&&o.terms.every(t=>!t.description&&!t.duration&&!t.startDate&&!t.endDate)},[b,W,$,U]),ne=c.useCallback(async()=>{var Y,T;if(!ie())return!1;if(!a)return x(s=>({...s,general:"User not authenticated. Please log in."})),!1;const{name:n,fromYear:l,toYear:o,isCurrent:g}=i,h={name:n,fromYear:new Date(l).toISOString(),toYear:new Date(o).toISOString(),isCurrent:g,createdBy:a,academicTerms:[],students:[],teachers:[]};try{F(!0),x(C=>({...C,name:"",fromYear:"",toYear:"",general:""}));const s=await P(_.ACADEMIC_YEARS,"POST",h);if(!s||s.status!=="success")throw new Error((s==null?void 0:s.message)||"Failed to create academic year");return await R(_.ACADEMIC_YEARS,"GET"),g&&await B(_.CURRENT_ACADEMIC_YEAR,"GET"),D(r),E(!1),!0}catch(s){const C=((T=(Y=s.response)==null?void 0:Y.data)==null?void 0:T.message)||s.message||"Failed to create academic year";return x(S=>({...S,general:C})),!1}finally{F(!1)}},[i,a,P,R,B]),fe=c.useCallback(async()=>{var Y,T;if(!pe())return!1;if(!a)return A(s=>({...s,general:"User not authenticated. Please log in."})),!1;const{terms:n,academicYearId:l,academicTermId:o}=b,g=n.filter(s=>s.description||s.startDate||s.endDate||s._id),h={academicYearId:l,terms:g.map(s=>({...s,startDate:s.startDate?new Date(s.startDate).toISOString():void 0,endDate:s.endDate?new Date(s.endDate).toISOString():void 0,createdBy:a}))};try{F(!0),A(O=>({...O,general:"",terms:O.terms.map(()=>({description:"",duration:"",startDate:"",endDate:""}))}));const s=o?`${_.ACADEMIC_TERM}/${o}`:_.ACADEMIC_TERM,S=await P(s,o?"PATCH":"POST",h);if(!S||S.status!=="success")throw new Error((S==null?void 0:S.message)||`Failed to ${o?"update":"create"} academic term`);return await R(_.ACADEMIC_YEARS,"GET"),await q(l),p(m),G(!1),!0}catch(s){const C=((T=(Y=s.response)==null?void 0:Y.data)==null?void 0:T.message)||s.message||`Failed to ${o?"update":"create"} academic term`;return A(S=>({...S,general:C})),!1}finally{F(!1)}},[b,a,P,R,q]),ce=c.useCallback(async()=>{var T,s;if(!ie())return!1;const{id:n,name:l,fromYear:o,toYear:g,isCurrent:h}=i;if(!a)return x(C=>({...C,general:"User not authenticated. Please log in."})),!1;const Y={name:l,fromYear:new Date(o).toISOString(),toYear:new Date(g).toISOString(),isCurrent:h,createdBy:a};try{F(!0),x(S=>({...S,name:"",fromYear:"",toYear:"",general:""}));const C=await P(`${_.ACADEMIC_YEARS}/${n}`,"PATCH",Y);if(!C||C.status!=="success")throw new Error((C==null?void 0:C.message)||"Failed to update academic year");return await R(_.ACADEMIC_YEARS,"GET"),(h||(N==null?void 0:N._id)===n)&&await B(_.CURRENT_ACADEMIC_YEAR,"GET"),D(r),E(!1),!0}catch(C){const S=((s=(T=C.response)==null?void 0:T.data)==null?void 0:s.message)||C.message||"Failed to update academic year";return x(O=>({...O,general:S})),!1}finally{F(!1)}},[i,a,P,R,B,N]),v=c.useCallback(async()=>M?await ce():await ne(),[M,ne,ce]),Me=c.useCallback(n=>{D({id:n._id,name:n.name,fromYear:n.fromYear.split("T")[0],toYear:n.toYear.split("T")[0],isCurrent:n.isCurrent}),E(!0),x({name:"",fromYear:"",toYear:"",general:""})},[]),Ae=c.useCallback(async n=>{var g,h,Y,T;await q(n);const l=((h=(g=$[n])==null?void 0:g[0])==null?void 0:h.terms)||[],o=["1st Term","2nd Term","3rd Term"];if(l.length>0){const s=((T=(Y=$[n])==null?void 0:Y[0])==null?void 0:T._id)||"",C=o.map((S,O)=>{const z=l.find(t=>t.name===S);return z?{...z,startDate:z.startDate?new Date(z.startDate).toISOString().split("T")[0]:"",endDate:z.endDate?new Date(z.endDate).toISOString().split("T")[0]:"",createdBy:a}:{name:S,description:"",duration:"3 months",startDate:"",endDate:"",createdBy:a,isCurrent:!1,_id:""}});p({academicYearId:n,academicTermId:s,terms:C}),G(!0)}else p({...m,academicYearId:n,terms:m.terms.map(s=>({...s,createdBy:a}))}),G(!1);A({general:"",terms:Array(3).fill().map(()=>({description:"",duration:"",startDate:"",endDate:""}))})},[a,m,$,q]),je=c.useCallback(()=>{D(r),x({name:"",fromYear:"",toYear:"",general:""}),E(!1)},[]),we=c.useCallback(()=>{p(m),A({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]}),G(!1)},[]);return{setFormValues:D,formValues:i,handleChange:ee,handleTermChange:re,handleSubmit:v,handleCreateAcademicTerm:fe,startEdit:Me,startAddTerm:Ae,editMode:M,termEditMode:U,setEditMode:E,academicYears:W,currentAcademicYear:N,academicTerms:$,loading:me||ue||ae||de,error:K||Z||f||y.general?{...y,general:K||Z||f||y.general}:y,termError:I,isSubmitting:V,resetForm:je,resetTermForm:we,termFormValues:b,handleDeleteAcademicYear:he,fetchAcademicTermsApi:q}},kt=({open:a,onClose:r,handleSubmit:m,error:i={},editMode:D=!1,userId:b,formValues:p,handleChange:y,isSubmitting:x=!1})=>{const I=new Date().toISOString().split("T")[0],A=()=>{if(D)return null;if(!p.fromYear)return I;const E=new Date(p.fromYear);return E.setFullYear(E.getFullYear()+1),E.toISOString().split("T")[0]},M=async E=>{E.preventDefault();try{await m(p)&&r()}catch(U){console.error("Submission error:",U)}};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            opacity: 1;
          }
          input[type="date"] {
            color-scheme: light;
          }
        `}),e.jsx(Ie,{open:a,onClose:r,title:D?"Edit Academic Year":"Add Academic Year",noConfirm:!0,children:e.jsxs(w,{component:"form",onSubmit:M,children:[e.jsx(w,{mb:2,children:e.jsx(le,{label:"Academic Year Name (e.g., 2024/2025)",name:"name",value:p.name||"",onChange:y,fullWidth:!0,required:!0,error:!!i.name,helperText:i.name||"Format: YYYY/YYYY (e.g., 2024/2025)"})}),e.jsx(w,{mb:2,children:e.jsx(le,{label:"From Year",name:"fromYear",type:"date",value:p.fromYear||"",onChange:y,fullWidth:!0,required:!0,error:!!i.fromYear,helperText:i.fromYear,InputLabelProps:{shrink:!0},inputProps:{min:D?null:I}})}),e.jsx(w,{mb:2,children:e.jsx(le,{label:"To Year",name:"toYear",type:"date",value:p.toYear||"",onChange:y,fullWidth:!0,required:!0,error:!!i.toYear,helperText:i.toYear,InputLabelProps:{shrink:!0},inputProps:{min:A()}})}),e.jsx(w,{mb:2,children:e.jsx(Ge,{control:e.jsx(He,{checked:p.isCurrent||!1,onChange:y,name:"isCurrent",color:"primary"}),label:"Set as Current Academic Year"})}),i.general&&e.jsx(k,{variant:"caption",color:"error",mb:2,children:i.general}),e.jsx(We,{type:"submit",variant:"contained",color:"primary",disabled:x,fullWidth:!0,children:x?"Submitting...":D?"Update Academic Year":"Submit"})]})})]})},It=({open:a,onClose:r,handleSubmit:m,error:i={},userId:D,formValues:b,handleChange:p,isSubmitting:y=!1,academicYears:x,editMode:I=!1,academicTerms:A})=>{var $,Q,de;const M=new Date().toISOString().split("T")[0],E=async u=>{u.preventDefault();try{await m()&&r()}catch(f){console.error("Submission error:",f)}},U=Array.from({length:10},(u,f)=>`${f+1} month${f+1>1?"s":""}`),G=x.find(u=>u._id===b.academicYearId),V=G?new Date(G.toYear).toISOString().split("T")[0]:M,F=((de=(Q=($=A[b.academicYearId])==null?void 0:$[0])==null?void 0:Q.terms)==null?void 0:de.length)||0;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            opacity: 1;
          }
          input[type="date"] {
            color-scheme: light;
          }
        `}),e.jsx(Ie,{open:a,onClose:r,title:I?"Edit Academic Terms":"Add Academic Terms",noConfirm:!0,children:e.jsxs(w,{component:"form",onSubmit:E,children:[e.jsx(w,{mb:2,children:e.jsxs($e,{fullWidth:!0,required:!0,disabled:I,children:[e.jsx(Be,{id:"academic-year-label",children:"Academic Year"}),e.jsx(Ne,{labelId:"academic-year-label",name:"academicYearId",value:b.academicYearId||"",onChange:u=>p({target:{name:"academicYearId",value:u.target.value}}),label:"Academic Year",children:x.map(u=>e.jsxs(Le,{value:u._id,children:[u.name," (",new Date(u.fromYear).toLocaleDateString()," -"," ",new Date(u.toYear).toLocaleDateString(),")"]},u._id))})]})}),b.terms.map((u,f)=>{var me,K,R,X,ue,Z,B,ae,P,q,W,N,ee,he,re,ie,pe,ne,fe,ce;const J=!!u._id,L=!J&&f>=3-F;return e.jsxs(w,{mb:3,sx:{border:"1px solid #ccc",p:2,borderRadius:1,opacity:L?.5:1,pointerEvents:L?"none":"auto"},children:[e.jsx(k,{variant:"h6",children:u.name}),e.jsx(w,{mb:2,children:e.jsx(le,{label:"Term Name",name:"name",value:u.name||"",onChange:v=>p(v,f),fullWidth:!0,required:!0,disabled:!0,error:!!((K=(me=i.terms)==null?void 0:me[f])!=null&&K.name),helperText:(X=(R=i.terms)==null?void 0:R[f])==null?void 0:X.name})}),e.jsx(w,{mb:2,children:e.jsx(le,{label:"Description",name:"description",value:u.description||"",onChange:v=>p(v,f),fullWidth:!0,required:J||u.startDate||u.endDate,error:!!((Z=(ue=i.terms)==null?void 0:ue[f])!=null&&Z.description),helperText:(ae=(B=i.terms)==null?void 0:B[f])==null?void 0:ae.description,disabled:L})}),e.jsx(w,{mb:2,children:e.jsxs($e,{fullWidth:!0,required:J||u.description||u.endDate,error:!!((q=(P=i.terms)==null?void 0:P[f])!=null&&q.duration),disabled:L,children:[e.jsx(Be,{id:`duration-label-${f}`,children:"Duration"}),e.jsx(Ne,{labelId:`duration-label-${f}`,name:"duration",value:u.duration||"3 months",onChange:v=>p(v,f),label:"Duration",children:U.map(v=>e.jsx(Le,{value:v,children:v},v))}),((N=(W=i.terms)==null?void 0:W[f])==null?void 0:N.duration)&&e.jsx(k,{variant:"caption",color:"error",children:i.terms[f].duration})]})}),e.jsx(w,{mb:2,children:e.jsx(le,{label:"Start Date",name:"startDate",type:"date",value:u.startDate||"",onChange:v=>p(v,f),fullWidth:!0,required:J||u.description||u.endDate,error:!!((he=(ee=i.terms)==null?void 0:ee[f])!=null&&he.startDate),helperText:(ie=(re=i.terms)==null?void 0:re[f])==null?void 0:ie.startDate,InputLabelProps:{shrink:!0},inputProps:{min:M,max:V},disabled:L})}),e.jsx(w,{mb:2,children:e.jsx(le,{label:"End Date",name:"endDate",type:"date",value:u.endDate||"",onChange:v=>p(v,f),fullWidth:!0,required:J||u.description||u.startDate,error:!!((ne=(pe=i.terms)==null?void 0:pe[f])!=null&&ne.endDate),helperText:(ce=(fe=i.terms)==null?void 0:fe[f])==null?void 0:ce.endDate,InputLabelProps:{shrink:!0},inputProps:{min:u.startDate||M,max:V},disabled:L})}),e.jsx(w,{mb:2,children:e.jsx(Ge,{control:e.jsx(He,{checked:u.isCurrent||!1,onChange:v=>p(v,f,!0),name:"isCurrent",color:"primary",disabled:L}),label:"Set as Current Term"})})]},u.name)}),i.general&&e.jsx(k,{variant:"caption",color:"error",mb:2,children:i.general}),e.jsx(We,{type:"submit",variant:"contained",color:"primary",disabled:y||!b.academicYearId,fullWidth:!0,children:y?"Submitting...":I?"Update Terms":"Submit"})]})})]})};class ta extends Xe.Component{constructor(){super(...arguments);Pe(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(m){return{hasError:!0,error:m}}componentDidCatch(m,i){console.error("Error caught by boundary:",m,i)}render(){var m;return this.state.hasError?e.jsxs(w,{sx:{p:3,textAlign:"center"},children:[e.jsx(k,{variant:"h5",color:"error",children:"Something went wrong."}),e.jsx(k,{variant:"body1",mt:2,children:((m=this.state.error)==null?void 0:m.message)||"An unexpected error occurred."}),e.jsx(ve,{content:"Reload",onClick:()=>window.location.reload(),sx:{mt:2}})]}):this.props.children}}const _t=()=>{var t,j,De,ge,be,xe,Fe,Re;const a=qe(),r=Ue(a.palette.mode),m=ke(d=>{var H;return(H=d.users.user)==null?void 0:H._id})||"",{academicYears:i,currentAcademicYear:D,academicTerms:b,error:p,termError:y,handleSubmit:x,handleCreateAcademicTerm:I,handleDeleteAcademicYear:A,startEdit:M,startAddTerm:E,editMode:U,termEditMode:G,setEditMode:V,formValues:F,termFormValues:$,handleChange:Q,handleTermChange:de,isSubmitting:u,resetForm:f,resetTermForm:J,fetchAcademicTermsApi:L}=vt({userId:m}),[me,K]=c.useState(!1),[R,X]=c.useState(!1),[ue,Z]=c.useState(!1),[B,ae]=c.useState(null),[P,q]=c.useState(!1),[W,N]=c.useState(null),[ee,he]=c.useState("name"),[re,ie]=c.useState("asc"),[pe,ne]=c.useState(0),[fe,ce]=c.useState(5),[v,Me]=c.useState(""),Ae=[{id:"sn",label:"S/N"},{id:"name",label:"Name"},{id:"fromYear",label:"From Year"},{id:"toYear",label:"To Year"},{id:"isCurrent",label:"Current"},{id:"studentCount",label:"Students"},{id:"teacherCount",label:"Teachers"},{id:"actions",label:"Actions"}],je=[{id:"name",label:"Term Name"},{id:"description",label:"Description"},{id:"duration",label:"Duration"},{id:"startDate",label:"Start Date"},{id:"endDate",label:"End Date"},{id:"isCurrent",label:"Current"}],we=i.map((d,H)=>{var se,oe,te;return{sn:H+1,id:d._id,name:d.name,fromYear:new Date(d.fromYear).toLocaleDateString(),toYear:new Date(d.toYear).toLocaleDateString(),isCurrent:d.isCurrent?"Yes":"No",studentCount:((se=d.students)==null?void 0:se.length)||0,teacherCount:((oe=d.teachers)==null?void 0:oe.length)||0,actions:e.jsxs(w,{children:[e.jsx(Ye,{onClick:()=>n(d),children:e.jsx(ut,{})}),e.jsx(Ye,{onClick:()=>l(d._id),disabled:(((te=d==null?void 0:d.academicTerms)==null?void 0:te.length)||0)>=1,children:e.jsx(ht,{})}),e.jsx(Ye,{onClick:()=>o(d._id),children:e.jsx(pt,{})}),e.jsx(Ye,{onClick:()=>g(d._id),children:e.jsx(ft,{})})]})}}),n=d=>{M(d),K(!0)},l=d=>{E(d),X(!0)},o=d=>{N(d),q(!0),b[d]||L(d)},g=d=>{ae(d),Z(!0)},h=async()=>{B&&await A(B)&&(Z(!1),ae(null))},Y=()=>{Z(!1),ae(null)},T=d=>{const H=ee===d&&re==="asc";he(d),ie(H?"desc":"asc")},s=(d,H)=>{ne(H)},C=d=>{ce(parseInt(d.target.value,10)),ne(0)},O=[...we.filter(d=>d.name.toLowerCase().includes(v.toLowerCase()))].sort((d,H)=>{const se=d[ee],oe=H[ee];return re==="asc"?se>oe?1:-1:se<oe?1:-1}),z=d=>{var se,oe;return(((oe=(se=b[d])==null?void 0:se[0])==null?void 0:oe.terms)||[]).map((te,Ve)=>({id:`${d}-${Ve}`,name:te.name,description:te.description,duration:te.duration,startDate:new Date(te.startDate).toLocaleDateString(),endDate:new Date(te.endDate).toLocaleDateString(),isCurrent:te.isCurrent?"Yes":"No"}))};return e.jsxs(ye,{container:!0,children:[e.jsx(ye,{item:!0,xs:12,children:e.jsx(ze,{title:"Academics Management",subtitle:"Manage Academic Sessions"})}),e.jsxs(ye,{item:!0,xs:12,children:[e.jsxs(w,{sx:{mb:3,p:2,backgroundColor:r.primary[400],borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(w,{children:[e.jsx(k,{variant:"h5",color:r.grey[100],children:"Current Academic Year"}),D?e.jsxs(k,{variant:"body1",color:r.grey[100],children:[D.name," (",new Date(D.fromYear).toLocaleDateString()," -"," ",new Date(D.toYear).toLocaleDateString(),") |"," ",((t=D.students)==null?void 0:t.length)||0," Students,"," ",((j=D.teachers)==null?void 0:j.length)||0," Teachers,"," ",((be=(ge=(De=b[D._id])==null?void 0:De[0])==null?void 0:ge.terms)==null?void 0:be.length)||0," Terms"]}):e.jsx(k,{variant:"body1",color:r.redAccent[500],children:"No current academic year set."})]}),e.jsx(ve,{onClick:()=>{K(!0),V(!1),f()},content:"Add Academic Year"})]}),e.jsx(kt,{open:me,onClose:()=>{K(!1),V(!1),f()},handleSubmit:x,error:p,editMode:U,userId:m,formValues:F,handleChange:Q,isSubmitting:u}),e.jsx(It,{open:R,onClose:()=>{X(!1),J()},handleSubmit:I,error:y,userId:m,formValues:$,handleChange:de,isSubmitting:u,academicYears:i,editMode:G,academicTerms:b}),e.jsx(Ie,{open:ue,onClose:Y,title:"Confirm Deletion",noConfirm:!1,confirmText:"Delete",onConfirm:h,cancelText:"Cancel",children:e.jsx(k,{children:"Are you sure you want to delete this academic year? This action cannot be undone."})}),e.jsx(lt,{open:P,onClose:()=>q(!1),sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(w,{sx:{bgcolor:r.primary[400],p:3,borderRadius:1,maxWidth:"80%",maxHeight:"80%",overflow:"auto"},children:[e.jsxs(k,{variant:"h6",gutterBottom:!0,children:["Academic Terms for ",(xe=i.find(d=>d._id===W))==null?void 0:xe.name]}),W&&b[W]&&((Re=(Fe=b[W][0])==null?void 0:Fe.terms)==null?void 0:Re.length)>0?e.jsx(Oe,{columns:je,tableHeader:"Terms",data:z(W),sortBy:"name",sortDirection:"asc",rowsPerPage:5,hiddenColumnsSmallScreen:["description","duration"],hiddenColumnsTabScreen:["description"]}):e.jsx(k,{color:r.redAccent[500],children:"No terms found for this academic year."}),e.jsx(ve,{content:"Close",onClick:()=>q(!1),sx:{mt:2}})]})}),e.jsx(Oe,{columns:Ae,tableHeader:"Academic Years",data:O,sortBy:ee,sortDirection:re,onSortChange:T,page:pe,rowsPerPage:fe,onPageChange:s,onRowsPerPageChange:C,hiddenColumnsSmallScreen:["fromYear","toYear","studentCount","teacherCount","termsCount","actions"],hiddenColumnsTabScreen:["studentCount","teacherCount"]})]})]})},Mt=()=>{const a=ke(r=>r.users.user.role);return console.log(a),e.jsx("div",{children:a==="teacher"?e.jsx(Et,{}):e.jsx(_t,{})})},aa=Dt(Mt);export{aa as default};
