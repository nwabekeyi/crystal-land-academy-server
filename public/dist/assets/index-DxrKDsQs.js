import{r as o,j as t,a as fe,e as Se,M as be}from"./index-CFm5FUDz.js";import{t as G,D as Ce,a as je,b as De,c as Ae,M as Ue}from"./modal-CGQB-OdF.js";import{g as Te,a as ye,u as Ne,_ as Me,s as ve,b as Q,d as we,e as Ee,T as h,r as Ie,$ as Re,a0 as Pe,a1 as $e,j as X,y as _,w as N}from"./TextField-D31oTOPm.js";import{M as K,u as ke}from"./MenuItem-Bl0c-FiE.js";import{S as P}from"./index-r5krkWVY.js";import{H as Le}from"./Header-DuaJzItp.js";import{a as Oe,b as B,T as F}from"./table-ByZlExWb.js";import{c as _e}from"./index-DEDwNO_F.js";import{d as Be}from"./Edit-Ds0GRgn4.js";import{d as Fe}from"./Visibility-D3SPYdtH.js";import{u as q}from"./useApi-CJvuMKus.js";import{I as W}from"./IconButton-CBoSefry.js";import{w as We}from"./dasboardPagesContainer-CRC60AsQ.js";import{C as He}from"./confirmationModal-u8w1H2AU.js";import"./Alert-BYN5sqwV.js";import"./useSlot-BSMtljHD.js";import"./useMediaQuery-B2qIVE6J.js";import"./index-BQNoxMBA.js";import"./loadingButton-BvWQ0Fjl.js";import"./CircularProgress-Ca-7iBDz.js";function Ve(l){return Te("MuiDialogContentText",l)}ye("MuiDialogContentText",["root"]);const Je=["children","className"],ze=l=>{const{classes:n}=l,i=Ee({root:["root"]},Ve,n);return Q({},n,i)},Ke=ve(h,{shouldForwardProp:l=>Ie(l)||l==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(l,n)=>n.root})({}),qe=o.forwardRef(function(n,a){const i=Ne({props:n,name:"MuiDialogContentText"}),{className:c}=i,m=Me(i,Je),d=ze(m);return t.jsx(Ke,Q({component:"p",variant:"body1",color:"text.secondary",ref:a,ownerState:m,className:we(d.root,c)},i,{classes:d}))}),Ge=({label:l,options:n,onSelect:a})=>{const[i,c]=o.useState(""),m=d=>{const r=d.target.value;c(r),a(r)};return t.jsxs(Re,{sx:{width:"170px",paddingBottom:"2%"},variant:"outlined",children:[t.jsx(Pe,{id:`${l}-select-label`,children:l}),t.jsxs($e,{labelId:`${l}-select-label`,value:i,onChange:m,label:l,children:[t.jsx(K,{value:"",disabled:!0,children:`Select ${l}`}),n.map(d=>t.jsx(K,{value:d.value,children:d.label},d.value))]})]})},Qe=()=>t.jsx(P,{role:"student"}),Xe=()=>t.jsx(P,{role:"teacher"}),Ye=()=>t.jsx(P,{role:"admin"}),Y=()=>{const l=ke(),n=fe(e=>e.adminData.usersData||{}),{students:a=[],teachers:i=[],admins:c=[]}=n;console.log("Teachers data:",i);const m=(e,s)=>s==="student"?a.find(b=>b.studentId===e):s==="teacher"?i.find(b=>b.teacherId===e):s==="admin"?c.find(b=>b._id===e):null,[d,r]=o.useState(""),[g,p]=o.useState("id"),[u,x]=o.useState("asc"),[A,f]=o.useState(0),[M,S]=o.useState(20),[U,C]=o.useState(null),[v,T]=o.useState({}),[E,j]=o.useState(!1),[D,I]=o.useState(!1),[w,y]=o.useState(!1),[$,k]=o.useState(0),[L,V]=o.useState(!1),{callApi:Z,loading:ee,data:te,error:se}=q(),{loading:ae,error:oe}=q(),[ne,J]=o.useState(!1),[R,O]=o.useState(!1),le=e=>{r(e),y(!0)};o.useEffect(()=>{O(!R)},[D,w]);const re=e=>{x(g===e&&u==="asc"?"desc":"asc"),p(e)},ie=(e,s)=>{f(s)},de=e=>{S(parseInt(e.target.value,10)),f(0)},ce=e=>{const s=m(e.id,e.role);s&&(sessionStorage.setItem("selectedUser",JSON.stringify({...s,role:e.role})),T(s),j(!0))},z=e=>{const s=m(e.id,e.role);s&&(sessionStorage.setItem("selectedUser",JSON.stringify({...s,role:e.role})),T(s),I(!0))},me=()=>{J(!1)},ge=async()=>{const e=JSON.parse(sessionStorage.getItem("selectedUser"));if(e)try{const s={id:e.studentId||e.teacherId||e._id,role:e.role};await Z(Se.USER,"DELETE",s),te&&(l(be({id:s.id,role:s.role})),sessionStorage.removeItem("selectedUser"),sessionStorage.setItem("confirmModal","true"),j(!1),C(null),O(!R))}catch(s){console.error("Error deleting user:",s),sessionStorage.setItem("confirmModal","true"),O(!R)}},ue=[{id:"sn",label:"S/N",width:90},{id:"id",label:"ID",width:100,renderCell:e=>t.jsx(h,{children:(e.role==="student"||e.role==="teacher",String(e.id))})},{id:"name",label:"Name",flex:1},{id:"email",label:"Email",flex:1},{id:"details",label:"Details",flex:1,renderCell:e=>e.role==="student"?`${e.classLevel||"N/A"} (${e.boardingStatus||"N/A"})`:e.role==="teacher"?e.subject||"N/A":"Admin"},{id:"createdAt",label:"Registered Date",flex:1},{id:"actions",label:"Actions",width:200,renderCell:e=>t.jsxs("div",{style:{display:"flex"},children:[t.jsx(W,{onClick:()=>z(e),children:t.jsx(Be,{})}),t.jsx(W,{onClick:()=>ce(e),children:t.jsx(_e,{})}),t.jsx(W,{onClick:()=>{C(e),V(!0)},children:t.jsx(Fe,{})})]})}],he=Array.isArray(a)?a.map((e,s)=>(console.log("Student:",e),{id:e.studentId??"N/A",sn:s+1,role:"student",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",classLevel:e.currentClassLevel?`${e.currentClassLevel.className} ${e.currentClassLevel.subclass}`:"N/A",boardingStatus:e.boardingStatus||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"})).sort((e,s)=>e.sn-s.sn):[],pe=Array.isArray(i)?i.map((e,s)=>{var b;return{id:e.teacherId||"N/A",sn:s+1,role:"teacher",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",subject:((b=e.subject)==null?void 0:b.name)||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"}}).sort((e,s)=>e.sn-s.sn):[],xe=Array.isArray(c)?c.map((e,s)=>({id:e._id||"N/A",sn:s+1,role:"admin",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"})).sort((e,s)=>e.sn-s.sn):[];return{studentData:he,teacherData:pe,adminData:xe,selectedRole:d,setSelectedRole:r,sortBy:g,sortDirection:u,page:A,rowsPerPage:M,selectedUser:U,setSelectedUser:C,editUserDetailsState:v,openDeleteModal:E,setOpenDeleteModal:j,editDialogOpen:D,setEditDialogOpen:I,signUpDialogOpen:w,setSignUpDialogOpen:y,viewUserDetails:L,setViewUserDetails:V,confirmModalOpen:ne,setConfirmModalOpen:J,handleRoleSelect:le,handleSortChange:re,handlePageChange:ie,handleRowsPerPageChange:de,handleEdit:z,handleDelete:ge,handleConfirmationModalClose:me,columns:ue,tabIndex:$,handleTabChange:(e,s)=>{k(s),f(0)},loading:ee||ae,deleteError:se,updateError:oe,rerender:R}},H=({confirm:l,buttonLabel:n,dialogTitle:a,dialogContent:i,scrollType:c="paper",actionText1:m="Cancel",actionText2:d="Confirm",open:r=!1,onClose:g,onConfirm:p,maxWidth:u="sm"})=>{const[x,A]=o.useState(c),f=o.useRef(null),M=X(),S=G(M.palette.mode);return o.useEffect(()=>{if(r){const{current:U}=f;U!==null&&U.focus()}},[r]),t.jsxs(o.Fragment,{children:[t.jsx(_,{onClick:()=>g(),children:n}),t.jsxs(Ce,{open:r,onClose:g,scroll:x,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",maxWidth:u,fullWidth:!0,children:[t.jsx(je,{id:"scroll-dialog-title",children:a}),t.jsx(De,{dividers:x==="paper",children:t.jsx(qe,{id:"scroll-dialog-description",ref:f,tabIndex:-1,children:i})}),t.jsxs(Ae,{children:[t.jsx(_,{sx:{color:S.redAccent[500],border:`solis 2px ${S.redAccent[500]}`},onClick:g,children:m}),l&&t.jsx(_,{sx:{color:S.greenAccent[500],border:`solis 2px ${S.greenAccent[500]}`},onClick:p,children:d})]})]})]})},Ze=({selectedRole:l,editDialogOpen:n,setEditDialogOpen:a,handleEdit:i})=>{const[c,m]=o.useState(null);return o.useEffect(()=>{const d=sessionStorage.getItem("selectedUser");if(d){const r=JSON.parse(d);console.log(r),m(r),console.log(c)}},[]),t.jsx(N,{children:t.jsx(H,{buttonLabel:"Edit User",dialogTitle:"Edit User",dialogContent:c&&t.jsx(P,{role:l,selectedUser:c._id}),scrollType:"body",actionText1:"Cancel",actionText2:"Confirm",open:n,onClose:()=>a(!1),onConfirm:i})})},et=({open:l,onClose:n})=>{const{handleDelete:a,loading:i,deleteData:c,rerender:m,deleteError:d}=Y(),[r,g]=o.useState(!1);o.useEffect(()=>{const u=sessionStorage.getItem("confrimModal");u&&(g(u),console.log(r))},[m]);const p=()=>{g(!1),sessionStorage.removeItem("confrimModal")};return t.jsxs(t.Fragment,{children:[t.jsx(Ue,{open:l,onClose:n,title:"Confirm delete",onConfirm:a,children:t.jsxs("p",{children:["Confirm deletion of user."," ",t.jsx("span",{style:{color:"#EB433D",fontWeight:"900",fontSize:"large"},children:"Kindly note that this cannot be reversed"})]})}),t.jsx(He,{open:r&&r,isLoading:i,onClose:p,title:"Delete confirmation",message:c?"User successfully deleted":d})]})},tt=()=>{const l=X(),n=G(l.palette.mode),{selectedUser:a,editDialogOpen:i,studentData:c,teacherData:m,adminData:d,selectedRole:r,setSelectedRole:g,sortBy:p,sortDirection:u,page:x,rowsPerPage:A,setEditDialogOpen:f,signUpDialogOpen:M,setSignUpDialogOpen:S,handleRoleSelect:U,handleSortChange:C,handlePageChange:v,handleRowsPerPageChange:T,handleEdit:E,columns:j,tabIndex:D,handleTabChange:I,viewUserDetails:w,setViewUserDetails:y,openDeleteModal:$,setOpenDeleteModal:k,rerender:L}=Y();return o.useEffect(()=>{a&&y(!0)},[a,y]),t.jsxs(N,{children:[t.jsx(Le,{title:"User Management",subtitle:"Manage users"}),t.jsx(Ge,{label:"Add Users",options:[{value:"student",label:"Student"},{value:"teacher",label:"Teacher"},{value:"admin",label:"Admin"}],onSelect:U}),t.jsx(N,{mt:2,children:t.jsxs(Oe,{value:D,onChange:I,"aria-label":"user role tabs",sx:{backgroundColor:n.primary[400],"& .MuiTabs-indicator":{backgroundColor:n.blueAccent[700]}},children:[t.jsx(B,{label:"Students",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:n.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:n.primary[400]}}),t.jsx(B,{label:"Teachers",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:n.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:n.primary[400]}}),t.jsx(B,{label:"Admins",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:n.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:n.primary[400]}})]})}),D===0&&t.jsx(N,{m:"20px 0 0 0",height:"75vh",children:t.jsx(F,{columns:j,tableHeader:"Student Management",data:c,sortBy:p,sortDirection:u,onSortChange:C,page:x,rowsPerPage:A,onPageChange:v,onRowsPerPageChange:T,onRowClick:()=>g("student"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})}),D===1&&t.jsx(N,{m:"20px 0 0 0",height:"75vh",children:t.jsx(F,{columns:j,tableHeader:"Teacher Management",data:m,sortBy:p,sortDirection:u,onSortChange:C,page:x,rowsPerPage:A,onPageChange:v,onRowsPerPageChange:T,onRowClick:()=>g("teacher"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})}),D===2&&t.jsx(N,{m:"20px 0 0 0",height:"75vh",children:t.jsx(F,{columns:j,tableHeader:"Admin Management",data:d,sortBy:p,sortDirection:u,onSortChange:C,page:x,rowsPerPage:A,onPageChange:v,onRowsPerPageChange:T,onRowClick:()=>g("admin"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})}),w&&a&&t.jsx(H,{buttonLabel:"View User Details",dialogTitle:"User Details",dialogContent:t.jsxs(t.Fragment,{children:[t.jsxs(h,{children:["ID: ",a.id]}),t.jsxs(h,{children:["Name: ",`${a.name}`]}),t.jsxs(h,{children:["Email: ",a.email]}),a.role==="student"&&t.jsxs(t.Fragment,{children:[t.jsxs(h,{children:["Class: ",a.classLevel]}),t.jsxs(h,{children:["Boarding Status: ",a.boardingStatus]})]}),a.role==="teacher"&&t.jsxs(h,{children:["Subject: ",a.subject]}),t.jsxs(h,{children:["Role: ",a.role]}),t.jsxs(h,{children:["Registered Date: ",a.createdAt]})]}),scrollType:"paper",actionText1:"Close",actionText2:"Edit",open:w,onClose:()=>y(!1),onAction2:()=>E(a)}),t.jsx(et,{open:$,onClose:()=>k(!1)}),t.jsx(Ze,{selectedRole:r,editDialogOpen:i,setEditDialogOpen:f,handleEdit:E,rerender:L}),t.jsx(H,{buttonLabel:"Sign Up",dialogTitle:"Sign Up User",dialogContent:r==="student"?t.jsx(Qe,{}):r==="teacher"?t.jsx(Xe,{}):r==="admin"?t.jsx(Ye,{}):null,scrollType:"body",actionText1:"Cancel",actionText2:"Confirm",open:M,onClose:()=>S(!1)})]})},At=We(tt);export{At as default};
