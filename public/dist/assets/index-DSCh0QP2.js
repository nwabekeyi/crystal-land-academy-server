var $e=Object.defineProperty;var Le=(r,t,n)=>t in r?$e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n;var xe=(r,t,n)=>Le(r,typeof t!="symbol"?t+"":t,n);import{r as j,j as e,a as ie,e as oe,i as Me,I as ce,J as le,R as _e}from"./index-sE9McROK.js";import{u as Ye}from"./useApi-CPAxUgM_.js";import{H as ve}from"./Header-Ce3beeyr.js";import{t as Te,M as we}from"./modal-D5t_VsWL.js";import{g as me,a as he,_ as pe,ae as Ne,at as ke,b as z,s as ae,d as ne,h as X,e as fe,B as qe,r as Ae,c as be,u as Pe,i as ze,au as Oe,T as F,j as Fe,w as Y,P as Ue,z as Z,y as Ie,$ as Ce,a0 as De,a1 as je}from"./TextField-CMl_o3n-.js";import{A as We,G as de}from"./index-BS84kvxy.js";import{T as He}from"./table-BiKsd7Cl.js";import{u as Ve}from"./useAdminData-BpzmvROS.js";import{u as Ge,M as Se}from"./MenuItem-BXhanr4d.js";import{a as Qe}from"./index-BbKQoXkK.js";import{A as Ee}from"./confirmationModal-DtYljRDW.js";import{f as Je,g as Ke}from"./index.esm-5QlBNWyy.js";import{I as ye}from"./IconButton-DNp91bHf.js";import{w as Xe}from"./dasboardPagesContainer-D6kqLPWj.js";import"./CircularProgress-Cqs5A885.js";import"./useSlot-BX7f3QAU.js";import"./useMediaQuery-CnNNHth1.js";import"./loadingButton-CLKFd1OZ.js";function Ze(r){return me("PrivateSwitchBase",r)}he("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const et=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],tt=r=>{const{classes:t,checked:n,disabled:s,edge:h}=r,m={root:["root",n&&"checked",s&&"disabled",h&&`edge${X(h)}`],input:["input"]};return fe(m,Ze,t)},rt=ae(qe)(({ownerState:r})=>z({padding:9,borderRadius:"50%"},r.edge==="start"&&{marginLeft:r.size==="small"?-3:-12},r.edge==="end"&&{marginRight:r.size==="small"?-3:-12})),at=ae("input",{shouldForwardProp:Ae})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),st=j.forwardRef(function(t,n){const{autoFocus:s,checked:h,checkedIcon:m,className:l,defaultChecked:u,disabled:S,disableFocusRipple:g=!1,edge:v=!1,icon:f,id:c,inputProps:P,inputRef:O,name:L,onBlur:D,onChange:k,onFocus:w,readOnly:N,required:W=!1,tabIndex:T,type:M,value:_}=t,I=pe(t,et),[E,V]=Ne({controlled:h,default:!!u,name:"SwitchBase",state:"checked"}),B=ke(),G=i=>{w&&w(i),B&&B.onFocus&&B.onFocus(i)},J=i=>{D&&D(i),B&&B.onBlur&&B.onBlur(i)},Q=i=>{if(i.nativeEvent.defaultPrevented)return;const R=i.target.checked;V(R),k&&k(i,R)};let H=S;B&&typeof H>"u"&&(H=B.disabled);const K=M==="checkbox"||M==="radio",x=z({},t,{checked:E,disabled:H,disableFocusRipple:g,edge:v}),o=tt(x);return e.jsxs(rt,z({component:"span",className:ne(o.root,l),centerRipple:!0,focusRipple:!g,disabled:H,tabIndex:null,role:void 0,onFocus:G,onBlur:J,ownerState:x,ref:n},I,{children:[e.jsx(at,z({autoFocus:s,checked:h,defaultChecked:u,className:o.input,disabled:H,id:K?c:void 0,name:L,onChange:Q,readOnly:N,ref:O,required:W,ownerState:x,tabIndex:T,type:M},M==="checkbox"&&_===void 0?{}:{value:_},P)),E?m:f]}))}),ot=be(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),nt=be(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),it=be(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function ct(r){return me("MuiCheckbox",r)}const ue=he("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),lt=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],dt=r=>{const{classes:t,indeterminate:n,color:s,size:h}=r,m={root:["root",n&&"indeterminate",`color${X(s)}`,`size${X(h)}`]},l=fe(m,ct,t);return z({},t,l)},ut=ae(st,{shouldForwardProp:r=>Ae(r)||r==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:n}=r;return[t.root,n.indeterminate&&t.indeterminate,t[`size${X(n.size)}`],n.color!=="default"&&t[`color${X(n.color)}`]]}})(({theme:r,ownerState:t})=>z({color:(r.vars||r).palette.text.secondary},!t.disableRipple&&{"&:hover":{backgroundColor:r.vars?`rgba(${t.color==="default"?r.vars.palette.action.activeChannel:r.vars.palette[t.color].mainChannel} / ${r.vars.palette.action.hoverOpacity})`:ze(t.color==="default"?r.palette.action.active:r.palette[t.color].main,r.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${ue.checked}, &.${ue.indeterminate}`]:{color:(r.vars||r).palette[t.color].main},[`&.${ue.disabled}`]:{color:(r.vars||r).palette.action.disabled}})),mt=e.jsx(nt,{}),ht=e.jsx(ot,{}),pt=e.jsx(it,{}),Be=j.forwardRef(function(t,n){var s,h;const m=Pe({props:t,name:"MuiCheckbox"}),{checkedIcon:l=mt,color:u="primary",icon:S=ht,indeterminate:g=!1,indeterminateIcon:v=pt,inputProps:f,size:c="medium",className:P}=m,O=pe(m,lt),L=g?v:S,D=g?v:l,k=z({},m,{color:u,indeterminate:g,size:c}),w=dt(k);return e.jsx(ut,z({type:"checkbox",inputProps:z({"data-indeterminate":g},f),icon:j.cloneElement(L,{fontSize:(s=L.props.fontSize)!=null?s:c}),checkedIcon:j.cloneElement(D,{fontSize:(h=D.props.fontSize)!=null?h:c}),ownerState:k,ref:n,className:ne(w.root,P)},O,{classes:w}))});function ft(r){return me("MuiFormControlLabel",r)}const re=he("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),bt=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],gt=r=>{const{classes:t,disabled:n,labelPlacement:s,error:h,required:m}=r,l={root:["root",n&&"disabled",`labelPlacement${X(s)}`,h&&"error",m&&"required"],label:["label",n&&"disabled"],asterisk:["asterisk",h&&"error"]};return fe(l,ft,t)},xt=ae("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(r,t)=>{const{ownerState:n}=r;return[{[`& .${re.label}`]:t.label},t.root,t[`labelPlacement${X(n.labelPlacement)}`]]}})(({theme:r,ownerState:t})=>z({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${re.disabled}`]:{cursor:"default"}},t.labelPlacement==="start"&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},t.labelPlacement==="top"&&{flexDirection:"column-reverse",marginLeft:16},t.labelPlacement==="bottom"&&{flexDirection:"column",marginLeft:16},{[`& .${re.label}`]:{[`&.${re.disabled}`]:{color:(r.vars||r).palette.text.disabled}}})),Ct=ae("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(r,t)=>t.asterisk})(({theme:r})=>({[`&.${re.error}`]:{color:(r.vars||r).palette.error.main}})),Re=j.forwardRef(function(t,n){var s,h;const m=Pe({props:t,name:"MuiFormControlLabel"}),{className:l,componentsProps:u={},control:S,disabled:g,disableTypography:v,label:f,labelPlacement:c="end",required:P,slotProps:O={}}=m,L=pe(m,bt),D=ke(),k=(s=g??S.props.disabled)!=null?s:D==null?void 0:D.disabled,w=P??S.props.required,N={disabled:k,required:w};["checked","name","onChange","value","inputRef"].forEach(E=>{typeof S.props[E]>"u"&&typeof m[E]<"u"&&(N[E]=m[E])});const W=Oe({props:m,muiFormControl:D,states:["error"]}),T=z({},m,{disabled:k,labelPlacement:c,required:w,error:W.error}),M=gt(T),_=(h=O.typography)!=null?h:u.typography;let I=f;return I!=null&&I.type!==F&&!v&&(I=e.jsx(F,z({component:"span"},_,{className:ne(M.label,_==null?void 0:_.className),children:I}))),e.jsxs(xt,z({className:ne(M.root,l),ownerState:T,ref:n},L,{children:[j.cloneElement(S,N),w?e.jsxs(Qe,{display:"block",children:[I,e.jsxs(Ct,{ownerState:T,"aria-hidden":!0,className:M.asterisk,children:["â€‰","*"]})]}):I]}))}),Dt=()=>{const[r,t]=j.useState(""),[n,s]=j.useState(""),[h,m]=j.useState([]),l=ie(v=>v.users.user),{loading:u,data:S,callApi:g}=Ye();return j.useEffect(()=>{g(oe.COURSES,"GET")},[]),j.useEffect(()=>{if(S&&S.courses){const v=S.courses.find(f=>f.courseName===l.program);v&&(t(v.courseName),s(v.duration),m(v.curriculum||[]))}},[S]),{courseName:r,courseDuration:n,curriculum:h,loading:u}},jt=()=>{const r=Fe(),t=Te(r.palette.mode),{courseDuration:n,courseName:s,curriculum:h,loading:m}=Dt();return e.jsxs(Y,{children:[e.jsx(ve,{title:s||"Primary 2",subtitle:`${n||0} months`}),m?e.jsx(Me,{}):h&&h.length>0?e.jsxs(Y,{children:[e.jsx(F,{variant:"h2",gutterBottom:!0,children:"Curriculum"}),e.jsx(Y,{sx:{width:"100%"},children:h.map((l,u)=>e.jsxs(Ue,{elevation:3,sx:{backgroundColor:t.primary[400],color:t.blueAccent[500],p:3,mb:2,display:"flex",alignItems:"flex-start",gap:2,borderRadius:"12px",boxShadow:"0 3px 10px rgba(0, 0, 0, 0.1)"},children:[e.jsx(We,{sx:{bgcolor:t.primary[500],width:40,height:40,fontSize:"18px",color:"white"},children:u+1}),e.jsxs(Y,{children:[e.jsxs(F,{variant:"h3",sx:{color:t.blueAccent[200]},children:[l.topic||"No topic available"," "]}),e.jsxs(F,{variant:"body1",color:"textSecondary",sx:{mb:1},children:[l.description||"No description available"," "]}),e.jsxs(F,{variant:"body1",sx:{fontStyle:"italic"},children:["Duration: ",l.duration||"Unknown"," "]}),e.jsxs(F,{variant:"h6",sx:{color:t.blueAccent[200]},children:["Resources: ",Array.isArray(l.resources)?l.resources.join(", "):"No resources available"]})]})]},l._id||u))})]}):e.jsx(F,{variant:"body1",color:"textSecondary",children:"No curriculum available."})]})},St=()=>{const r={id:"",name:"",fromYear:"",toYear:"",isCurrent:!1},t={academicYearId:"",terms:[{name:"1st Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1},{name:"2nd Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1},{name:"3rd Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1}]},[n,s]=j.useState(r),[h,m]=j.useState(t),[l,u]=j.useState({name:"",fromYear:"",toYear:"",general:""}),[S,g]=j.useState({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]}),[v,f]=j.useState(!1),[c,P]=j.useState(!1),{loading:O,callApi:L}=Ye(),D=Ge(),{academicYears:k,currentAcademicYear:w,refetchAcademicYears:N,refetchCurrentYear:W}=Ve(),T=ie(o=>{var i;return(i=o.users.user)==null?void 0:i._id}),M=o=>{const{name:i,value:R,type:C,checked:$}=o.target,a=C==="checkbox"?$:R;s(d=>({...d,[i]:a})),u(d=>({...d,[i]:"",general:""}))},_=(o,i,R=!1)=>{const{name:C,value:$,type:a,checked:d}=o.target,y=a==="checkbox"?d:$;m(p=>{const A=[...p.terms];return A[i]={...A[i],[C]:y,createdBy:T},R&&y&&A.forEach((q,se)=>{se!==i&&(q.isCurrent=!1)}),{...p,terms:A}}),g(p=>({...p,terms:p.terms.map((A,q)=>q===i?{...A,[C]:""}:A),general:""}))},I=()=>{const{name:o,fromYear:i,toYear:R}=n,C={name:"",fromYear:"",toYear:"",general:""};return o.trim()?/^\d{4}\/\d{4}$/.test(o.trim())||(C.name="Name must be in format YYYY/YYYY (e.g., 2024/2025)"):C.name="Academic year name is required",i.trim()||(C.fromYear="From year is required"),R.trim()||(C.toYear="To year is required"),u(C),!C.name&&!C.fromYear&&!C.toYear},E=()=>{const{terms:o}=h,i={general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]};(!o||o.length!==3||!o.every(a=>["1st Term","2nd Term","3rd Term"].includes(a.name)))&&(i.general="Exactly three terms (1st Term, 2nd Term, 3rd Term) are required"),o.filter(a=>a.isCurrent).length>1&&(i.general="Only one term can be set as current");const C=Array.from({length:10},(a,d)=>`${d+1} month${d+1>1?"s":""}`);o.forEach((a,d)=>{a.description.trim()||(i.terms[d].description="Description is required"),(!a.duration||!C.includes(a.duration))&&(i.terms[d].duration="Duration must be between 1 and 10 months"),a.startDate||(i.terms[d].startDate="Start date is required"),a.endDate||(i.terms[d].endDate="End date is required"),a.startDate&&a.endDate&&new Date(a.startDate)>=new Date(a.endDate)&&(i.terms[d].endDate="End date must be after start date")});const $=o.map(a=>a.duration);new Set($).size!==$.length&&(i.general="All terms must have unique durations");for(let a=0;a<o.length;a++)for(let d=a+1;d<o.length;d++)o[a].startDate&&o[a].endDate&&o[d].startDate&&o[d].endDate&&new Date(o[a].startDate)<=new Date(o[d].endDate)&&new Date(o[d].startDate)<=new Date(o[a].endDate)&&(i.terms[d].startDate=`Terms ${o[a].name} and ${o[d].name} have overlapping dates`);return g(i),!i.general&&i.terms.every(a=>!a.description&&!a.duration&&!a.startDate&&!a.endDate)},V=async()=>{var a,d;if(!I())return!1;if(!T)return u(y=>({...y,general:"User not authenticated. Please log in."})),!1;const{name:o,fromYear:i,toYear:R,isCurrent:C}=n,$={name:o,fromYear:new Date(i).toISOString(),toYear:new Date(R).toISOString(),isCurrent:C,createdBy:T,academicTerms:[],students:[],teachers:[]};try{P(!0),u(A=>({...A,name:"",fromYear:"",toYear:"",general:""}));const y=await L(oe.ACADEMIC_YEARS,"POST",$);if(!y||y.status!=="success")throw new Error((y==null?void 0:y.message)||"Failed to create academic year");const p=y.data;return D(ce([...k,p])),C&&D(le(p)),await N(),await W(),s(r),f(!1),!0}catch(y){const p=((d=(a=y.response)==null?void 0:a.data)==null?void 0:d.message)||y.message||"Failed to create academic year";return u(A=>({...A,general:p})),D(u(p)),!1}finally{P(!1)}},B=async()=>{var C,$;if(!E())return!1;if(!T)return g(a=>({...a,general:"User not authenticated. Please log in."})),!1;const{terms:o,academicYearId:i}=h,R={academicYearId:i,terms:o.map(a=>({...a,startDate:a.startDate?new Date(a.startDate).toISOString():void 0,endDate:a.endDate?new Date(a.endDate).toISOString():void 0,createdBy:T}))};try{P(!0),g(p=>({...p,general:"",terms:p.terms.map(()=>({description:"",duration:"",startDate:"",endDate:""}))}));const a=await L(oe.ACADEMIC_TERMS,"POST",R);if(!a||a.status!=="success")throw new Error((a==null?void 0:a.message)||"Failed to create academic term");const d=a.data,y=k.map(p=>p._id===i?{...p,academicTerms:[...p.academicTerms||[],d._id]}:p);return D(ce(y)),await N(),m(t),!0}catch(a){const d=(($=(C=a.response)==null?void 0:C.data)==null?void 0:$.message)||a.message||"Failed to create academic term";return g(y=>({...y,general:d})),D(u(d)),!1}finally{P(!1)}},G=async()=>{var d,y;if(!I())return!1;const{id:o,name:i,fromYear:R,toYear:C,isCurrent:$}=n;if(!T)return u(p=>({...p,general:"User not authenticated. Please log in."})),!1;const a={name:i,fromYear:new Date(R).toISOString(),toYear:new Date(C).toISOString(),isCurrent:$,createdBy:T};try{P(!0),u(q=>({...q,name:"",fromYear:"",toYear:"",general:""}));const p=await L(`${oe.ACADEMIC_YEARS}/${o}`,"PATCH",a);if(!p||p.status!=="success")throw new Error((p==null?void 0:p.message)||"Failed to update academic year");const A=p.data;return D(ce(k.map(q=>q._id===o?A:q))),$?D(le(A)):(w==null?void 0:w._id)===o&&!$&&D(le(null)),await N(),await W(),s(r),f(!1),!0}catch(p){const A=((y=(d=p.response)==null?void 0:d.data)==null?void 0:y.message)||p.message||"Failed to update academic year";return u(q=>({...q,general:A})),D(u(A)),!1}finally{P(!1)}};return{setFormValues:s,formValues:n,handleChange:M,handleTermChange:_,handleSubmit:async()=>v?await G():await V(),handleCreateAcademicTerm:B,startEdit:o=>{s({id:o._id,name:o.name,fromYear:o.fromYear.split("T")[0],toYear:o.toYear.split("T")[0],isCurrent:o.isCurrent}),f(!0),u({name:"",fromYear:"",toYear:"",general:""})},startAddTerm:o=>{m({...t,academicYearId:o,terms:t.terms.map(i=>({...i,createdBy:T}))}),g({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]})},editMode:v,setEditMode:f,academicYears:k,currentAcademicYear:w,loading:O,error:l,termError:S,isSubmitting:c,resetForm:()=>{s(r),u({name:"",fromYear:"",toYear:"",general:""}),f(!1)},resetTermForm:()=>{m(t),g({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]})},termFormValues:h}},yt=({open:r,onClose:t,handleSubmit:n,error:s={},editMode:h=!1,userId:m,formValues:l,handleChange:u,isSubmitting:S=!1})=>{const g=new Date().toISOString().split("T")[0],v=async f=>{f.preventDefault(),console.log("Form submission attempted with values:",l);try{await n(l)?(console.log("Submission successful"),t()):console.log("Submission failed, handleSubmit returned false")}catch(c){console.error("Submission error:",c)}};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            opacity: 1;
          }
          input[type="date"] {
            color-scheme: light;
          }
        `}),e.jsx(we,{open:r,onClose:t,title:h?"Edit Academic Year":"Add Academic Year",noConfirm:!0,children:e.jsxs(Y,{component:"form",onSubmit:v,children:[e.jsx(Y,{mb:2,children:e.jsx(Z,{label:"Academic Year Name (e.g., 2024/2025)",name:"name",value:l.name||"",onChange:u,fullWidth:!0,required:!0,error:!!s.name,helperText:s.name||"Format: YYYY/YYYY (e.g., 2024/2025)"})}),e.jsx(Y,{mb:2,children:e.jsx(Z,{label:"From Year",name:"fromYear",type:"date",value:l.fromYear||"",onChange:u,fullWidth:!0,required:!0,error:!!s.fromYear,helperText:s.fromYear,InputLabelProps:{shrink:!0},inputProps:{min:g}})}),e.jsx(Y,{mb:2,children:e.jsx(Z,{label:"To Year",name:"toYear",type:"date",value:l.toYear||"",onChange:u,fullWidth:!0,required:!0,error:!!s.toYear,helperText:s.toYear,InputLabelProps:{shrink:!0},inputProps:{min:l.fromYear||g}})}),e.jsx(Y,{mb:2,children:e.jsx(Re,{control:e.jsx(Be,{checked:l.isCurrent||!1,onChange:u,name:"isCurrent",color:"primary"}),label:"Set as Current Academic Year"})}),s.general&&e.jsx(F,{variant:"caption",color:"error",mb:2,children:s.general}),e.jsx(Ie,{type:"submit",variant:"contained",color:"primary",disabled:S,fullWidth:!0,children:S?"Submitting...":h?"Update Academic Year":"Submit"})]})})]})},Yt=({open:r,onClose:t,handleSubmit:n,error:s={},userId:h,formValues:m,handleChange:l,isSubmitting:u=!1})=>{const S=new Date().toISOString().split("T")[0],g=async f=>{f.preventDefault();try{await n()&&t()}catch(c){console.error("Submission error:",c)}},v=Array.from({length:10},(f,c)=>`${c+1} month${c+1>1?"s":""}`);return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            opacity: 1;
          }
          input[type="date"] {
            color-scheme: light;
          }
        `}),e.jsx(we,{open:r,onClose:t,title:"Add Academic Term",noConfirm:!0,children:e.jsxs(Y,{component:"form",onSubmit:g,children:[m.terms.map((f,c)=>{var P,O,L,D,k,w,N,W,T,M,_,I,E,V,B,G,J,Q,H,K;return e.jsxs(Y,{mb:3,sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(F,{variant:"h6",children:f.name}),e.jsx(Y,{mb:2,children:e.jsxs(Ce,{fullWidth:!0,required:!0,error:!!((O=(P=s.terms)==null?void 0:P[c])!=null&&O.name),children:[e.jsx(De,{id:`term-name-label-${c}`,children:"Term Name"}),e.jsx(je,{labelId:`term-name-label-${c}`,name:"name",value:f.name||"",onChange:x=>l(x,c),label:"Term Name",disabled:!0,children:["1st Term","2nd Term","3rd Term"].map(x=>e.jsx(Se,{value:x,children:x},x))}),((D=(L=s.terms)==null?void 0:L[c])==null?void 0:D.name)&&e.jsx(F,{variant:"caption",color:"error",children:s.terms[c].name})]})}),e.jsx(Y,{mb:2,children:e.jsx(Z,{label:"Description",name:"description",value:f.description||"",onChange:x=>l(x,c),fullWidth:!0,required:!0,error:!!((w=(k=s.terms)==null?void 0:k[c])!=null&&w.description),helperText:(W=(N=s.terms)==null?void 0:N[c])==null?void 0:W.description})}),e.jsx(Y,{mb:2,children:e.jsxs(Ce,{fullWidth:!0,required:!0,error:!!((M=(T=s.terms)==null?void 0:T[c])!=null&&M.duration),children:[e.jsx(De,{id:`duration-label-${c}`,children:"Duration"}),e.jsx(je,{labelId:`duration-label-${c}`,name:"duration",value:f.duration||"3 months",onChange:x=>l(x,c),label:"Duration",children:v.map(x=>e.jsx(Se,{value:x,children:x},x))}),((I=(_=s.terms)==null?void 0:_[c])==null?void 0:I.duration)&&e.jsx(F,{variant:"caption",color:"error",children:s.terms[c].duration})]})}),e.jsx(Y,{mb:2,children:e.jsx(Z,{label:"Start Date",name:"startDate",type:"date",value:f.startDate||"",onChange:x=>l(x,c),fullWidth:!0,required:!0,error:!!((V=(E=s.terms)==null?void 0:E[c])!=null&&V.startDate),helperText:(G=(B=s.terms)==null?void 0:B[c])==null?void 0:G.startDate,InputLabelProps:{shrink:!0},inputProps:{min:S}})}),e.jsx(Y,{mb:2,children:e.jsx(Z,{label:"End Date",name:"endDate",type:"date",value:f.endDate||"",onChange:x=>l(x,c),fullWidth:!0,required:!0,error:!!((Q=(J=s.terms)==null?void 0:J[c])!=null&&Q.endDate),helperText:(K=(H=s.terms)==null?void 0:H[c])==null?void 0:K.endDate,InputLabelProps:{shrink:!0},inputProps:{min:f.startDate||S}})}),e.jsx(Y,{mb:2,children:e.jsx(Re,{control:e.jsx(Be,{checked:f.isCurrent||!1,onChange:x=>l(x,c,!0),name:"isCurrent",color:"primary"}),label:"Set as Current Term"})})]},f.name)}),s.general&&e.jsx(F,{variant:"caption",color:"error",mb:2,children:s.general}),e.jsx(Ie,{type:"submit",variant:"contained",color:"primary",disabled:u,fullWidth:!0,children:u?"Submitting...":"Submit"})]})})]})};class vt extends _e.Component{constructor(){super(...arguments);xe(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,s){console.error("Error caught by boundary:",n,s)}render(){var n;return this.state.hasError?e.jsxs(Y,{sx:{p:3,textAlign:"center"},children:[e.jsx(F,{variant:"h5",color:"error",children:"Something went wrong."}),e.jsx(F,{variant:"body1",mt:2,children:((n=this.state.error)==null?void 0:n.message)||"An unexpected error occurred."}),e.jsx(Ee,{content:"Reload",onClick:()=>window.location.reload(),sx:{mt:2}})]}):this.props.children}}const Tt=()=>{var q,se,ge;const r=Fe(),t=Te(r.palette.mode),{academicYears:n,currentAcademicYear:s,loading:h,error:m,termError:l,handleSubmit:u,handleCreateAcademicTerm:S,startEdit:g,startAddTerm:v,editMode:f,setEditMode:c,formValues:P,termFormValues:O,handleChange:L,handleTermChange:D,isSubmitting:k,resetForm:w,resetTermForm:N}=St(),[W,T]=j.useState(!1),[M,_]=j.useState(!1),I=ie(b=>{var U;return(U=b.users.user)==null?void 0:U._id})||"",[E,V]=j.useState("name"),[B,G]=j.useState("asc"),[J,Q]=j.useState(0),[H,K]=j.useState(5),[x,o]=j.useState(""),i=[{id:"sn",label:"S/N"},{id:"name",label:"Name"},{id:"fromYear",label:"From Year"},{id:"toYear",label:"To Year"},{id:"isCurrent",label:"Current"},{id:"studentCount",label:"Students"},{id:"teacherCount",label:"Teachers"},{id:"actions",label:"Actions"}],R=n.map((b,U)=>{var ee,te;return{sn:U+1,id:b._id,name:b.name,fromYear:new Date(b.fromYear).toLocaleDateString(),toYear:new Date(b.toYear).toLocaleDateString(),isCurrent:b.isCurrent?"Yes":"No",studentCount:((ee=b.students)==null?void 0:ee.length)||0,teacherCount:((te=b.teachers)==null?void 0:te.length)||0,actions:e.jsxs(Y,{children:[e.jsxs(ye,{onClick:()=>{console.log("EditIcon clicked for academicYearId:",b._id),C(b)},children:[e.jsx(Je,{})," "]}),e.jsxs(ye,{onClick:()=>{console.log("AddCircleIcon clicked for academicYearId:",b._id),$(b._id)},children:[e.jsx(Ke,{})," "]})]})}}),C=b=>{console.log("handleEdit called with year:",b._id),g(b),T(!0)},$=b=>{console.log("handleAddTerm called with academicYearId:",b);try{v(b),_(!0)}catch(U){console.error("Error in handleAddTerm:",U)}},a=b=>{const U=E===b&&B==="asc";V(b),G(U?"desc":"asc")},d=(b,U)=>{Q(U)},y=b=>{K(parseInt(b.target.value,10)),Q(0)},A=[...R.filter(b=>b.name.toLowerCase().includes(x.toLowerCase()))].sort((b,U)=>{const ee=b[E],te=U[E];return B==="asc"?ee>te?1:-1:ee<te?1:-1});return e.jsx(vt,{children:e.jsxs(de,{container:!0,children:[e.jsx(de,{item:!0,xs:12,children:e.jsx(ve,{title:"Academics Management",subtitle:"Manage Academic Sessions"})}),e.jsx(de,{item:!0,xs:12,children:h?e.jsx(Y,{children:"Loading..."}):m.general?e.jsx(Y,{sx:{color:"red"},children:m.general}):e.jsxs(e.Fragment,{children:[e.jsxs(Y,{sx:{mb:3,p:2,backgroundColor:t.primary[400],borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(Y,{children:[e.jsx(F,{variant:"h5",color:t.grey[100],children:"Current Academic Year"}),s?e.jsxs(F,{variant:"body1",color:t.grey[100],children:[s.name," (",new Date(s.fromYear).toLocaleDateString()," -"," ",new Date(s.toYear).toLocaleDateString(),") |"," ",((q=s.students)==null?void 0:q.length)||0," Students,"," ",((se=s.teachers)==null?void 0:se.length)||0," Teachers,"," ",((ge=s.academicTerms)==null?void 0:ge.length)||0," Terms"]}):e.jsx(F,{variant:"body1",color:t.redAccent[500],children:"No current academic year set."})]}),e.jsx(Ee,{onClick:()=>{T(!0),c(!1),w()},content:"Add Academic Year"})]}),e.jsx(yt,{open:W,onClose:()=>{T(!1),c(!1),w()},handleSubmit:u,error:m,editMode:f,userId:I,formValues:P,handleChange:L,isSubmitting:k}),e.jsx(Yt,{open:M,onClose:()=>{_(!1),N()},handleSubmit:S,error:l,userId:I,formValues:O,handleChange:D,isSubmitting:k}),e.jsx(He,{columns:i,tableHeader:"Academic Years",data:A,sortBy:E,sortDirection:B,onSortChange:a,page:J,rowsPerPage:H,onPageChange:d,onRowsPerPageChange:y,hiddenColumnsSmallScreen:["fromYear","toYear","studentCount","teacherCount","academicTermCount","actions"],hiddenColumnsTabScreen:["studentCount","teacherCount","academicTermCount"]})]})})]})})},wt=()=>{const r=ie(t=>t.users.user.role);return console.log(r),e.jsx("div",{children:r==="teacher"?e.jsx(jt,{}):e.jsx(Tt,{})})},Vt=Xe(wt);export{Vt as default};
