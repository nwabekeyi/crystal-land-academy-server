import{r as l,f as _,j as e,a as $}from"./index-BuRqVy2o.js";import{t as R,M as L}from"./modal-Dtd90-ui.js";import{H as N}from"./Header-CPyALzpz.js";import{C as F}from"./accordion-6iif8NxD.js";import{w as O}from"./dasboardPagesContainer-2WDa4n00.js";import{u as H}from"./useApi-D4lIDwWM.js";import{j as I,M as P,v as m,T as c,x as S}from"./TextField-DPEWop0l.js";import{C as B}from"./CircularProgress-CZOZaR_c.js";import"./IconButton-DN-FrFOr.js";import"./index-CdkazARq.js";import"./confirmationModal-DFTnOKbM.js";import"./MenuItem-DAhVz_SE.js";import"./index-gjfgqqyg.js";import"./loadingButton-WtJYv-TH.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-BNYqSIw-.js";const D=u=>{const{loading:s,error:h,callApi:i}=H(),[r,d]=l.useState([]),n=l.useRef(!0),b=async y=>{try{const x=`${_.CURRICULUM}/teacher/${y}`,a=await i(x,"GET");if(a&&a.status==="success"&&n.current){const v=a.data.map(p=>{var k,M,g,T;return{_id:p._id,subject:((k=p.subjectId)==null?void 0:k.name)||"Unknown Subject",subjectId:(M=p.subjectId)==null?void 0:M._id,classLevel:((g=p.classLevelId)==null?void 0:g.name)||"Unknown Class",classLevelId:(T=p.classLevelId)==null?void 0:T._id,topics:p.topics.map((f,A)=>({_id:f._id||`topic_${A}`,topic:f.topic||"Untitled Topic",description:f.description||"No description available",resources:f.resources||[],isCompleted:f.isCompleted||!1})),completionRate:p.completionRate||0}});d(v)}return a}catch(x){throw new Error(x.message||"Failed to fetch curricula")}},j=async(y,x)=>{try{return await i(`${_.CURRICULUM}/${y}/topics/${x}/complete`,"PATCH")}catch(a){throw new Error(a.message||"Failed to mark topic as completed")}};return l.useEffect(()=>()=>{n.current=!1},[u]),{loading:s,error:h,curricula:r,fetchTeacherCurricula:b,markTopicAsCompleted:j}},W=({open:u,onClose:s,onConfirm:h,curriculumId:i,topic:r})=>{const d=I(),n=R(d.palette.mode);return e.jsx(P,{open:u,onClose:s,children:e.jsxs(m,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:n.primary[400],p:4,borderRadius:1},children:[e.jsx(c,{variant:"h6",sx:{mb:2,color:n.grey[100]},children:"Mark Topic as Completed"}),e.jsxs(c,{sx:{mb:2,color:n.grey[100]},children:['Are you sure you want to mark the topic "',r==null?void 0:r.topic,'" as completed?']}),e.jsxs(m,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[e.jsx(S,{onClick:s,sx:{mr:1,color:n.grey[100]},children:"Cancel"}),e.jsx(S,{variant:"contained",onClick:()=>h(i,r._id),sx:{bgcolor:n.greenAccent[500]},children:"Confirm"})]})]})})},G=({open:u,onClose:s,message:h,isSuccess:i})=>{const r=I(),d=R(r.palette.mode);return e.jsx(L,{open:u,onClose:s,title:i?"Success":"Error",confirmText:"OK",showCancel:!1,styleProps:{backgroundColor:d.primary[400],borderRadius:"8px",width:"400px",margin:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:e.jsx(c,{sx:{mb:2,color:d.grey[100]},children:h})})},K=()=>{const u=I(),s=R(u.palette.mode),{loading:h,error:i,curricula:r,fetchTeacherCurricula:d,markTopicAsCompleted:n}=D(),{user:b}=$(t=>t.users),j=b==null?void 0:b._id,[y,x]=l.useState(!1),[a,v]=l.useState(null),[p,k]=l.useState(null),[M,g]=l.useState(!1),[T,f]=l.useState(""),[A,E]=l.useState(!0),w=(t,o=!0)=>{f(t),E(o),g(!0)};l.useEffect(()=>{j&&d(j)},[j]);const U=async(t,o)=>{try{const C=await n(t,o);C.status==="success"?(w("Topic marked as completed"),await d(j)):w(C.message||"Failed to mark topic as completed",!1)}catch(C){w(C.message||"Failed to mark topic as completed",!1)}};return e.jsxs(m,{sx:{p:3},children:[e.jsx(N,{title:"Teacher Curriculum Management",subtitle:"View and mark topics as completed for your assigned subjects"}),h?e.jsx(m,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(B,{color:"primary"})}):i?e.jsx(c,{variant:"body1",color:s.redAccent[500],sx:{mt:2},children:i}):r.length>0?r.map(t=>e.jsxs(m,{sx:{mb:4},children:[e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(c,{variant:"h2",sx:{color:s.blueAccent[200],fontWeight:"bold"},children:[t.subject," (",t.classLevel,")"]}),e.jsxs(c,{sx:{color:s.grey[100]},children:["Completion Rate: ",t.completionRate.toFixed(2),"%"]})]}),t.topics.length>0?t.topics.map((o,C)=>e.jsx(m,{sx:{mb:1},children:e.jsx(F,{title:`${C+1}. ${o.topic}`,details:e.jsxs(m,{children:[e.jsx(c,{variant:"body1",color:s.grey[100],sx:{mb:1},children:o.description||"No description available"}),e.jsxs(c,{variant:"body1",sx:{color:s.blueAccent[200]},children:["Resources:"," ",Array.isArray(o.resources)?o.resources.join(", "):"No resources available"]}),e.jsxs(c,{variant:"body1",sx:{color:o.isCompleted?s.greenAccent[500]:s.redAccent[500]},children:["Status: ",o.isCompleted?"Completed":"Not Completed"]}),!o.isCompleted&&e.jsx(m,{sx:{mt:2},children:e.jsx(S,{onClick:()=>{v(t),k(o),x(!0)},sx:{color:s.greenAccent[500]},children:"Mark Complete"})})]}),defaultExpanded:!1})},o._id||"")):e.jsxs(c,{variant:"body1",color:s.grey[100],children:["No topics available for ",t.subject,"."]})]},t._id)):e.jsx(c,{variant:"body1",color:s.grey[100],children:"No curricula available for your subjects."}),e.jsx(W,{open:y,onClose:()=>x(!1),onConfirm:U,curriculumId:a==null?void 0:a._id,topic:p}),e.jsx(G,{open:M,onClose:()=>g(!1),message:T,isSuccess:A})]})},le=O(K);export{le as default};
