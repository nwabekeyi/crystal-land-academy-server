var Pe=Object.defineProperty;var _e=(n,r,d)=>r in n?Pe(n,r,{enumerable:!0,configurable:!0,writable:!0,value:d}):n[r]=d;var ge=(n,r,d)=>_e(n,typeof r!="symbol"?r+"":r,d);import{j as e,r as b,a as ne,e as ee,i as $e,H as re,I as ae,R as Me}from"./index-CdkYNvdJ.js";import{u as je}from"./useApi-BrBqn812.js";import{H as Ye}from"./Header-DO0uyZl5.js";import{t as Se,M as de}from"./modal-DsXk1ME2.js";import{c as ue,a as Be,g as Re,u as ze,_ as Oe,b as te,s as Le,d as Ne,h as se,e as qe,a1 as Ue,i as We,j as ye,v as D,T as A,P as He,y as Z,x as Te,Z as xe,$ as be,a0 as De}from"./TextField-C_K1waWO.js";import{A as Ve,G as ie}from"./index-_RTzlu92.js";import{T as Ge}from"./table-bH-7jnlx.js";import{u as Qe}from"./useAdminData-DcNZQ8Eg.js";import{u as Ze,M as Ce}from"./MenuItem-CDF6WLe1.js";import{S as Je,F as ve}from"./FormControlLabel-CQQRDuxc.js";import{A as we}from"./confirmationModal-D-x-W9p9.js";import{e as Ke,f as Xe,g as et}from"./index.esm-BzJpWXI8.js";import{I as ce}from"./IconButton-CVLyvWG7.js";import{w as tt}from"./dasboardPagesContainer-xYUEgO23.js";import"./index-d7u5DjPe.js";import"./loadingButton-BvfSXHsQ.js";import"./CircularProgress-DmkQDBLp.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-BvsMscbt.js";import"./useMediaQuery-BtMw92rj.js";const rt=ue(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),at=ue(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),st=ue(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function nt(n){return Re("MuiCheckbox",n)}const le=Be("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),ot=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],it=n=>{const{classes:r,indeterminate:d,color:s,size:S}=n,j={root:["root",d&&"indeterminate",`color${se(s)}`,`size${se(S)}`]},p=qe(j,nt,r);return te({},r,p)},ct=Le(Je,{shouldForwardProp:n=>Ue(n)||n==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(n,r)=>{const{ownerState:d}=n;return[r.root,d.indeterminate&&r.indeterminate,r[`size${se(d.size)}`],d.color!=="default"&&r[`color${se(d.color)}`]]}})(({theme:n,ownerState:r})=>te({color:(n.vars||n).palette.text.secondary},!r.disableRipple&&{"&:hover":{backgroundColor:n.vars?`rgba(${r.color==="default"?n.vars.palette.action.activeChannel:n.vars.palette[r.color].mainChannel} / ${n.vars.palette.action.hoverOpacity})`:We(r.color==="default"?n.palette.action.active:n.palette[r.color].main,n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},r.color!=="default"&&{[`&.${le.checked}, &.${le.indeterminate}`]:{color:(n.vars||n).palette[r.color].main},[`&.${le.disabled}`]:{color:(n.vars||n).palette.action.disabled}})),lt=e.jsx(at,{}),dt=e.jsx(rt,{}),ut=e.jsx(st,{}),Ae=b.forwardRef(function(r,d){var s,S;const j=ze({props:r,name:"MuiCheckbox"}),{checkedIcon:p=lt,color:u="primary",icon:I=dt,indeterminate:Y=!1,indeterminateIcon:v=ut,inputProps:f,size:o="medium",className:k}=j,R=Oe(j,ot),_=Y?v:I,y=Y?v:p,P=te({},j,{color:u,indeterminate:Y,size:o}),E=it(P);return e.jsx(ct,te({type:"checkbox",inputProps:te({"data-indeterminate":Y},f),icon:b.cloneElement(_,{fontSize:(s=_.props.fontSize)!=null?s:o}),checkedIcon:b.cloneElement(y,{fontSize:(S=y.props.fontSize)!=null?S:o}),ownerState:P,ref:d,className:Ne(E.root,k)},R,{classes:E}))}),mt=()=>{const[n,r]=b.useState(""),[d,s]=b.useState(""),[S,j]=b.useState([]),p=ne(v=>v.users.user),{loading:u,data:I,callApi:Y}=je();return b.useEffect(()=>{Y(ee.COURSES,"GET")},[]),b.useEffect(()=>{if(I&&I.courses){const v=I.courses.find(f=>f.courseName===p.program);v&&(r(v.courseName),s(v.duration),j(v.curriculum||[]))}},[I]),{courseName:n,courseDuration:d,curriculum:S,loading:u}},ht=()=>{const n=ye(),r=Se(n.palette.mode),{courseDuration:d,courseName:s,curriculum:S,loading:j}=mt();return e.jsxs(D,{children:[e.jsx(Ye,{title:s||"Primary 2",subtitle:`${d||0} months`}),j?e.jsx($e,{}):S&&S.length>0?e.jsxs(D,{children:[e.jsx(A,{variant:"h2",gutterBottom:!0,children:"Curriculum"}),e.jsx(D,{sx:{width:"100%"},children:S.map((p,u)=>e.jsxs(He,{elevation:3,sx:{backgroundColor:r.primary[400],color:r.blueAccent[500],p:3,mb:2,display:"flex",alignItems:"flex-start",gap:2,borderRadius:"12px",boxShadow:"0 3px 10px rgba(0, 0, 0, 0.1)"},children:[e.jsx(Ve,{sx:{bgcolor:r.primary[500],width:40,height:40,fontSize:"18px",color:"white"},children:u+1}),e.jsxs(D,{children:[e.jsxs(A,{variant:"h3",sx:{color:r.blueAccent[200]},children:[p.topic||"No topic available"," "]}),e.jsxs(A,{variant:"body1",color:"textSecondary",sx:{mb:1},children:[p.description||"No description available"," "]}),e.jsxs(A,{variant:"body1",sx:{fontStyle:"italic"},children:["Duration: ",p.duration||"Unknown"," "]}),e.jsxs(A,{variant:"h6",sx:{color:r.blueAccent[200]},children:["Resources: ",Array.isArray(p.resources)?p.resources.join(", "):"No resources available"]})]})]},p._id||u))})]}):e.jsx(A,{variant:"body1",color:"textSecondary",children:"No curriculum available."})]})},pt=()=>{const n={id:"",name:"",fromYear:"",toYear:"",isCurrent:!1},r={academicYearId:"",terms:[{name:"1st Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1},{name:"2nd Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1},{name:"3rd Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1}]},[d,s]=b.useState(n),[S,j]=b.useState(r),[p,u]=b.useState({name:"",fromYear:"",toYear:"",general:""}),[I,Y]=b.useState({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]}),[v,f]=b.useState(!1),[o,k]=b.useState(!1),{loading:R,callApi:_}=je(),y=Ze(),{academicYears:P,currentAcademicYear:E,refetchAcademicYears:B,refetchCurrentYear:z}=Qe(),F=ne(a=>{var i;return(i=a.users.user)==null?void 0:i._id}),O=a=>{const{name:i,value:w,type:c,checked:g}=a.target,t=c==="checkbox"?g:w;s(l=>({...l,[i]:t})),u(l=>({...l,[i]:"",general:""}))},Q=async a=>{var i,w;if(!F)return u(c=>({...c,general:"User not authenticated. Please log in."})),!1;try{k(!0),u(g=>({...g,general:""}));const c=await _(`${ee.ACADEMIC_YEARS}/${a}`,"DELETE");if(!c||c.status!=="success")throw new Error((c==null?void 0:c.message)||"Failed to delete academic year");return y(re(P.filter(g=>g._id!==a))),(E==null?void 0:E._id)===a&&y(ae(null)),await B(),await z(),!0}catch(c){const g=((w=(i=c.response)==null?void 0:i.data)==null?void 0:w.message)||c.message||"Failed to delete academic year";return u(t=>({...t,general:g})),y(u(g)),!1}finally{k(!1)}},U=(a,i,w=!1)=>{const{name:c,value:g,type:t,checked:l}=a.target,x=t==="checkbox"?l:g;j(h=>{const T=[...h.terms];return T[i]={...T[i],[c]:x,createdBy:F},w&&x&&T.forEach(($,oe)=>{oe!==i&&($.isCurrent=!1)}),{...h,terms:T}}),Y(h=>({...h,terms:h.terms.map((T,$)=>$===i?{...T,[c]:""}:T),general:""}))},W=()=>{const{name:a,fromYear:i,toYear:w}=d,c={name:"",fromYear:"",toYear:"",general:""};return a.trim()?/^\d{4}\/\d{4}$/.test(a.trim())||(c.name="Name must be in format YYYY/YYYY (e.g., 2024/2025)"):c.name="Academic year name is required",i.trim()||(c.fromYear="From year is required"),w.trim()||(c.toYear="To year is required"),u(c),!c.name&&!c.fromYear&&!c.toYear},L=()=>{const{terms:a}=S,i={general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]};(!a||a.length!==3||!a.every(t=>["1st Term","2nd Term","3rd Term"].includes(t.name)))&&(i.general="Exactly three terms (1st Term, 2nd Term, 3rd Term) are required"),a.filter(t=>t.isCurrent).length>1&&(i.general="Only one term can be set as current");const c=Array.from({length:10},(t,l)=>`${l+1} month${l+1>1?"s":""}`);a.forEach((t,l)=>{t.description.trim()||(i.terms[l].description="Description is required"),(!t.duration||!c.includes(t.duration))&&(i.terms[l].duration="Duration must be between 1 and 10 months"),t.startDate||(i.terms[l].startDate="Start date is required"),t.endDate||(i.terms[l].endDate="End date is required"),t.startDate&&t.endDate&&new Date(t.startDate)>=new Date(t.endDate)&&(i.terms[l].endDate="End date must be after start date")});const g=a.map(t=>t.duration);new Set(g).size!==g.length&&(i.general="All terms must have unique durations");for(let t=0;t<a.length;t++)for(let l=t+1;l<a.length;l++)a[t].startDate&&a[t].endDate&&a[l].startDate&&a[l].endDate&&new Date(a[t].startDate)<=new Date(a[l].endDate)&&new Date(a[l].startDate)<=new Date(a[t].endDate)&&(i.terms[l].startDate=`Terms ${a[t].name} and ${a[l].name} have overlapping dates`);return Y(i),!i.general&&i.terms.every(t=>!t.description&&!t.duration&&!t.startDate&&!t.endDate)},H=async()=>{var t,l;if(!W())return!1;if(!F)return u(x=>({...x,general:"User not authenticated. Please log in."})),!1;const{name:a,fromYear:i,toYear:w,isCurrent:c}=d,g={name:a,fromYear:new Date(i).toISOString(),toYear:new Date(w).toISOString(),isCurrent:c,createdBy:F,academicTerms:[],students:[],teachers:[]};try{k(!0),u(T=>({...T,name:"",fromYear:"",toYear:"",general:""}));const x=await _(ee.ACADEMIC_YEARS,"POST",g);if(!x||x.status!=="success")throw new Error((x==null?void 0:x.message)||"Failed to create academic year");const h=x.data;return y(re([...P,h])),c&&y(ae(h)),await B(),await z(),s(n),f(!1),!0}catch(x){const h=((l=(t=x.response)==null?void 0:t.data)==null?void 0:l.message)||x.message||"Failed to create academic year";return u(T=>({...T,general:h})),y(u(h)),!1}finally{k(!1)}},N=async()=>{var c,g;if(!L())return!1;if(!F)return Y(t=>({...t,general:"User not authenticated. Please log in."})),!1;const{terms:a,academicYearId:i}=S,w={academicYearId:i,terms:a.map(t=>({...t,startDate:t.startDate?new Date(t.startDate).toISOString():void 0,endDate:t.endDate?new Date(t.endDate).toISOString():void 0,createdBy:F}))};try{k(!0),Y(h=>({...h,general:"",terms:h.terms.map(()=>({description:"",duration:"",startDate:"",endDate:""}))}));const t=await _(ee.ACADEMIC_TERMS,"POST",w);if(!t||t.status!=="success")throw new Error((t==null?void 0:t.message)||"Failed to create academic term");const l=t.data,x=P.map(h=>h._id===i?{...h,academicTerms:[...h.academicTerms||[],l._id]}:h);return y(re(x)),await B(),j(r),!0}catch(t){const l=((g=(c=t.response)==null?void 0:c.data)==null?void 0:g.message)||t.message||"Failed to create academic term";return Y(x=>({...x,general:l})),y(u(l)),!1}finally{k(!1)}},V=async()=>{var l,x;if(!W())return!1;const{id:a,name:i,fromYear:w,toYear:c,isCurrent:g}=d;if(!F)return u(h=>({...h,general:"User not authenticated. Please log in."})),!1;const t={name:i,fromYear:new Date(w).toISOString(),toYear:new Date(c).toISOString(),isCurrent:g,createdBy:F};try{k(!0),u($=>({...$,name:"",fromYear:"",toYear:"",general:""}));const h=await _(`${ee.ACADEMIC_YEARS}/${a}`,"PATCH",t);if(!h||h.status!=="success")throw new Error((h==null?void 0:h.message)||"Failed to update academic year");const T=h.data;return y(re(P.map($=>$._id===a?T:$))),g?y(ae(T)):(E==null?void 0:E._id)===a&&!g&&y(ae(null)),await B(),await z(),s(n),f(!1),!0}catch(h){const T=((x=(l=h.response)==null?void 0:l.data)==null?void 0:x.message)||h.message||"Failed to update academic year";return u($=>({...$,general:T})),y(u(T)),!1}finally{k(!1)}};return{setFormValues:s,formValues:d,handleChange:O,handleTermChange:U,handleSubmit:async()=>v?await V():await H(),handleCreateAcademicTerm:N,startEdit:a=>{s({id:a._id,name:a.name,fromYear:a.fromYear.split("T")[0],toYear:a.toYear.split("T")[0],isCurrent:a.isCurrent}),f(!0),u({name:"",fromYear:"",toYear:"",general:""})},startAddTerm:a=>{j({...r,academicYearId:a,terms:r.terms.map(i=>({...i,createdBy:F}))}),Y({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]})},editMode:v,setEditMode:f,academicYears:P,currentAcademicYear:E,loading:R,error:p,termError:I,isSubmitting:o,resetForm:()=>{s(n),u({name:"",fromYear:"",toYear:"",general:""}),f(!1)},resetTermForm:()=>{j(r),Y({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]})},termFormValues:S,handleDeleteAcademicYear:Q}},ft=({open:n,onClose:r,handleSubmit:d,error:s={},editMode:S=!1,userId:j,formValues:p,handleChange:u,isSubmitting:I=!1})=>{const Y=new Date().toISOString().split("T")[0],v=async f=>{f.preventDefault(),console.log("Form submission attempted with values:",p);try{await d(p)?(console.log("Submission successful"),r()):console.log("Submission failed, handleSubmit returned false")}catch(o){console.error("Submission error:",o)}};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            opacity: 1;
          }
          input[type="date"] {
            color-scheme: light;
          }
        `}),e.jsx(de,{open:n,onClose:r,title:S?"Edit Academic Year":"Add Academic Year",noConfirm:!0,children:e.jsxs(D,{component:"form",onSubmit:v,children:[e.jsx(D,{mb:2,children:e.jsx(Z,{label:"Academic Year Name (e.g., 2024/2025)",name:"name",value:p.name||"",onChange:u,fullWidth:!0,required:!0,error:!!s.name,helperText:s.name||"Format: YYYY/YYYY (e.g., 2024/2025)"})}),e.jsx(D,{mb:2,children:e.jsx(Z,{label:"From Year",name:"fromYear",type:"date",value:p.fromYear||"",onChange:u,fullWidth:!0,required:!0,error:!!s.fromYear,helperText:s.fromYear,InputLabelProps:{shrink:!0},inputProps:{min:Y}})}),e.jsx(D,{mb:2,children:e.jsx(Z,{label:"To Year",name:"toYear",type:"date",value:p.toYear||"",onChange:u,fullWidth:!0,required:!0,error:!!s.toYear,helperText:s.toYear,InputLabelProps:{shrink:!0},inputProps:{min:p.fromYear||Y}})}),e.jsx(D,{mb:2,children:e.jsx(ve,{control:e.jsx(Ae,{checked:p.isCurrent||!1,onChange:u,name:"isCurrent",color:"primary"}),label:"Set as Current Academic Year"})}),s.general&&e.jsx(A,{variant:"caption",color:"error",mb:2,children:s.general}),e.jsx(Te,{type:"submit",variant:"contained",color:"primary",disabled:I,fullWidth:!0,children:I?"Submitting...":S?"Update Academic Year":"Submit"})]})})]})},gt=({open:n,onClose:r,handleSubmit:d,error:s={},userId:S,formValues:j,handleChange:p,isSubmitting:u=!1})=>{const I=new Date().toISOString().split("T")[0],Y=async f=>{f.preventDefault();try{await d()&&r()}catch(o){console.error("Submission error:",o)}},v=Array.from({length:10},(f,o)=>`${o+1} month${o+1>1?"s":""}`);return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            opacity: 1;
          }
          input[type="date"] {
            color-scheme: light;
          }
        `}),e.jsx(de,{open:n,onClose:r,title:"Add Academic Term",noConfirm:!0,children:e.jsxs(D,{component:"form",onSubmit:Y,children:[j.terms.map((f,o)=>{var k,R,_,y,P,E,B,z,F,O,Q,U,W,L,H,N,V,q,J,G;return e.jsxs(D,{mb:3,sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(A,{variant:"h6",children:f.name}),e.jsx(D,{mb:2,children:e.jsxs(xe,{fullWidth:!0,required:!0,error:!!((R=(k=s.terms)==null?void 0:k[o])!=null&&R.name),children:[e.jsx(be,{id:`term-name-label-${o}`,children:"Term Name"}),e.jsx(De,{labelId:`term-name-label-${o}`,name:"name",value:f.name||"",onChange:C=>p(C,o),label:"Term Name",disabled:!0,children:["1st Term","2nd Term","3rd Term"].map(C=>e.jsx(Ce,{value:C,children:C},C))}),((y=(_=s.terms)==null?void 0:_[o])==null?void 0:y.name)&&e.jsx(A,{variant:"caption",color:"error",children:s.terms[o].name})]})}),e.jsx(D,{mb:2,children:e.jsx(Z,{label:"Description",name:"description",value:f.description||"",onChange:C=>p(C,o),fullWidth:!0,required:!0,error:!!((E=(P=s.terms)==null?void 0:P[o])!=null&&E.description),helperText:(z=(B=s.terms)==null?void 0:B[o])==null?void 0:z.description})}),e.jsx(D,{mb:2,children:e.jsxs(xe,{fullWidth:!0,required:!0,error:!!((O=(F=s.terms)==null?void 0:F[o])!=null&&O.duration),children:[e.jsx(be,{id:`duration-label-${o}`,children:"Duration"}),e.jsx(De,{labelId:`duration-label-${o}`,name:"duration",value:f.duration||"3 months",onChange:C=>p(C,o),label:"Duration",children:v.map(C=>e.jsx(Ce,{value:C,children:C},C))}),((U=(Q=s.terms)==null?void 0:Q[o])==null?void 0:U.duration)&&e.jsx(A,{variant:"caption",color:"error",children:s.terms[o].duration})]})}),e.jsx(D,{mb:2,children:e.jsx(Z,{label:"Start Date",name:"startDate",type:"date",value:f.startDate||"",onChange:C=>p(C,o),fullWidth:!0,required:!0,error:!!((L=(W=s.terms)==null?void 0:W[o])!=null&&L.startDate),helperText:(N=(H=s.terms)==null?void 0:H[o])==null?void 0:N.startDate,InputLabelProps:{shrink:!0},inputProps:{min:I}})}),e.jsx(D,{mb:2,children:e.jsx(Z,{label:"End Date",name:"endDate",type:"date",value:f.endDate||"",onChange:C=>p(C,o),fullWidth:!0,required:!0,error:!!((q=(V=s.terms)==null?void 0:V[o])!=null&&q.endDate),helperText:(G=(J=s.terms)==null?void 0:J[o])==null?void 0:G.endDate,InputLabelProps:{shrink:!0},inputProps:{min:f.startDate||I}})}),e.jsx(D,{mb:2,children:e.jsx(ve,{control:e.jsx(Ae,{checked:f.isCurrent||!1,onChange:C=>p(C,o,!0),name:"isCurrent",color:"primary"}),label:"Set as Current Term"})})]},f.name)}),s.general&&e.jsx(A,{variant:"caption",color:"error",mb:2,children:s.general}),e.jsx(Te,{type:"submit",variant:"contained",color:"primary",disabled:u,fullWidth:!0,children:u?"Submitting...":"Submit"})]})})]})};class xt extends Me.Component{constructor(){super(...arguments);ge(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(d){return{hasError:!0,error:d}}componentDidCatch(d,s){console.error("Error caught by boundary:",d,s)}render(){var d;return this.state.hasError?e.jsxs(D,{sx:{p:3,textAlign:"center"},children:[e.jsx(A,{variant:"h5",color:"error",children:"Something went wrong."}),e.jsx(A,{variant:"body1",mt:2,children:((d=this.state.error)==null?void 0:d.message)||"An unexpected error occurred."}),e.jsx(we,{content:"Reload",onClick:()=>window.location.reload(),sx:{mt:2}})]}):this.props.children}}const bt=()=>{var he,pe,fe;const n=ye(),r=Se(n.palette.mode),{academicYears:d,currentAcademicYear:s,loading:S,error:j,termError:p,handleSubmit:u,handleCreateAcademicTerm:I,handleDeleteAcademicYear:Y,startEdit:v,startAddTerm:f,editMode:o,setEditMode:k,formValues:R,termFormValues:_,handleChange:y,handleTermChange:P,isSubmitting:E,resetForm:B,resetTermForm:z}=pt(),[F,O]=b.useState(!1),[Q,U]=b.useState(!1),[W,L]=b.useState(!1),[H,N]=b.useState(null),V=ne(m=>{var M;return(M=m.users.user)==null?void 0:M._id})||"",[q,J]=b.useState("name"),[G,C]=b.useState("asc"),[me,a]=b.useState(0),[i,w]=b.useState(5),[c,g]=b.useState(""),t=[{id:"sn",label:"S/N"},{id:"name",label:"Name"},{id:"fromYear",label:"From Year"},{id:"toYear",label:"To Year"},{id:"isCurrent",label:"Current"},{id:"studentCount",label:"Students"},{id:"teacherCount",label:"Teachers"},{id:"actions",label:"Actions"}],l=d.map((m,M)=>{var K,X;return{sn:M+1,id:m._id,name:m.name,fromYear:new Date(m.fromYear).toLocaleDateString(),toYear:new Date(m.toYear).toLocaleDateString(),isCurrent:m.isCurrent?"Yes":"No",studentCount:((K=m.students)==null?void 0:K.length)||0,teacherCount:((X=m.teachers)==null?void 0:X.length)||0,actions:e.jsxs(D,{children:[e.jsx(ce,{onClick:()=>{console.log("EditIcon clicked for academicYearId:",m._id),x(m)},children:e.jsx(Ke,{})}),e.jsx(ce,{onClick:()=>{console.log("AddCircleIcon clicked for academicYearId:",m._id),h(m._id)},children:e.jsx(Xe,{})}),e.jsx(ce,{onClick:()=>{console.log("DeleteIcon clicked for academicYearId:",m._id),T(m._id)},children:e.jsx(et,{})})]})}}),x=m=>{console.log("handleEdit called with year:",m._id),v(m),O(!0)},h=m=>{console.log("handleAddTerm called with academicYearId:",m);try{f(m),U(!0)}catch(M){console.error("Error in handleAddTerm:",M)}},T=m=>{N(m),L(!0)},$=async()=>{H&&await Y(H)&&(L(!1),N(null))},oe=()=>{L(!1),N(null)},Ie=m=>{const M=q===m&&G==="asc";J(m),C(M?"desc":"asc")},ke=(m,M)=>{a(M)},Ee=m=>{w(parseInt(m.target.value,10)),a(0)},Fe=[...l.filter(m=>m.name.toLowerCase().includes(c.toLowerCase()))].sort((m,M)=>{const K=m[q],X=M[q];return G==="asc"?K>X?1:-1:K<X?1:-1});return e.jsx(xt,{children:e.jsxs(ie,{container:!0,children:[e.jsx(ie,{item:!0,xs:12,children:e.jsx(Ye,{title:"Academics Management",subtitle:"Manage Academic Sessions"})}),e.jsx(ie,{item:!0,xs:12,children:S?e.jsx(D,{children:"Loading..."}):j.general?e.jsx(D,{sx:{color:"red"},children:j.general}):e.jsxs(e.Fragment,{children:[e.jsxs(D,{sx:{mb:3,p:2,backgroundColor:r.primary[400],borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(D,{children:[e.jsx(A,{variant:"h5",color:r.grey[100],children:"Current Academic Year"}),s?e.jsxs(A,{variant:"body1",color:r.grey[100],children:[s.name," (",new Date(s.fromYear).toLocaleDateString()," -"," ",new Date(s.toYear).toLocaleDateString(),") |"," ",((he=s.students)==null?void 0:he.length)||0," Students,"," ",((pe=s.teachers)==null?void 0:pe.length)||0," Teachers,"," ",((fe=s.academicTerms)==null?void 0:fe.length)||0," Terms"]}):e.jsx(A,{variant:"body1",color:r.redAccent[500],children:"No current academic year set."})]}),e.jsx(we,{onClick:()=>{O(!0),k(!1),B()},content:"Add Academic Year"})]}),e.jsx(ft,{open:F,onClose:()=>{O(!1),k(!1),B()},handleSubmit:u,error:j,editMode:o,userId:V,formValues:R,handleChange:y,isSubmitting:E}),e.jsx(gt,{open:Q,onClose:()=>{U(!1),z()},handleSubmit:I,error:p,userId:V,formValues:_,handleChange:P,isSubmitting:E}),e.jsx(de,{open:W,onClose:oe,title:"Confirm Deletion",noConfirm:!1,confirmText:"Delete",onConfirm:$,cancelText:"Cancel",children:e.jsx(A,{children:"Are you sure you want to delete this academic year? This action cannot be undone."})}),e.jsx(Ge,{columns:t,tableHeader:"Academic Years",data:Fe,sortBy:q,sortDirection:G,onSortChange:Ie,page:me,rowsPerPage:i,onPageChange:ke,onRowsPerPageChange:Ee,hiddenColumnsSmallScreen:["fromYear","toYear","studentCount","teacherCount","academicTermCount","actions"],hiddenColumnsTabScreen:["studentCount","teacherCount","academicTermCount"]})]})})]})})},Dt=()=>{const n=ne(r=>r.users.user.role);return console.log(n),e.jsx("div",{children:n==="teacher"?e.jsx(ht,{}):e.jsx(bt,{})})},Nt=tt(Dt);export{Nt as default};
