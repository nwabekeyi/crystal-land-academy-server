import{r as m,j as s}from"./index-D_BFJj-0.js";import{t as we,M as $}from"./modal-DeOsfxrp.js";import{H as _e}from"./Header-C-YprI0O.js";import{a as K,b as k,T as X}from"./table-C-Aynt9f.js";import{w as ve}from"./dasboardPagesContainer-C23oWqq1.js";import{C as W}from"./accordion-BFPEmMeu.js";import{j as Ae,v as i,T as r,x as _,y as q,Z as Ne,$ as Pe,a0 as Ie}from"./TextField-CTJJbsxV.js";import{G as E}from"./index-_IQoXbr8.js";import{L as ee}from"./LinearProgress-ChTU34Es.js";import{M as Me}from"./MenuItem-i_3gn4dc.js";import"./IconButton-irclJGl8.js";import"./useMediaQuery-BI2wzVFI.js";import"./index-B8xU_-Xi.js";import"./loadingButton-CzAJehWZ.js";import"./CircularProgress-euEUZc_8.js";import"./useSlot-CnZl1Zys.js";import"./useApi-DAb_JD3N.js";import"./confirmationModal-JfczPszj.js";function Q(O){const{children:o,value:f,index:S,...N}=O;return s.jsx("div",{role:"tabpanel",hidden:f!==S,id:`main-tabpanel-${S}`,"aria-labelledby":`main-tab-${S}`,...N,children:f===S&&s.jsx(i,{sx:{p:3},children:o})})}const h={academicYears:[{_id:"year_1",name:"2023–2024"},{_id:"year_2",name:"2024–2025"}],classes:[{_id:"class_1",academicYearId:"year_2",section:"Primary",displayName:"Primary 1A",students:["stu_1","stu_2"],subjectsTaught:["Mathematics","English"]},{_id:"class_2",academicYearId:"year_2",section:"Secondary",displayName:"Secondary 1B",students:["stu_3"],subjectsTaught:["Science"]}],students:[{_id:"stu_1",firstName:"John",lastName:"Doe",subjects:[{name:"Mathematics",topics:[{topic:"Linear Equations",progress:80},{topic:"Quadratic Functions",progress:60}],overallProgress:70},{name:"English",topics:[{topic:"Grammar Basics",progress:90},{topic:"Literature Analysis",progress:50}],overallProgress:70}]},{_id:"stu_2",firstName:"Jane",lastName:"Smith",subjects:[{name:"Mathematics",topics:[{topic:"Linear Equations",progress:70},{topic:"Quadratic Functions",progress:40}],overallProgress:55}]},{_id:"stu_3",firstName:"Alice",lastName:"Brown",subjects:[{name:"Science",topics:[{topic:"Chemical Reactions",progress:85}],overallProgress:85}]}],testQuestions:[{id:"q_1",classId:"class_1",subject:"Mathematics",question:"What is the solution to 2x + 3 = 7?",options:["x = 1","x = 2","x = 3","x = 4"],correctAnswer:"x = 2"},{id:"q_2",classId:"class_1",subject:"English",question:'What is a synonym for "happy"?',options:["Sad","Joyful","Angry","Tired"],correctAnswer:"Joyful"},{id:"q_3",classId:"class_2",subject:"Science",question:"What gas do plants absorb during photosynthesis?",options:["Oxygen","Nitrogen","Carbon Dioxide","Hydrogen"],correctAnswer:"Carbon Dioxide"}],tests:[{id:"test_1",classId:"class_1",subject:"Mathematics",questionIds:["q_1"]},{id:"test_2",classId:"class_1",subject:"English",questionIds:["q_2"]},{id:"test_3",classId:"class_2",subject:"Science",questionIds:["q_3"]}],testScores:[{id:"score_1",testId:"test_1",studentId:"stu_1",score:80,date:"2024-09-20"},{id:"score_2",testId:"test_1",studentId:"stu_2",score:70,date:"2024-09-20"},{id:"score_3",testId:"test_2",studentId:"stu_1",score:90,date:"2024-09-21"},{id:"score_4",testId:"test_3",studentId:"stu_3",score:85,date:"2024-09-22"}],announcements:[{id:"ann_1",classId:"class_1",title:"Math Homework Reminder",message:"Please complete the algebra worksheet by Friday.",date:"2024-09-18"},{id:"ann_2",classId:"class_2",title:"Science Project Update",message:"Project proposals are due next Monday.",date:"2024-09-19"}]},De=()=>{const O=Ae(),o=we(O.palette.mode),[f,S]=m.useState(0),[N,se]=m.useState(0),P=Array.isArray(h.academicYears)?h.academicYears:[],[v,L]=m.useState(P.reduce((e,t)=>({...e,[t._id]:{page:0,rowsPerPage:5,sortBy:"name",sortDirection:"asc"}}),{})),[te,R]=m.useState(!1),[ae,Y]=m.useState(!1),[ne,H]=m.useState(!1),[re,V]=m.useState(!1),[c,I]=m.useState(null),[l,G]=m.useState(null),[y,J]=m.useState(null),[M,oe]=m.useState(h.testQuestions),[D,ie]=m.useState(h.announcements),[g,T]=m.useState({question:"",options:["","","",""],correctAnswer:""}),[w,B]=m.useState({title:"",message:""}),F=[];h.classes.forEach(e=>{e.subjectsTaught.forEach(t=>{F.push({classId:e._id,className:e.displayName,subject:t})})});const le=(e,t)=>{S(t)},ce=(e,t)=>{se(t)},de=(e,t)=>{L(a=>({...a,[e]:{...a[e],page:t}}))},ue=(e,t)=>{L(a=>({...a,[e]:{...a[e],page:0,rowsPerPage:parseInt(t.target.value,10)}}))},me=(e,t)=>{L(a=>{const n=a[e],d=n.sortBy===t&&n.sortDirection==="asc"?"desc":"asc";return{...a,[e]:{...n,sortBy:t,sortDirection:d}}})},xe=e=>{I(e),R(!0)},pe=e=>{I(e),Y(!0)},he=e=>{G(e),H(!0)},ge=e=>{J(e),V(!0)},z=e=>{const{name:t,value:a}=e.target;T(n=>({...n,[t]:a}))},be=(e,t)=>{T(a=>{const n=[...a.options];return n[e]=t,{...a,options:n}})},je=()=>{if(!g.question||!g.options.every(a=>a)||!g.correctAnswer){alert("Please fill all fields");return}const t={id:`q_${M.length+1}`,classId:l.classId,subject:l.subject,question:g.question,options:g.options,correctAnswer:g.correctAnswer};oe([...M,t]),T({question:"",options:["","","",""],correctAnswer:""})},U=e=>{const{name:t,value:a}=e.target;B(n=>({...n,[t]:a}))},fe=()=>{if(!w.title||!w.message){alert("Please fill all fields");return}const t={id:`ann_${D.length+1}`,classId:y._id,title:w.title,message:w.message,date:new Date().toISOString().split("T")[0]};ie([...D,t]),B({title:"",message:""})},ye=e=>{const{page:t,rowsPerPage:a,sortBy:n,sortDirection:d}=v[e]||{page:0,rowsPerPage:5,sortBy:"name",sortDirection:"asc"},x=h.classes.filter(u=>u.academicYearId===e);let p=[];x.forEach(u=>{const j=h.students.filter(b=>u.students.includes(b._id)).map(b=>({...b,className:u.displayName,section:u.section,subjectsDisplay:(b.subjects||[]).map(C=>C.name).join(", ")}));p.push(...j)}),p.sort((u,j)=>{let b=u[n]??"",C=j[n]??"";return n==="name"?(b=`${u.firstName} ${u.lastName}`.toLowerCase(),C=`${j.firstName} ${j.lastName}`.toLowerCase()):n==="subjects"?(b=(u.subjects||[]).length,C=(j.subjects||[]).length):n==="subjectsDisplay"&&(b=u.subjectsDisplay.toLowerCase(),C=j.subjectsDisplay.toLowerCase()),b<C?d==="asc"?-1:1:b>C?d==="asc"?1:-1:0});const A=t*a;return p.slice(A,A+a).map((u,j)=>({...u,sn:A+j+1,name:`${u.firstName} ${u.lastName}`}))},Z=e=>{const t=h.tests.find(n=>n.classId===e.classId&&n.subject===e.subject);return t?h.testScores.filter(n=>n.testId===t.id).map((n,d)=>{const x=h.students.find(p=>p._id===n.studentId);return{sn:d+1,studentName:x?`${x.firstName} ${x.lastName}`:"Unknown",score:n.score,date:new Date(n.date).toLocaleDateString()}}):[]},Ce=[{id:"sn",label:"S/N",flex:.5},{id:"studentName",label:"Student Name",flex:2},{id:"score",label:"Score (%)",flex:1},{id:"date",label:"Date",flex:1}],Se=[{id:"sn",label:"S/N",flex:.5},{id:"name",label:"Student Name",flex:2,renderCell:e=>s.jsx(r,{children:e.name})},{id:"className",label:"Class",flex:1,renderCell:e=>s.jsx(r,{children:e.className})},{id:"subjectsDisplay",label:"Subjects",flex:2,renderCell:e=>s.jsx(r,{children:e.subjectsDisplay||"None"})},{id:"actions",label:"Actions",flex:1,renderCell:e=>s.jsxs(i,{display:"flex",gap:"10px",children:[s.jsx(_,{variant:"contained",color:"primary",size:"small",onClick:()=>xe(e),children:"View"}),s.jsx(_,{variant:"contained",color:"secondary",size:"small",onClick:()=>pe(e),children:"Progress"})]})}];return s.jsxs(i,{children:[s.jsx(_e,{title:"TEACHER CLASS MANAGEMENT",subtitle:"Manage Students, Tests, and Announcements"}),s.jsxs(i,{sx:{mt:3,mb:3},children:[s.jsxs(K,{value:f,onChange:le,"aria-label":"main tabs",sx:{backgroundColor:o.primary[400],"& .MuiTabs-indicator":{backgroundColor:o.blueAccent[700]}},children:[s.jsx(k,{label:"Students",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:o.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:o.primary[400]}}),s.jsx(k,{label:"Tests",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:o.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:o.primary[400]}}),s.jsx(k,{label:"Announcements",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:o.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:o.primary[400]}})]}),s.jsx(Q,{value:f,index:0,children:P.length>0?s.jsxs(s.Fragment,{children:[s.jsx(K,{value:N,onChange:ce,"aria-label":"academic year tabs",sx:{backgroundColor:o.primary[400],"& .MuiTabs-indicator":{backgroundColor:o.blueAccent[700]}},children:P.map((e,t)=>s.jsx(k,{label:e.name,sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:o.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:o.primary[400]}},e._id))}),P.map((e,t)=>{var a,n,d,x;return s.jsx(Q,{value:N,index:t,children:s.jsx(X,{columns:Se,tableHeader:`Students for ${e.name}`,data:ye(e._id),page:((a=v[e._id])==null?void 0:a.page)||0,rowsPerPage:((n=v[e._id])==null?void 0:n.rowsPerPage)||5,sortBy:((d=v[e._id])==null?void 0:d.sortBy)||"name",sortDirection:((x=v[e._id])==null?void 0:x.sortDirection)||"asc",onSortChange:p=>me(e._id,p),onPageChange:(p,A)=>de(e._id,A),onRowsPerPageChange:p=>ue(e._id,p),onRowClick:p=>console.log("Row clicked:",p),hiddenColumnsSmallScreen:["subjectsDisplay"]})},e._id)})]}):s.jsx(r,{children:"No academic years assigned"})}),s.jsxs(Q,{value:f,index:1,children:[s.jsx(r,{variant:"h5",sx:{mb:3},children:"Manage Test Questions"}),F.length>0?s.jsx(E,{container:!0,spacing:2,children:F.map((e,t)=>s.jsx(E,{item:!0,xs:12,sm:6,md:4,children:s.jsxs(i,{p:2,borderRadius:"8px",boxShadow:2,bgcolor:o.primary[400],display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",children:[s.jsx(r,{variant:"h6",children:e.subject}),s.jsx(r,{variant:"body1",children:e.className}),s.jsx(_,{variant:"contained",color:"primary",onClick:()=>he(e),children:"Manage Questions"})]})},t))}):s.jsx(r,{children:"No subjects or classes assigned"})]}),s.jsxs(Q,{value:f,index:2,children:[s.jsx(r,{variant:"h5",sx:{mb:3},children:"Manage Class Announcements"}),h.classes.length>0?s.jsx(E,{container:!0,spacing:2,children:h.classes.map((e,t)=>s.jsx(E,{item:!0,xs:12,sm:6,md:4,children:s.jsxs(i,{p:2,borderRadius:"8px",boxShadow:2,bgcolor:o.primary[400],display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",children:[s.jsx(r,{variant:"h6",children:e.displayName}),s.jsx(_,{variant:"contained",color:"primary",onClick:()=>ge(e),children:"Manage Announcements"})]})},e._id))}):s.jsx(r,{children:"No classes assigned"})]})]}),s.jsx($,{open:te,onClose:()=>{R(!1),I(null)},title:`${(c==null?void 0:c.name)||"Student"} Details`,noConfirm:!0,children:c&&s.jsxs(i,{children:[s.jsxs(r,{variant:"h6",children:["Class: ",c.className||"N/A"]}),s.jsx(r,{variant:"h6",sx:{mt:2},children:"Subjects and Progress"}),(c.subjects||[]).length>0?c.subjects.map((e,t)=>{var n;const a=(c.subjects||[]).reduce((d,x)=>d+x.overallProgress,0)/(((n=c.subjects)==null?void 0:n.length)||1);return s.jsx(W,{title:`${e.name} (${e.overallProgress.toFixed(2)}%)`,details:s.jsx(i,{children:e.topics.map((d,x)=>s.jsxs(i,{sx:{mb:2},children:[s.jsx(r,{variant:"body1",sx:{mb:1},children:d.topic}),s.jsx(ee,{variant:"determinate",value:d.progress,sx:{height:10,borderRadius:5,backgroundColor:o.grey[300],"& .MuiLinearProgress-bar":{backgroundColor:o.greenAccent[500]}}}),s.jsxs(i,{sx:{mt:1},children:[s.jsxs(r,{variant:"body2",color:o.grey[100],children:[s.jsx("strong",{style:{color:o.blueAccent[200]},children:"Topic Progress:"})," ",d.progress.toFixed(2),"%"]}),s.jsxs(r,{variant:"body2",color:o.grey[100],children:[s.jsx("strong",{style:{color:o.blueAccent[200]},children:"Subject Overall Progress:"})," ",e.overallProgress.toFixed(2),"%"]}),s.jsxs(r,{variant:"body2",color:o.grey[100],children:[s.jsx("strong",{style:{color:o.blueAccent[200]},children:"Student Average Progress:"})," ",a.toFixed(2),"%"]})]})]},x))}),defaultExpanded:!1},t)}):s.jsx(r,{variant:"body1",children:"No subjects assigned"})]})}),s.jsx($,{open:ae,onClose:()=>{Y(!1),I(null)},title:`Progress for ${(c==null?void 0:c.name)||"Student"}`,noConfirm:!0,children:c&&s.jsx(i,{display:"flex",flexDirection:"column",gap:"16px",children:(c.subjects||[]).length>0?c.subjects.map((e,t)=>s.jsxs(i,{children:[s.jsxs(r,{variant:"h6",mb:"15px",children:[e.name," (",e.overallProgress.toFixed(2),"%)"]}),e.topics.map((a,n)=>s.jsxs(i,{sx:{mb:2},children:[s.jsx(r,{variant:"body1",mb:"10px",children:a.topic}),s.jsx(ee,{variant:"determinate",value:a.progress,sx:{height:"10px",borderRadius:"5px",backgroundColor:o.primary[300],"& .MuiLinearProgress-bar":{backgroundColor:o.greenAccent[500]}}}),s.jsxs(r,{variant:"body2",mt:"10px",children:["Progress: ",a.progress.toFixed(2),"%"]})]},n))]},t)):s.jsx(r,{variant:"body1",children:"No subjects available to display"})})}),s.jsx($,{open:ne,onClose:()=>{H(!1),G(null),T({question:"",options:["","","",""],correctAnswer:""})},title:`Manage Test Questions for ${l==null?void 0:l.subject} (${(l==null?void 0:l.className)||"Class"})`,noConfirm:!0,children:l&&s.jsxs(i,{display:"flex",flexDirection:"column",gap:"16px",children:[s.jsxs(i,{children:[s.jsx(r,{variant:"h6",mb:"10px",children:"Add New Question"}),s.jsx(q,{label:"Question",name:"question",value:g.question,onChange:z,fullWidth:!0,multiline:!0,rows:2,sx:{mb:2}}),g.options.map((e,t)=>s.jsx(q,{label:`Option ${t+1}`,value:e,onChange:a=>be(t,a.target.value),fullWidth:!0,sx:{mb:2}},t)),s.jsxs(Ne,{fullWidth:!0,sx:{mb:2},children:[s.jsx(Pe,{id:"correct-answer-select-label",children:"Correct Answer"}),s.jsx(Ie,{labelId:"correct-answer-select-label",name:"correctAnswer",value:g.correctAnswer,onChange:z,label:"Correct Answer",children:g.options.map((e,t)=>s.jsx(Me,{value:e,disabled:!e,children:e||`Option ${t+1}`},t))})]}),s.jsx(_,{variant:"contained",color:"primary",onClick:je,sx:{mb:2},children:"Add Question"})]}),s.jsx(r,{variant:"h6",children:"Existing Questions"}),M.filter(e=>e.classId===l.classId&&e.subject===l.subject).length>0?M.filter(e=>e.classId===l.classId&&e.subject===l.subject).map((e,t)=>s.jsx(W,{title:`Question ${t+1}: ${e.question}`,details:s.jsxs(i,{children:[s.jsxs(r,{variant:"body1",children:["Subject: ",e.subject]}),s.jsx(r,{variant:"body1",sx:{mt:1},children:"Options:"}),s.jsx("ul",{children:e.options.map((a,n)=>s.jsx("li",{children:s.jsxs(r,{variant:"body2",color:a===e.correctAnswer?o.greenAccent[500]:"inherit",children:[a,a===e.correctAnswer&&" (Correct)"]})},n))})]}),defaultExpanded:!1},e.id)):s.jsx(r,{children:"No questions set for this subject and class."}),s.jsx(r,{variant:"h6",sx:{mt:3},children:"Student Test Scores"}),Z(l).length>0?s.jsx(X,{columns:Ce,tableHeader:`Scores for ${l.subject} (${l.className})`,data:Z(l),page:0,rowsPerPage:5,sortBy:"studentName",sortDirection:"asc",hiddenColumnsSmallScreen:["date"]}):s.jsx(r,{children:"No test scores available for this subject and class."})]})}),s.jsx($,{open:re,onClose:()=>{V(!1),J(null),B({title:"",message:""})},title:`Manage Announcements for ${(y==null?void 0:y.displayName)||"Class"}`,noConfirm:!0,children:y&&s.jsxs(i,{display:"flex",flexDirection:"column",gap:"16px",children:[s.jsxs(i,{children:[s.jsx(r,{variant:"h6",mb:"10px",children:"Add New Announcement"}),s.jsx(q,{label:"Title",name:"title",value:w.title,onChange:U,fullWidth:!0,sx:{mb:2}}),s.jsx(q,{label:"Message",name:"message",value:w.message,onChange:U,fullWidth:!0,multiline:!0,rows:4,sx:{mb:2}}),s.jsx(_,{variant:"contained",color:"primary",onClick:fe,sx:{mb:2},children:"Add Announcement"})]}),s.jsx(r,{variant:"h6",children:"Existing Announcements"}),D.filter(e=>e.classId===y._id).length>0?D.filter(e=>e.classId===y._id).map((e,t)=>s.jsx(W,{title:`${e.title} (${new Date(e.date).toLocaleDateString()})`,details:s.jsxs(i,{children:[s.jsx(r,{variant:"body1",children:e.message}),s.jsxs(r,{variant:"body2",sx:{mt:1,color:o.grey[500]},children:["Posted on: ",new Date(e.date).toLocaleDateString()]})]}),defaultExpanded:!1},e.id)):s.jsx(r,{children:"No announcements for this class."})]})})]})},Ze=ve(De);export{Ze as default};
