import{r as l,f as M,j as e}from"./index-BuRqVy2o.js";import{t as R,M as H}from"./modal-Dtd90-ui.js";import{H as ye}from"./Header-CPyALzpz.js";import{C as Te}from"./accordion-6iif8NxD.js";import{w as ve}from"./dasboardPagesContainer-2WDa4n00.js";import{u as U}from"./useApi-D4lIDwWM.js";import{j as $,a1 as K,a2 as V,a3 as z,T as L,y as J,v as k,x as q}from"./TextField-DPEWop0l.js";import{M as F}from"./MenuItem-DAhVz_SE.js";import{C as Ae}from"./CircularProgress-CZOZaR_c.js";import"./IconButton-DN-FrFOr.js";import"./index-CdkazARq.js";import"./confirmationModal-DFTnOKbM.js";import"./index-gjfgqqyg.js";import"./loadingButton-WtJYv-TH.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-BNYqSIw-.js";const we=()=>{const[y,o]=l.useState([]),[g,t]=l.useState([]),[n,b]=l.useState([]),r=l.useRef(!0);l.useEffect(()=>()=>{r.current=!1},[]);const{loading:i,error:f,callApi:T}=U(),{loading:A,error:p,callApi:m}=U(),{loading:w,error:I,callApi:Z}=U(),{loading:fe,error:D,callApi:ee}=U(),{loading:se,error:E,callApi:G}=U(),{loading:Ce,error:_,callApi:te}=U(),{loading:ae,error:O,callApi:Q}=U(),{loading:v,error:S,callApi:X}=U(),{loading:le,error:x,callApi:oe}=U(),c=l.useCallback(async(d="",h="")=>{const u=[];d&&u.push(`classLevelId=${d}`),h&&u.push(`subjectId=${h}`);const W=`${M.CURRICULUM}${u.length?`?${u.join("&")}`:""}`,P=await T(W);if(P&&P.status==="success"&&r.current){const a=P.data.map(s=>{var B,xe,be,je;const C=g.find(N=>{var he,ge;return((he=N.name)==null?void 0:he._id)===((ge=s.subjectId)==null?void 0:ge.name)});return{_id:s._id,subject:((B=C==null?void 0:C.name)==null?void 0:B.name)||"Unknown Subject",subjectId:(xe=s.subjectId)==null?void 0:xe._id,classLevel:((be=s.classLevelId)==null?void 0:be.name)||"Unknown Class",classLevelId:(je=s.classLevelId)==null?void 0:je._id,topics:s.topics.map((N,he)=>({_id:N._id||`topic_${he}`,topic:N.topic||"Untitled Topic",description:N.description||"No description available",resources:N.resources||[],isCompleted:N.isCompleted||!1})),completionRate:s.completionRate||0}});o(a)}return P},[T,g]),ce=l.useCallback(async()=>{const d=await m(M.SUBJECT);if(d&&d.status==="success"&&r.current){const h=Array.isArray(d.data)?d.data.map(u=>({...u,name:typeof u.name=="object"&&u.name!==null?u.name:{name:u.name||"Unknown Subject"}})):[];return t(h),d}},[m]),re=l.useCallback(async()=>{const d=await Z(M.CLASS_LEVEL);if(d&&d.status==="success"&&r.current){const h=Array.isArray(d.data.data)?d.data.data:[];return b(h),d}},[Z]),Y=l.useCallback(async d=>{const h=await ee(M.CURRICULUM,"POST",d);if(h&&h.status==="success"&&r.current)return await c(),h},[ee,c]),ne=l.useCallback(async(d,h)=>{const u=await G(`${M.CURRICULUM}/${d}`,"PATCH",h);if(u&&u.status==="success"&&r.current)return await c(),u},[G,c]),ie=l.useCallback(async d=>{const h=await te(`${M.CURRICULUM}/${d}`,"DELETE");if(h&&h.status==="success"&&r.current)return await c(),h},[te,c]),de=l.useCallback(async(d,h)=>{const u=await Q(`${M.CURRICULUM}/${d}/topics`,"POST",h);if(u&&u.status==="success"&&r.current)return await c(),u},[Q,c]),ue=l.useCallback(async(d,h,u)=>{const W=await X(`${M.CURRICULUM}/${d}/topics/${h}`,"PATCH",u);if(W&&W.status==="success"&&r.current)return await c(),W},[X,c]),j=l.useCallback(async(d,h)=>{const u=await oe(`${M.CURRICULUM}/${d}/topics/${h}`,"DELETE");if(u&&u.status==="success"&&r.current)return await c(),u},[oe,c]),pe=i||A||w||fe||se||Ce||ae||v||le,me=l.useMemo(()=>({curricula:f!=null&&f.includes("headers")?"Failed to fetch curricula":f,subjects:p!=null&&p.includes("headers")?"Failed to fetch subjects":p,classLevels:I!=null&&I.includes("headers")?"Failed to fetch class levels":I,createCurriculum:D!=null&&D.includes("headers")?"Failed to create curriculum":D,updateCurriculum:E!=null&&E.includes("headers")?"Failed to update curriculum":E,deleteCurriculum:_!=null&&_.includes("headers")?"Failed to delete curriculum":_,addTopic:O!=null&&O.includes("headers")?"Failed to add topic":O,updateTopic:S!=null&&S.includes("headers")?"Failed to update topic":S,deleteTopic:x!=null&&x.includes("headers")?"Failed to delete topic":x}),[f,p,I,D,E,_,O,S,x]);return l.useMemo(()=>({loading:pe,errors:me,curricula:y,subjects:g,classLevels:n,fetchCurricula:c,fetchSubjects:ce,fetchClassLevels:re,createCurriculum:Y,updateCurriculum:ne,deleteCurriculum:ie,addTopic:de,updateTopic:ue,deleteTopic:j}),[pe,me,y,g,n,c,ce,re,Y,ne,ie,de,ue,j])},Se=({open:y,onClose:o,onSubmit:g,subjects:t,classLevels:n})=>{const b=$(),r=R(b.palette.mode),[i,f]=l.useState({subjectId:"",classLevelId:"",topics:[]}),T=p=>{f({...i,[p.target.name]:p.target.value})},A=()=>{g(i),f({subjectId:"",classLevelId:"",topics:[]}),o()};return e.jsxs(H,{open:y,onClose:o,title:"Add New Curriculum",onConfirm:A,confirmText:"Create",cancelText:"Cancel",showCancel:!0,styleProps:{backgroundColor:r.primary[400],borderRadius:"8px",width:"400px",margin:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[e.jsxs(K,{fullWidth:!0,sx:{mb:2},children:[e.jsx(V,{children:"Subject"}),e.jsx(z,{name:"subjectId",value:i.subjectId,onChange:T,children:t.map(p=>{var m;return e.jsx(F,{value:p._id,children:((m=p.name)==null?void 0:m.name)||"Unknown Subject"},p._id)})})]}),e.jsxs(K,{fullWidth:!0,sx:{mb:2},children:[e.jsx(V,{children:"Class Level"}),e.jsx(z,{name:"classLevelId",value:i.classLevelId,onChange:T,children:n.map(p=>e.jsx(F,{value:p._id,children:p.name},p._id))})]})]})},Le=({open:y,onClose:o,onSubmit:g,curriculum:t,subjects:n,classLevels:b})=>{const r=$(),i=R(r.palette.mode),[f,T]=l.useState({subjectId:"",classLevelId:""});l.useEffect(()=>{t&&T({subjectId:t.subjectId||"",classLevelId:t.classLevelId||""})},[t]);const A=m=>{T({...f,[m.target.name]:m.target.value})},p=()=>{g(t._id,f),o()};return e.jsxs(H,{open:y,onClose:o,title:"Edit Curriculum",onConfirm:p,confirmText:"Update",cancelText:"Cancel",showCancel:!0,styleProps:{backgroundColor:i.primary[400],borderRadius:"8px",width:"400px",margin:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[e.jsxs(K,{fullWidth:!0,sx:{mb:2},children:[e.jsx(V,{children:"Subject"}),e.jsx(z,{name:"subjectId",value:f.subjectId,onChange:A,children:n.map(m=>{var w;return e.jsx(F,{value:m._id,children:((w=m.name)==null?void 0:w.name)||"Unknown Subject"},m._id)})})]}),e.jsxs(K,{fullWidth:!0,sx:{mb:2},children:[e.jsx(V,{children:"Class Level"}),e.jsx(z,{name:"classLevelId",value:f.classLevelId,onChange:A,children:b.map(m=>e.jsx(F,{value:m._id,children:m.name},m._id))})]})]})},Ie=({open:y,onClose:o,onConfirm:g,curriculum:t})=>{const n=$(),b=R(n.palette.mode);return e.jsx(H,{open:y,onClose:o,title:"Delete Curriculum",onConfirm:()=>g(t._id),confirmText:"Delete",cancelText:"Cancel",showCancel:!0,styleProps:{backgroundColor:b.primary[400],borderRadius:"8px",width:"400px",margin:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:e.jsxs(L,{sx:{mb:2,color:b.grey[100]},children:["Are you sure you want to delete the curriculum for"," ",t==null?void 0:t.subject," (",t==null?void 0:t.classLevel,")?"]})})},Me=({open:y,onClose:o,onSubmit:g,curriculumId:t})=>{const n=$(),b=R(n.palette.mode),[r,i]=l.useState({topic:"",description:"",resources:[],isCompleted:!1}),f=A=>{const{name:p,value:m}=A.target;i(p==="resources"?{...r,resources:m.split(",").map(w=>w.trim())}:{...r,[p]:m})},T=()=>{g(t,r),i({topic:"",description:"",resources:[],isCompleted:!1}),o()};return e.jsxs(H,{open:y,onClose:o,title:"Add New Topic",onConfirm:T,confirmText:"Add",cancelText:"Cancel",showCancel:!0,styleProps:{backgroundColor:b.primary[400],borderRadius:"8px",width:"400px",margin:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[e.jsx(J,{fullWidth:!0,label:"Topic",name:"topic",value:r.topic,onChange:f,sx:{mb:2}}),e.jsx(J,{fullWidth:!0,label:"Description",name:"description",value:r.description,onChange:f,multiline:!0,rows:4,sx:{mb:2}}),e.jsx(J,{fullWidth:!0,label:"Resources (comma-separated)",name:"resources",value:r.resources.join(", "),onChange:f,sx:{mb:2}})]})},Ue=({open:y,onClose:o,onSubmit:g,curriculumId:t,topic:n})=>{const b=$(),r=R(b.palette.mode),[i,f]=l.useState({topic:"",description:"",resources:[],isCompleted:!1});l.useEffect(()=>{n&&f({topic:n.topic||"",description:n.description||"",resources:n.resources||[],isCompleted:n.isCompleted||!1})},[n]);const T=p=>{const{name:m,value:w}=p.target;f(m==="resources"?{...i,resources:w.split(",").map(I=>I.trim())}:{...i,[m]:w})},A=()=>{g(t,n._id,i),o()};return e.jsxs(H,{open:y,onClose:o,title:"Edit Topic",onConfirm:A,confirmText:"Update",cancelText:"Cancel",showCancel:!0,styleProps:{backgroundColor:r.primary[400],borderRadius:"8px",width:"400px",margin:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[e.jsx(J,{fullWidth:!0,label:"Topic",name:"topic",value:i.topic,onChange:T,sx:{mb:2}}),e.jsx(J,{fullWidth:!0,label:"Description",name:"description",value:i.description,onChange:T,multiline:!0,rows:4,sx:{mb:2}}),e.jsx(J,{fullWidth:!0,label:"Resources (comma-separated)",name:"resources",value:i.resources.join(", "),onChange:T,sx:{mb:2}})]})},ke=({open:y,onClose:o,onConfirm:g,curriculumId:t,topic:n})=>{const b=$(),r=R(b.palette.mode);return e.jsx(H,{open:y,onClose:o,title:"Delete Topic",onConfirm:()=>g(t,n._id),confirmText:"Delete",cancelText:"Cancel",showCancel:!0,styleProps:{backgroundColor:r.primary[400],borderRadius:"8px",width:"400px",margin:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:e.jsxs(L,{sx:{mb:2,color:r.grey[100]},children:['Are you sure you want to delete the topic "',n==null?void 0:n.topic,'"?']})})},De=({open:y,onClose:o,message:g,isSuccess:t})=>{const n=$(),b=R(n.palette.mode);return e.jsx(H,{open:y,onClose:o,title:t?"Success":"Error",confirmText:"OK",showCancel:!1,styleProps:{backgroundColor:b.primary[400],borderRadius:"8px",width:"400px",margin:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:e.jsx(L,{sx:{mb:2,color:b.grey[100]},children:g})})},_e=()=>{const y=$(),o=R(y.palette.mode),{loading:g,errors:t,curricula:n,subjects:b,classLevels:r,fetchCurricula:i,fetchSubjects:f,fetchClassLevels:T,createCurriculum:A,updateCurriculum:p,deleteCurriculum:m,addTopic:w,updateTopic:I,deleteTopic:Z}=we(),[fe,D]=l.useState(!1),[ee,se]=l.useState(!1),[E,G]=l.useState(!1),[Ce,_]=l.useState(!1),[te,ae]=l.useState(!1),[O,Q]=l.useState(!1),[v,S]=l.useState(null),[X,le]=l.useState(null),[x,oe]=l.useState(""),[c,ce]=l.useState(""),[re,Y]=l.useState(!1),[ne,ie]=l.useState(""),[de,ue]=l.useState(!0),j=(a,s=!0)=>{ie(a),ue(s),Y(!0)};l.useEffect(()=>{f(),T()},[]),l.useEffect(()=>{x&&c&&i(x,c)},[i,x,c]);const pe=async a=>{try{const s=await A(a);s&&s.status==="success"?(j("Curriculum created successfully"),x&&c&&await i(x,c)):j(t.createCurriculum||"Failed to create curriculum",!1)}catch{j(t.createCurriculum||"Failed to create curriculum",!1)}},me=async(a,s)=>{try{const C=await p(a,s);C&&C.status==="success"?(j("Curriculum updated successfully"),x&&c&&await i(x,c)):j(t.updateCurriculum||"Failed to update curriculum",!1)}catch{j(t.updateCurriculum||"Failed to update curriculum",!1)}},d=async a=>{try{const s=await m(a);s&&s.status==="success"?(j("Curriculum deleted successfully"),x&&c&&await i(x,c)):j(t.deleteCurriculum||"Failed to delete curriculum",!1)}catch{j(t.deleteCurriculum||"Failed to delete curriculum",!1)}},h=async(a,s)=>{try{const C=await w(a,s);C&&C.status==="success"?(j("Topic added successfully"),x&&c&&await i(x,c)):j(t.addTopic||"Failed to add topic",!1)}catch{j(t.addTopic||"Failed to add topic",!1)}},u=async(a,s,C)=>{try{const B=await I(a,s,C);B&&B.status==="success"?(j("Topic updated successfully"),x&&c&&await i(x,c)):j(t.updateTopic||"Failed to update topic",!1)}catch{j(t.updateTopic||"Failed to update topic",!1)}},W=async(a,s)=>{try{const C=await Z(a,s);C&&C.status==="success"?(j("Topic deleted successfully"),x&&c&&await i(x,c)):j(t.deleteTopic||"Failed to delete topic",!1)}catch{j(t.deleteTopic||"Failed to delete topic",!1)}},P=a=>{const{name:s,value:C}=a.target;s==="classLevelId"?oe(C):s==="subjectId"&&ce(C)};return e.jsxs(k,{sx:{p:3},children:[e.jsx(ye,{title:"Admin Curriculum Management",subtitle:"Manage curricula and topics for all classes and subjects"}),e.jsxs(k,{sx:{display:"flex",mb:2,gap:2},children:[e.jsxs(K,{sx:{minWidth:200},children:[e.jsx(V,{children:"Class Level"}),e.jsxs(z,{name:"classLevelId",value:x,onChange:P,children:[e.jsx(F,{value:"",children:"All Classes"}),r.map(a=>e.jsx(F,{value:a._id,children:a.name||"Unknown Class"},a._id))]})]}),e.jsxs(K,{sx:{minWidth:200},children:[e.jsx(V,{children:"Subject"}),e.jsxs(z,{name:"subjectId",value:c,onChange:P,children:[e.jsx(F,{value:"",children:"All Subjects"}),b.map(a=>{var s;return e.jsx(F,{value:a._id,children:((s=a.name)==null?void 0:s.name)||a.name||"Unknown Subject"},a._id)})]})]}),e.jsx(q,{variant:"contained",onClick:()=>D(!0),sx:{bgcolor:o.blueAccent[700]},children:"Add Curriculum"})]}),g?e.jsx(k,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Ae,{color:"secondary"})}):t.curricula?e.jsx(L,{variant:"body1",color:o.redAccent[500],sx:{mt:2},children:t.curricula}):n.length>0?n.map(a=>e.jsxs(k,{sx:{mb:1},children:[e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(L,{variant:"h2",sx:{color:o.blueAccent[200],fontWeight:"bold"},children:[a.subject," (",a.classLevel,")"]}),e.jsxs(k,{children:[e.jsx(q,{onClick:()=>{S(a),se(!0)},sx:{color:o.blueAccent[200],mr:1},children:"Edit"}),e.jsx(q,{onClick:()=>{S(a),G(!0)},sx:{color:o.redAccent[500],mr:1},children:"Delete"}),e.jsx(q,{variant:"contained",onClick:()=>{S(a),_(!0)},sx:{bgcolor:o.blueAccent[700]},children:"Add Topic"})]})]}),a.topics.length>0?a.topics.map((s,C)=>e.jsx(k,{sx:{mb:1},children:e.jsx(Te,{title:`${C+1}. ${s.topic}`,details:e.jsxs(k,{children:[e.jsx(L,{variant:"body1",color:o.grey[100],sx:{mb:1},children:s.description||"No description available"}),e.jsxs(L,{variant:"body1",sx:{color:o.blueAccent[200]},children:["Resources:"," ",Array.isArray(s.resources)?s.resources.join(", "):"No resources available"]}),e.jsxs(L,{variant:"body1",sx:{color:s.isCompleted?o.greenAccent[500]:o.redAccent[500]},children:["Status: ",s.isCompleted?"Completed":"Not Completed"]}),e.jsxs(k,{sx:{mt:2},children:[e.jsx(q,{onClick:()=>{S(a),le(s),ae(!0)},sx:{color:o.blueAccent[200],mr:1},children:"Edit Topic"}),e.jsx(q,{onClick:()=>{S(a),le(s),Q(!0)},sx:{color:o.redAccent[500]},children:"Delete Topic"})]})]}),defaultExpanded:!1})},s._id||C)):e.jsxs(L,{variant:"body1",color:o.grey[100],children:["No topics available for ",a.subject,"."]})]},a._id)):e.jsx(L,{variant:"body1",color:o.grey[100],children:"No curricula available for the selected filters."}),e.jsx(Se,{open:fe,onClose:()=>D(!1),onSubmit:pe,subjects:b,classLevels:r}),e.jsx(Le,{open:ee,onClose:()=>se(!1),onSubmit:me,curriculum:v,subjects:b,classLevels:r}),e.jsx(Ie,{open:E,onClose:()=>G(!1),onConfirm:d,curriculum:v}),e.jsx(Me,{open:Ce,onClose:()=>_(!1),onSubmit:h,curriculumId:v==null?void 0:v._id}),e.jsx(Ue,{open:te,onClose:()=>ae(!1),onSubmit:u,curriculumId:v==null?void 0:v._id,topic:X}),e.jsx(ke,{open:O,onClose:()=>Q(!1),onConfirm:W,curriculumId:v==null?void 0:v._id,topic:X}),e.jsx(De,{open:re,onClose:()=>Y(!1),message:ne,isSuccess:de})]})},Qe=ve(_e);export{Qe as default};
