import{r as o,j as t,a as Ne,e as X,E as ee}from"./index-BdybpPeh.js";import{r as Ie,t as se,D as Ee,a as Re,b as Pe,c as We,M as k}from"./modal-DeXGtVHz.js";import{g as Oe,a as $e,u as ke,_ as _e,s as Le,b as ae,d as Be,e as Fe,T as p,a1 as ze,Z as He,$ as Je,a0 as Ve,q as qe,j as oe,x as H,v}from"./TextField-kKLYiU0N.js";import{M as te,u as Ke}from"./MenuItem-DmfVB64U.js";import{S as _}from"./index-DNak_PmD.js";import{H as Ye}from"./Header-BhSo-vTi.js";import{a as Ze,b as J,T as V}from"./table-C8DwS9aK.js";import{c as Ge}from"./index-BfcDX7Jl.js";import{d as Qe}from"./Edit-DrlVhPhn.js";import{d as Xe}from"./Visibility-BvYGOyWg.js";import{u as q}from"./useApi-BtG_FYeQ.js";import{I as $}from"./IconButton-ngG_4x53.js";import{w as et}from"./dasboardPagesContainer-eCulhxLH.js";import"./confirmationModal-v5YzOX-t.js";import"./CircularProgress-PAT3fSQ0.js";import"./Alert-D2uT5B4D.js";import"./useSlot-CLq4ah7Q.js";import"./useMediaQuery-BxgjEkmC.js";import"./index-D-9M-KGn.js";import"./loadingButton-BLWVx6oC.js";import"./crystal-land-log-removebg-DVF-nlbN.js";function tt(n){return Oe("MuiDialogContentText",n)}$e("MuiDialogContentText",["root"]);const st=["children","className"],at=n=>{const{classes:r}=n,i=Fe({root:["root"]},tt,r);return ae({},r,i)},ot=Le(p,{shouldForwardProp:n=>ze(n)||n==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(n,r)=>r.root})({}),nt=o.forwardRef(function(r,a){const i=ke({props:r,name:"MuiDialogContentText"}),{className:c}=i,h=_e(i,st),d=at(h);return t.jsx(ot,ae({component:"p",variant:"body1",color:"text.secondary",ref:a,ownerState:h,className:Be(d.root,c)},i,{classes:d}))}),rt=({label:n,options:r,onSelect:a})=>{const[i,c]=o.useState(""),h=d=>{const l=d.target.value;c(l),a(l)};return t.jsxs(He,{sx:{width:"170px",paddingBottom:"2%"},variant:"outlined",children:[t.jsx(Je,{id:`${n}-select-label`,children:n}),t.jsxs(Ve,{labelId:`${n}-select-label`,value:i,onChange:h,label:n,children:[t.jsx(te,{value:"",disabled:!0,children:`Select ${n}`}),r.map(d=>t.jsx(te,{value:d.value,children:d.label},d.value))]})]})},lt=()=>t.jsx(_,{role:"student"}),it=()=>t.jsx(_,{role:"teacher"}),dt=()=>t.jsx(_,{role:"admin"});var Y={},ct=qe;Object.defineProperty(Y,"__esModule",{value:!0});var ne=Y.default=void 0,ht=ct(Ie()),mt=t;ne=Y.default=(0,ht.default)((0,mt.jsx)("path",{d:"M8.65 5.82C9.36 4.72 10.6 4 12 4c2.21 0 4 1.79 4 4 0 1.4-.72 2.64-1.82 3.35zM20 17.17c-.02-1.1-.63-2.11-1.61-2.62-.54-.28-1.13-.54-1.77-.76zm1.19 4.02L2.81 2.81 1.39 4.22l8.89 8.89c-1.81.23-3.39.79-4.67 1.45-1 .51-1.61 1.54-1.61 2.66V20h13.17l2.61 2.61z"}),"PersonOff");const Z=()=>{const n=Ke(),r=Ne(e=>e.adminData.usersData||{}),{students:a=[],teachers:i=[],admins:c=[]}=r;console.log("Teachers data:",i);const h=(e,s)=>s==="student"?a.find(f=>f.studentId===e):s==="teacher"?i.find(f=>f.teacherId===e):s==="admin"?c.find(f=>f._id===e):null,[d,l]=o.useState(""),[m,u]=o.useState("id"),[g,S]=o.useState("asc"),[U,C]=o.useState(0),[N,b]=o.useState(20),[y,j]=o.useState(null),[I,w]=o.useState({}),[P,D]=o.useState(!1),[A,W]=o.useState(!1),[E,M]=o.useState(!1),[L,B]=o.useState(0),[F,O]=o.useState(!1),[z,x]=o.useState(!1),{callApi:re,loading:le,data:ie,error:de}=q(),{loading:ce,error:he}=q(),{callApi:me,loading:ue,data:ge,error:pe}=q(),[ft,xe]=o.useState(!1),[T,R]=o.useState(!1),fe=e=>{l(e),M(!0)};o.useEffect(()=>{R(!T)},[A,E]);const Se=e=>{S(m===e&&g==="asc"?"desc":"asc"),u(e)},Ce=(e,s)=>{C(s)},be=e=>{b(parseInt(e.target.value,10)),C(0)},je=e=>{const s=h(e.id,e.role);s&&(sessionStorage.setItem("selectedUser",JSON.stringify({...s,role:e.role})),w(s),D(!0))},G=e=>{const s=h(e.id,e.role);s&&(sessionStorage.setItem("selectedUser",JSON.stringify({...s,role:e.role})),w(s),x(!0))},we=()=>{x(!1),sessionStorage.removeItem("selectedUser")},Q=e=>{const s=h(e.id,e.role);s&&(sessionStorage.setItem("selectedUser",JSON.stringify({...s,role:e.role})),w(s),W(!0))},De=()=>{xe(!1)},Ae=async()=>{const e=JSON.parse(sessionStorage.getItem("selectedUser"));if(!(!e||e.role!=="student"))try{const s=`${X.STUDENTS}/withdraw/${e._id}`;await me(s,"PATCH",{},{Authorization:`Bearer ${sessionStorage.getItem("token")}`})&&(n(ee({id:e.studentId,role:"student"})),sessionStorage.removeItem("selectedUser"),x(!1),R(!T))}catch(s){console.error("Error withdrawing student:",s),sessionStorage.setItem("confirmWithdrawModal","true"),x(!1),R(!T)}},Ue=async()=>{const e=JSON.parse(sessionStorage.getItem("selectedUser"));if(e)try{const s={id:e.studentId||e.teacherId||e._id,role:e.role};await re(X.USER,"DELETE",s),ie&&(n(ee({id:s.id,role:s.role})),sessionStorage.removeItem("selectedUser"),sessionStorage.setItem("confirmModal","true"),D(!1),j(null),R(!T))}catch(s){console.error("Error deleting user:",s),sessionStorage.setItem("confirmModal","true"),R(!T)}},ye=[{id:"sn",label:"S/N",width:90},{id:"id",label:"ID",width:100,renderCell:e=>t.jsx(p,{children:(e.role==="student"||e.role==="teacher",String(e.id))})},{id:"name",label:"Name",flex:1},{id:"email",label:"Email",flex:1},{id:"details",label:"Details",flex:1,renderCell:e=>e.role==="student"?`${e.classLevel||"N/A"} (${e.boardingStatus||"N/A"})`:e.role==="teacher"?e.subject||"N/A":"Admin"},{id:"createdAt",label:"Registered Date",flex:1},{id:"actions",label:"Actions",width:200,renderCell:e=>t.jsxs("div",{style:{display:"flex"},children:[t.jsx($,{onClick:()=>Q(e),children:t.jsx(Qe,{})}),t.jsx($,{onClick:()=>je(e),children:t.jsx(Ge,{})}),t.jsx($,{onClick:()=>{j(e),O(!0)},children:t.jsx(Xe,{})}),e.role==="student"&&t.jsx($,{onClick:()=>G(e),disabled:e.isWithdrawn,title:e.isWithdrawn?"Student already withdrawn":"Withdraw student",children:t.jsx(ne,{})})]})}],Me=Array.isArray(a)?a.map((e,s)=>(console.log("Student:",e),{id:e.studentId??"N/A",sn:s+1,role:"student",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",classLevel:e.currentClassLevel?`${e.currentClassLevel.className} ${e.currentClassLevel.subclass}`:"N/A",boardingStatus:e.boardingStatus||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A",isWithdrawn:e.isWithdrawn||!1,_id:e._id})).sort((e,s)=>e.sn-s.sn):[],Te=Array.isArray(i)?i.map((e,s)=>{var f;return{id:e.teacherId||"N/A",sn:s+1,role:"teacher",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",subject:((f=e.subject)==null?void 0:f.name)||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"}}).sort((e,s)=>e.sn-s.sn):[],ve=Array.isArray(c)?c.map((e,s)=>({id:e._id||"N/A",sn:s+1,role:"admin",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"})).sort((e,s)=>e.sn-s.sn):[];return{studentData:Me,teacherData:Te,adminData:ve,selectedRole:d,setSelectedRole:l,sortBy:m,sortDirection:g,page:U,rowsPerPage:N,selectedUser:y,setSelectedUser:j,editUserDetailsState:I,openDeleteModal:P,setOpenDeleteModal:D,editDialogOpen:A,setEditDialogOpen:W,signUpDialogOpen:E,setSignUpDialogOpen:M,viewUserDetails:F,setViewUserDetails:O,withdrawModalOpen:z,setWithdrawModalOpen:x,handleRoleSelect:fe,handleSortChange:Se,handlePageChange:Ce,handleRowsPerPageChange:be,handleEdit:Q,handleDelete:Ue,handleWithdraw:Ae,handleWithdrawOpen:G,handleWithdrawClose:we,handleConfirmationModalClose:De,columns:ye,tabIndex:L,handleTabChange:(e,s)=>{B(s),C(0)},loading:le||ce||ue,deleteError:de,updateError:he,withdrawError:pe,withdrawData:ge,rerender:T}},K=({confirm:n,buttonLabel:r,dialogTitle:a,dialogContent:i,scrollType:c="paper",actionText1:h="Cancel",actionText2:d="Confirm",open:l=!1,onClose:m,onConfirm:u,maxWidth:g="sm"})=>{const[S,U]=o.useState(c),C=o.useRef(null),N=oe(),b=se(N.palette.mode);return o.useEffect(()=>{if(l){const{current:y}=C;y!==null&&y.focus()}},[l]),t.jsxs(o.Fragment,{children:[t.jsx(H,{onClick:()=>m(),children:r}),t.jsxs(Ee,{open:l,onClose:m,scroll:S,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",maxWidth:g,fullWidth:!0,children:[t.jsx(Re,{id:"scroll-dialog-title",children:a}),t.jsx(Pe,{dividers:S==="paper",children:t.jsx(nt,{id:"scroll-dialog-description",ref:C,tabIndex:-1,children:i})}),t.jsxs(We,{children:[t.jsx(H,{sx:{color:b.redAccent[500],border:`solis 2px ${b.redAccent[500]}`},onClick:m,children:h}),n&&t.jsx(H,{sx:{color:b.greenAccent[500],border:`solis 2px ${b.greenAccent[500]}`},onClick:u,children:d})]})]})]})},ut=({selectedRole:n,editDialogOpen:r,setEditDialogOpen:a,handleEdit:i})=>{const[c,h]=o.useState(null);return o.useEffect(()=>{const d=sessionStorage.getItem("selectedUser");if(d){const l=JSON.parse(d);console.log(l),h(l)}},[]),t.jsx(v,{children:t.jsx(K,{buttonLabel:"Edit User",dialogTitle:"Edit User",dialogContent:c&&t.jsx(_,{role:n,selectedUser:c._id}),scrollType:"body",actionText1:"Cancel",actionText2:"Confirm",open:r,onClose:()=>a(!1),onConfirm:i})})},gt=({open:n,onClose:r})=>{const{handleDelete:a,deleteData:i,rerender:c,deleteError:h}=Z(),[d,l]=o.useState(!1);o.useEffect(()=>{const u=sessionStorage.getItem("confirmModal");u&&l(u)},[c]);const m=()=>{l(!1),sessionStorage.removeItem("confirmModal")};return t.jsxs(t.Fragment,{children:[t.jsx(k,{open:n,onClose:r,title:"Confirm delete",onConfirm:a,children:t.jsxs("p",{children:["Confirm deletion of user."," ",t.jsx("span",{style:{color:"#EB433D",fontWeight:"900",fontSize:"large"},children:"Kindly note that this cannot be reversed"})]})}),t.jsx(k,{open:d&&d,onClose:m,title:"Delete Confirmation",onConfirm:m,children:t.jsx("p",{children:i?"User successfully deleted":h})})]})},pt=({open:n,onClose:r,onConfirm:a,userName:i})=>{const{withdrawError:c,withdrawData:h,rerender:d}=Z(),[l,m]=o.useState(!1);o.useEffect(()=>{const g=sessionStorage.getItem("confirmWithdrawModal");g&&m(g)},[d]);const u=()=>{m(!1),sessionStorage.removeItem("confirmWithdrawModal")};return t.jsxs(t.Fragment,{children:[t.jsx(k,{open:n,onClose:r,title:"Confirm Student Withdrawal",onConfirm:()=>{a(),sessionStorage.setItem("confirmWithdrawModal","true")},children:t.jsxs("p",{children:["Are you sure you want to withdraw ",t.jsx("strong",{children:i}),"?"," ",t.jsx("span",{style:{color:"#EB433D",fontWeight:"900",fontSize:"large"},children:"This action will mark the student as withdrawn and remove them from their class and academic year."})]})}),t.jsx(k,{open:l&&l,onClose:u,title:"Withdraw Confirmation",onConfirm:u,children:t.jsx("p",{children:h?"Student successfully withdrawn":c||"An error occurred"})})]})},xt=()=>{const n=oe(),r=se(n.palette.mode),{selectedUser:a,editDialogOpen:i,studentData:c,teacherData:h,adminData:d,selectedRole:l,setSelectedRole:m,sortBy:u,sortDirection:g,page:S,rowsPerPage:U,setEditDialogOpen:C,signUpDialogOpen:N,setSignUpDialogOpen:b,handleRoleSelect:y,handleSortChange:j,handlePageChange:I,handleRowsPerPageChange:w,handleEdit:P,columns:D,tabIndex:A,handleTabChange:W,viewUserDetails:E,setViewUserDetails:M,openDeleteModal:L,setOpenDeleteModal:B,withdrawModalOpen:F,handleWithdraw:O,handleWithdrawClose:z,editUserDetailsState:x}=Z();return o.useEffect(()=>{a&&M(!0)},[a,M]),t.jsxs(v,{children:[t.jsx(Ye,{title:"User Management",subtitle:"Manage users"}),t.jsx(rt,{label:"Add Users",options:[{value:"student",label:"Student"},{value:"teacher",label:"Teacher"},{value:"admin",label:"Admin"}],onSelect:y}),t.jsx(v,{mt:2,children:t.jsxs(Ze,{value:A,onChange:W,"aria-label":"user role tabs",sx:{backgroundColor:r.primary[400],"& .MuiTabs-indicator":{backgroundColor:r.blueAccent[700]}},children:[t.jsx(J,{label:"Students",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:r.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:r.primary[400]}}),t.jsx(J,{label:"Teachers",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:r.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:r.primary[400]}}),t.jsx(J,{label:"Admins",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:r.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:r.primary[400]}})]})}),A===0&&t.jsx(v,{m:"20px 0 0 0",height:"75vh",children:t.jsx(V,{columns:D,tableHeader:"Student Management",data:c,sortBy:u,sortDirection:g,onSortChange:j,page:S,rowsPerPage:U,onPageChange:I,onRowsPerPageChange:w,onRowClick:()=>m("student"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})}),A===1&&t.jsx(v,{m:"20px 0 0 0",height:"75vh",children:t.jsx(V,{columns:D,tableHeader:"Teacher Management",data:h,sortBy:u,sortDirection:g,onSortChange:j,page:S,rowsPerPage:U,onPageChange:I,onRowsPerPageChange:w,onRowClick:()=>m("teacher"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})}),A===2&&t.jsx(v,{m:"20px 0 0 0",height:"75vh",children:t.jsx(V,{columns:D,tableHeader:"Admin Management",data:d,sortBy:u,sortDirection:g,onSortChange:j,page:S,rowsPerPage:U,onPageChange:I,onRowsPerPageChange:w,onRowClick:()=>m("admin"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})}),E&&a&&t.jsx(K,{buttonLabel:"View User Details",dialogTitle:"User Details",dialogContent:t.jsxs(t.Fragment,{children:[t.jsxs(p,{children:["ID: ",a.id]}),t.jsxs(p,{children:["Name: ",`${a.name}`]}),t.jsxs(p,{children:["Email: ",a.email]}),a.role==="student"&&t.jsxs(t.Fragment,{children:[t.jsxs(p,{children:["Class: ",a.classLevel]}),t.jsxs(p,{children:["Boarding Status: ",a.boardingStatus]}),t.jsxs(p,{children:["Withdrawn: ",a.isWithdrawn?"Yes":"No"]})]}),a.role==="teacher"&&t.jsxs(p,{children:["Subject: ",a.subject]}),t.jsxs(p,{children:["Role: ",a.role]}),t.jsxs(p,{children:["Registered Date: ",a.createdAt]})]}),scrollType:"paper",actionText1:"Close",actionText2:"Edit",open:E,onClose:()=>M(!1),onAction2:()=>P(a)}),t.jsx(gt,{open:L,onClose:()=>B(!1)}),t.jsx(ut,{selectedRole:l,editDialogOpen:i,setEditDialogOpen:C,handleEdit:P}),t.jsx(pt,{open:F,onClose:z,onConfirm:O,userName:x?`${x.firstName} ${x.lastName}`:""}),t.jsx(K,{buttonLabel:"Sign Up",dialogTitle:"Sign Up User",dialogContent:l==="student"?t.jsx(lt,{}):l==="teacher"?t.jsx(it,{}):l==="admin"?t.jsx(dt,{}):null,scrollType:"body",actionText1:"Cancel",actionText2:"Confirm",open:N,onClose:()=>b(!1)})]})},Lt=et(xt);export{Lt as default};
