import{r as n,j as t,a as pe,e as fe,M as xe}from"./index-DJ40OD_I.js";import{g as Se,a as Ce,u as je,_ as De,s as be,b as K,d as Ae,e as Ue,T as p,r as Te,$ as Ne,a0 as ye,a1 as ve,j as Me,y as O,w as U}from"./TextField-DbQGskJz.js";import{M as W,u as Ee}from"./MenuItem-69d4BKzx.js";import{S as w}from"./index-CR0AEXUg.js";import{H as Ie}from"./Header-ChEoJLci.js";import{T as _}from"./table-DqF6R8Nv.js";import{a as Re}from"./index-0EApi6ug.js";import{d as Pe}from"./Edit-Bp0lQQSZ.js";import{d as we}from"./Visibility-Ce_EvbDw.js";import{u as z}from"./useApi-CdL-Hv1t.js";import{I as k}from"./IconButton-BLKugJlb.js";import{t as $e,D as Le,a as Oe,b as _e,c as ke,M as Be}from"./modal-Bhf68z0j.js";import{w as Fe}from"./dasboardPagesContainer-Jzv5KZ9W.js";import{C as He}from"./confirmationModal-B83xkLCk.js";import{T as Ve,a as B}from"./Tabs-GIWPQgYe.js";import"./Alert-B_67j3yr.js";import"./useSlot-mbHhkoSz.js";import"./useMediaQuery-D3LbBbL_.js";import"./index-DWmupT9o.js";import"./loadingButton-BzTpu-ci.js";import"./CircularProgress-CWzzA20Q.js";function Je(s){return Se("MuiDialogContentText",s)}Ce("MuiDialogContentText",["root"]);const We=["children","className"],ze=s=>{const{classes:i}=s,l=Ue({root:["root"]},Je,i);return K({},i,l)},Ke=be(p,{shouldForwardProp:s=>Te(s)||s==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(s,i)=>i.root})({}),qe=n.forwardRef(function(i,m){const l=je({props:i,name:"MuiDialogContentText"}),{className:c}=l,d=De(l,We),o=ze(d);return t.jsx(Ke,K({component:"p",variant:"body1",color:"text.secondary",ref:m,ownerState:d,className:Ae(o.root,c)},l,{classes:o}))}),Ge=({label:s,options:i,onSelect:m})=>{const[l,c]=n.useState(""),d=o=>{const r=o.target.value;c(r),m(r)};return t.jsxs(Ne,{sx:{width:"170px",paddingBottom:"2%"},variant:"outlined",children:[t.jsx(ye,{id:`${s}-select-label`,children:s}),t.jsxs(ve,{labelId:`${s}-select-label`,value:l,onChange:d,label:s,children:[t.jsx(W,{value:"",disabled:!0,children:`Select ${s}`}),i.map(o=>t.jsx(W,{value:o.value,children:o.label},o.value))]})]})},Qe=()=>t.jsx(w,{role:"student"}),Xe=()=>t.jsx(w,{role:"teacher"}),Ye=()=>t.jsx(w,{role:"admin"}),q=()=>{const s=Ee(),i=pe(e=>e.adminData.usersData||{}),{students:m=[],teachers:l=[],admins:c=[]}=i;console.log("Teachers data:",l);const d=(e,a)=>a==="student"?m.find(C=>C.studentId===e):a==="teacher"?l.find(C=>C.teacherId===e):a==="admin"?c.find(C=>C._id===e):null,[o,r]=n.useState(""),[g,f]=n.useState("id"),[h,D]=n.useState("asc"),[M,x]=n.useState(0),[T,u]=n.useState(20),[S,j]=n.useState(null),[E,b]=n.useState({}),[A,N]=n.useState(!1),[y,v]=n.useState(!1),[I,R]=n.useState(!1),[$,G]=n.useState(0),[Q,H]=n.useState(!1),{callApi:X,loading:Y,data:Z,error:ee}=z(),{loading:te,error:se}=z(),[ae,V]=n.useState(!1),[P,L]=n.useState(!1),ne=e=>{r(e),R(!0)};n.useEffect(()=>{L(!P)},[y,I]);const oe=e=>{D(g===e&&h==="asc"?"desc":"asc"),f(e)},le=(e,a)=>{x(a)},re=e=>{u(parseInt(e.target.value,10)),x(0)},ie=e=>{const a=d(e.id,e.role);a&&(sessionStorage.setItem("selectedUser",JSON.stringify({...a,role:e.role})),b(a),N(!0))},J=e=>{const a=d(e.id,e.role);a&&(sessionStorage.setItem("selectedUser",JSON.stringify({...a,role:e.role})),b(a),v(!0))},de=()=>{V(!1)},ce=async()=>{const e=JSON.parse(sessionStorage.getItem("selectedUser"));if(e)try{const a={id:e.studentId||e.teacherId||e._id,role:e.role};await X(fe.USER,"DELETE",a),Z&&(s(xe({id:a.id,role:a.role})),sessionStorage.removeItem("selectedUser"),sessionStorage.setItem("confirmModal","true"),N(!1),j(null),L(!P))}catch(a){console.error("Error deleting user:",a),sessionStorage.setItem("confirmModal","true"),L(!P)}},me=[{id:"sn",label:"S/N",width:90},{id:"id",label:"ID",width:100,renderCell:e=>t.jsx(p,{children:(e.role==="student"||e.role==="teacher",String(e.id))})},{id:"name",label:"Name",flex:1},{id:"email",label:"Email",flex:1},{id:"details",label:"Details",flex:1,renderCell:e=>e.role==="student"?`${e.classLevel||"N/A"} (${e.boardingStatus||"N/A"})`:e.role==="teacher"?e.subject||"N/A":"Admin"},{id:"createdAt",label:"Registered Date",flex:1},{id:"actions",label:"Actions",width:200,renderCell:e=>t.jsxs("div",{style:{display:"flex"},children:[t.jsx(k,{onClick:()=>J(e),children:t.jsx(Pe,{})}),t.jsx(k,{onClick:()=>ie(e),children:t.jsx(Re,{})}),t.jsx(k,{onClick:()=>{j(e),H(!0)},children:t.jsx(we,{})})]})}],ge=Array.isArray(m)?m.map((e,a)=>(console.log("Student:",e),{id:e.studentId??"N/A",sn:a+1,role:"student",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",classLevel:e.currentClassLevel?`${e.currentClassLevel.className} ${e.currentClassLevel.subclass}`:"N/A",boardingStatus:e.boardingStatus||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"})).sort((e,a)=>e.sn-a.sn):[],he=Array.isArray(l)?l.map((e,a)=>{var C;return{id:e.teacherId||"N/A",sn:a+1,role:"teacher",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",subject:((C=e.subject)==null?void 0:C.name)||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"}}).sort((e,a)=>e.sn-a.sn):[],ue=Array.isArray(c)?c.map((e,a)=>({id:e._id||"N/A",sn:a+1,role:"admin",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"})).sort((e,a)=>e.sn-a.sn):[];return{studentData:ge,teacherData:he,adminData:ue,selectedRole:o,setSelectedRole:r,sortBy:g,sortDirection:h,page:M,rowsPerPage:T,selectedUser:S,setSelectedUser:j,editUserDetailsState:E,openDeleteModal:A,setOpenDeleteModal:N,editDialogOpen:y,setEditDialogOpen:v,signUpDialogOpen:I,setSignUpDialogOpen:R,viewUserDetails:Q,setViewUserDetails:H,confirmModalOpen:ae,setConfirmModalOpen:V,handleRoleSelect:ne,handleSortChange:oe,handlePageChange:le,handleRowsPerPageChange:re,handleEdit:J,handleDelete:ce,handleConfirmationModalClose:de,columns:me,tabIndex:$,handleTabChange:(e,a)=>{G(a),x(0)},loading:Y||te,deleteError:ee,updateError:se,rerender:P}},F=({confirm:s,buttonLabel:i,dialogTitle:m,dialogContent:l,scrollType:c="paper",actionText1:d="Cancel",actionText2:o="Confirm",open:r=!1,onClose:g,onConfirm:f,maxWidth:h="sm"})=>{const[D,M]=n.useState(c),x=n.useRef(null),T=Me(),u=$e(T.palette.mode);return n.useEffect(()=>{if(r){const{current:S}=x;S!==null&&S.focus()}},[r]),t.jsxs(n.Fragment,{children:[t.jsx(O,{onClick:()=>g(),children:i}),t.jsxs(Le,{open:r,onClose:g,scroll:D,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",maxWidth:h,fullWidth:!0,children:[t.jsx(Oe,{id:"scroll-dialog-title",children:m}),t.jsx(_e,{dividers:D==="paper",children:t.jsx(qe,{id:"scroll-dialog-description",ref:x,tabIndex:-1,children:l})}),t.jsxs(ke,{children:[t.jsx(O,{sx:{color:u.redAccent[500],border:`solis 2px ${u.redAccent[500]}`},onClick:g,children:d}),s&&t.jsx(O,{sx:{color:u.greenAccent[500],border:`solis 2px ${u.greenAccent[500]}`},onClick:f,children:o})]})]})]})},Ze=({selectedRole:s,editDialogOpen:i,setEditDialogOpen:m,handleEdit:l})=>{const[c,d]=n.useState(null);return n.useEffect(()=>{const o=sessionStorage.getItem("selectedUser");if(o){const r=JSON.parse(o);console.log(r),d(r),console.log(c)}},[]),t.jsx(U,{children:t.jsx(F,{buttonLabel:"Edit User",dialogTitle:"Edit User",dialogContent:c&&t.jsx(w,{role:s,selectedUser:c._id}),scrollType:"body",actionText1:"Cancel",actionText2:"Confirm",open:i,onClose:()=>m(!1),onConfirm:l})})},et=({open:s,onClose:i})=>{const{handleDelete:m,loading:l,deleteData:c,rerender:d,deleteError:o}=q(),[r,g]=n.useState(!1);n.useEffect(()=>{const h=sessionStorage.getItem("confrimModal");h&&(g(h),console.log(r))},[d]);const f=()=>{g(!1),sessionStorage.removeItem("confrimModal")};return t.jsxs(t.Fragment,{children:[t.jsx(Be,{open:s,onClose:i,title:"Confirm delete",onConfirm:m,children:t.jsxs("p",{children:["Confirm deletion of user."," ",t.jsx("span",{style:{color:"#EB433D",fontWeight:"900",fontSize:"large"},children:"Kindly note that this cannot be reversed"})]})}),t.jsx(He,{open:r&&r,isLoading:l,onClose:f,title:"Delete confirmation",message:c?"User successfully deleted":o})]})},tt=()=>{const{selectedUser:s,editDialogOpen:i,studentData:m,teacherData:l,adminData:c,selectedRole:d,setSelectedRole:o,sortBy:r,sortDirection:g,page:f,rowsPerPage:h,setEditDialogOpen:D,signUpDialogOpen:M,setSignUpDialogOpen:x,handleRoleSelect:T,handleSortChange:u,handlePageChange:S,handleRowsPerPageChange:j,handleEdit:E,columns:b,tabIndex:A,handleTabChange:N,viewUserDetails:y,setViewUserDetails:v,openDeleteModal:I,setOpenDeleteModal:R,rerender:$}=q();return n.useEffect(()=>{s&&v(!0)},[s]),t.jsxs(U,{children:[t.jsx(Ie,{title:"User Management",subtitle:"Manage users"}),t.jsx(Ge,{label:"Add Users",options:[{value:"student",label:"Student"},{value:"teacher",label:"Teacher"},{value:"admin",label:"Admin"}],onSelect:T}),t.jsx(U,{mt:2,children:t.jsxs(Ve,{value:A,onChange:N,children:[t.jsx(B,{label:"Students"}),t.jsx(B,{label:"Teachers"}),t.jsx(B,{label:"Admins"})]})}),A===0&&t.jsx(U,{m:"20px 0 0 0",height:"75vh",children:t.jsx(_,{columns:b,tableHeader:"Student Management",data:m,sortBy:r,sortDirection:g,onSortChange:u,page:f,rowsPerPage:h,onPageChange:S,onRowsPerPageChange:j,onRowClick:()=>o("student"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})}),A===1&&t.jsx(U,{m:"20px 0 0 0",height:"75vh",children:t.jsx(_,{columns:b,tableHeader:"Teacher Management",data:l,sortBy:r,sortDirection:g,onSortChange:u,page:f,rowsPerPage:h,onPageChange:S,onRowsPerPageChange:j,onRowClick:()=>o("teacher"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})}),A===2&&t.jsx(U,{m:"20px 0 0 0",height:"75vh",children:t.jsx(_,{columns:b,tableHeader:"Admin Management",data:c,sortBy:r,sortDirection:g,onSortChange:u,page:f,rowsPerPage:h,onPageChange:S,onRowsPerPageChange:j,onRowClick:()=>o("admin"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})}),y&&s&&t.jsx(F,{buttonLabel:"View User Details",dialogTitle:"User Details",dialogContent:t.jsxs(t.Fragment,{children:[t.jsxs(p,{children:["ID: ",s.id]}),t.jsxs(p,{children:["Name: ",`${s.name}`]}),t.jsxs(p,{children:["Email: ",s.email]}),s.role==="student"&&t.jsxs(t.Fragment,{children:[t.jsxs(p,{children:["Class: ",s.classLevel]}),t.jsxs(p,{children:["Boarding Status: ",s.boardingStatus]})]}),s.role==="teacher"&&t.jsxs(p,{children:["Subject: ",s.subject]}),t.jsxs(p,{children:["Role: ",s.role]}),t.jsxs(p,{children:["Registered Date: ",s.createdAt]})]}),scrollType:"paper",actionText1:"Close",actionText2:"Edit",open:y,onClose:()=>v(!1),onAction2:()=>E(s)}),t.jsx(et,{open:I,onClose:()=>R(!1)}),t.jsx(Ze,{selectedRole:d,editDialogOpen:i,setEditDialogOpen:D,handleEdit:E,rerender:$}),t.jsx(F,{buttonLabel:"Sign Up",dialogTitle:"Sign Up User",dialogContent:d==="student"?t.jsx(Qe,{}):d==="teacher"?t.jsx(Xe,{}):d==="admin"?t.jsx(Ye,{}):null,scrollType:"body",actionText1:"Cancel",actionText2:"Confirm",open:M,onClose:()=>x(!1)})]})},Ut=Fe(tt);export{Ut as default};
