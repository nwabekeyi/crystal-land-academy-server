import{r as s,j as t,i as Le,e as B,a as q}from"./index-CikQMIxq.js";import{t as J,M as N}from"./modal-DegES_uk.js";import{T as Q}from"./table-BLDLF2xb.js";import{H as X}from"./Header-TreUcfEU.js";import{j as Z,w as A,T as g,y as Re,z as R}from"./TextField-DBM3Kdjt.js";import{u as C}from"./useApi-ClS9LJ9f.js";import{C as ee,A as W}from"./confirmationModal-IVK2OKxs.js";import{C as H}from"./customIconButton-yInW23qL.js";import{d as Ne}from"./Edit-CnI8ZXAk.js";import{A as Be,c as $e}from"./index-CBIszJhn.js";import{d as Oe}from"./Visibility-CGxD2sVQ.js";import{w as We}from"./dasboardPagesContainer-MS05gvgF.js";import"./IconButton-D4HzaP6M.js";import"./useMediaQuery-rMa90EY2.js";import"./index-C35jSBSo.js";import"./loadingButton-B7aR1mEr.js";import"./CircularProgress-D0-LNmPF.js";import"./MenuItem-wbOmOVuU.js";import"./useSlot-perXj4Tc.js";const He=[{id:1,date:"2025-06-02",location:"Room 101",time:"08:00 - 09:00",topic:"Mathematics: Algebra Basics",attended:"Yes"},{id:2,date:"2025-06-02",location:"Room 102",time:"09:15 - 10:15",topic:"English: Literature Analysis",attended:"No"},{id:3,date:"2025-06-03",location:"Lab 1",time:"10:30 - 11:30",topic:"Science: Chemistry Experiments",attended:"Yes"},{id:4,date:"2025-06-04",location:"Room 103",time:"08:00 - 09:00",topic:"History: World War II",attended:"No"},{id:5,date:"2025-06-05",location:"Room 101",time:"09:15 - 10:15",topic:"Physical Education: Fitness Training",attended:"Yes"}],Ue=()=>{const u=Z();J(u.palette.mode);const[p]=s.useState(He),[c,h]=s.useState("date"),[f,a]=s.useState("asc"),[x,n]=s.useState(0),[d,S]=s.useState(5),T=p.map((o,i)=>({...o,sn:i+1,date:o.date?new Date(o.date).toLocaleDateString():"N/A"})),D={columns:[{id:"sn",label:"S/N",flex:.5},{id:"date",label:"Date",flex:1,renderCell:o=>t.jsx(g,{children:o.date||"N/A"})},{id:"location",label:"Location",flex:1,renderCell:o=>t.jsx(g,{children:String(o.location||"N/A")})},{id:"time",label:"Time",flex:1,renderCell:o=>t.jsx(g,{children:String(o.time||"N/A")})},{id:"topic",label:"Topic",flex:2,renderCell:o=>t.jsx(g,{children:String(o.topic||"N/A")})},{id:"attended",label:"Attended",flex:1,renderCell:o=>t.jsx(g,{children:String(o.attended||"N/A")})}],tableHeader:"Schedule",data:T,sortBy:c,sortDirection:f,onSortChange:o=>{a(c===o&&f==="asc"?"desc":"asc"),h(o)},page:x,rowsPerPage:d,onPageChange:(o,i)=>{n(i)},onRowsPerPageChange:o=>{S(parseInt(o.target.value,10)),n(0)},onRowClick:o=>{console.log("Row clicked:",o)}};return t.jsxs(A,{py:"20px",children:[t.jsx(X,{title:"TIME TABLE",subtitle:"Overview of Schedule"}),t.jsx(A,{children:t.jsx(Q,{...D})})]})},_e=({openAttendanceModal:u,handleAttendanceModalClose:p,timeTable:c,cohortName:h})=>{const[f,a]=s.useState([]),[x,n]=s.useState(!1),{loading:d,error:S,callApi:T}=C(),{loading:j,callApi:k,data:M}=C();s.useEffect(()=>{(async()=>{const i=await T(`${B.COHORT}/students/${h}`);i&&i.students&&a(i.students),n(!0)})()},[h]);const I=()=>{n(!1)},P=async o=>{const i={studentId:o,cohortName:h,timeTableId:c.id};await k(B.MARK_ATTENDANCE,"PATCH",i)},D=o=>{var i;return(i=c==null?void 0:c.attendance)==null?void 0:i.includes(o)};return t.jsxs(N,{open:u,onClose:p,title:"Mark Attendance",noConfirm:!0,confirmMessage:"Attendance",children:[d?t.jsx(Le,{}):f.map(o=>t.jsxs(A,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,p:2,borderRadius:"4px",border:"1px solid #ccc",children:[t.jsxs(A,{display:"flex",alignItems:"center",children:[t.jsx(Be,{src:o.profilePicture,alt:o.firstName,sx:{width:48,height:48,mr:2}}),t.jsxs(g,{variant:"h6",children:[o.firstName," ",o.lastName]})]}),t.jsx(Re,{variant:"contained",color:"primary",onClick:()=>P(o.userId),disabled:D(o.userId)||j,children:D(o.userId)?"Attendance Marked":j?"Marking...":"Mark Attendance"})]},o.userId)),t.jsx(ee,{open:x,onClose:I,title:"Confirmation marked attendance",isLoading:j,message:M.message}),S&&t.jsx(g,{color:"error",children:S})]})},Fe=()=>{const u=Z();J(u.palette.mode);const[p,c]=s.useState(!1),[h,f]=s.useState(!1),[a,x]=s.useState(null),[n,d]=s.useState({date:"",course:"",time:"",location:"",topic:""}),[S,T]=s.useState(0),[j,k]=s.useState(10),[M,I]=s.useState("date"),[P,D]=s.useState("asc"),[o,i]=s.useState(null),[te,w]=s.useState([]),[b,$]=s.useState(!1),[v,y]=s.useState(!1),[oe,U]=s.useState(!1),[ae,se]=s.useState(""),[ne,_]=s.useState(!1),[F,ie]=s.useState(!1),[Ke,le]=s.useState(!1),Y=q(e=>e.users.user),O=Y.cohort,E=`${B.TIMETABLE}/${O}`;console.log(O);const ce=()=>{b===!0&&$(!1),v===!0&&y(!1)},re=e=>{U(!0),se(e)},de=e=>{U(!1)},{callApi:ue}=C(),{callApi:me}=C(),{loading:pe,error:K,callApi:he}=C(),{loading:fe,error:xe,callApi:ge}=C(),{data:Ce,callApi:Ae}=C();s.useEffect(()=>{(async()=>{if(E){const l=await me(E,"GET");w(l)}})()},[]);const z=(e,l)=>{if(!e||!l)return"Invalid Date";const m=new Date(e).toISOString().split("T")[0],r=new Date(`${m}T${l}`);return isNaN(r)?"Invalid Date":r},Se=[{id:"date",label:"Date",renderCell:e=>z(e.date,e.time).toLocaleDateString()},{id:"time",label:"Time"},{id:"location",label:"Location"},{id:"topic",label:"Topic"},{id:"actions",label:"Actions",renderCell:e=>{const r=z(e.date,e.time)<=new Date,ve=e.done;return ie(ve),le(r),t.jsxs(A,{sx:{px:0},children:[t.jsx(H,{onClick:()=>je(e),icon:t.jsx(Ne,{})}),t.jsx(H,{onClick:()=>Me(e),icon:t.jsx(Oe,{})}),t.jsx(H,{onClick:()=>Pe(e),icon:t.jsx($e,{})})]})}}],G=()=>c(!0),L=()=>{c(!1),d({date:"",course:"",time:"",location:"",topic:""}),x(null)},Te=()=>f(!0),V=()=>{f(!1),i(null)},je=e=>{x(e),d({date:e.date||"",time:e.time||"",location:e.location||"",topic:e.topic||"",course:e.course||""}),G()},De=async()=>{if(a){const e={date:n.date,time:n.time,location:n.location,topic:n.topic,course:n.course};await he(`${E}/${a.id}`,"PUT",e)&&w(m=>m.map(r=>r.id===a.id?{...r,...e}:r)),y(!0),L()}},be=async()=>{if(a){const e={cohortName:O,entryId:a.id};await Ae(B.MARK_TIMETABLE,"PATCH",e)&&w(m=>m.map(r=>r.id===a.id?{...r,done:!0}:r)),y(!0),L()}};console.log(Ce);const Me=e=>{x(e),_(!0)},Pe=e=>{i(e),Te()},we=async()=>{a&&(await ge(`${E}/${a.id}`,"DELETE")?w(l=>l.filter(m=>m.id!==a.id)):$(!0),V(),$(!0))},ye=async()=>{const e={date:n.date,time:n.time,location:n.location,topic:n.topic,course:n.course},l=await ue(E,"POST",e);l&&w(l.timetable),L()},Ee=e=>{D(M===e&&P==="asc"?"desc":"asc"),I(e)},ke=(e,l)=>{T(l)},Ie=e=>{k(+e.target.value),T(0)};return t.jsxs(A,{children:[t.jsx(X,{title:"TIME TABLE",subtitle:"Overview of Weekly Schedule"}),t.jsx(W,{onClick:G,content:"Add Schedule"}),t.jsx(Q,{columns:Se,data:te,page:S,rowsPerPage:j,onSortChange:Ee,sortBy:M,sortDirection:P,onPageChange:ke,onRowsPerPageChange:Ie,hiddenColumnsSmallScreen:["topic","location"]}),t.jsxs(N,{open:p,onClose:L,title:a?"Edit Schedule":"Add Schedule",onConfirm:a?De:ye,confirmMessage:a?"Update":"Add",children:[t.jsx(R,{fullWidth:!0,name:"date",label:"Date",type:"date",value:n.date,onChange:e=>d({...n,date:e.target.value}),sx:{mb:"15px"},InputLabelProps:{shrink:!0}}),t.jsx(R,{fullWidth:!0,name:"time",label:"Time",type:"time",value:n.time,onChange:e=>d({...n,time:e.target.value}),sx:{mb:"15px"},InputLabelProps:{shrink:!0}}),t.jsx(R,{fullWidth:!0,name:"location",label:"Location",value:n.location,onChange:e=>d({...n,location:e.target.value}),sx:{mb:"15px"}}),t.jsx(R,{fullWidth:!0,name:"topic",label:"Topic",value:n.topic,onChange:e=>d({...n,topic:e.target.value}),sx:{mb:"15px"}})]}),t.jsxs(N,{open:ne,onClose:()=>_(!1),title:"Assignment Details",noConfirm:!0,children:[t.jsxs(A,{children:[t.jsxs("p",{children:["Topic: ",a==null?void 0:a.topic]}),t.jsxs("p",{children:["Date: ",a==null?void 0:a.date]}),t.jsxs("p",{children:["Time: ",a==null?void 0:a.time]}),t.jsxs("p",{children:["Location: ",a==null?void 0:a.location]})]}),t.jsx(W,{onClick:()=>re(a),content:"Mark Attendance",sx:{width:"120px"}}),t.jsx(W,{onClick:()=>be(),content:F?"Schedule completed":"Mark as done",sx:{width:"120px",mx:1},disable:F})]}),t.jsx(N,{open:h,onClose:V,title:"Delete Schedule",onConfirm:we,confirmMessage:"Delete",children:"Are you sure you want to delete this schedule?"}),t.jsx(ee,{open:b||v,onClose:ce,title:b?"Delete Confirmation":"Update confirmation",isLoading:b?fe:pe,message:b?"Time Table successfully deleted":v?K:b&&xe||v&&K?"Could not update time table, something went wrong":"something went wrong"}),t.jsx(_e,{openAttendanceModal:oe,cohortName:Y.cohort,timeTable:ae,handleAttendanceModalClose:de})]})},Ye=()=>{const u=q(c=>c.users.user),p=u.role;return t.jsx("div",{children:p==="student"?t.jsx(Ue,{}):t.jsx(Fe,{babtechUser:u})})},ut=We(Ye);export{ut as default};
