import{j as e,R as Ye,a as qe,P as Be,r as l,e as le,N as Ue,i as Je}from"./index-sE9McROK.js";import{M as ce,t as Ke}from"./modal-D5t_VsWL.js";import{H as Qe}from"./Header-Ce3beeyr.js";import{a as Xe,b as Ze,T as Ie}from"./table-BiKsd7Cl.js";import{u as $e}from"./useApi-CPAxUgM_.js";import{I as es}from"./IconButton-DNp91bHf.js";import{h as be,f as fe,i as ss,j as ae,k as ts}from"./index.esm-5QlBNWyy.js";import{u as as,M as ge}from"./MenuItem-BXhanr4d.js";import{w as rs}from"./dasboardPagesContainer-D6kqLPWj.js";import{A as X}from"./confirmationModal-DtYljRDW.js";import{c as oe,L as Oe,a as Re}from"./index-BS84kvxy.js";import{T as _,w as E,a1 as Se,z as S,x as Ve,j as ns}from"./TextField-CMl_o3n-.js";import"./useMediaQuery-CnNNHth1.js";import"./index-BbKQoXkK.js";import"./loadingButton-CLKFd1OZ.js";import"./CircularProgress-Cqs5A885.js";import"./useSlot-BX7f3QAU.js";const B=({onClick:b,icon:m,title:u,...i})=>e.jsx(es,{title:u,onClick:b,sx:{fontSize:{xs:"12px",sm:"12px",md:"18px",lg:"18px",xl:"18px"},...i.sx},...i,children:Ye.cloneElement(m,{fontSize:"inherit"})}),is=()=>{const b=as(),{classLevels:m,academicYears:u}=qe(Be),[i,r]=l.useState("section"),[h,M]=l.useState("asc"),[O,$]=l.useState(!1),[F,g]=l.useState("create"),[Y,N]=l.useState(null),[d,c]=l.useState({section:"Primary",name:"",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],description:"",academicYear:"",subclasses:[{letter:"A",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],timetables:[]}]}),[q,C]=l.useState(""),{data:j,loading:L,callApi:y}=$e(),{callApi:K,loading:re,error:I}=$e();l.useEffect(()=>{y(le.CLASS_LEVEL,"GET")},[y]),l.useEffect(()=>{j&&Array.isArray(j.data)&&(console.log("Fetched classLevels:",j.data),b(Ue(j.data)))},[j,b]);const p=l.useCallback(s=>{i===s?M(h==="asc"?"desc":"asc"):(r(s),M("asc"))},[i,h]),v=l.useCallback((s,t=null)=>{var a,o;g(s),N(t),s==="create"?c({section:"Primary",name:"",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],description:"",academicYear:((a=u.find(x=>x.isCurrent))==null?void 0:a._id)||"",subclasses:[{letter:"A",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],timetables:[]}]}):t&&c({section:t.section||"Primary",name:t.name||"",feesPerTerm:t.feesPerTerm||[{termName:"1st Term",amount:0,description:""}],description:t.description||"",academicYear:((o=t.academicYear)==null?void 0:o._id)||"",subclasses:t.subclasses||[{letter:"A",feesPerTerm:t.feesPerTerm||[{termName:"1st Term",amount:0,description:""}],timetables:[]}]}),$(!0)},[u]),P=l.useCallback(s=>{const{name:t,value:a}=s.target;c(o=>({...o,[t]:a}))},[]),k=l.useCallback((s,t,a)=>{c(o=>{const x=[...o.feesPerTerm];return x[s]={...x[s],[t]:a},{...o,feesPerTerm:x}})},[]),D=l.useCallback((s,t,a,o)=>{c(x=>{const f=[...x.subclasses],R=[...f[s].feesPerTerm];return R[t]={...R[t],[a]:o},f[s]={...f[s],feesPerTerm:R},{...x,subclasses:f}})},[]),W=l.useCallback(()=>{c(s=>({...s,feesPerTerm:[...s.feesPerTerm,{termName:`${s.feesPerTerm.length+1} Term`,amount:0,description:""}]}))},[]),G=l.useCallback(s=>{c(t=>({...t,feesPerTerm:t.feesPerTerm.filter((a,o)=>o!==s)}))},[]),he=l.useCallback(s=>{c(t=>{const a=[...t.subclasses];return a[s]={...a[s],feesPerTerm:[...a[s].feesPerTerm,{termName:`${a[s].feesPerTerm.length+1} Term`,amount:0,description:""}]},{...t,subclasses:a}})},[]),de=l.useCallback((s,t)=>{c(a=>{const o=[...a.subclasses];return o[s]={...o[s],feesPerTerm:o[s].feesPerTerm.filter((x,f)=>f!==t)},{...a,subclasses:o}})},[]),Ce=l.useCallback((s,t,a,o)=>{c(x=>{const f=[...x.subclasses],R=f.findIndex(Pe=>Pe.letter===o);if(R===-1)return x;const ie=[...f[R].timetables];return ie[s]={...ie[s],[t]:a},f[R]={...f[R],timetables:ie},{...x,subclasses:f}})},[]),me=l.useCallback(s=>{c(t=>{const a=[...t.subclasses],o=a.findIndex(x=>x.letter===s);return o===-1?t:(a[o]={...a[subIndex],timetables:[...a[subIndex].timetables,{day:"Monday",startTime:"08:00",endTime:"09:00",subject:""}]},{...t,subclasses:a})})},[]),ue=l.useCallback((s,t)=>{c(a=>{const o=[...a.subclasses],x=o.findIndex(f=>f.letter===t);return x===-1?a:(o[x]={...o[subIndex],timetables:o[subIndex].timetables.filter((f,R)=>R!==s)},{...a,subclasses:o})})},[]),ne=l.useCallback(()=>d.section?d.name?d.academicYear?d.feesPerTerm.every(s=>s.termName&&s.amount>=0)?d.subclasses.every(s=>s.feesPerTerm.every(t=>t.termName&&t.amount>=0))?d.subclasses.some(s=>s.timetables.some(t=>!t.day||!t.startTime||!t.endTime||!t.subject))?"All timetable entries must have valid fields":"":"All subclass fees must have a term name and a valid amount":"All class fees must have a term name and a valid amount":"Academic year is required":"Class name is required":"Section is required",[d]),je=l.useCallback(async()=>{const s=ne();if(s){C(s);return}const t={section:d.section,name:d.name,description:d.description,academicYear:d.academicYear,feesPerTerm:d.feesPerTerm,subclasses:d.subclasses.map(a=>({letter:a.letter,feesPerTerm:a.feesPerTerm,timetables:a.timetables}))};try{F==="create"?await K(le.CLASS_LEVEL,"POST",t):F==="edit"?await K(`${le.CLASS_LEVEL}/${Y._id}`,"PATCH",t):F==="delete"&&await K(`${le.CLASS_LEVEL}/${Y._id}`,"DELETE"),y(le.CLASS_LEVEL,"GET"),$(!1),C("")}catch{C(I||"Failed to process request")}},[F,d,Y,K,y,I,ne]),pe=s=>{const t=new Date(s);return!isNaN(t.getTime())&&/^\d{4}-\d{2}-\d{2}$/.test(s)?t.toLocaleDateString(navigator.language||"en-US",{year:"numeric",month:"long",day:"numeric"}):s},H=l.useMemo(()=>Array.isArray(m)?m.map(s=>({...s,displayName:pe(s.name)})):[],[m]),Te=l.useMemo(()=>{const s={};return u.forEach(t=>{s[t._id]={Primary:H.filter(a=>{var o,x,f;return((o=a.academicYear)==null?void 0:o._id)===t._id&&(((x=a.section)==null?void 0:x.toLowerCase())==="primary"||((f=a.section)==null?void 0:f.toLowerCase())==="Primary")}),Secondary:H.filter(a=>{var o,x,f;return((o=a.academicYear)==null?void 0:o._id)===t._id&&(((x=a.section)==null?void 0:x.toLowerCase())==="secondary"||((f=a.section)==null?void 0:f.toLowerCase())==="Secondary")})},console.log(`Grouped data for year ${t._id}:`,s[t._id])}),s},[H,u]);return{tableProps:{columns:l.useMemo(()=>[{id:"sn",label:"S/N",width:90},{id:"section",label:"Section",flex:1},{id:"displayName",label:"Class Name",flex:1,renderCell:s=>s.displayName},{id:"studentsCount",label:"Students",flex:1,renderCell:s=>{var t;return((t=s.students)==null?void 0:t.length)||0}},{id:"academicYear",label:"Academic Year",flex:1,renderCell:s=>{var t;return((t=s.academicYear)==null?void 0:t.name)||"N/A"}},{id:"actions",label:"Actions",flex:1,renderCell:s=>e.jsxs(e.Fragment,{children:[e.jsx(B,{icon:e.jsx(be,{}),title:"View Class",onClick:()=>v("view",s),sx:{mx:.5}}),e.jsx(B,{icon:e.jsx(fe,{}),title:"Edit Class",onClick:()=>v("edit",s),sx:{mx:.5}}),e.jsx(B,{icon:e.jsx(ss,{}),title:"Delete Class",onClick:()=>v("delete",s),sx:{mx:.5}})]})}],[v]),tableHeader:"Class Management",data:H,classLevels:Te,sortBy:i,sortDirection:h,onSortChange:p,onRowClick:s=>v("view",s),hiddenColumnsSmallScreen:["description"],hiddenColumnsTabScreen:[],academicYears:u},modalOpen:O,setModalOpen:$,modalMode:F,setModalMode:g,formData:d,setFormData:c,handleFormChange:P,handleFeesChange:k,handleSubclassFeesChange:D,addTermFee:W,removeTermFee:G,addSubclassTermFee:he,removeSubclassTermFee:de,handleTimetableChange:Ce,addTimetableEntry:me,removeTimetableEntry:ue,handleSubmit:je,error:q,loadingClasses:L,loadingSubmit:re,openModal:v,academicYears:u,selectedClass:Y}},ls=({open:b,onClose:m,title:u,modalMode:i,setModal:r,formData:h,handleFormChange:M,handleFeesChange:O,handleSubclassFeesChange:$,addTermFee:F,removeTermFee:g,addSubclassTermFee:Y,removeSubclassTermFee:N,openTimetableModal:d,setStudentsModalOpen:c,setTeachersModalOpen:q,setFeesModalOpen:C,handleSubmit:j,error:L,loadingSubmit:y,academicYears:K,colors:re,theme:I})=>{const p=i==="view",v=i==="delete";return Ye.useEffect(()=>{console.log("ClassModal props:",{modalMode:i,setModal:typeof r})},[i,r]),e.jsx(ce,{open:b,onClose:m,title:u,onConfirm:j,confirmMessage:v?"Delete":"Save",noConfirm:p,styleProps:{padding:I.spacing(3)},children:v?e.jsx(_,{children:"Are you sure you want to delete this class level?"}):e.jsxs(E,{component:"form",sx:{display:"flex",flexDirection:"column",gap:2},children:[p&&e.jsx(X,{icon:e.jsx(fe,{}),content:"Edit",onClick:()=>{typeof r=="function"?r("edit"):console.error("setModal is not a function")},sx:{alignSelf:"flex-start",mb:2}}),e.jsxs(Se,{label:"Section",name:"section",value:h.section,onChange:M,fullWidth:!0,disabled:p,required:!0,children:[e.jsx(ge,{value:"Primary",children:"Primary"}),e.jsx(ge,{value:"Secondary",children:"Secondary"})]}),e.jsx(S,{label:"Class Name",name:"name",value:h.name,onChange:M,fullWidth:!0,disabled:p,required:!0}),e.jsx(Se,{label:"Academic Year",name:"academicYear",value:h.academicYear,onChange:M,fullWidth:!0,disabled:p,required:!0,children:K.map(P=>e.jsx(ge,{value:P._id,children:P.name},P._id))}),e.jsx(S,{label:"Description",name:"description",value:h.description,onChange:M,fullWidth:!0,disabled:p,multiline:!0,rows:3}),e.jsx(_,{variant:"h6",children:"Class Fees Per Term"}),h.feesPerTerm.map((P,k)=>e.jsxs(E,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(S,{label:"Term Name",value:P.termName,onChange:D=>O(k,"termName",D.target.value),disabled:p,required:!0}),e.jsx(S,{label:"Amount",type:"number",value:P.amount,onChange:D=>O(k,"amount",parseFloat(D.target.value)),disabled:p,required:!0}),e.jsx(S,{label:"Description",value:P.description,onChange:D=>O(k,"description",D.target.value),disabled:p}),!p&&e.jsx(B,{icon:e.jsx(oe,{}),title:"Remove Term Fee",onClick:()=>g(k),disabled:h.feesPerTerm.length===1})]},k)),!p&&e.jsx(B,{icon:e.jsx(ae,{}),title:"Add Term Fee",onClick:F,sx:{alignSelf:"flex-start"}}),e.jsx(_,{variant:"h6",children:"Subclasses"}),h.subclasses.map((P,k)=>e.jsxs(E,{sx:{border:`1px solid ${re.grey[500]}`,p:2,mb:2},children:[e.jsxs(_,{variant:"subtitle1",children:["Subclass ",P.letter]}),e.jsx(_,{variant:"subtitle2",children:"Fees Per Term"}),P.feesPerTerm.map((D,W)=>e.jsxs(E,{sx:{display:"flex",gap:2,alignItems:"center",mt:1},children:[e.jsx(S,{label:"Term Name",value:D.termName,onChange:G=>$(k,W,"termName",G.target.value),disabled:p,required:!0}),e.jsx(S,{label:"Amount",type:"number",value:D.amount,onChange:G=>$(k,W,"amount",parseFloat(G.target.value)),disabled:p,required:!0}),e.jsx(S,{label:"Description",value:D.description,onChange:G=>$(k,W,"description",G.target.value),disabled:p}),!p&&e.jsx(B,{icon:e.jsx(oe,{}),title:"Remove Term Fee",onClick:()=>N(k,W),disabled:P.feesPerTerm.length===1})]},W)),!p&&e.jsx(B,{icon:e.jsx(ae,{}),title:"Add Subclass Term Fee",onClick:()=>Y(k),sx:{mt:1}}),e.jsx(X,{icon:e.jsx(ts,{}),content:"View Timetable",onClick:()=>d("view",P),sx:{mt:1}})]},k)),p&&e.jsxs(E,{sx:{display:"flex",gap:2,mt:2},children:[e.jsx(X,{icon:e.jsx(be,{}),content:"View Students",onClick:()=>c(!0),sx:{mx:.5}}),e.jsx(X,{icon:e.jsx(be,{}),content:"View Teachers",onClick:()=>q(!0),sx:{mx:.5}}),e.jsx(X,{icon:e.jsx(be,{}),content:"View Fees",onClick:()=>C(!0),sx:{mx:.5}})]}),L&&e.jsx(_,{color:"error",children:L}),y&&e.jsx(_,{children:"Processing..."})]})})},os=({open:b,onClose:m,students:u,theme:i})=>e.jsx(ce,{open:b,onClose:m,title:"Students",noConfirm:!0,styleProps:{padding:i.spacing(3)},children:u.length>0?e.jsx(Ve,{children:u.map(r=>e.jsx(Oe,{children:e.jsx(Re,{primary:`${r.firstName} ${r.lastName}`,secondary:`Email: ${r.email}${r.phone?` | Phone: ${r.phone}`:""}`})},r._id))}):e.jsx(_,{children:"No students assigned to this class."})}),cs=({open:b,onClose:m,teachers:u,theme:i})=>e.jsx(ce,{open:b,onClose:m,title:"Teachers",noConfirm:!0,styleProps:{padding:i.spacing(3)},children:u.length>0?e.jsx(Ve,{children:u.map(r=>e.jsx(Oe,{children:e.jsx(Re,{primary:`${r.firstName} ${r.lastName}`,secondary:`Email: ${r.email}${r.phone?` | Phone: ${r.phone}`:""}`})},r._id))}):e.jsx(_,{children:"No teachers assigned to this class."})}),ds=({open:b,onClose:m,title:u,timetableMode:i,selectedSubclass:r,handleTimetableChange:h,addTimetableEntry:M,removeTimetableEntry:O,setTimetableMode:$,handleSubmit:F,error:g,theme:Y})=>e.jsx(ce,{open:b,onClose:m,title:u,onConfirm:i==="edit"?F:null,confirmMessage:"Save",noConfirm:i==="view",styleProps:{padding:Y.spacing(3)},children:e.jsxs(E,{sx:{display:"flex",flexDirection:"column",gap:2},children:[i==="view"&&e.jsx(X,{icon:e.jsx(fe,{}),content:"Edit Timetable",onClick:()=>$("edit"),sx:{alignSelf:"flex-start",mb:2}}),r==null?void 0:r.timetables.map((N,d)=>e.jsxs(E,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(Se,{label:"Day",value:N.day,onChange:c=>h(d,"day",c.target.value,r.letter),disabled:i==="view",required:!0,children:["Monday","Tuesday","Wednesday","Thursday","Friday"].map(c=>e.jsx(ge,{value:c,children:c},c))}),e.jsx(S,{label:"Start Time",type:"time",value:N.startTime,onChange:c=>h(d,"startTime",c.target.value,r.letter),disabled:i==="view",required:!0,InputLabelProps:{shrink:!0}}),e.jsx(S,{label:"End Time",type:"time",value:N.endTime,onChange:c=>h(d,"endTime",c.target.value,r.letter),disabled:i==="view",required:!0,InputLabelProps:{shrink:!0}}),e.jsx(S,{label:"Subject",value:N.subject,onChange:c=>h(d,"subject",c.target.value,r.letter),disabled:i==="view",required:!0}),i==="edit"&&e.jsx(B,{icon:e.jsx(oe,{}),title:"Remove Timetable Entry",onClick:()=>O(d,r.letter),disabled:r.timetables.length===1})]},d)),i==="edit"&&e.jsx(B,{icon:e.jsx(ae,{}),title:"Add Timetable Entry",onClick:()=>M(r.letter),sx:{alignSelf:"flex-start"}}),g&&e.jsx(_,{color:"error",children:g})]})}),ms=({open:b,onClose:m,formData:u,handleFeesChange:i,handleSubclassFeesChange:r,addTermFee:h,removeTermFee:M,addSubclassTermFee:O,removeSubclassTermFee:$,handleSubmit:F,isViewMode:g,setIsViewMode:Y,error:N,colors:d,theme:c})=>e.jsx(ce,{open:b,onClose:m,title:"View/Edit Fees",onConfirm:F,confirmMessage:"Save",noConfirm:g,styleProps:{padding:c.spacing(3)},children:e.jsxs(E,{sx:{display:"flex",flexDirection:"column",gap:2},children:[g&&e.jsx(X,{icon:e.jsx(fe,{}),content:"Edit Fees",onClick:()=>Y(!1),sx:{alignSelf:"flex-start",mb:2}}),e.jsx(_,{variant:"h6",children:"Class Fees Per Term"}),u.feesPerTerm.map((q,C)=>e.jsxs(E,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(S,{label:"Term Name",value:q.termName,onChange:j=>i(C,"termName",j.target.value),disabled:g,required:!0}),e.jsx(S,{label:"Amount",type:"number",value:q.amount,onChange:j=>i(C,"amount",parseFloat(j.target.value)),disabled:g,required:!0}),e.jsx(S,{label:"Description",value:q.description,onChange:j=>i(C,"description",j.target.value),disabled:g}),!g&&e.jsx(B,{icon:e.jsx(oe,{}),title:"Remove Term Fee",onClick:()=>M(C),disabled:u.feesPerTerm.length===1})]},C)),!g&&e.jsx(B,{icon:e.jsx(ae,{}),title:"Add Term Fee",onClick:h,sx:{alignSelf:"flex-start"}}),u.subclasses.map((q,C)=>e.jsxs(E,{sx:{border:`1px solid ${d.grey[500]}`,p:2,mt:2},children:[e.jsxs(_,{variant:"subtitle1",children:["Subclass ",q.letter," Fees"]}),q.feesPerTerm.map((j,L)=>e.jsxs(E,{sx:{display:"flex",gap:2,alignItems:"center",mt:1},children:[e.jsx(S,{label:"Term Name",value:j.termName,onChange:y=>r(C,L,"termName",y.target.value),disabled:g,required:!0}),e.jsx(S,{label:"Amount",type:"number",value:j.amount,onChange:y=>r(C,L,"amount",parseFloat(y.target.value)),disabled:g,required:!0}),e.jsx(S,{label:"Description",value:j.description,onChange:y=>r(C,L,"description",y.target.value),disabled:g}),!g&&e.jsx(B,{icon:e.jsx(oe,{}),title:"Remove Term Fee",onClick:()=>$(C,L),disabled:q.feesPerTerm.length===1})]},L)),!g&&e.jsx(B,{icon:e.jsx(ae,{}),title:"Add Subclass Term Fee",onClick:()=>O(C),sx:{mt:1}})]},C)),N&&e.jsx(_,{color:"error",children:N})]})});function us(b){const{children:m,value:u,index:i,...r}=b;return e.jsx("div",{role:"tabpanel",hidden:u!==i,id:`academic-year-tabpanel-${i}`,"aria-labelledby":`academic-year-tab-${i}`,...r,children:u===i&&e.jsx(E,{sx:{p:3},children:m})})}const ps=()=>{const b=ns(),m=Ke(b.palette.mode),{tableProps:u,modalOpen:i,setModalOpen:r,modalMode:h,setModalMode:M,formData:O,handleFormChange:$,handleFeesChange:F,handleSubclassFeesChange:g,addTermFee:Y,removeTermFee:N,addSubclassTermFee:d,removeSubclassTermFee:c,handleTimetableChange:q,addTimetableEntry:C,removeTimetableEntry:j,handleSubmit:L,error:y,loadingClasses:K,loadingSubmit:re,openModal:I,academicYears:p,selectedClass:v}=is(),{usersData:P}=qe(Be),[k,D]=l.useState(!1),[W,G]=l.useState(!1),[he,de]=l.useState(!1),[Ce,me]=l.useState(!1),[ue,ne]=l.useState("view"),[je,pe]=l.useState(!0),[H,Te]=l.useState(null),[ve,ye]=l.useState(0),[s,t]=l.useState(p.reduce((n,T)=>({...n,[T._id]:{page:0,rowsPerPage:5,sortBy:"section",sortDirection:"asc"}}),{}));l.useEffect(()=>{t(n=>p.reduce((A,w)=>({...A,[w._id]:n[w._id]||{page:0,rowsPerPage:5,sortBy:"section",sortDirection:"asc"}}),{}))},[p]);const a=v!=null&&v.students?P.students.filter(n=>v.students.includes(n._id)):[],o=v!=null&&v.teachers?P.teachers.filter(n=>v.teachers.includes(n._id)):[],x=(n,T)=>{ne(n),Te(T),de(!0)},f=()=>{pe(!0),me(!0)},R=(n,T)=>{ye(T)},ie=(n,T)=>{t(A=>({...A,[n]:{...A[n],page:T}}))},Pe=(n,T)=>{t(A=>({...A,[n]:{...A[n],page:0,rowsPerPage:parseInt(T.target.value,10)}}))},Ge=(n,T)=>{t(A=>{const w=A[n],Z=w.sortBy===T&&w.sortDirection==="asc"?"desc":"asc";return{...A,[n]:{...w,sortBy:T,sortDirection:Z}}})},We=n=>{const{page:T,rowsPerPage:A,sortBy:w,sortDirection:Z}=s[n]||{page:0,rowsPerPage:5,sortBy:"section",sortDirection:"asc"},ee=u.classLevels[n]||{Primary:[],Secondary:[]};console.log(`Data for year ${n}:`,ee);let z=[...ee.Primary||[]],se=[...ee.Secondary||[]];const ke=U=>U.length?U.sort((V,Q)=>{var Fe,Ne,Le,De,_e,Me;let J=V[w]??"",te=Q[w]??"";return w==="displayName"?(J=V.displayName??"",te=Q.displayName??""):w==="studentsCount"?(J=((Fe=V.students)==null?void 0:Fe.length)??0,te=((Ne=Q.students)==null?void 0:Ne.length)??0):w==="academicYear"?(J=((Le=V.academicYear)==null?void 0:Le.name)??"",te=((De=Q.academicYear)==null?void 0:De.name)??""):w==="section"&&(J=((_e=V.section)==null?void 0:_e.toLowerCase())==="primary"?0:1,te=((Me=Q.section)==null?void 0:Me.toLowerCase())==="secondary"?1:0),J<te?Z==="asc"?-1:1:J>te?Z==="asc"?1:-1:0}):U;z=ke(z),se=ke(se);let He=[...z,...se];const xe=T*A,ze=He.slice(xe,xe+A);let Ae=1,we=1;if(T>0){const U=z.slice(0,xe).length,V=se.slice(0,xe).length;Ae=U+1,we=V+1}const Ee=ze.map(U=>{var Q,J;let V;return((Q=U.section)==null?void 0:Q.toLowerCase())==="primary"?V=Ae++:((J=U.section)==null?void 0:J.toLowerCase())==="secondary"?V=we++:V=0,{...U,sn:V}});return console.log(`Paginated data for year ${n}:`,Ee),Ee};return e.jsxs(E,{children:[e.jsx(Qe,{title:"Class Management",subtitle:"Manage class levels and their details"}),e.jsxs(E,{sx:{mt:3,mb:3},children:[e.jsx(X,{icon:e.jsx(ae,{}),content:"Add Class",onClick:()=>I("create"),sx:{mb:2}}),K?e.jsx(Je,{}):e.jsx(E,{height:"75vh",sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{borderBottom:"none"},"& .MuiDataGrid-columnHeaders":{backgroundColor:m.blueAccent[700],borderBottom:"none"},"& .MuiDataGrid-virtualScroller":{backgroundColor:m.primary[400]},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:m.blueAccent[700]},"& .MuiCheckbox-root":{color:`${m.greenAccent[200]} !important`}},children:p.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{value:ve,onChange:R,"aria-label":"academic year tabs",sx:{backgroundColor:m.primary[400],"& .MuiTabs-indicator":{backgroundColor:m.blueAccent[700]}},children:p.map((n,T)=>e.jsx(Ze,{label:n.name,sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:m.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:m.primary[400]}},n._id))}),p.map((n,T)=>{var A,w,Z,ee;return e.jsx(us,{value:ve,index:T,children:e.jsx(Ie,{...u,classLevels:We(n._id),tableHeader:`Classes for ${n.name}`,page:((A=s[n._id])==null?void 0:A.page)||0,rowsPerPage:((w=s[n._id])==null?void 0:w.rowsPerPage)||5,sortBy:((Z=s[n._id])==null?void 0:Z.sortBy)||"section",sortDirection:((ee=s[n._id])==null?void 0:ee.sortDirection)||"asc",onSortChange:z=>Ge(n._id,z),onPageChange:(z,se)=>ie(n._id,se),onRowsPerPageChange:z=>Pe(n._id,z)})},n._id)})]}):e.jsx(_,{children:"No academic years available"})})]}),e.jsx(ls,{open:i,onClose:()=>r(!1),title:{create:"Create Class Level",edit:"Edit Class Level",view:"View Class Level",delete:"Delete Class Level"}[h],modalMode:h,setModal:M,formData:O,handleFormChange:$,handleFeesChange:F,handleSubclassFeesChange:g,addTermFee:Y,removeTermFee:N,addSubclassTermFee:d,removeSubclassTermFee:c,openTimetableModal:x,setStudentsModalOpen:D,setTeachersModalOpen:G,setFeesModalOpen:f,handleSubmit:L,error:y,loadingSubmit:re,academicYears:p,colors:m,theme:b}),e.jsx(os,{open:k,onClose:()=>D(!1),students:a,theme:b}),e.jsx(cs,{open:W,onClose:()=>G(!1),teachers:o,theme:b}),e.jsx(ds,{open:he,onClose:()=>de(!1),title:`${ue==="edit"?"Edit":"View"} Timetable for Subclass ${H==null?void 0:H.letter}`,timetableMode:ue,selectedSubclass:H,handleTimetableChange:q,addTimetableEntry:C,removeTimetableEntry:j,setTimetableMode:ne,handleSubmit:L,error:y,theme:b}),e.jsx(ms,{open:Ce,onClose:()=>me(!1),formData:O,handleFeesChange:F,handleSubclassFeesChange:g,addTermFee:Y,removeTermFee:N,addSubclassTermFee:d,removeSubclassTermFee:c,handleSubmit:L,isViewMode:je,setIsViewMode:pe,error:y,colors:m,theme:b})]})},Ns=rs(ps);export{Ns as default};
