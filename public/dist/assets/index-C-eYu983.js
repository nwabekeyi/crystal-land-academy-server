import{r as l,e as z,j as e,a as qe,i as Ie}from"./index-CmongNqj.js";import{M as Te,t as es,D as ss,a as as,b as ts,c as rs}from"./modal-DOkj5b5S.js";import{H as ls}from"./Header-C-IOg9fy.js";import{a as ns,b as is,T as cs}from"./table-POZbbwRY.js";import{u as ue}from"./useApi-DRHDw2QR.js";import{C as X}from"./customIconButton-BhwbxGgW.js";import{m as Fe,j as Ve,l as os,n as Ce}from"./index-CYDaGODW.js";import{w as ds}from"./dasboardPagesContainer-Dlct0AZS.js";import{A as me}from"./confirmationModal-DmU1e-AI.js";import{c as Ye,L as Je,a as We}from"./index-DlEtA_4g.js";import{a as us}from"./index-B8oAjlv9.js";import{v as D,T as N,a3 as H,y as ie,a1 as ce,a2 as oe,w as Ge,j as ms,x as Re}from"./TextField-BRCl01nD.js";import{M as y}from"./MenuItem-CBa9F7RL.js";import"./IconButton-BxixnWx-.js";import"./useMediaQuery-GijD3KK4.js";import"./index-Cdxudna_.js";import"./loadingButton-Cu9NSFum.js";import"./CircularProgress-CJ7ctfkv.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-Ctrqk4ly.js";const hs=({userId:S})=>{const[T,A]=l.useState(!1),[g,b]=l.useState("create"),[c,R]=l.useState(null),[M,B]=l.useState(!1),[_,K]=l.useState({teachers:[],subclasses:[],availableSubclasses:[]}),[Q,i]=l.useState(""),[Y,V]=l.useState(!1),[L,C]=l.useState(null),[E,se]=l.useState(""),[x,he]=l.useState([]),[$,U]=l.useState(0),[O,ae]=l.useState(5),[F,f]=l.useState(0),[J,I]=l.useState([]),[W,te]=l.useState([]),[re,u]=l.useState([]),[j,w]=l.useState([]),{loading:P,error:h,callApi:Z}=ue(),{loading:ke,error:pe,callApi:ve}=ue(),{loading:Ee,error:ge,callApi:ye}=ue(),{loading:Pe,error:be,callApi:Ae}=ue(),{loading:Ne,error:ee,callApi:le}=ue(),{loading:Me,error:je,callApi:Se}=ue();l.useEffect(()=>{(async()=>{try{const r=await Se(z.TEACHERS,"GET");r.status==="success"?w(Array.isArray(r.data.data)?r.data.data:[]):(i("Failed to fetch teachers"),w([]))}catch(r){i(je||r.message||"Failed to fetch teachers"),w([])}})()},[Se,je]),l.useEffect(()=>{const s=new URLSearchParams;s.append("page",($+1).toString()),s.append("limit",O.toString()),E&&s.append("section",E),x.length>0&&s.append("classLevels",x.join(",")),(async()=>{var a;try{const t=await Z(`${z.CLASS_LEVEL}?${s.toString()}`,"GET"),o=await ve(z.ACADEMIC_YEARS,"GET"),d=await ye(z.SUBJECT,"GET");(a=t==null?void 0:t.data)!=null&&a.data&&(I(t.data.data),f(t.data.totalPages||0)),o!=null&&o.data&&te(o.data),d!=null&&d.data&&u(d.data)}catch(t){i(h||pe||ge||t.message||"Failed to fetch data")}})()},[Z,ve,ye,$,O,E,x,h,pe,ge]),l.useEffect(()=>{$>=F&&F>0&&U(0)},[$,F]);const[v,G]=l.useState({section:"Primary",name:"",description:"",academicYear:"",subclasses:[{letter:"A",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],subjects:[]}],teachers:[]});l.useEffect(()=>{var s;if(W.length>0&&!v.academicYear&&g==="create"){const r=((s=W.find(a=>a.isCurrent))==null?void 0:s._id)||"";G(a=>({...a,academicYear:r}))}},[W,v,g]);const $e=l.useMemo(()=>{var r;if(!c||!Array.isArray(j))return[];const s=((r=c.teachers)==null?void 0:r.map(a=>a.teacherId.toString()))||[];return j.filter(a=>a._id&&!s.includes(a._id.toString()))},[j,c]),we=l.useCallback(()=>{var s,r;c?(K({teachers:((s=c.teachers)==null?void 0:s.map(a=>{var t,o;return{teacherId:a.teacherId,firstName:a.firstName||((t=a.name)==null?void 0:t.split(" ")[0])||"",lastName:a.lastName||((o=a.name)==null?void 0:o.split(" ").slice(1).join(" "))||""}}))||[],subclasses:c.subclasses.map(a=>({letter:a.letter,subjects:a.subjects.map(t=>({subjectId:t.subject,teacherIds:t.teachers||[]}))})),availableSubclasses:((r=c.subclasses)==null?void 0:r.map(a=>a.letter))||[]}),B(!0)):i("No class selected for teacher assignment")},[c]),de=l.useCallback((s,r=null)=>{var a,t,o,d;b(s),R(r),s==="create"?G({section:"Primary",name:"",description:"",academicYear:((a=W.find(n=>n.isCurrent))==null?void 0:a._id)||"",subclasses:[{letter:"A",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],subjects:[]}],teachers:[]}):r&&G({section:r.section||"Primary",name:r.name||"",description:r.description||"",academicYear:((t=r.academicYear)==null?void 0:t._id)||r.academicYear||"",subclasses:((o=r.subclasses)==null?void 0:o.map(n=>{var m;return{letter:n.letter,feesPerTerm:n.feesPerTerm||[{termName:"1st Term",amount:0,description:""}],subjects:((m=n.subjects)==null?void 0:m.map(k=>({subject:k.subject,teachers:k.teachers||[]})))||[]}}))||[{letter:"A",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],subjects:[]}],teachers:((d=r.teachers)==null?void 0:d.map(n=>{var m,k;return{teacherId:n.teacherId,firstName:n.firstName||((m=n.name)==null?void 0:m.split(" ")[0])||"",lastName:n.lastName||((k=n.name)==null?void 0:k.split(" ").slice(1).join(" "))||""}}))||[]}),A(!0)},[W]),_e=l.useCallback(s=>{C(s),V(!0)},[]),xe=l.useCallback(()=>{C(null),V(!1)},[]),De=l.useCallback(async()=>{var s;if(!L||!S){i("User not authenticated or no class selected for deletion");return}try{if(await le(`${z.CLASS_LEVEL}/${L._id}`,"DELETE")){const a=new URLSearchParams;a.append("page",($+1).toString()),a.append("limit",O.toString()),E&&a.append("section",E),x.length>0&&a.append("classLevels",x.join(","));const t=await Z(`${z.CLASS_LEVEL}?${a.toString()}`,"GET");(s=t==null?void 0:t.data)!=null&&s.data&&(I(t.data.data),f(t.data.totalPages||0)),i(""),xe()}}catch(r){i(ee||r.message||"Failed to delete class")}},[L,S,le,Z,ee,xe,$,O,E,x]),p=l.useCallback(s=>{const{name:r,value:a}=s.target;G(t=>({...t,[r]:a}))},[]),q=l.useCallback((s,r,a,t)=>{G(o=>{const d=[...o.subclasses],n=[...d[s].feesPerTerm];return n[r]={...n[r],[a]:a==="amount"?parseFloat(t)||0:t},d[s]={...d[s],feesPerTerm:n},{...o,subclasses:d}})},[]),ne=l.useCallback(s=>{G(r=>{const a=[...r.subclasses];return a[s]={...a[s],feesPerTerm:[...a[s].feesPerTerm,{termName:`${a[s].feesPerTerm.length+1}st Term`,amount:0,description:""}]},{...r,subclasses:a}})},[]),Le=l.useCallback((s,r)=>{G(a=>{const t=[...a.subclasses];return t[s]={...t[s],feesPerTerm:t[s].feesPerTerm.filter((o,d)=>d!==r)},{...a,subclasses:t}})},[]),Be=l.useCallback((s,r,a,t)=>{G(o=>{const d=[...o.subclasses],n=[...d[s].subjects];return n[r]={...n[r],[a]:t},d[s]={...d[s],subjects:n},{...o,subclasses:d}})},[]),Ue=l.useCallback(s=>{G(r=>{const a=[...r.subclasses];return a[s]={...a[s],subjects:[...a[s].subjects,{subject:"",teachers:[]}]},{...r,subclasses:a}})},[]),He=l.useCallback((s,r)=>{G(a=>{const t=[...a.subclasses];return t[s]={...t[s],subjects:t[s].subjects.filter((o,d)=>d!==r)},{...a,subclasses:t}})},[]),Ke=l.useCallback(s=>{const r=s.map(a=>{const t=j.find(o=>o._id.toString()===a.toString());return{teacherId:a,firstName:(t==null?void 0:t.firstName)||"",lastName:(t==null?void 0:t.lastName)||""}});G(a=>({...a,teachers:r}))},[j]),Ze=l.useCallback((s,r,a)=>{K(t=>{const o=c&&["JSS","SS"].includes(c.section);let d=[...t.teachers],n=[...t.subclasses];return o&&s&&r&&a?n=n.map(m=>{if(m.letter===r){const k=m.subjects.map(fe=>fe.subjectId===a?{...fe,teacherIds:s}:fe);return{...m,subjects:k}}return m}):o||(d=s.map(m=>{const k=j.find(fe=>fe._id.toString()===m.toString());return{teacherId:m,firstName:(k==null?void 0:k.firstName)||"",lastName:(k==null?void 0:k.lastName)||""}})),{...t,teachers:d,subclasses:n}})},[c,j]),ze=l.useCallback(async()=>{var r,a;if(!c||!S){i("User not authenticated or no class selected");return}if(_.teachers.length===0){i("At least one teacher must be selected");return}const s=["JSS","SS"].includes(c.section);if(s&&!_.subclasses.every(t=>t.subjects.some(o=>o.teacherIds.length>0))){i("At least one subject must be assigned to a teacher for each subclass in JSS/SS classes");return}try{const t=((r=c.subclasses)==null?void 0:r.map(n=>n.letter))||[];for(const n of _.subclasses){if(!t.includes(n.letter)){i(`Invalid subclass letter: ${n.letter}`);return}if(s&&n.subjects){for(const m of n.subjects)if(!m.subjectId||!re.some(k=>k._id.toString()===m.subjectId.toString())){i(`Invalid subject ID: ${m.subjectId}`);return}}}const o={classId:c._id,teacherIds:s?[...new Set(_.subclasses.flatMap(n=>n.subjects.flatMap(m=>m.teacherIds)))].map(n=>{const m=j.find(k=>k._id.toString()===n.toString());return{teacherId:n,firstName:(m==null?void 0:m.firstName)||"",lastName:(m==null?void 0:m.lastName)||""}}):_.teachers,subclasses:_.subclasses};if(await Ae(`${z.CLASS_LEVEL}/${c._id}/assign-teachers`,"PATCH",o)){const n=new URLSearchParams;n.append("page",($+1).toString()),n.append("limit",O.toString()),E&&n.append("section",E),x.length>0&&n.append("classLevels",x.join(","));const m=await Z(`${z.CLASS_LEVEL}?${n.toString()}`,"GET");(a=m==null?void 0:m.data)!=null&&a.data&&(I(m.data.data),f(m.data.totalPages||0)),B(!1),i("")}}catch(t){i(be||t.message||"Failed to assign teachers")}},[c,S,_,Ae,Z,be,$,O,E,x,j,re]),Oe=l.useCallback(()=>{if(!S)return"User not authenticated. Please log in.";if(!v.section)return"Section is required";if(!v.name)return"Class name is required";if(!v.academicYear)return"Academic year is required";if(!v.subclasses.every(s=>s.letter.match(/^[A-Z]$/)))return"All subclasses must have a single capital letter";if(!v.subclasses.every(s=>s.feesPerTerm.every(r=>r.termName&&r.amount>=0)))return"All subclass fees must have a term name and a valid amount";if(["SS 1","SS 2","SS 3"].includes(v.name)){if(!v.subclasses.every(s=>s.subjects.every(r=>r.subject&&r.teachers.length>0)))return"All subjects in SS classes must have a subject ID and at least one teacher"}else if(v.subclasses.some(s=>s.subjects.length>0))return"Subjects are not allowed for non-SS classes";return""},[v,S]),Qe=l.useCallback(async()=>{var a;const s=Oe();if(s){i(s);return}const r={section:v.section,name:v.name,description:v.description,academicYear:v.academicYear,subclasses:v.subclasses.map(t=>({letter:t.letter,feesPerTerm:t.feesPerTerm,subjects:t.subjects})),teachers:v.teachers,createdBy:S};try{let t;if(g==="create"?t=await le(z.CLASS_LEVEL,"POST",r):g==="edit"&&(t=await le(`${z.CLASS_LEVEL}/${c._id}`,"PATCH",r)),t){const o=new URLSearchParams;o.append("page",($+1).toString()),o.append("limit",O.toString()),E&&o.append("section",E),x.length>0&&o.append("classLevels",x.join(","));const d=await Z(`${z.CLASS_LEVEL}?${o.toString()}`,"GET");(a=d==null?void 0:d.data)!=null&&a.data&&(I(d.data.data),f(d.data.totalPages||0)),A(!1),i("")}}catch(t){i(ee||t.message||"Failed to process request")}},[g,v,c,le,Z,ee,Oe,S,$,O,E,x]),Xe=l.useMemo(()=>Array.isArray(J)?J.map((s,r)=>{var a,t,o,d;return{...s,sn:r+1+$*O,displayName:s.name,studentsCount:((a=s.students)==null?void 0:a.length)||0,teachersCount:((t=s.teachers)==null?void 0:t.length)||0,academicYearName:((o=W.find(n=>n._id===s.academicYear))==null?void 0:o._id)||"N/A",subclassesCount:((d=s.subclasses)==null?void 0:d.length)||0}}):[],[J,W,$,O]);return{tableProps:{columns:l.useMemo(()=>[{id:"sn",label:"S/N",width:90},{id:"displayName",label:"Class Name",flex:1,renderCell:s=>s.displayName},{id:"studentsCount",label:"Students",flex:1,renderCell:s=>s.studentsCount},{id:"teachersCount",label:"Teachers",flex:1,renderCell:s=>s.teachersCount},{id:"subclassesCount",label:"Subclasses",flex:1,renderCell:s=>s.subclassesCount},{id:"academicYearName",label:"Academic Year",flex:1,renderCell:s=>s.academicYearName},{id:"actions",label:"Actions",flex:1,renderCell:s=>e.jsxs(e.Fragment,{children:[e.jsx(X,{icon:e.jsx(Fe,{}),title:"View Class",onClick:()=>de("view",s),sx:{mx:.5}}),e.jsx(X,{icon:e.jsx(Ve,{}),title:"Edit Class",onClick:()=>de("edit",s),sx:{mx:.5}}),e.jsx(X,{icon:e.jsx(os,{}),title:"Delete Class",onClick:()=>_e(s),sx:{mx:.5}})]})}],[de,_e]),tableHeader:"Class Management",data:Xe,sortBy:"displayName",sortDirection:"asc",onSortChange:()=>{},hiddenColumnsSmallScreen:["description"],hiddenColumnsTabScreen:[],academicYears:W},modalOpen:T,setModalOpen:A,modalMode:g,setModalMode:b,formData:v,setFormData:G,handleFormChange:p,handleSubclassFeesChange:q,addSubclassTermFee:ne,removeSubclassTermFee:Le,handleSubclassSubjectChange:Be,addSubclassSubject:Ue,removeSubclassSubject:He,handleTeacherChange:Ke,handleSubmit:Qe,error:h||pe||ge||ee||be||je||Q,loading:P||ke||Ee||Ne||Pe||Me,openModal:de,academicYears:W,classLevels:J,subjects:re,allTeachers:j,availableTeachers:$e,selectedClass:c,deleteConfirmOpen:Y,classToDelete:L,handleDelete:De,closeDeleteConfirm:xe,loadingSubmit:Ne,sectionFilter:E,setSectionFilter:se,classLevelsFilter:x,setClassLevelsFilter:he,page:$,setPage:U,rowsPerPage:O,setRowsPerPage:ae,totalPages:F,assignTeachersModalOpen:M,setAssignTeachersModalOpen:B,assignTeachersFormData:_,handleAssignTeachersChange:Ze,handleAssignTeachers:ze,openAssignTeachersModal:we,loadingAssignTeachers:Pe}},ps=({open:S,onClose:T,title:A,modalMode:g,setModalMode:b,formData:c,handleFormChange:R,handleSubclassFeesChange:M,handleSubclassSubjectChange:B,addSubclassTermFee:_,removeSubclassTermFee:K,addSubclassSubject:Q,removeSubclassSubject:i,handleTeacherChange:Y,setStudentsModalOpen:V,setTeachersModalOpen:L,setFeesModalOpen:C,setAssignTeachersModalOpen:E,handleSubmit:se,error:x,loadingSubmit:he,academicYears:$,usersData:U,subjects:O,colors:ae,theme:F})=>{const f=g==="view",J=g==="delete",I=["SS 1","SS 2","SS 3"].includes(c.name),W=["Kindergarten","Reception","Nursery 1","Nursery 2","Primary 1","Primary 2","Primary 3","Primary 4","Primary 5","Primary 6"],te=["JSS 1","JSS 2","JSS 3","SS 1","SS 2","SS 3"],re=c.section==="Primary"?W:te;return e.jsx(Te,{open:S,onClose:T,title:A,onConfirm:se,confirmMessage:J?"Confirm Delete":"Save",cancelMessage:"Cancel",noConfirm:f,styleProps:{padding:F.spacing(3)},children:J?e.jsxs(D,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(N,{variant:"h6",color:"error",children:"Confirm Deletion"}),e.jsxs(N,{children:["Are you sure you want to delete the class ",e.jsx("strong",{children:c.name}),"? This action cannot be undone."]}),x&&e.jsx(N,{color:"error",children:x})]}):e.jsxs(D,{component:"form",sx:{display:"flex",flexDirection:"column",gap:2},children:[f&&e.jsx(me,{icon:e.jsx(Ve,{}),content:"Edit",onClick:()=>b("edit"),sx:{alignSelf:"flex-start",mb:2}}),e.jsxs(H,{label:"Section",name:"section",value:c.section,onChange:u=>{R(u),R({target:{name:"name",value:""}})},fullWidth:!0,disabled:f,required:!0,children:[e.jsx(y,{value:"Primary",children:"Primary"}),e.jsx(y,{value:"Secondary",children:"Secondary"})]}),e.jsxs(H,{label:"Class Name",name:"name",value:c.name,onChange:R,fullWidth:!0,disabled:f||!c.section,required:!0,children:[e.jsx(y,{value:"",disabled:!0,children:"Select a class"}),re.map(u=>e.jsx(y,{value:u,children:u},u))]}),e.jsxs(H,{label:"Academic Year",name:"academicYear",value:c.academicYear,onChange:R,fullWidth:!0,disabled:f,required:!0,children:[e.jsx(y,{value:"",disabled:!0,children:"Select an academic year"}),$.map(u=>e.jsx(y,{value:u._id,children:u.name},u._id))]}),e.jsx(ie,{label:"Description",name:"description",value:c.description,onChange:R,fullWidth:!0,disabled:f,multiline:!0,rows:3}),e.jsxs(ce,{children:[e.jsx(oe,{children:"Teachers"}),e.jsx(H,{multiple:!0,value:c.teachers.map(u=>u.teacherId||u),onChange:u=>Y(u.target.value.map(j=>{var w,P;return{teacherId:j,name:((w=U.teachers.find(h=>h._id===j))==null?void 0:w.firstName)+" "+((P=U.teachers.find(h=>h._id===j))==null?void 0:P.lastName)}})),disabled:f,children:U.teachers.map(u=>e.jsx(y,{value:u._id,children:`${u.firstName} ${u.lastName}`},u._id))})]}),e.jsx(N,{variant:"h6",children:"Subclasses"}),c.subclasses.map((u,j)=>e.jsxs(D,{sx:{border:`1px solid ${ae.grey[500]}`,p:2,mb:2},children:[e.jsx(ie,{label:"Subclass Letter",value:u.letter,onChange:w=>{const P=[...c.subclasses];P[j].letter=w.target.value.toUpperCase(),setFormData({...c,subclasses:P})},disabled:f,required:!0,inputProps:{maxLength:1,pattern:"[A-Z]"}}),e.jsx(N,{variant:"subtitle2",children:"Fees Per Term"}),u.feesPerTerm.map((w,P)=>e.jsxs(D,{sx:{display:"flex",gap:2,alignItems:"center",mt:1},children:[e.jsxs(H,{label:"Term Name",value:w.termName,onChange:h=>M(j,P,"termName",h.target.value),disabled:f,required:!0,children:[e.jsx(y,{value:"1st Term",children:"1st Term"}),e.jsx(y,{value:"2nd Term",children:"2nd Term"}),e.jsx(y,{value:"3rd Term",children:"3rd Term"})]}),e.jsx(ie,{label:"Amount",type:"number",value:w.amount,onChange:h=>M(j,P,"amount",parseFloat(h.target.value)),disabled:f,required:!0}),e.jsx(ie,{label:"Description",value:w.description,onChange:h=>M(j,P,"description",h.target.value),disabled:f}),!f&&e.jsx(X,{icon:e.jsx(Ye,{}),title:"Remove Term Fee",onClick:()=>K(j,P),disabled:u.feesPerTerm.length===1})]},P)),!f&&e.jsx(X,{icon:e.jsx(Ce,{}),title:"Add Subclass Term Fee",onClick:()=>_(j),sx:{mt:1}}),I&&e.jsxs(e.Fragment,{children:[e.jsx(N,{variant:"subtitle2",children:"Subjects"}),u.subjects.map((w,P)=>e.jsxs(D,{sx:{display:"flex",gap:2,alignItems:"center",mt:1},children:[e.jsxs(H,{label:"Subject",value:w.subject,onChange:h=>B(j,P,"subject",h.target.value),disabled:f,required:!0,children:[e.jsx(y,{value:"",disabled:!0,children:"Select a subject"}),O.map(h=>e.jsx(y,{value:h._id,children:h.name},h._id))]}),e.jsxs(ce,{sx:{minWidth:200},children:[e.jsx(oe,{children:"Teachers"}),e.jsx(H,{multiple:!0,value:w.teachers,onChange:h=>B(j,P,"teachers",h.target.value),disabled:f,required:!0,children:U.teachers.map(h=>e.jsx(y,{value:h._id,children:`${h.firstName} ${h.lastName}`},h._id))})]}),!f&&e.jsx(X,{icon:e.jsx(Ye,{}),title:"Remove Subject",onClick:()=>i(j,P)})]},P)),!f&&e.jsx(X,{icon:e.jsx(Ce,{}),title:"Add Subject",onClick:()=>Q(j),sx:{mt:1}})]})]},j)),!f&&e.jsx(X,{icon:e.jsx(Ce,{}),title:"Add Subclass",onClick:()=>{setFormData(u=>({...u,subclasses:[...u.subclasses,{letter:String.fromCharCode(65+u.subclasses.length),feesPerTerm:[{termName:"1st Term",amount:0,description:""}],subjects:[]}]}))},sx:{mt:1}}),f&&e.jsxs(D,{sx:{display:"flex",gap:2,mt:2},children:[e.jsx(me,{icon:e.jsx(Fe,{}),content:"View Students",onClick:()=>V(!0),sx:{mx:.5}}),e.jsx(me,{icon:e.jsx(Fe,{}),content:"View Teachers",onClick:()=>L(!0),sx:{mx:.5}}),e.jsx(me,{icon:e.jsx(Fe,{}),content:"View Fees",onClick:()=>C(!0),sx:{mx:.5}}),e.jsx(me,{icon:e.jsx(us,{}),content:"Assign Teachers",onClick:()=>E(!0),sx:{mx:.5}})]}),x&&e.jsx(N,{color:"error",children:x}),he&&!J&&e.jsx(N,{children:"Processing..."})]})})},gs=({open:S,onClose:T,students:A,theme:g})=>e.jsx(Te,{open:S,onClose:T,title:"Students",noConfirm:!0,styleProps:{padding:g.spacing(3)},children:A.length>0?e.jsx(Ge,{children:A.map(b=>e.jsx(Je,{children:e.jsx(We,{primary:`${b.firstName} ${b.lastName}`,secondary:`Email: ${b.email}${b.phone?` | Phone: ${b.phone}`:""}`})},b._id))}):e.jsx(N,{children:"No students assigned to this class."})}),bs=({open:S,onClose:T,teachers:A,theme:g})=>e.jsx(Te,{open:S,onClose:T,title:"Teachers",noConfirm:!0,styleProps:{padding:g.spacing(3)},children:A.length>0?e.jsx(Ge,{children:A.map(b=>e.jsx(Je,{children:e.jsx(We,{primary:`${b.firstName} ${b.lastName}`,secondary:`Email: ${b.email}${b.phone?` | Phone: ${b.phone}`:""}`})},b._id))}):e.jsx(N,{children:"No teachers assigned to this class."})}),js=({open:S,onClose:T,formData:A,handleSubclassFeesChange:g,addSubclassTermFee:b,removeSubclassTermFee:c,handleSubmit:R,isViewMode:M,setIsViewMode:B,error:_,colors:K,theme:Q})=>e.jsx(Te,{open:S,onClose:T,title:"View Fees",onConfirm:R,confirmMessage:"Save",noConfirm:M,styleProps:{padding:Q.spacing(3)},children:e.jsxs(D,{sx:{display:"flex",flexDirection:"column",gap:2},children:[A.subclasses.map((i,Y)=>e.jsxs(D,{sx:{border:`1px solid ${K.grey[500]}`,p:2,mt:2},children:[e.jsxs(N,{variant:"subtitle1",children:["Subclass ",i.letter," Fees"]}),i.feesPerTerm.map((V,L)=>e.jsxs(D,{sx:{display:"flex",gap:2,alignItems:"center",mt:1},children:[e.jsx(ie,{label:"Term Name",value:V.termName,onChange:C=>g(Y,L,"termName",C.target.value),disabled:M,required:!0}),e.jsx(ie,{label:"Amount",type:"number",value:V.amount,onChange:C=>g(Y,L,"amount",parseFloat(C.target.value)),disabled:M,required:!0}),e.jsx(ie,{label:"Description",value:V.description,onChange:C=>g(Y,L,"description",C.target.value),disabled:M}),!M&&e.jsx(X,{icon:e.jsx(Ye,{}),title:"Remove Term Fee",onClick:()=>c(Y,L),disabled:i.feesPerTerm.length===1})]},L)),!M&&e.jsx(X,{icon:e.jsx(Ce,{}),title:"Add Subclass Term Fee",onClick:()=>b(Y),sx:{mt:1}})]},Y)),_&&e.jsx(N,{color:"error",children:_})]})}),Ss=({open:S,onClose:T,classId:A,formData:g,usersData:b,subjects:c,handleAssignTeachersChange:R,handleAssignTeachers:M,error:B,loading:_,theme:K})=>{const Q=g.section&&["JSS","SS"].includes(g.section.split(" ")[0]);return e.jsx(Te,{open:S,onClose:T,title:"Assign Teachers",onConfirm:M,confirmMessage:"Assign",cancelMessage:"Cancel",styleProps:{padding:K.spacing(3)},children:e.jsxs(D,{sx:{display:"flex",flexDirection:"column",gap:2},children:[Q?g.subclasses.map((i,Y)=>e.jsxs(D,{sx:{border:`1px solid ${K.palette.grey[500]}`,p:2,mb:2},children:[e.jsxs(N,{variant:"subtitle1",children:["Subclass ",i.letter]}),i.subjects.map((V,L)=>e.jsxs(D,{sx:{display:"flex",gap:2,alignItems:"center",mt:1},children:[e.jsxs(ce,{fullWidth:!0,children:[e.jsx(oe,{children:"Subject"}),e.jsxs(H,{value:V.subjectId||"",onChange:C=>R(null,i.letter,C.target.value,Y,L,"subjectId"),required:!0,children:[e.jsx(y,{value:"",disabled:!0,children:"Select a subject"}),c.map(C=>e.jsx(y,{value:C._id,children:C.name},C._id))]})]}),e.jsxs(ce,{fullWidth:!0,children:[e.jsx(oe,{children:"Teachers"}),e.jsx(H,{multiple:!0,value:V.teacherIds||[],onChange:C=>R(C.target.value,i.letter,V.subjectId,Y,L,"teacherIds"),required:!0,children:b.teachers.map(C=>e.jsx(y,{value:C._id,children:`${C.firstName} ${C.lastName}`},C._id))})]})]},L))]},i.letter)):e.jsxs(ce,{fullWidth:!0,children:[e.jsx(oe,{children:"Teachers"}),e.jsx(H,{multiple:!0,value:g.teachers.map(i=>i.teacherId||i),onChange:i=>R(i.target.value),required:!0,children:b.teachers.map(i=>e.jsx(y,{value:i._id,children:`${i.firstName} ${i.lastName}`},i._id))})]}),B&&e.jsx(N,{color:"error",children:B}),_&&e.jsx(N,{children:"Assigning..."})]})})};function xs(S){const{children:T,value:A,index:g,...b}=S;return e.jsx("div",{role:"tabpanel",hidden:A!==g,id:`academic-year-tabpanel-${g}`,"aria-labelledby":`academic-year-tab-${g}`,...b,children:A===g&&e.jsx(D,{sx:{p:3},children:T})})}const fs=()=>{const S=ms(),T=es(S.palette.mode),{usersData:A}=qe(p=>p.adminData),g=qe(p=>{var q;return(q=p.users.user)==null?void 0:q._id})||"",{tableProps:b,modalOpen:c,setModalOpen:R,modalMode:M,setModalMode:B,formData:_,handleFormChange:K,handleSubclassFeesChange:Q,addSubclassTermFee:i,removeSubclassTermFee:Y,handleSubclassSubjectChange:V,addSubclassSubject:L,removeSubclassSubject:C,handleTeacherChange:E,handleSubmit:se,error:x,loading:he,openModal:$,academicYears:U,subjects:O,allTeachers:ae,selectedClass:F,deleteConfirmOpen:f,classToDelete:J,handleDelete:I,closeDeleteConfirm:W,loadingSubmit:te,sectionFilter:re,setSectionFilter:u,classLevelsFilter:j,setClassLevelsFilter:w,page:P,setPage:h,rowsPerPage:Z,setRowsPerPage:ke,totalPages:pe,assignTeachersModalOpen:ve,setAssignTeachersModalOpen:Ee,assignTeachersFormData:ge,handleAssignTeachersChange:ye,handleAssignTeachers:Pe,openAssignTeachersModal:be,loadingAssignTeachers:Ae}=hs({userId:g}),[Ne,ee]=l.useState(!1),[le,Me]=l.useState(!1),[je,Se]=l.useState(!1),[v,G]=l.useState(0),$e=F!=null&&F.students?A.students.filter(p=>F.students.some(q=>q.toString()===p._id)):[],we=F!=null&&F.teachers?ae.filter(p=>F.teachers.some(q=>{var ne;return((ne=q.teacherId)==null?void 0:ne.toString())===p._id||q.toString()===p._id})):[],de=()=>{Se(!0)},_e=(p,q)=>{G(q),h(0)},xe=(p,q)=>{h(q)},De=p=>{ke(parseInt(p.target.value,10)),h(0)};return e.jsxs(D,{children:[e.jsx(ls,{title:"Class Management",subtitle:"Manage class levels and their details"}),e.jsxs(D,{sx:{mt:3,mb:3},children:[e.jsxs(D,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(me,{icon:e.jsx(Ce,{}),content:"Add Class",onClick:()=>$("create")}),e.jsxs(ce,{sx:{minWidth:120},children:[e.jsx(oe,{children:"Section"}),e.jsxs(H,{value:re,onChange:p=>u(p.target.value),label:"Section",children:[e.jsx(y,{value:"",children:"All Sections"}),e.jsx(y,{value:"Primary",children:"Primary"}),e.jsx(y,{value:"Secondary",children:"Secondary"})]})]}),e.jsxs(ce,{sx:{minWidth:200},children:[e.jsx(oe,{children:"Class Levels"}),e.jsx(H,{multiple:!0,value:j,onChange:p=>w(p.target.value),label:"Class Levels",children:["Kindergarten","Reception","Nursery 1","Nursery 2","Primary 1","Primary 2","Primary 3","Primary 4","Primary 5","Primary 6","JSS 1","JSS 2","JSS 3","SS 1","SS 2","SS 3"].map(p=>e.jsx(y,{value:p,children:p},p))})]})]}),he?e.jsx(Ie,{}):x?e.jsx(N,{color:"error",children:x}):e.jsx(D,{height:"75vh",sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{borderBottom:"none"},"& .MuiDataGrid-columnHeaders":{backgroundColor:T.blueAccent[700],borderBottom:"none"},"& .MuiDataGrid-virtualScroller":{backgroundColor:T.primary[400]},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:T.blueAccent[700]},"& .MuiCheckbox-root":{color:`${T.greenAccent[200]} !important`}},children:U.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ns,{value:v,onChange:_e,"aria-label":"academic year tabs",variant:"scrollable",scrollButtons:"auto",sx:{backgroundColor:T.primary[400],"& .MuiTabs-indicator":{backgroundColor:T.blueAccent[700]}},children:U.map((p,q)=>e.jsx(is,{label:p.name,sx:{color:"white !important",textTransform:"none",fontWeight:"bold",minWidth:160,width:160,"&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:T.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:T.primary[400]}},p._id))}),U.map((p,q)=>e.jsx(xs,{value:v,index:q,children:e.jsx(cs,{...b,data:b.data.filter(ne=>{var Le;return ne.academicYear===p._id||((Le=ne.academicYear)==null?void 0:Le._id)===p._id}),tableHeader:`Classes for ${p.name}`,page:P,rowsPerPage:Z,count:pe*Z,onPageChange:xe,onRowsPerPageChange:De})},p._id))]}):e.jsx(N,{children:"No academic years available"})})]}),e.jsx(ps,{open:c,onClose:()=>R(!1),title:{create:"Create Class Level",edit:"Edit Class Level",view:"View Class Level",delete:"Delete Class Level"}[M],modalMode:M,setModalMode:B,formData:_,handleFormChange:K,handleSubclassFeesChange:Q,handleSubclassSubjectChange:V,addSubclassTermFee:i,removeSubclassTermFee:Y,addSubclassSubject:L,removeSubclassSubject:C,handleTeacherChange:E,setStudentsModalOpen:ee,setTeachersModalOpen:Me,setFeesModalOpen:de,setAssignTeachersModalOpen:be,handleSubmit:se,error:x,loadingSubmit:te,academicYears:U,usersData:{teachers:ae},subjects:O,colors:T,theme:S}),e.jsx(gs,{open:Ne,onClose:()=>ee(!1),students:$e,theme:S}),e.jsx(bs,{open:le,onClose:()=>Me(!1),teachers:we,theme:S}),e.jsx(js,{open:je,onClose:()=>Se(!1),formData:_,handleSubclassFeesChange:Q,addSubclassTermFee:i,removeSubclassTermFee:Y,handleSubmit:se,isViewMode:M==="view",setIsViewMode:B,error:x,colors:T,theme:S}),e.jsx(Ss,{open:ve,onClose:()=>Ee(!1),classId:F==null?void 0:F._id,formData:ge,usersData:{teachers:ae},subjects:O,handleAssignTeachersChange:ye,handleAssignTeachers:Pe,error:x,loading:Ae,theme:S}),e.jsxs(ss,{open:f,onClose:W,"aria-labelledby":"delete-confirm-dialog-title","aria-describedby":"delete-confirm-dialog-description",children:[e.jsx(as,{id:"delete-confirm-dialog-title",children:"Confirm Deletion"}),e.jsxs(ts,{children:[e.jsxs(N,{id:"delete-confirm-dialog-description",children:["Are you sure you want to delete the class ",e.jsx("strong",{children:J==null?void 0:J.name}),"? This action cannot be undone."]}),x&&e.jsx(N,{color:"error",sx:{mt:2},children:x})]}),e.jsxs(rs,{children:[e.jsx(Re,{onClick:W,color:"secondary",children:"Cancel"}),e.jsx(Re,{onClick:I,color:"error",variant:"contained",disabled:te,children:te?"Deleting...":"Delete"})]})]})]})},Ws=ds(fs);export{Ws as default};
