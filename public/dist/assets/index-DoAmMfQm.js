import{r as i,f as y,j as e,a as Ds}from"./index-DYB9vdJh.js";import{M as je,t as Ns}from"./modal-Dt9KnTX1.js";import{H as us}from"./Header-AXN3siQS.js";import{a as ks,b as ms,T as Oe}from"./table-DpmIgZH_.js";import{w as Es}from"./dasboardPagesContainer-D4ZABES0.js";import{u as E}from"./useApi-BEUY4qmG.js";import{G as h,U as Ls}from"./index-H39KJanZ.js";import{v as T,T as S,y as $,a1 as H,a2 as Y,a3 as U,x as q,j as $s}from"./TextField-Dq7C8pjc.js";import{M as A}from"./MenuItem-BsLcltYv.js";import{C as ws}from"./confirmationModal-CAE5W3-f.js";import"./IconButton-Dp3Riz_a.js";import"./useMediaQuery-BDV9TRV9.js";import"./index-DG_QlDDe.js";import"./loadingButton-BBKAh30x.js";import"./CircularProgress-pT4wBbD6.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-DWslFdTP.js";const qs=({userId:j})=>{const[C,t]=i.useState(0),[d,x]=i.useState(""),[b,G]=i.useState(""),[F,Q]=i.useState(!1),[ie,X]=i.useState(!1),[w,_]=i.useState(!1),[a,M]=i.useState(!1),[ce,D]=i.useState(!1),[Ce,N]=i.useState(!1),[de,k]=i.useState(""),[ue,me]=i.useState(null),[O,z]=i.useState(null),[B,V]=i.useState(null),[f,P]=i.useState(null),[r,g]=i.useState([]),[p,K]=i.useState({question:"",optionA:"",optionB:"",optionC:"",optionD:"",correctAnswer:"",score:""}),[u,te]=i.useState({name:"",description:"",subject:"",classLevel:"",subclassLetter:[],passMark:"",totalMark:"",duration:"",examDate:"",examTime:"",examType:"test",academicTerm:"",academicYear:""}),[pe,Te]=i.useState([]),[xe,Be]=i.useState([]),[he,Pe]=i.useState([]),[I,We]=i.useState([]),[Re,v]=i.useState(""),{data:ae,loading:He,error:Me,callApi:ye}=E(),{data:ne,loading:Ye,error:_e,callApi:De}=E(),{data:Z,loading:Ue,error:Ne,callApi:ke}=E(),{data:re,loading:Ge,error:Ee,callApi:be}=E(),{data:fe,loading:Le,error:o,callApi:L}=E(),{data:W,loading:Fe,error:le,callApi:Xe}=E(),{data:ee,loading:Ve,error:Ie,callApi:xs}=E(),{data:Se,loading:hs,error:Je,callApi:Ke}=E(),{data:ge,loading:bs,error:Ze,callApi:es}=E(),{data:ve,loading:fs,error:ss,callApi:$e}=E(),{data:we,loading:js,error:ts,callApi:Cs}=E(),{data:qe,loading:Ss,error:as,callApi:gs}=E(),{data:se,loading:ns,error:rs,callApi:vs}=E(),{data:Ae,loading:As,error:ls,callApi:os}=E();i.useEffect(()=>{j?(ye(`${y.CLASS_LEVEL}/teacher/${j}`,"GET"),es(`${y.CURRENT_ACADEMIC_YEAR}`,"GET"),Ke(`${y.CURRENT_ACADEMIC_TERM}`,"GET"),be(`${y.TEACHER_EXAM}?teacherId=${j}`,"GET")):v("User not authenticated")},[ye,es,Ke,be,j]),i.useEffect(()=>{var s;(s=ae==null?void 0:ae.data)!=null&&s.assignedClasses&&We(ae.data.assignedClasses.map(n=>{var l;return{_id:n._id,name:n.name,displayName:n.name,subclasses:((l=n.subclasses)==null?void 0:l.map(c=>c.letter))||[],section:n.section||"",isSSClass:n.isSSClass||!1}}))},[ae]),i.useEffect(()=>{Se!=null&&Se.data&&Be([Se.data]),ge!=null&&ge.data&&Pe([ge.data])},[Se,ge]),i.useEffect(()=>{re!=null&&re.data&&Te(re.data||[])},[re]),i.useEffect(()=>{ve!=null&&ve.data&&g(ve.data||[])},[ve]),i.useEffect(()=>{((fe==null?void 0:fe.status)==="success"||(W==null?void 0:W.status)==="success"||(ee==null?void 0:ee.status)==="success")&&be(`${y.TEACHER_EXAM}?teacherId=${j}`,"GET")},[fe,W,ee,be,j]),i.useEffect(()=>{((we==null?void 0:we.status)==="success"||(qe==null?void 0:qe.status)==="success"||(se==null?void 0:se.status)==="success")&&$e(`${y.TEACHER_EXAM}/${f==null?void 0:f._id}/questions`,"GET")},[we,qe,se,$e,f]),i.useEffect(()=>{(ee==null?void 0:ee.status)==="success"&&(k("Exam deleted successfully"),N(!0))},[ee]),i.useEffect(()=>{(se==null?void 0:se.status)==="success"&&(k("Question deleted successfully"),N(!0))},[se]),i.useEffect(()=>{d&&j&&De(`${y.SUBJECT}/class/${d}/teacher/${j}`,"GET")},[d,j,De]),i.useEffect(()=>{O&&j&&b&&ke(`${y.SUBJECT}/class/${O.classId}/subclassLetter/${b}/students`,"GET")},[O,b,j,ke]),i.useEffect(()=>{f!=null&&f._id&&($e(`${y.TEACHER_EXAM}/${f._id}/questions`,"GET"),os(`${y.EXAM_RESULTS}/exam/${f._id}`,"GET"))},[f,$e,os]),i.useEffect(()=>{const s=[Me,_e,Ne,Ee,Je,Ze,o,le,Ie,ss,ts,as,rs,ls].filter(Boolean);v(s[0]||"")},[Me,_e,Ne,Ee,Je,Ze,o,le,Ie,ss,ts,as,rs,ls]);const is=i.useCallback(s=>ne!=null&&ne.data?ne.data.map(n=>{var l;return{name:((l=n.name)==null?void 0:l.name)||n.name,_id:n._id}}):[],[ne]),Ts=i.useCallback((s,n)=>{if(!(Z!=null&&Z.data)||!s)return[];const l=I.find(m=>m._id===s);if(!l)return[];const c=Z.data.find(m=>m.subjectName===n);return c?c.students.map((m,R)=>({studentId:m.studentId,name:`${m.firstName} ${m.lastName}`,className:`${l.name} ${b||""}`,section:l.section,details:{role:"student",firstName:m.firstName||"",lastName:m.lastName||"",middleName:m.middleName||"",email:m.email||"",studentId:m.studentId||"",gender:m.gender||"",currentClassLevel:{className:l.name,subclass:b||""},boardingStatus:m.boardingStatus||"",boardingDetails:m.boardingDetails||null,viewedByRole:"teacher",phoneNumber:null,address:null,tribe:null,religion:null,dob:null,rating:null},sn:R+1})):[]},[Z,I,b]),Ms=i.useCallback(s=>{const n=I.find(l=>l._id===s);return n?`${n.name} ${b||""}`:"Class"},[I,b]),ys=i.useCallback((s,n)=>pe.filter(l=>{var c;return l.classLevel===s&&((c=l.subject)==null?void 0:c._id)===n}),[pe]),_s=i.useCallback(s=>!(Ae!=null&&Ae.data)||!s?[]:Ae.data.map((n,l)=>{var c,m;return{sn:l+1,studentName:`${((c=n.student)==null?void 0:c.firstName)||""} ${((m=n.student)==null?void 0:m.lastName)||""}`,score:n.score||0,date:n.date?new Date(n.date).toLocaleDateString():""}}),[Ae]),Qe=pe.reduce((s,n)=>{var cs,ds;const l=((cs=n.classLevel)==null?void 0:cs._id)||n.classLevel,c=(ds=n.subject)==null?void 0:ds._id,m=I.find(ze=>ze._id===l),R=is(l).find(ze=>ze._id===c);if(!m||!R)return s;const J=`${l}_${c}`;return s[J]||(s[J]={className:m.displayName,subjectName:R.name,exams:[]}),(!b||n.subclassLetter===null||(Array.isArray(n.subclassLetter)?n.subclassLetter.includes(b):n.subclassLetter===b))&&s[J].exams.push(n),s},{});return{mainTabValue:C,selectedClass:d,subclassLetter:b,studentModalOpen:F,questionsModalOpen:ie,detailsModalOpen:w,examModalOpen:a,deleteConfirmModalOpen:ce,successModalOpen:Ce,confirmationMessage:de,confirmationAction:ue,selectedSubject:O,selectedStudent:B,selectedExam:f,questions:r,newQuestion:p,newExam:u,exams:pe,academicTerms:xe,academicYears:he,classes:I,error:Re,loading:He||Ye||Ue||Ge||hs||bs||fs||Le||Fe||Ve||js||Ss||ns||As,getSubjectsForClass:is,getStudentsForSubject:Ts,getClassName:Ms,getExamsForSubject:ys,getTestScoresData:_s,handleMainTabChange:(s,n)=>{t(n)},handleClassChange:s=>{x(s.target.value),G(""),z(null),Q(!1)},handleSubclassChange:s=>{G(s.target.value),z(null),Q(!1)},openStudentModal:(s,n)=>{if(!b){v("Please select a subclass to view students");return}z({subject:s,classId:n}),Q(!0)},openQuestionsModal:s=>{const n=Object.keys(Qe).find(c=>Qe[c].exams.some(m=>m._id===s._id)),l=n?Qe[n].exams.find(c=>c._id===s._id):null;P({...s,totalMark:l?l.totalMark:0}),X(!0)},openDetailsModal:s=>{V(s),_(!0)},openExamModal:(s=null)=>{var n,l,c,m,R,J,oe;s?(P(s),te({name:s.name||"",description:s.description||"",subject:((n=s.subject)==null?void 0:n._id)||"",classLevel:s.classLevel||"",subclassLetter:Array.isArray(s.subclassLetter)?s.subclassLetter:s.subclassLetter?[s.subclassLetter]:[],passMark:s.passMark||"",totalMark:s.totalMark||"",duration:s.duration?String(s.duration):"",examDate:s.examDate?s.examDate.split("T")[0]:"",examTime:s.examTime||"",examType:s.examType||"test",academicTerm:((l=s.academicTerm)==null?void 0:l._id)||((c=xe[0])==null?void 0:c._id)||"",academicYear:((m=s.academicYear)==null?void 0:m._id)||((R=he[0])==null?void 0:R._id)||""})):(P(null),te({name:"",description:"",subject:"",classLevel:d||"",subclassLetter:[],passMark:"",totalMark:"",duration:"",examDate:"",examTime:"",examType:"test",academicTerm:((J=xe[0])==null?void 0:J._id)||"",academicYear:((oe=he[0])==null?void 0:oe._id)||""})),M(!0)},handleQuestionInputChange:s=>{const{name:n,value:l}=s.target;K(c=>({...c,[n]:l}))},handleOptionChange:(s,n)=>{K(l=>{const c=[l.optionA,l.optionB,l.optionC,l.optionD];return c[s]=n,{...l,optionA:c[0]||"",optionB:c[1]||"",optionC:c[2]||"",optionD:c[3]||""}})},handleAddQuestion:async()=>{if(!p.question||!p.optionA||!p.optionB||!p.optionC||!p.optionD||!p.correctAnswer||!p.score){v("Please fill all question fields, including score");return}const s=Number(p.score);if(isNaN(s)||s<=0){v("Score must be a positive number");return}if(!f){v("No exam selected");return}if(r.reduce((c,m)=>c+Number(m.score||0),0)+s>f.totalMark){v("Total score for questions cannot exceed examâ€™s total mark");return}if(![p.optionA,p.optionB,p.optionC,p.optionD].includes(p.correctAnswer)){v("Correct answer must match one of the provided options");return}const l={question:p.question,optionA:p.optionA,optionB:p.optionB,optionC:p.optionC,optionD:p.optionD,correctAnswer:p.correctAnswer,score:s};try{await Cs(`${y.TEACHER_EXAM}/${f._id}/questions`,"POST",l),k("Question added successfully"),N(!0),K({question:"",optionA:"",optionB:"",optionC:"",optionD:"",correctAnswer:"",score:""})}catch(c){v(c.message||"Failed to add question")}},handleUpdateQuestion:async(s,n)=>{try{await gs(`${y.TEACHER_EXAM}/${f._id}/questions/${s}`,"PATCH",{question:n.question,optionA:n.optionA,optionB:n.optionB,optionC:n.optionC,optionD:n.optionD,correctAnswer:n.correctAnswer,score:Number(n.score)}),k("Question updated successfully"),N(!0)}catch(l){v(l.message||"Failed to update question")}},handleDeleteQuestion:async s=>{try{await vs(`${y.TEACHER_EXAM}/${f._id}/questions/${s}`,"DELETE"),k("Question deleted successfully"),N(!0)}catch(n){v(n.message||"Failed to delete question")}},handleExamInputChange:s=>{const{name:n,value:l}=s.target;te(c=>({...c,[n]:l}))},handleSaveExam:async()=>{var R,J;if(!u.name||!u.description||!u.subject||!u.classLevel||!u.passMark||!u.totalMark||!u.duration||!u.examDate||!u.examTime||!u.examType||!u.academicTerm||!u.academicYear){v("Please fill all required exam fields");return}const s=I.find(oe=>oe._id===u.classLevel);if(s!=null&&s.isSSClass&&(!u.subclassLetter||u.subclassLetter.length===0)){v("Please select at least one subclass for SS class");return}const n=Number(u.totalMark),l=Number(u.passMark),c=Number(u.duration);if(isNaN(n)||n>100||n<=0){v("Total mark must be a number between 1 and 100");return}if(isNaN(l)||l>n||l<0){v("Pass mark must be a number between 0 and the total mark");return}if(isNaN(c)||c<=0){v("Duration must be a positive number");return}const m={name:u.name,description:u.description,subject:u.subject,classLevel:u.classLevel,subclassLetter:u.subclassLetter,passMark:l,totalMark:n,duration:c,examDate:u.examDate,examTime:u.examTime,examType:u.examType,academicTerm:u.academicTerm,academicYear:u.academicYear};try{f?await Xe(`${y.TEACHER_EXAM}/${f._id}`,"PATCH",m):await L(y.TEACHER_EXAM,"POST",m),k("Exam saved successfully"),N(!0),M(!1),te({name:"",description:"",subject:"",classLevel:"",subclassLetter:[],passMark:"",totalMark:"",duration:"",examDate:"",examTime:"",examType:"test",academicTerm:((R=xe[0])==null?void 0:R._id)||"",academicYear:((J=he[0])==null?void 0:J._id)||""}),P(null)}catch(oe){v(oe.message||"Failed to save exam")}},handleDeleteExam:s=>{k("Are you sure you want to delete this exam?"),me(()=>async()=>{try{await xs(`${y.TEACHER_EXAM}/${s}`,"DELETE"),D(!1)}catch(n){v(n.message||"Failed to delete exam"),D(!1)}}),D(!0)},setStudentModalOpen:Q,setQuestionsModalOpen:X,setDetailsModalOpen:_,setExamModalOpen:M,setDeleteConfirmModalOpen:D,setSuccessModalOpen:N,setSelectedSubject:z,setSelectedStudent:V,setSelectedExam:P,setNewQuestion:K,setNewExam:te,loadingDeleteExam:Ve,loadingDeleteQuestion:ns,groupedExams:Qe}},Qs=({open:j,onClose:C,selectedSubject:t,getStudentsForSubject:d,getClassName:x,studentColumns:b,colors:G,TableComponent:F})=>e.jsx(je,{open:j,onClose:C,title:t?`Students for ${t.subject} (${x(t.classId)})`:"Students",noConfirm:!0,children:t&&e.jsx(T,{children:e.jsx(F,{columns:b,tableHeader:`Students for ${t.subject}`,data:d(t.classId,t.subject),page:0,rowsPerPage:5,sortBy:"name",sortDirection:"asc",hiddenColumnsSmallScreen:[]})})}),Os=({open:j,onClose:C,selectedStudent:t,colors:d})=>e.jsx(je,{open:j,onClose:C,title:t?`${t.name}'s Details`:"Student Details",noConfirm:!0,children:t&&e.jsx(T,{children:e.jsx(Ls,{user:t.details})})}),Bs=({open:j,onClose:C,selectedExam:t,questions:d,newQuestion:x,handleQuestionInputChange:b,handleOptionChange:G,handleAddQuestion:F,handleUpdateQuestion:Q,handleDeleteQuestion:ie,getTestScoresData:X,colors:w,TableComponent:_})=>{const[a,M]=i.useState(null),[ce,D]=i.useState(""),[Ce,N]=i.useState(!1),[de,k]=i.useState(null),ue=[{id:"sn",label:"S/N",flex:.5},{id:"question",label:"Question",flex:2},{id:"correctAnswer",label:"Correct Answer",flex:1},{id:"score",label:"Score",flex:1},{id:"actions",label:"Actions",flex:1,renderCell:r=>e.jsxs(T,{display:"flex",gap:"10px",children:[e.jsx(q,{variant:"contained",color:"secondary",size:"small",onClick:()=>M(r),children:"Edit"}),e.jsx(q,{variant:"contained",color:"error",size:"small",onClick:()=>{k(r._id),N(!0)},children:"Delete"})]})}],me=()=>{if(!a.question||!a.optionA||!a.optionB||!a.optionC||!a.optionD||!a.correctAnswer||!a.score){D("Please fill all question fields, including score");return}const r=Number(a.score);if(isNaN(r)||r<=0){D("Score must be a positive number");return}if(d.filter(p=>p._id!==a._id).reduce((p,K)=>p+Number(K.score||0),0)+r>((t==null?void 0:t.totalMark)||0)){D("Total score for questions cannot exceed examâ€™s total mark");return}if(![a.optionA,a.optionB,a.optionC,a.optionD].includes(a.correctAnswer)){D("Correct answer must match one of the provided options");return}Q(a._id,{question:a.question,optionA:a.optionA,optionB:a.optionB,optionC:a.optionC,optionD:a.optionD,correctAnswer:a.correctAnswer,score:r}),M(null),D("")},O=()=>{M(null),D("")},z=()=>{de&&(ie(de),N(!1),k(null))},B=d.reduce((r,g)=>r+Number(g.score||0),0),V=t!=null&&t.totalMark?t.totalMark-B:0,f=t!=null&&t.totalMark?B>=t.totalMark:!0,P=d.map((r,g)=>({sn:g+1,_id:r._id,question:r.question,correctAnswer:r.correctAnswer,score:r.score,optionA:r.optionA,optionB:r.optionB,optionC:r.optionC,optionD:r.optionD})).sort((r,g)=>r.sn-g.sn);return e.jsx(je,{open:j,onClose:()=>{C(),M(null),D(""),N(!1),k(null)},title:t?`Manage Questions for ${t.name} (${Array.isArray(t.subclassLetter)?t.subclassLetter.join(", "):t.subclassLetter||""})`:"Manage Questions",noConfirm:!0,children:e.jsxs(T,{children:[ce&&e.jsx(S,{color:"error",sx:{mb:2},children:ce}),t&&e.jsxs(S,{sx:{mb:2},children:["Total Marks: ",t.totalMark||"N/A"," | Current Total: ",B," | Remaining: ",V]}),e.jsx(S,{variant:"h6",sx:{mb:2},children:"Add New Question"}),e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,children:e.jsx($,{fullWidth:!0,label:"Question",name:"question",value:x.question,onChange:b,variant:"outlined",disabled:(t==null?void 0:t.examStatus)==="approved"||f})}),["optionA","optionB","optionC","optionD"].map((r,g)=>e.jsx(h,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:`Option ${g+1}`,value:x[r],onChange:p=>G(g,p.target.value),variant:"outlined",disabled:(t==null?void 0:t.examStatus)==="approved"||f})},r)),e.jsx(h,{item:!0,xs:6,children:e.jsxs(H,{fullWidth:!0,children:[e.jsx(Y,{children:"Correct Answer"}),e.jsxs(U,{name:"correctAnswer",value:x.correctAnswer,onChange:b,label:"Correct Answer",disabled:(t==null?void 0:t.examStatus)==="approved"||f,children:[e.jsx(A,{value:"",children:e.jsx("em",{children:"Select correct answer"})}),[x.optionA,x.optionB,x.optionC,x.optionD].map((r,g)=>e.jsx(A,{value:r,disabled:!r,children:r||`Option ${g+1}`},g))]})]})}),e.jsx(h,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Score",name:"score",type:"number",value:x.score,onChange:b,variant:"outlined",inputProps:{min:1,max:V},disabled:(t==null?void 0:t.examStatus)==="approved"||f})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(q,{variant:"contained",color:"primary",onClick:F,disabled:(t==null?void 0:t.examStatus)==="approved"||f,children:"Add Question"})})]}),a&&e.jsxs(T,{sx:{mt:4},children:[e.jsx(S,{variant:"h6",sx:{mb:2},children:"Edit Question"}),e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,children:e.jsx($,{fullWidth:!0,label:"Question",value:a.question||"",onChange:r=>M({...a,question:r.target.value}),variant:"outlined"})}),["optionA","optionB","optionC","optionD"].map((r,g)=>e.jsx(h,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:`Option ${g+1}`,value:a[r]||"",onChange:p=>M({...a,[r]:p.target.value}),variant:"outlined"})},r)),e.jsx(h,{item:!0,xs:6,children:e.jsxs(H,{fullWidth:!0,children:[e.jsx(Y,{children:"Correct Answer"}),e.jsxs(U,{value:a.correctAnswer||"",onChange:r=>M({...a,correctAnswer:r.target.value}),label:"Correct Answer",children:[e.jsx(A,{value:"",children:e.jsx("em",{children:"Select correct answer"})}),[a.optionA,a.optionB,a.optionC,a.optionD].map((r,g)=>e.jsx(A,{value:r,disabled:!r,children:r||`Option ${g+1}`},g))]})]})}),e.jsx(h,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Score",type:"number",value:a.score||"",onChange:r=>M({...a,score:r.target.value}),variant:"outlined",inputProps:{min:1,max:V+Number(a.score||0)}})}),e.jsxs(h,{item:!0,xs:12,children:[e.jsx(q,{variant:"contained",color:"primary",onClick:me,children:"Save Changes"}),e.jsx(q,{variant:"outlined",color:"secondary",onClick:O,sx:{ml:2},children:"Cancel"})]})]})]}),e.jsxs(T,{sx:{mt:4},children:[e.jsx(S,{variant:"h6",children:"Existing Questions"}),e.jsx(_,{columns:ue,tableHeader:"Questions",data:P,page:0,rowsPerPage:5,sortBy:"sn",sortDirection:"asc",hiddenColumnsSmallScreen:[]})]}),e.jsxs(T,{sx:{mt:4},children:[e.jsx(S,{variant:"h6",children:"Test Scores"}),e.jsx(_,{columns:[{id:"sn",label:"S/N",flex:.5},{id:"studentName",label:"Student Name",flex:2},{id:"score",label:"Score",flex:1},{id:"date",label:"Date",flex:1}],tableHeader:"Scores",data:t?X(t):[],page:0,rowsPerPage:5,sortBy:"studentName",sortDirection:"asc",hiddenColumnsSmallScreen:[]})]}),e.jsx(je,{open:Ce,onClose:()=>{N(!1),k(null)},title:"Confirm Delete Question",onConfirm:z,confirmText:"Delete",showCancel:!0,children:e.jsx(S,{children:"Are you sure you want to delete this question?"})})]})})},Ps=({open:j,onClose:C,newExam:t,handleExamInputChange:d,handleSaveExam:x,classes:b,subjects:G,academicTerms:F,academicYears:Q,colors:ie,isEditing:X})=>{const w=b.find(a=>a._id===t.classLevel),_=(w==null?void 0:w.isSSClass)||!1;return e.jsx(je,{open:j,onClose:C,title:X?"Edit Exam":"Create New Exam",onConfirm:x,confirmText:X?"Save Changes":"Create Exam",showCancel:!0,children:e.jsx(T,{children:e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,children:e.jsx($,{fullWidth:!0,label:"Exam Name",name:"name",value:t.name,onChange:d,variant:"outlined",required:!0})}),e.jsx(h,{item:!0,xs:12,children:e.jsx($,{fullWidth:!0,label:"Description",name:"description",value:t.description,onChange:d,variant:"outlined",multiline:!0,rows:3,required:!0})}),e.jsx(h,{item:!0,xs:12,children:e.jsxs(H,{fullWidth:!0,required:!0,children:[e.jsx(Y,{children:"Class"}),e.jsxs(U,{name:"classLevel",value:t.classLevel,onChange:d,label:"Class",children:[e.jsx(A,{value:"",children:e.jsx("em",{children:"Select a class"})}),b.map(a=>e.jsx(A,{value:a._id,children:a.displayName},a._id))]})]})}),t.classLevel&&e.jsx(h,{item:!0,xs:12,children:e.jsxs(H,{fullWidth:!0,required:_,children:[e.jsx(Y,{children:"Subclass"}),e.jsxs(U,{multiple:_,name:"subclassLetter",value:_?t.subclassLetter:t.subclassLetter[0]||"",onChange:a=>{const M=_?a.target.value:[a.target.value];d({target:{name:"subclassLetter",value:M}})},label:"Subclass",renderValue:a=>Array.isArray(a)?a.join(", "):a,children:[e.jsx(A,{value:"",disabled:_,children:e.jsx("em",{children:_?"Select subclasses":"Select a subclass"})}),((w==null?void 0:w.subclasses)||[]).map(a=>e.jsx(A,{value:a,children:a},a))]})]})}),e.jsx(h,{item:!0,xs:12,children:e.jsxs(H,{fullWidth:!0,required:!0,children:[e.jsx(Y,{children:"Subject"}),e.jsxs(U,{name:"subject",value:t.subject,onChange:d,label:"Subject",children:[e.jsx(A,{value:"",children:e.jsx("em",{children:"Select a subject"})}),G.map(a=>e.jsx(A,{value:a._id,children:a.name},a._id))]})]})}),e.jsx(h,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Pass Mark",name:"passMark",type:"number",value:t.passMark,onChange:d,variant:"outlined",required:!0,inputProps:{min:0,max:Number(t.totalMark)||100}})}),e.jsx(h,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Total Mark",name:"totalMark",type:"number",value:t.totalMark,onChange:d,variant:"outlined",required:!0,inputProps:{min:0,max:100}})}),e.jsx(h,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Duration (minutes)",name:"duration",type:"number",value:t.duration,onChange:d,variant:"outlined",required:!0,inputProps:{min:1}})}),e.jsx(h,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Exam Date",name:"examDate",type:"date",value:t.examDate,onChange:d,variant:"outlined",InputLabelProps:{shrink:!0},required:!0})}),e.jsx(h,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Exam Time",name:"examTime",type:"time",value:t.examTime,onChange:d,variant:"outlined",InputLabelProps:{shrink:!0},required:!0})}),e.jsx(h,{item:!0,xs:6,children:e.jsxs(H,{fullWidth:!0,required:!0,children:[e.jsx(Y,{children:"Exam Type"}),e.jsxs(U,{name:"examType",value:t.examType,onChange:d,label:"Exam Type",children:[e.jsx(A,{value:"test",children:"Test"}),e.jsx(A,{value:"exam",children:"Exam"})]})]})}),e.jsx(h,{item:!0,xs:6,children:e.jsxs(H,{fullWidth:!0,required:!0,children:[e.jsx(Y,{children:"Academic Term"}),e.jsxs(U,{name:"academicTerm",value:t.academicTerm,onChange:d,label:"Academic Term",children:[e.jsx(A,{value:"",children:e.jsx("em",{children:"Select a term"})}),F.map(a=>e.jsx(A,{value:a._id,children:a.name},a._id))]})]})}),e.jsx(h,{item:!0,xs:6,children:e.jsxs(H,{fullWidth:!0,required:!0,children:[e.jsx(Y,{children:"Academic Year"}),e.jsxs(U,{name:"academicYear",value:t.academicYear,onChange:d,label:"Academic Year",children:[e.jsx(A,{value:"",children:e.jsx("em",{children:"Select a year"})}),Q.map(a=>e.jsx(A,{value:a._id,children:a.name},a._id))]})]})})]})})})};function ps(j){const{children:C,value:t,index:d,...x}=j;return e.jsx("div",{role:"tabpanel",hidden:t!==d,id:`tabpanel-${d}`,"aria-labelledby":`tab-${d}`,...x,children:t===d&&e.jsx(T,{sx:{p:3},children:C})})}const Ws=()=>{var Le;const j=$s(),C=Ns(j.palette.mode),t=Ds(o=>{var L,W;return(W=(L=o.users)==null?void 0:L.user)==null?void 0:W._id});if(!t)return e.jsxs(T,{children:[e.jsx(us,{title:"SUBJECT MANAGEMENT",subtitle:"Manage Subjects, Exams, and Questions"}),e.jsx(S,{color:"error",sx:{mt:2},children:"Please log in to access subject management."})]});const{mainTabValue:d,selectedClass:x,subclassLetter:b,studentModalOpen:G,questionsModalOpen:F,detailsModalOpen:Q,examModalOpen:ie,deleteConfirmModalOpen:X,successModalOpen:w,confirmationMessage:_,confirmationAction:a,selectedSubject:M,selectedStudent:ce,selectedExam:D,questions:Ce,newQuestion:N,newExam:de,exams:k,academicTerms:ue,academicYears:me,classes:O,error:z,loading:B,getSubjectsForClass:V,getStudentsForSubject:f,getClassName:P,getTestScoresData:r,handleMainTabChange:g,handleClassChange:p,handleSubclassChange:K,openStudentModal:u,openQuestionsModal:te,openDetailsModal:pe,openExamModal:Te,handleQuestionInputChange:xe,handleOptionChange:Be,handleAddQuestion:he,handleUpdateQuestion:Pe,handleDeleteQuestion:I,handleExamInputChange:We,handleSaveExam:Re,handleDeleteExam:v,setStudentModalOpen:ae,setQuestionsModalOpen:He,setDetailsModalOpen:Me,setExamModalOpen:ye,setDeleteConfirmModalOpen:ne,setSuccessModalOpen:Ye,setSelectedSubject:_e,setSelectedStudent:De,setSelectedExam:Z,setNewQuestion:Ue,setNewExam:Ne,loadingDeleteExam:ke,loadingDeleteQuestion:re,groupedExams:Ge}=qs({userId:t}),Ee=[{id:"sn",label:"S/N",flex:.5},{id:"subject",label:"Subject",flex:2,renderCell:o=>e.jsx(S,{children:o.subject})},{id:"actions",label:"Actions",flex:1,renderCell:o=>e.jsx(q,{variant:"contained",color:"primary",size:"small",onClick:()=>u(o.subject,o.classId),disabled:!b,children:"View Students"})}],be=[{id:"sn",label:"S/N",flex:.5},{id:"name",label:"Student Name",flex:2,renderCell:o=>e.jsx(S,{children:o.name})},{id:"className",label:"Class",flex:1,renderCell:o=>e.jsx(S,{children:o.className})},{id:"actions",label:"Actions",flex:1,renderCell:o=>e.jsx(T,{display:"flex",gap:"10px",children:e.jsx(q,{variant:"contained",color:"primary",size:"small",onClick:()=>pe(o),children:"View Details"})})}],fe=[{id:"sn",label:"S/N",flex:.5},{id:"name",label:"Exam Name",flex:2,renderCell:o=>e.jsx(S,{children:o.name})},{id:"examType",label:"Type",flex:1,renderCell:o=>e.jsx(S,{children:o.examType})},{id:"examStatus",label:"Status",flex:1,renderCell:o=>e.jsx(S,{children:o.examStatus})},{id:"actions",label:"Actions",flex:2,renderCell:o=>e.jsxs(T,{display:"flex",gap:"10px",children:[e.jsx(q,{variant:"contained",color:"primary",size:"small",onClick:()=>te(o),children:"Manage Questions"}),e.jsx(q,{variant:"contained",color:"secondary",size:"small",onClick:()=>Te(o),disabled:o.examStatus==="approved",children:"Edit"}),e.jsx(q,{variant:"contained",color:"error",size:"small",onClick:()=>v(o._id),disabled:o.examStatus==="approved",children:"Delete"})]})}];return e.jsxs(T,{children:[e.jsx(us,{title:"SUBJECT MANAGEMENT",subtitle:"Manage Subjects, Exams, and Questions"}),z&&e.jsx(S,{color:"error",sx:{mb:2},children:z}),e.jsxs(T,{sx:{mt:3,mb:3},children:[e.jsxs(ks,{value:d,onChange:g,"aria-label":"main tabs",sx:{backgroundColor:C.primary[400],"& .MuiTabs-indicator":{backgroundColor:C.blueAccent[700]}},children:[e.jsx(ms,{label:"Subjects",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:C.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:C.primary[400]}}),e.jsx(ms,{label:"Exams",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:C.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:C.primary[400]}})]}),e.jsxs(ps,{value:d,index:0,children:[e.jsxs(T,{sx:{display:"flex",gap:2,mb:3},children:[e.jsxs(H,{fullWidth:!0,children:[e.jsx(Y,{id:"class-select-label",children:"Select Class"}),e.jsxs(U,{labelId:"class-select-label",value:x,label:"Select Class",onChange:p,disabled:B,children:[e.jsx(A,{value:"",children:e.jsx("em",{children:"Select a class"})}),O.map(o=>e.jsx(A,{value:o._id,children:o.displayName},o._id))]})]}),x&&e.jsxs(H,{fullWidth:!0,children:[e.jsx(Y,{id:"subclass-select-label",children:"Select Subclass"}),e.jsxs(U,{labelId:"subclass-select-label",value:b,label:"Select Subclass",onChange:K,disabled:B,children:[e.jsx(A,{value:"",children:e.jsx("em",{children:"Select a subclass"})}),((Le=O.find(o=>o._id===x))==null?void 0:Le.subclasses.map(o=>e.jsx(A,{value:o,children:o},o)))||[]]})]})]}),B&&e.jsx(S,{children:"Loading..."}),x&&b&&e.jsx(Oe,{columns:Ee,tableHeader:`Subjects for ${P(x)}`,data:V(x).map((o,L)=>({sn:L+1,subject:o.name,classId:x})),page:0,rowsPerPage:5,sortBy:"subject",sortDirection:"asc",hiddenColumnsSmallScreen:[]}),(!x||!b)&&e.jsx(S,{children:"Please select a class and subclass to view subjects"})]}),e.jsxs(ps,{value:d,index:1,children:[e.jsx(T,{display:"flex",justifyContent:"flex-end",mb:2,children:e.jsx(q,{variant:"contained",color:"primary",onClick:()=>Te(),disabled:!x,children:"Create New Exam"})}),B?e.jsx(S,{children:"Loading exams..."}):k.length>0?e.jsx(h,{container:!0,spacing:2,children:Object.values(Ge).map(({className:o,subjectName:L,exams:W},Fe)=>e.jsx(h,{item:!0,xs:12,children:e.jsxs(T,{p:2,borderRadius:"8px",boxShadow:2,bgcolor:C.primary[400],children:[e.jsxs(S,{variant:"h6",children:[L," (",o,")"]}),W.length>0?e.jsx(Oe,{columns:fe,tableHeader:`Exams for ${L}`,data:W.map((le,Xe)=>({sn:Xe+1,_id:le._id,name:le.name,examType:le.examType,examStatus:le.examStatus})),page:0,rowsPerPage:5,sortBy:"name",sortDirection:"asc",hiddenColumnsSmallScreen:[]}):e.jsx(S,{children:"No exams set for this subject and class."})]})},`${o}_${L}_${Fe}`))}):e.jsx(S,{children:"No exams available."})]})]}),e.jsx(Qs,{open:G,onClose:()=>{ae(!1),_e(null)},selectedSubject:M,getStudentsForSubject:f,getClassName:P,studentColumns:be,colors:C,TableComponent:Oe}),e.jsx(Bs,{open:F,onClose:()=>{He(!1),Z(null),Ue({question:"",optionA:"",optionB:"",optionC:"",optionD:"",correctAnswer:"",score:""})},selectedExam:D,questions:Ce,newQuestion:N,handleQuestionInputChange:xe,handleOptionChange:Be,handleAddQuestion:he,handleUpdateQuestion:Pe,handleDeleteQuestion:I,getTestScoresData:r,colors:C,TableComponent:Oe}),e.jsx(Os,{open:Q,onClose:()=>{Me(!1),De(null)},selectedStudent:ce,colors:C}),e.jsx(Ps,{open:ie,onClose:()=>{var o,L;ye(!1),Z(null),Ne({name:"",description:"",subject:"",classLevel:"",subclassLetter:[],passMark:"",totalMark:"",duration:"",examDate:"",examTime:"",examType:"test",academicTerm:((o=ue[0])==null?void 0:o._id)||"",academicYear:((L=me[0])==null?void 0:L._id)||""})},newExam:de,handleExamInputChange:We,handleSaveExam:Re,classes:O,subjects:x?V(x):[],academicTerms:ue,academicYears:me,colors:C,isEditing:!!D}),e.jsx(je,{open:X,onClose:()=>ne(!1),title:"Confirm Deletion",onConfirm:a,confirmText:"Confirm",showCancel:!0,children:e.jsx(S,{children:_})}),e.jsx(ws,{open:w,onClose:()=>Ye(!1),title:"Success",message:_,isLoading:ke||re})]})},Ct=Es(Ws);export{Ct as default};
