var Ke=Object.defineProperty;var Xe=(a,r,m)=>r in a?Ke(a,r,{enumerable:!0,configurable:!0,writable:!0,value:m}):a[r]=m;var $e=(a,r,m)=>Xe(a,typeof r!="symbol"?r+"":r,m);import{j as e,r as c,a as Ee,f as _,i as Ze,R as et}from"./index-BGLh42TJ.js";import{u as ge}from"./useApi-DN8WZFPX.js";import{H as Ue}from"./Header-BlEaZ8dh.js";import{t as qe,M as ve}from"./modal-DfySOKQn.js";import{c as ke,a as tt,g as at,u as rt,_ as st,b as ue,s as nt,d as ot,h as De,e as it,a4 as ct,i as lt,j as We,v as y,T as k,P as dt,y as oe,x as Ge,a1 as Ne,a2 as Be,a3 as Oe,M as mt}from"./TextField-IhUWfT1k.js";import{A as ut,G as Se}from"./index-1nOsHyls.js";import{T as Le}from"./table-C4UeRYqv.js";import{S as ht,F as He}from"./FormControlLabel-1Qx68tGA.js";import{M as ze}from"./MenuItem-CxDLM7qu.js";import{A as ye}from"./actionButton-CbLEt57f.js";import{j as pt,k as ft,l as gt,m as Dt}from"./index-JJRHpl5N.js";import{I as fe}from"./IconButton-D8odhYXc.js";import{w as Ct}from"./dasboardPagesContainer-BZrGlab9.js";import"./confirmationModal-CidaOsZI.js";import"./CircularProgress-C2yr_0Gq.js";import"./index-BZ5_ktoT.js";import"./loadingButton-C3VBQU3Q.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-DcScONqL.js";import"./useMediaQuery-DDxCNW03.js";const bt=ke(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),xt=ke(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),Yt=ke(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function Tt(a){return at("MuiCheckbox",a)}const je=tt("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),At=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],St=a=>{const{classes:r,indeterminate:m,color:l,size:D}=a,T={root:["root",m&&"indeterminate",`color${De(l)}`,`size${De(D)}`]},h=it(T,Tt,r);return ue({},r,h)},jt=nt(ht,{shouldForwardProp:a=>ct(a)||a==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(a,r)=>{const{ownerState:m}=a;return[r.root,m.indeterminate&&r.indeterminate,r[`size${De(m.size)}`],m.color!=="default"&&r[`color${De(m.color)}`]]}})(({theme:a,ownerState:r})=>ue({color:(a.vars||a).palette.text.secondary},!r.disableRipple&&{"&:hover":{backgroundColor:a.vars?`rgba(${r.color==="default"?a.vars.palette.action.activeChannel:a.vars.palette[r.color].mainChannel} / ${a.vars.palette.action.hoverOpacity})`:lt(r.color==="default"?a.palette.action.active:a.palette[r.color].main,a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},r.color!=="default"&&{[`&.${je.checked}, &.${je.indeterminate}`]:{color:(a.vars||a).palette[r.color].main},[`&.${je.disabled}`]:{color:(a.vars||a).palette.action.disabled}})),yt=e.jsx(xt,{}),wt=e.jsx(bt,{}),Et=e.jsx(Yt,{}),Ve=c.forwardRef(function(r,m){var l,D;const T=rt({props:r,name:"MuiCheckbox"}),{checkedIcon:h=yt,color:w="primary",icon:b=wt,indeterminate:I=!1,indeterminateIcon:j=Et,inputProps:F,size:v="medium",className:z}=T,B=st(T,At),H=I?j:b,R=I?j:h,U=ue({},T,{color:w,indeterminate:I,size:v}),V=St(U);return e.jsx(jt,ue({type:"checkbox",inputProps:ue({"data-indeterminate":I},F),icon:c.cloneElement(H,{fontSize:(l=H.props.fontSize)!=null?l:v}),checkedIcon:c.cloneElement(R,{fontSize:(D=R.props.fontSize)!=null?D:v}),ownerState:U,ref:m,className:ot(V.root,z)},B,{classes:V}))}),vt=()=>{const[a,r]=c.useState(""),[m,l]=c.useState(""),[D,T]=c.useState([]),h=Ee(j=>j.users.user),{loading:w,data:b,callApi:I}=ge();return c.useEffect(()=>{I(_.COURSES,"GET")},[]),c.useEffect(()=>{if(b&&b.courses){const j=b.courses.find(F=>F.courseName===h.program);j&&(r(j.courseName),l(j.duration),T(j.curriculum||[]))}},[b]),{courseName:a,courseDuration:m,curriculum:D,loading:w}},kt=()=>{const a=We(),r=qe(a.palette.mode),{courseDuration:m,courseName:l,curriculum:D,loading:T}=vt();return e.jsxs(y,{children:[e.jsx(Ue,{title:l||"Primary 2",subtitle:`${m||0} months`}),T?e.jsx(Ze,{}):D&&D.length>0?e.jsxs(y,{children:[e.jsx(k,{variant:"h2",gutterBottom:!0,children:"Curriculum"}),e.jsx(y,{sx:{width:"100%"},children:D.map((h,w)=>e.jsxs(dt,{elevation:3,sx:{backgroundColor:r.primary[400],color:r.blueAccent[500],p:3,mb:2,display:"flex",alignItems:"flex-start",gap:2,borderRadius:"12px",boxShadow:"0 3px 10px rgba(0, 0, 0, 0.1)"},children:[e.jsx(ut,{sx:{bgcolor:r.primary[500],width:40,height:40,fontSize:"18px",color:"white"},children:w+1}),e.jsxs(y,{children:[e.jsxs(k,{variant:"h3",sx:{color:r.blueAccent[200]},children:[h.topic||"No topic available"," "]}),e.jsxs(k,{variant:"body1",color:"textSecondary",sx:{mb:1},children:[h.description||"No description available"," "]}),e.jsxs(k,{variant:"body1",sx:{fontStyle:"italic"},children:["Duration: ",h.duration||"Unknown"," "]}),e.jsxs(k,{variant:"h6",sx:{color:r.blueAccent[200]},children:["Resources: ",Array.isArray(h.resources)?h.resources.join(", "):"No resources available"]})]})]},h._id||w))})]}):e.jsx(k,{variant:"body1",color:"textSecondary",children:"No curriculum available."})]})},It=({userId:a})=>{const r={id:"",name:"",fromYear:"",toYear:"",isCurrent:!1},m={academicYearId:"",academicTermId:"",terms:[{name:"1st Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1},{name:"2nd Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1},{name:"3rd Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1}]},[l,D]=c.useState(r),[T,h]=c.useState(m),[w,b]=c.useState({name:"",fromYear:"",toYear:"",general:""}),[I,j]=c.useState({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]}),[F,v]=c.useState(!1),[z,B]=c.useState(!1),[H,R]=c.useState(!1),[U,V]=c.useState({}),[p,C]=c.useState(!1),[q,W]=c.useState(null),{data:X,loading:ie,error:Z,callApi:$}=ge(),{data:Q,loading:ce,error:ee,callApi:O}=ge(),{loading:te,callApi:P}=ge(),G=c.useCallback(async s=>{C(!0),W(null);try{const n=await P(`${_.ACADEMIC_TERM}/year/${s}`,"GET");if(console.log("API Response for academic terms:",n),!n||n.status!=="success")throw new Error((n==null?void 0:n.message)||"Failed to fetch academic terms");const o=Array.isArray(n.data)?n.data.flatMap(f=>f.terms||[]):[];console.log("Normalized terms:",o),V(f=>({...f,[s]:o}))}catch(n){console.error("Error fetching terms:",n),W(n.message||"Failed to fetch academic terms")}finally{C(!1)}},[P]);c.useEffect(()=>{$(_.ACADEMIC_YEARS,"GET"),O(_.CURRENT_ACADEMIC_YEAR,"GET")},[$,O]);const ae=(X==null?void 0:X.data)||[],M=(Q==null?void 0:Q.data)||null,J=c.useCallback(s=>{const{name:n,value:o,type:f,checked:u}=s.target,A=f==="checkbox"?u:o;D(Y=>({...Y,[n]:A})),b(Y=>({...Y,[n]:"",general:""}))},[]),le=c.useCallback(async s=>{var n,o;if(!a)return b(f=>({...f,general:"User not authenticated. Please log in."})),!1;try{R(!0),b(u=>({...u,general:""}));const f=await P(`${_.ACADEMIC_YEARS}/${s}`,"DELETE");if(!f||f.status!=="success")throw new Error((f==null?void 0:f.message)||"Failed to delete academic year");return await $(_.ACADEMIC_YEARS,"GET"),(M==null?void 0:M._id)===s&&await O(_.CURRENT_ACADEMIC_YEAR,"GET"),V(u=>{const A={...u};return delete A[s],A}),!0}catch(f){const u=((o=(n=f.response)==null?void 0:n.data)==null?void 0:o.message)||f.message||"Failed to delete academic year";return b(A=>({...A,general:u})),!1}finally{R(!1)}},[a,P,$,O,M]),K=c.useCallback((s,n,o=!1)=>{const{name:f,value:u,type:A,checked:Y}=s.target,i=A==="checkbox"?Y:u;h(g=>{const x=[...g.terms];return x[n]={...x[n],[f]:i,createdBy:a},o&&i&&x.forEach((t,S)=>{S!==n&&(t.isCurrent=!1)}),{...g,terms:x}}),j(g=>({...g,terms:g.terms.map((x,t)=>t===n?{...x,[f]:""}:x),general:""}))},[a]),se=c.useCallback(()=>{const{name:s,fromYear:n,toYear:o,isCurrent:f}=l,u={name:"",fromYear:"",toYear:"",general:""};if(s.trim()?/^\d{4}\/\d{4}$/.test(s.trim())||(u.name="Name must be in format YYYY/YYYY (e.g., 2024/2025)"):u.name="Academic year name is required",n.trim()||(u.fromYear="From year is required"),o.trim()||(u.toYear="To year is required"),n&&o&&new Date(n)>=new Date(o)&&(u.toYear="To year must be after from year"),n&&o){const A=new Date(n),Y=new Date(o),i=365*24*60*60*1e3;Y-A<i&&(u.general="Academic year must span at least one year")}if(f&&n&&o){const A=new Date,Y=new Date;Y.setMonth(A.getMonth()+1);const i=new Date(n),g=new Date(o);i>Y&&(u.fromYear="Current academic year cannot start more than one month in the future"),g<A&&(u.toYear="Current academic year cannot end in the past")}return b(u),!u.name&&!u.fromYear&&!u.toYear&&!u.general},[l]),re=c.useCallback(()=>{const{terms:s,academicYearId:n}=T,o={general:"",terms:s.map(()=>({description:"",duration:"",startDate:"",endDate:""}))};n||(o.general="Academic year ID is required");const f=U[n]||[],u=s.filter(t=>t.description||t.startDate||t.endDate||t._id);(z?f.length:u.length)>3&&(o.general="Cannot have more than three terms per academic year");const Y=ae.find(t=>t._id===n),i=Y?new Date(Y.toYear):null;s.filter(t=>t.isCurrent).length>1&&(o.general="Only one term can be set as current");const x=Array.from({length:10},(t,S)=>`${S+1} month${S+1>1?"s":""}`);s.forEach((t,S)=>{if((t.description||t.startDate||t.endDate||t._id)&&!t.description.trim()&&(o.terms[S].description="Description is required"),(t.description||t.startDate||t.endDate||t._id)&&(!t.duration||!x.includes(t.duration))&&(o.terms[S].duration="Duration must be between 1 and 10 months"),(t.description||t.endDate||t._id)&&!t.startDate&&(o.terms[S].startDate="Start date is required"),(t.description||t.startDate||t._id)&&!t.endDate&&(o.terms[S].endDate="End date is required"),t.startDate&&t.endDate&&new Date(t.startDate)>=new Date(t.endDate)&&(o.terms[S].endDate="End date must be after start date"),i&&t.endDate&&new Date(t.endDate)>i&&(o.terms[S].endDate=`End date for ${t.name} cannot exceed academic year end date (${i.toLocaleDateString()})`),t.isCurrent&&t.startDate&&t.endDate){const he=new Date,pe=new Date;pe.setMonth(he.getMonth()+1);const Te=new Date(t.startDate),Ae=new Date(t.endDate);Te>pe&&(o.terms[S].startDate=`Term ${t.name} cannot be current: start date is more than one month in the future`),Ae<he&&(o.terms[S].endDate=`Term ${t.name} cannot be current: end date is in the past`)}});for(let t=0;t<s.length;t++)for(let S=t+1;S<s.length;S++)s[t].startDate&&s[t].endDate&&s[S].startDate&&s[S].endDate&&new Date(s[t].startDate)<=new Date(s[S].endDate)&&new Date(s[S].startDate)<=new Date(s[t].endDate)&&(o.terms[S].startDate=`Terms ${s[t].name} and ${s[S].name} have overlapping dates`);return j(o),!o.general&&o.terms.every(t=>!t.description&&!t.duration&&!t.startDate&&!t.endDate)},[T,ae,U,z]),ne=c.useCallback(async()=>{var A,Y;if(!se())return!1;if(!a)return b(i=>({...i,general:"User not authenticated. Please log in."})),!1;const{name:s,fromYear:n,toYear:o,isCurrent:f}=l,u={name:s,fromYear:new Date(n).toISOString(),toYear:new Date(o).toISOString(),isCurrent:f,createdBy:a,academicTerms:[],students:[],teachers:[]};try{R(!0),b(g=>({...g,name:"",fromYear:"",toYear:"",general:""}));const i=await P(_.ACADEMIC_YEARS,"POST",u);if(!i||i.status!=="success")throw new Error((i==null?void 0:i.message)||"Failed to create academic year");return await $(_.ACADEMIC_YEARS,"GET"),f&&await O(_.CURRENT_ACADEMIC_YEAR,"GET"),D(r),v(!1),!0}catch(i){const g=((Y=(A=i.response)==null?void 0:A.data)==null?void 0:Y.message)||i.message||"Failed to create academic year";return b(x=>({...x,general:g})),!1}finally{R(!1)}},[l,a,P,$,O]),de=c.useCallback(async()=>{var A,Y;if(!re())return!1;if(!a)return j(i=>({...i,general:"User not authenticated. Please log in."})),!1;const{terms:s,academicYearId:n,academicTermId:o}=T,f=s.filter(i=>i.description||i.startDate||i.endDate||i._id),u={academicYearId:n,terms:f.map(i=>({...i,startDate:i.startDate?new Date(i.startDate).toISOString():void 0,endDate:i.endDate?new Date(i.endDate).toISOString():void 0,createdBy:a}))};try{R(!0),j(t=>({...t,general:"",terms:t.terms.map(()=>({description:"",duration:"",startDate:"",endDate:""}))}));const i=o?`${_.ACADEMIC_TERM}/${o}`:_.ACADEMIC_TERM,x=await P(i,o?"PATCH":"POST",u);if(console.log("Term creation response:",x),!x||x.status!=="success")throw new Error((x==null?void 0:x.message)||`Failed to ${o?"update":"create"} academic term`);return await $(_.ACADEMIC_YEARS,"GET"),await G(n),h(m),B(!1),!0}catch(i){console.error("Error creating term:",i);const g=((Y=(A=i.response)==null?void 0:A.data)==null?void 0:Y.message)||i.message||`Failed to ${o?"update":"create"} academic term`;return j(x=>({...x,general:g})),!1}finally{R(!1)}},[T,a,P,$,G]),E=c.useCallback(async()=>{var Y,i;if(!se())return!1;const{id:s,name:n,fromYear:o,toYear:f,isCurrent:u}=l;if(!a)return b(g=>({...g,general:"User not authenticated. Please log in."})),!1;const A={name:n,fromYear:new Date(o).toISOString(),toYear:new Date(f).toISOString(),isCurrent:u,createdBy:a};try{R(!0),b(x=>({...x,name:"",fromYear:"",toYear:"",general:""}));const g=await P(`${_.ACADEMIC_YEARS}/${s}`,"PATCH",A);if(!g||g.status!=="success")throw new Error((g==null?void 0:g.message)||"Failed to update academic year");return await $(_.ACADEMIC_YEARS,"GET"),(u||(M==null?void 0:M._id)===s)&&await O(_.CURRENT_ACADEMIC_YEAR,"GET"),D(r),v(!1),!0}catch(g){const x=((i=(Y=g.response)==null?void 0:Y.data)==null?void 0:i.message)||g.message||"Failed to update academic year";return b(t=>({...t,general:x})),!1}finally{R(!1)}},[l,a,P,$,O,M]),Ce=c.useCallback(async()=>F?await E():await ne(),[F,ne,E]),be=c.useCallback(s=>{D({id:s._id,name:s.name,fromYear:s.fromYear.split("T")[0],toYear:s.toYear.split("T")[0],isCurrent:s.isCurrent}),v(!0),b({name:"",fromYear:"",toYear:"",general:""})},[]),xe=c.useCallback(async s=>{var f;await G(s);const n=U[s]||[],o=["1st Term","2nd Term","3rd Term"];if(n.length>0){const u=((f=n[0])==null?void 0:f._id)||"",A=o.map((Y,i)=>{const g=n.find(x=>x.name===Y);return g?{...g,startDate:g.startDate?new Date(g.startDate).toISOString().split("T")[0]:"",endDate:g.endDate?new Date(g.endDate).toISOString().split("T")[0]:"",createdBy:a}:{name:Y,description:"",duration:"3 months",startDate:"",endDate:"",createdBy:a,isCurrent:!1}});h({academicYearId:s,academicTermId:u,terms:A}),B(!0)}else h({...m,academicYearId:s,terms:m.terms.map(u=>({...u,createdBy:a}))}),B(!1);j({general:"",terms:Array(3).fill().map(()=>({description:"",duration:"",startDate:"",endDate:""}))})},[a,m,U,G]),Ie=c.useCallback(()=>{D(r),b({name:"",fromYear:"",toYear:"",general:""}),v(!1)},[]),Ye=c.useCallback(()=>{h(m),j({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]}),B(!1)},[]);return{setFormValues:D,formValues:l,handleChange:J,handleTermChange:K,handleSubmit:Ce,handleCreateAcademicTerm:de,startEdit:be,startAddTerm:xe,editMode:F,termEditMode:z,setEditMode:v,academicYears:ae,currentAcademicYear:M,academicTerms:U,loading:ie||ce||te||p,error:Z||ee||q||w.general?{...w,general:Z||ee||q||w.general}:w,termError:I,isSubmitting:H,resetForm:Ie,resetTermForm:Ye,termFormValues:T,handleDeleteAcademicYear:le,fetchAcademicTermsApi:G,termsLoading:p,termsError:q}},we=({message:a,sx:r})=>a?e.jsx(k,{variant:"h6",fontWeight:"bold",color:"error",sx:{mb:2,...r},children:a}):null,Pt=({open:a,onClose:r,handleSubmit:m,error:l={},editMode:D=!1,userId:T,formValues:h,handleChange:w,isSubmitting:b=!1})=>{const I=new Date().toISOString().split("T")[0],j=()=>{if(D)return null;if(!h.fromYear)return I;const v=new Date(h.fromYear);return v.setFullYear(v.getFullYear()+1),v.toISOString().split("T")[0]},F=async v=>{v.preventDefault();try{await m(h)&&r()}catch(z){console.error("Submission error:",z)}};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            opacity: 1;
          }
          input[type="date"] {
            color-scheme: light;
          }
        `}),e.jsx(ve,{open:a,onClose:r,title:D?"Edit Academic Year":"Add Academic Year",noConfirm:!0,children:e.jsxs(y,{component:"form",onSubmit:F,children:[e.jsx(y,{mb:2,children:e.jsx(oe,{label:"Academic Year Name (e.g., 2024/2025)",name:"name",value:h.name||"",onChange:w,fullWidth:!0,required:!0,error:!!l.name,helperText:l.name||"Format: YYYY/YYYY (e.g., 2024/2025)"})}),e.jsx(y,{mb:2,children:e.jsx(oe,{label:"From Year",name:"fromYear",type:"date",value:h.fromYear||"",onChange:w,fullWidth:!0,required:!0,error:!!l.fromYear,helperText:l.fromYear,InputLabelProps:{shrink:!0},inputProps:{min:D?null:I}})}),e.jsx(y,{mb:2,children:e.jsx(oe,{label:"To Year",name:"toYear",type:"date",value:h.toYear||"",onChange:w,fullWidth:!0,required:!0,error:!!l.toYear,helperText:l.toYear,InputLabelProps:{shrink:!0},inputProps:{min:j()}})}),e.jsx(y,{mb:2,children:e.jsx(He,{control:e.jsx(Ve,{checked:h.isCurrent||!1,onChange:w,name:"isCurrent",color:"primary"}),label:"Set as Current Academic Year"})}),e.jsx(we,{message:l.general})," ",e.jsx(Ge,{type:"submit",variant:"contained",color:"primary",disabled:b,fullWidth:!0,children:b?"Submitting...":D?"Update Academic Year":"Submit"})]})})]})},Mt=({open:a,onClose:r,handleSubmit:m,error:l={},userId:D,formValues:T,handleChange:h,isSubmitting:w=!1,academicYears:b,editMode:I=!1,academicTerms:j})=>{var V;const F=new Date().toISOString().split("T")[0],v=async p=>{p.preventDefault();try{await m()&&r()}catch(C){console.error("Submission error:",C)}},z=Array.from({length:10},(p,C)=>`${C+1} month${C+1>1?"s":""}`),B=b.find(p=>p._id===T.academicYearId),H=B?new Date(B.toYear).toISOString().split("T")[0]:F,R=((V=j[T.academicYearId])==null?void 0:V.length)||0,U=(B==null?void 0:B.isCurrent)||!1;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            opacity: 1;
          }
          input[type="date"] {
            color-scheme: light;
          }
        `}),e.jsx(ve,{open:a,onClose:r,title:I?"Edit Academic Terms":"Add Academic Terms",noConfirm:!0,children:e.jsxs(y,{component:"form",onSubmit:v,children:[e.jsx(y,{mb:2,children:e.jsxs(Ne,{fullWidth:!0,required:!0,disabled:I,children:[e.jsx(Be,{id:"academic-year-label",children:"Academic Year"}),e.jsx(Oe,{labelId:"academic-year-label",name:"academicYearId",value:T.academicYearId||"",onChange:p=>h({target:{name:"academicYearId",value:p.target.value}}),label:"Academic Year",children:b.map(p=>e.jsxs(ze,{value:p._id,children:[p.name," (",new Date(p.fromYear).toLocaleDateString()," -"," ",new Date(p.toYear).toLocaleDateString(),")"]},p._id))})]})}),T.terms.map((p,C)=>{var X,ie,Z,$,Q,ce,ee,O,te,P,G,ae,M,J,le,K,se,re,ne,de;const q=!!p._id,W=!q&&C>=3-R;return e.jsxs(y,{mb:3,sx:{border:"1px solid #ccc",p:2,borderRadius:1,opacity:W?.5:1,pointerEvents:W?"none":"auto"},children:[e.jsx(k,{variant:"h6",children:p.name}),e.jsx(y,{mb:2,children:e.jsx(oe,{label:"Term Name",name:"name",value:p.name||"",onChange:E=>h(E,C),fullWidth:!0,required:!0,disabled:!0,error:!!((ie=(X=l.terms)==null?void 0:X[C])!=null&&ie.name),helperText:($=(Z=l.terms)==null?void 0:Z[C])==null?void 0:$.name})}),e.jsx(y,{mb:2,children:e.jsx(oe,{label:"Description",name:"description",value:p.description||"",onChange:E=>h(E,C),fullWidth:!0,required:q||p.startDate||p.endDate,error:!!((ce=(Q=l.terms)==null?void 0:Q[C])!=null&&ce.description),helperText:(O=(ee=l.terms)==null?void 0:ee[C])==null?void 0:O.description,disabled:W})}),e.jsx(y,{mb:2,children:e.jsxs(Ne,{fullWidth:!0,required:q||p.description||p.endDate,error:!!((P=(te=l.terms)==null?void 0:te[C])!=null&&P.duration),disabled:W,children:[e.jsx(Be,{id:`duration-label-${C}`,children:"Duration"}),e.jsx(Oe,{labelId:`duration-label-${C}`,name:"duration",value:p.duration||"3 months",onChange:E=>h(E,C),label:"Duration",children:z.map(E=>e.jsx(ze,{value:E,children:E},E))}),e.jsx(we,{message:(ae=(G=l.terms)==null?void 0:G[C])==null?void 0:ae.duration})," "]})}),e.jsx(y,{mb:2,children:e.jsx(oe,{label:"Start Date",name:"startDate",type:"date",value:p.startDate||"",onChange:E=>h(E,C),fullWidth:!0,required:q||p.description||p.endDate,error:!!((J=(M=l.terms)==null?void 0:M[C])!=null&&J.startDate),helperText:(K=(le=l.terms)==null?void 0:le[C])==null?void 0:K.startDate,InputLabelProps:{shrink:!0},inputProps:{min:F,max:H},disabled:W})}),e.jsx(y,{mb:2,children:e.jsx(oe,{label:"End Date",name:"endDate",type:"date",value:p.endDate||"",onChange:E=>h(E,C),fullWidth:!0,required:q||p.description||p.startDate,error:!!((re=(se=l.terms)==null?void 0:se[C])!=null&&re.endDate),helperText:(de=(ne=l.terms)==null?void 0:ne[C])==null?void 0:de.endDate,InputLabelProps:{shrink:!0},inputProps:{min:p.startDate||F,max:H},disabled:W})}),U&&e.jsx(y,{mb:2,children:e.jsx(He,{control:e.jsx(Ve,{checked:p.isCurrent||!1,onChange:E=>h(E,C,!0),name:"isCurrent",color:"primary",disabled:W}),label:"Set as Current Term"})})]},p.name)}),e.jsx(we,{message:l.general})," ",e.jsx(Ge,{type:"submit",variant:"contained",color:"primary",disabled:w||!T.academicYearId,fullWidth:!0,children:w?"Submitting...":I?"Update Terms":"Submit"})]})})]})};class _t extends et.Component{constructor(){super(...arguments);$e(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(m){return{hasError:!0,error:m}}componentDidCatch(m,l){console.error("Error caught by boundary:",m,l)}render(){var m;return this.state.hasError?e.jsxs(y,{sx:{p:3,textAlign:"center"},children:[e.jsx(k,{variant:"h5",color:"error",children:"Something went wrong."}),e.jsx(k,{variant:"body1",mt:2,children:((m=this.state.error)==null?void 0:m.message)||"An unexpected error occurred."}),e.jsx(ye,{content:"Reload",onClick:()=>window.location.reload(),sx:{mt:2}})]}):this.props.children}}const Ft=()=>{var Me,_e,Fe,Re;const a=We(),r=qe(a.palette.mode),m=Ee(d=>{var L;return(L=d.users.user)==null?void 0:L._id})||"",{academicYears:l,currentAcademicYear:D,academicTerms:T,error:h,termError:w,handleSubmit:b,handleCreateAcademicTerm:I,handleDeleteAcademicYear:j,startEdit:F,startAddTerm:v,editMode:z,termEditMode:B,setEditMode:H,formValues:R,termFormValues:U,handleChange:V,handleTermChange:p,isSubmitting:C,resetForm:q,resetTermForm:W,fetchAcademicTermsApi:X,termsLoading:ie,termsError:Z}=It({userId:m}),[$,Q]=c.useState(!1),[ce,ee]=c.useState(!1),[O,te]=c.useState(!1),[P,G]=c.useState(null),[ae,M]=c.useState(!1),[J,le]=c.useState(null),[K,se]=c.useState("name"),[re,ne]=c.useState("asc"),[de,E]=c.useState(0),[Ce,be]=c.useState(5),[xe,Ie]=c.useState(""),[Ye,s]=c.useState(0),[n,o]=c.useState(5),f=[{id:"sn",label:"S/N"},{id:"name",label:"Name"},{id:"fromYear",label:"From Year"},{id:"toYear",label:"To Year"},{id:"isCurrent",label:"Current"},{id:"studentCount",label:"Students"},{id:"teacherCount",label:"Teachers"},{id:"actions",label:"Actions"}],u=[{id:"name",label:"Term Name"},{id:"description",label:"Description"},{id:"duration",label:"Duration"},{id:"startDate",label:"Start Date"},{id:"endDate",label:"End Date"},{id:"isCurrent",label:"Current"}],A=l.map((d,L)=>{var N,me;return{sn:L+1,id:d._id,name:d.name,fromYear:new Date(d.fromYear).toLocaleDateString(),toYear:new Date(d.toYear).toLocaleDateString(),isCurrent:d.isCurrent?"Yes":"No",studentCount:((N=d.students)==null?void 0:N.length)||0,teacherCount:((me=d.teachers)==null?void 0:me.length)||0,actions:e.jsxs(y,{children:[e.jsx(fe,{onClick:()=>Y(d),children:e.jsx(pt,{})}),e.jsx(fe,{onClick:()=>i(d._id),children:e.jsx(ft,{})}),e.jsx(fe,{onClick:()=>g(d._id),children:e.jsx(gt,{})}),e.jsx(fe,{onClick:()=>x(d._id),children:e.jsx(Dt,{})})]})}}),Y=d=>{F(d),Q(!0)},i=d=>{v(d),ee(!0)},g=d=>{le(d),M(!0),s(0),X(d)},x=d=>{G(d),te(!0)},t=async()=>{P&&await j(P)&&(te(!1),G(null))},S=()=>{te(!1),G(null)},he=d=>{const L=K===d&&re==="asc";se(d),ne(L?"desc":"asc")},pe=(d,L)=>{E(L)},Te=d=>{be(parseInt(d.target.value,10)),E(0)},Ae=(d,L)=>{s(L)},Qe=d=>{o(parseInt(d.target.value,10)),s(0)},Je=[...A.filter(d=>d.name.toLowerCase().includes(xe.toLowerCase()))].sort((d,L)=>{const N=d[K],me=L[K];return re==="asc"?N>me?1:-1:N<me?1:-1}),Pe=d=>(T[d]||[]).map(N=>({id:N._id||"N/A",name:N.name||"N/A",description:N.description||"N/A",duration:N.duration||"N/A",startDate:N.startDate?new Date(N.startDate).toLocaleDateString():"N/A",endDate:N.endDate?new Date(N.endDate).toLocaleDateString():"N/A",isCurrent:N.isCurrent?"Yes":"No"}));return e.jsx(_t,{children:e.jsxs(Se,{container:!0,children:[e.jsx(Se,{item:!0,xs:12,children:e.jsx(Ue,{title:"Academics Management",subtitle:"Manage Academic Sessions"})}),e.jsxs(Se,{item:!0,xs:12,children:[e.jsxs(y,{sx:{mb:3,p:2,backgroundColor:r.primary[400],borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(y,{children:[e.jsx(k,{variant:"h5",color:r.grey[100],children:"Current Academic Year"}),D?e.jsxs(k,{variant:"body1",color:r.grey[100],children:[D.name," (",new Date(D.fromYear).toLocaleDateString()," -"," ",new Date(D.toYear).toLocaleDateString(),") |"," ",((Me=D.students)==null?void 0:Me.length)||0," Students,"," ",((_e=D.teachers)==null?void 0:_e.length)||0," Teachers,"," ",((Fe=T[D._id])==null?void 0:Fe.length)||0," Terms"]}):e.jsx(k,{variant:"body1",color:r.redAccent[500],children:"No current academic year set."})]}),e.jsx(ye,{onClick:()=>{Q(!0),H(!1),q()},content:"Add Academic Year"})]}),e.jsx(Pt,{open:$,onClose:()=>{Q(!1),H(!1),q()},handleSubmit:b,error:h,editMode:z,userId:m,formValues:R,handleChange:V,isSubmitting:C}),e.jsx(Mt,{open:ce,onClose:()=>{ee(!1),W()},handleSubmit:I,error:w,userId:m,formValues:U,handleChange:p,isSubmitting:C,academicYears:l,editMode:B,academicTerms:T}),e.jsx(ve,{open:O,onClose:S,title:"Confirm Deletion",noConfirm:!1,confirmText:"Delete",onConfirm:t,cancelText:"Cancel",children:e.jsx(k,{children:"Are you sure you want to delete this academic year? This action cannot be undone."})}),e.jsx(mt,{open:ae,onClose:()=>M(!1),sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(y,{sx:{bgcolor:r.primary[400],p:3,borderRadius:1,maxWidth:"80%",maxHeight:"80%",overflow:"auto"},children:[e.jsxs(k,{variant:"h6",gutterBottom:!0,children:["Academic Terms for ",((Re=l.find(d=>d._id===J))==null?void 0:Re.name)||"Selected Year"]}),ie?e.jsx(k,{color:r.grey[100],children:"Loading terms..."}):Z?e.jsxs(k,{color:r.redAccent[500],children:["Error: ",Z]}):J&&Pe(J).length>0?e.jsx(Le,{columns:u,tableHeader:"Terms",data:Pe(J),sortBy:"name",sortDirection:"asc",page:Ye,rowsPerPage:n,onPageChange:Ae,onRowsPerPageChange:Qe,hiddenColumnsSmallScreen:["description","duration"],hiddenColumnsTabScreen:["description"]}):e.jsx(k,{color:r.redAccent[500],children:'No terms found for this academic year. Add terms using the "+" button.'}),e.jsx(ye,{content:"Close",onClick:()=>M(!1),sx:{mt:2}})]})}),e.jsx(Le,{columns:f,tableHeader:"Academic Years",data:Je,sortBy:K,sortDirection:re,onSortChange:he,page:de,rowsPerPage:Ce,onPageChange:pe,onRowsPerPageChange:Te,hiddenColumnsSmallScreen:["fromYear","toYear","studentCount","teacherCount","actions"],hiddenColumnsTabScreen:["studentCount","teacherCount"]})]})]})})},Rt=()=>{const a=Ee(r=>r.users.user.role);return console.log(a),e.jsx("div",{children:a==="teacher"?e.jsx(kt,{}):e.jsx(Ft,{})})},na=Ct(Rt);export{na as default};
