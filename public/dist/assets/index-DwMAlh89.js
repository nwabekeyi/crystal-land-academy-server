import{j as e,r as d,f as P,C as Pe,i as _e,a as de,D as lt,E as Dt}from"./index-Dia3dXnv.js";import{r as ve,t as R,M as se}from"./modal-CRceNtXl.js";import{c as De,a as Et,g as kt,u as wt,_ as ct,K as dt,af as Tt,ap as Ft,$ as Rt,o as Mt,b as Y,s as Ee,d as Ce,h as ut,e as Lt,aq as Ot,ar as Pt,q as be,j as M,v as l,T as a,w as ke,y as _,a1 as Ie,a2 as $e,a3 as We}from"./TextField-CiACpH9R.js";import{H as Nt}from"./Header-BKDrWR6o.js";import{G as Ve,L as we,a as Te,d as Be,C as Fe,b as Re,A as mt}from"./index-HCkcCK1E.js";import{t as ht}from"./nivo-pie-BVAn4h58.js";import{p as xt}from"./nivo-line.es-BN04JNkI.js";import{u as H}from"./useApi-CcDc2KeG.js";import{u as gt}from"./index-B_m23NjE.js";import{f as Ne,F as Ye,m as He,a as Ge,b as ft}from"./main-CdGqE39d.js";import{m as qe}from"./main-BeJNAls5.js";import{A as Ue}from"./Alert-DzwxKnjn.js";import{I as Xe}from"./IconButton-BeQuUMyU.js";import{X as zt}from"./nivo-bar-Cl5IhCWl.js";import{u as ot}from"./useMediaQuery-D2Chhg5w.js";import{w as It}from"./dasboardPagesContainer-FR1z_d3q.js";import{C as pt}from"./confirmationModal-CIDTnzxs.js";import{C as $t}from"./CircularProgress-Du6yAQTu.js";import{M as je}from"./MenuItem-9u3wVos-.js";import{A as ge}from"./actionButton-BwgkxJSG.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-BVdpsmmF.js";import"./isEqual-D0K1Aaai.js";import"./_baseIsEqual-CUbWgzuQ.js";import"./_baseForOwn-BHTwPXXH.js";import"./loadingButton-Dn6lZ4mI.js";import"./_baseSlice-z0Zd1-Ev.js";const Wt={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"},_t=De(e.jsx("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),Vt=De(e.jsx("path",{d:"M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"}),"StarBorder");function Bt(t){return kt("MuiRating",t)}const fe=Et("MuiRating",["root","sizeSmall","sizeMedium","sizeLarge","readOnly","disabled","focusVisible","visuallyHidden","pristine","label","labelEmptyValueActive","icon","iconEmpty","iconFilled","iconHover","iconFocus","iconActive","decimal"]),Yt=["value"],Ht=["className","defaultValue","disabled","emptyIcon","emptyLabelText","getLabelText","highlightSelectedOnly","icon","IconContainerComponent","max","name","onChange","onChangeActive","onMouseLeave","onMouseMove","precision","readOnly","size","value"];function Gt(t){const s=t.toString().split(".")[1];return s?s.length:0}function ze(t,s){if(t==null)return t;const n=Math.round(t/s)*s;return Number(n.toFixed(Gt(s)))}const qt=t=>{const{classes:s,size:n,readOnly:i,disabled:o,emptyValueFocused:c,focusVisible:r}=t,f={root:["root",`size${ut(n)}`,o&&"disabled",r&&"focusVisible",i&&"readOnly"],label:["label","pristine"],labelEmptyValue:[c&&"labelEmptyValueActive"],icon:["icon"],iconEmpty:["iconEmpty"],iconFilled:["iconFilled"],iconHover:["iconHover"],iconFocus:["iconFocus"],iconActive:["iconActive"],decimal:["decimal"],visuallyHidden:["visuallyHidden"]};return Lt(f,Bt,s)},Ut=Ee("span",{name:"MuiRating",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:n}=t;return[{[`& .${fe.visuallyHidden}`]:s.visuallyHidden},s.root,s[`size${ut(n.size)}`],n.readOnly&&s.readOnly]}})(({theme:t,ownerState:s})=>Y({display:"inline-flex",position:"relative",fontSize:t.typography.pxToRem(24),color:"#faaf00",cursor:"pointer",textAlign:"left",width:"min-content",WebkitTapHighlightColor:"transparent",[`&.${fe.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${fe.focusVisible} .${fe.iconActive}`]:{outline:"1px solid #999"},[`& .${fe.visuallyHidden}`]:Wt},s.size==="small"&&{fontSize:t.typography.pxToRem(18)},s.size==="large"&&{fontSize:t.typography.pxToRem(30)},s.readOnly&&{pointerEvents:"none"})),jt=Ee("label",{name:"MuiRating",slot:"Label",overridesResolver:({ownerState:t},s)=>[s.label,t.emptyValueFocused&&s.labelEmptyValueActive]})(({ownerState:t})=>Y({cursor:"inherit"},t.emptyValueFocused&&{top:0,bottom:0,position:"absolute",outline:"1px solid #999",width:"100%"})),Xt=Ee("span",{name:"MuiRating",slot:"Icon",overridesResolver:(t,s)=>{const{ownerState:n}=t;return[s.icon,n.iconEmpty&&s.iconEmpty,n.iconFilled&&s.iconFilled,n.iconHover&&s.iconHover,n.iconFocus&&s.iconFocus,n.iconActive&&s.iconActive]}})(({theme:t,ownerState:s})=>Y({display:"flex",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest}),pointerEvents:"none"},s.iconActive&&{transform:"scale(1.2)"},s.iconEmpty&&{color:(t.vars||t).palette.action.disabled})),Jt=Ee("span",{name:"MuiRating",slot:"Decimal",shouldForwardProp:t=>Ot(t)&&t!=="iconActive",overridesResolver:(t,s)=>{const{iconActive:n}=t;return[s.decimal,n&&s.iconActive]}})(({iconActive:t})=>Y({position:"relative"},t&&{transform:"scale(1.2)"}));function Kt(t){const s=ct(t,Yt);return e.jsx("span",Y({},s))}function it(t){const{classes:s,disabled:n,emptyIcon:i,focus:o,getLabelText:c,highlightSelectedOnly:r,hover:f,icon:u,IconContainerComponent:m,isActive:x,itemValue:h,labelProps:D,name:C,onBlur:k,onChange:g,onClick:y,onFocus:S,readOnly:E,ownerState:p,ratingValue:j,ratingValueRounded:N}=t,v=r?h===j:h<=j,z=h<=f,I=h<=o,K=h===N,G=dt(),V=e.jsx(Xt,{as:m,value:h,className:Ce(s.icon,v?s.iconFilled:s.iconEmpty,z&&s.iconHover,I&&s.iconFocus,x&&s.iconActive),ownerState:Y({},p,{iconEmpty:!v,iconFilled:v,iconHover:z,iconFocus:I,iconActive:x}),children:i&&!v?i:u});return E?e.jsx("span",Y({},D,{children:V})):e.jsxs(d.Fragment,{children:[e.jsxs(jt,Y({ownerState:Y({},p,{emptyValueFocused:void 0}),htmlFor:G},D,{children:[V,e.jsx("span",{className:s.visuallyHidden,children:c(h)})]})),e.jsx("input",{className:s.visuallyHidden,onFocus:S,onBlur:k,onChange:g,onClick:y,disabled:n,value:h,id:G,type:"radio",name:C,checked:K})]})}const Qt=e.jsx(_t,{fontSize:"inherit"}),Zt=e.jsx(Vt,{fontSize:"inherit"});function en(t){return`${t} Star${t!==1?"s":""}`}const tn=d.forwardRef(function(s,n){const i=wt({name:"MuiRating",props:s}),{className:o,defaultValue:c=null,disabled:r=!1,emptyIcon:f=Zt,emptyLabelText:u="Empty",getLabelText:m=en,highlightSelectedOnly:x=!1,icon:h=Qt,IconContainerComponent:D=Kt,max:C=5,name:k,onChange:g,onChangeActive:y,onMouseLeave:S,onMouseMove:E,precision:p=1,readOnly:j=!1,size:N="medium",value:v}=i,z=ct(i,Ht),I=dt(k),[K,G]=Tt({controlled:v,default:c,name:"Rating"}),V=ze(K,p),te=Ft(),[{hover:w,focus:Q},J]=d.useState({hover:-1,focus:-1});let q=V;w!==-1&&(q=w),Q!==-1&&(q=Q);const{isFocusVisibleRef:ae,onBlur:L,onFocus:me,ref:ie}=Rt(),[Z,he]=d.useState(!1),ye=d.useRef(),Me=Mt(ie,ye,n),Se=O=>{E&&E(O);const W=ye.current,{right:U,left:Ae,width:le}=W.getBoundingClientRect();let ce;te?ce=(U-O.clientX)/le:ce=(O.clientX-Ae)/le;let ee=ze(C*ce+p/2,p);ee=Pt(ee,p,C),J(re=>re.hover===ee&&re.focus===ee?re:{hover:ee,focus:ee}),he(!1),y&&w!==ee&&y(O,ee)},Le=O=>{S&&S(O);const W=-1;J({hover:W,focus:W}),y&&w!==W&&y(O,W)},b=O=>{let W=O.target.value===""?null:parseFloat(O.target.value);w!==-1&&(W=w),G(W),g&&g(O,W)},$=O=>{O.clientX===0&&O.clientY===0||(J({hover:-1,focus:-1}),G(null),g&&parseFloat(O.target.value)===V&&g(O,null))},A=O=>{me(O),ae.current===!0&&he(!0);const W=parseFloat(O.target.value);J(U=>({hover:U.hover,focus:W}))},B=O=>{if(w!==-1)return;L(O),ae.current===!1&&he(!1);const W=-1;J(U=>({hover:U.hover,focus:W}))},[Ct,rt]=d.useState(!1),xe=Y({},i,{defaultValue:c,disabled:r,emptyIcon:f,emptyLabelText:u,emptyValueFocused:Ct,focusVisible:Z,getLabelText:m,icon:h,IconContainerComponent:D,max:C,precision:p,readOnly:j,size:N}),ne=qt(xe);return e.jsxs(Ut,Y({ref:Me,onMouseMove:Se,onMouseLeave:Le,className:Ce(ne.root,o,j&&"MuiRating-readOnly"),ownerState:xe,role:j?"img":null,"aria-label":j?m(q):null},z,{children:[Array.from(new Array(C)).map((O,W)=>{const U=W+1,Ae={classes:ne,disabled:r,emptyIcon:f,focus:Q,getLabelText:m,highlightSelectedOnly:x,hover:w,icon:h,IconContainerComponent:D,name:I,onBlur:B,onChange:b,onClick:$,onFocus:A,ratingValue:q,ratingValueRounded:V,readOnly:j,ownerState:xe},le=U===Math.ceil(q)&&(w!==-1||Q!==-1);if(p<1){const ce=Array.from(new Array(1/p));return e.jsx(Jt,{className:Ce(ne.decimal,le&&ne.iconActive),ownerState:xe,iconActive:le,children:ce.map((ee,re)=>{const Oe=ze(U-1+(re+1)*p,p);return e.jsx(it,Y({},Ae,{isActive:!1,itemValue:Oe,labelProps:{style:ce.length-1===re?{}:{width:Oe===q?`${(re+1)*p*100}%`:"0%",overflow:"hidden",position:"absolute"}}}),Oe)})},U)}return e.jsx(it,Y({},Ae,{isActive:le,itemValue:U}),U)}),!j&&!r&&e.jsxs(jt,{className:Ce(ne.label,ne.labelEmptyValue),ownerState:xe,children:[e.jsx("input",{className:ne.visuallyHidden,value:"",id:`${I}-empty`,type:"radio",name:I,checked:V==null,onFocus:()=>rt(!0),onBlur:()=>rt(!1),onChange:b}),e.jsx("span",{className:ne.visuallyHidden,children:u})]})]}))}),Je=De(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),Ke=De(e.jsx("path",{d:"M3 13h2v-2H3zm0 4h2v-2H3zm0-8h2V7H3zm4 4h14v-2H7zm0 4h14v-2H7zM7 7v2h14V7z"}),"List");var Qe={},nn=be;Object.defineProperty(Qe,"__esModule",{value:!0});var vt=Qe.default=void 0,sn=nn(ve()),an=e;vt=Qe.default=(0,sn.default)((0,an.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7zm-8 2V5h2v6h1.17L12 13.17 9.83 11zm-6 7h14v2H5z"}),"DownloadOutlined");var Ze={},rn=be;Object.defineProperty(Ze,"__esModule",{value:!0});var bt=Ze.default=void 0,on=rn(ve()),ln=e;bt=Ze.default=(0,on.default)((0,ln.jsx)("path",{d:"M12 12.75c1.63 0 3.07.39 4.24.9 1.08.48 1.76 1.56 1.76 2.73V18H6v-1.61c0-1.18.68-2.26 1.76-2.73 1.17-.52 2.61-.91 4.24-.91M4 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m1.13 1.1c-.37-.06-.74-.1-1.13-.1-.99 0-1.93.21-2.78.58C.48 14.9 0 15.62 0 16.43V18h4.5v-1.61c0-.83.23-1.61.63-2.29M20 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m4 3.43c0-.81-.48-1.53-1.22-1.85-.85-.37-1.79-.58-2.78-.58-.39 0-.76.04-1.13.1.4.68.63 1.46.63 2.29V18H24zM12 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3"}),"Groups");var et={},cn=be;Object.defineProperty(et,"__esModule",{value:!0});var yt=et.default=void 0,dn=cn(ve()),un=e;yt=et.default=(0,dn.default)((0,un.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 14H4V8l8 5 8-5zm-8-7L4 6h16z"}),"MailOutline");var tt={},mn=be;Object.defineProperty(tt,"__esModule",{value:!0});var St=tt.default=void 0,hn=mn(ve()),xn=e;St=tt.default=(0,hn.default)((0,xn.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const T=({children:t,noFlex:s,height:n,moreStyles:i={}})=>{const o=M(),c=R(o.palette.mode);return e.jsxs(l,{backgroundColor:c.primary[400],p:"20px",borderRadius:"10px",textAlign:"center",display:!s&&"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",sx:{height:n||"100%",boxShadow:o.palette.mode==="light"?"0px 2px 10px rgba(0, 0, 0, 0.1)":"0px 4px 12px rgba(0, 0, 0, 0.3)",...i},children:[t," "]})},nt=({children:t,...s})=>e.jsxs(Ve,{container:!0,spacing:2,...s,children:[t," "]}),X=({children:t})=>e.jsxs(Ve,{container:!0,item:!0,xs:12,spacing:2,children:[t," "]}),F=({children:t,...s})=>e.jsxs(Ve,{item:!0,xs:12,...s,children:[t," "]}),gn=({classLevels:t})=>{const s=M(),n=R(s.palette.mode);if(console.log("Class Levels Data:",t),!t||!Array.isArray(t)||t.length===0)return e.jsx(l,{children:e.jsx(a,{variant:"body1",align:"center",sx:{mt:2,color:n.grey[100]},children:"No class distribution data available for the current academic year"})});const i=r=>r&&typeof r=="object"&&r.name&&r.section&&r.academicYear&&typeof r.studentCount=="number",o=t.filter(r=>i(r)&&r.studentCount>0).map(r=>({id:r.name,label:`${r.name} (${r.section})`,value:r.studentCount,color:r.section==="Primary"?"rgba(75, 192, 192, 0.6)":"rgba(255, 159, 64, 0.6)"})),c=t.filter(i).map(r=>({id:r.id,label:`${r.name} (${r.section})`,studentCount:r.studentCount}));return e.jsxs(l,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,color:n.grey[100]},children:"Class Distribution (Students)"}),o.length===0?e.jsx(a,{variant:"body1",align:"center",sx:{color:n.grey[100]},children:"No active students to display in the current academic year"}):e.jsx("div",{style:{height:"350px"},children:e.jsx(ht,{data:o,theme:{axis:{domain:{line:{stroke:n.grey[100]}},legend:{text:{fill:n.grey[100]}},ticks:{line:{stroke:n.grey[100],strokeWidth:1},text:{fill:n.grey[100]}}},legends:{text:{fill:n.grey[100]}},tooltip:{container:{background:n.primary[400],color:n.grey[100],fontSize:12}}},margin:{top:40,right:80,bottom:80,left:80},innerRadius:.5,padAngle:.7,cornerRadius:3,activeOuterRadiusOffset:8,borderColor:{from:"color",modifiers:[["darker",.2]]},arcLinkLabelsSkipAngle:10,arcLinkLabelsTextColor:n.grey[100],arcLinkLabelsThickness:2,arcLinkLabelsColor:{from:"color"},enableArcLabels:!0,arcLabelsRadiusOffset:.4,arcLabelsSkipAngle:7,arcLabelsTextColor:{from:"color",modifiers:[["darker",2]]},colors:o.map(r=>r.color),defs:[{id:"dots",type:"patternDots",background:"inherit",color:"rgba(255, 255, 255, 0.3)",size:4,padding:1,stagger:!0},{id:"lines",type:"patternLines",background:"inherit",color:"rgba(255, 255, 255, 0.3)",rotation:-45,lineWidth:6,spacing:10}],legends:[{anchor:"bottom",direction:"row",justify:!1,translateX:0,translateY:56,itemsSpacing:0,itemWidth:100,itemHeight:18,itemTextColor:"#999",itemDirection:"left-to-right",itemOpacity:1,symbolSize:18,symbolShape:"circle",effects:[{on:"hover",style:{itemTextColor:"#000"}}]}]})}),e.jsx(l,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:c.length>0?c.map(r=>e.jsxs(a,{sx:{color:n.grey[100],fontSize:12,minWidth:120},children:[r.label,": ",r.studentCount," students"]},r.id)):e.jsx(a,{variant:"body1",align:"center",sx:{color:n.grey[100]},children:"No valid class distribution data to display for the current academic year"})})]})},st=()=>{var Q,J,q,ae;const[t,s]=d.useState(0),n=gt(),[i,o]=d.useState([]),[c,r]=d.useState([]),{loading:f,error:u,callApi:m}=H(),{loading:x,data:h,error:D,callApi:C}=H(),{loading:k,data:g,error:y,callApi:S}=H(),{loading:E,data:p,error:j,callApi:N}=H(),v=d.useCallback(()=>(console.log("Fetching subjects from:",P.SUBJECT),m(P.SUBJECT,"GET")),[m]),z=d.useCallback(()=>(console.log("Fetching financial data from:",P.FINANCIAL_DATA),C(P.FINANCIAL_DATA,"GET")),[C]),I=d.useCallback(()=>(console.log("Fetching outstanding fees from:",P.OUTSTANDING_FEES_DATA),S(P.OUTSTANDING_FEES_DATA,"GET")),[S]),K=d.useCallback(()=>(console.log("Fetching admin stats from:",P.ADMIN_DATA),N(P.ADMIN_DATA,"GET")),[N]);d.useEffect(()=>{const L=new AbortController;return(async()=>{await Promise.all([v(),z(),I(),K()])})(),()=>{console.log("Cleaning up useAdminData API calls"),L.abort()}},[v,z,I,K]),d.useEffect(()=>{if(p){console.log("Raw Admin Stats Data:",p);const L=p.data||{};console.log("Processed Admin Stats Data:",L),o(L.classLevels||[]),s(L.unreadEnquiries||0)}j&&(console.error("Admin Stats Error:",j),n(Pe(j.message||"Failed to fetch admin stats.")))},[p,j,n]),d.useEffect(()=>{h&&(console.log("Raw Financial Data:",h),console.log("Processed Financial Data:",(h==null?void 0:h.data)||{})),D&&(console.error("Financial Data Error:",D),n(Pe(D.message||"Failed to fetch financial data.")))},[h,D,n]),d.useEffect(()=>{g&&(console.log("Raw Outstanding Fees Data:",g),console.log("Processed Outstanding Fees Data:",(g==null?void 0:g.data)||[])),y&&(console.error("Outstanding Fees Error:",y),n(Pe(y.message||"Failed to fetch outstanding fees data.")))},[g,y,n]);const G=d.useMemo(()=>{var ie;const L=((ie=p==null?void 0:p.data)==null?void 0:ie.enrollmentsPerAcademicYear)||[];return console.log("Enrollments Data:",L),{total:L.map(Z=>({id:`Total-${Z.academicYear}`,academicYear:Z.academicYear,value:Z.enrollmentCount})).filter(Z=>Z.value>0)}},[p]),V=d.useMemo(()=>i.map(L=>({id:L.id,name:L.name,section:L.section,academicYear:L.academicYear,studentCount:L.studentCount})),[i]);d.useEffect(()=>{console.log("Class Distribution Data:",V)},[V]);const te=d.useMemo(()=>{const L=(g==null?void 0:g.data)||[];return console.log("Memoized Outstanding Fees Data:",L),L},[g]),w=[u,D,y,j].find(L=>L)||null;return{usersData:{totalStudents:((Q=p==null?void 0:p.data)==null?void 0:Q.totalStudents)||0,totalTeachers:((J=p==null?void 0:p.data)==null?void 0:J.totalTeachers)||0,currentYearStudents:((q=p==null?void 0:p.data)==null?void 0:q.currentYearStudents)||0,topTeachers:((ae=p==null?void 0:p.data)==null?void 0:ae.topTeachers)||[]},unreadEnquiriesCount:t,classLevels:V,subjects:c,financialData:(h==null?void 0:h.data)||{primary:[],secondary:[]},outstandingFeesData:te,enrollmentData:G,financialDataLoading:x,financialDataError:D,outstandingFeesLoading:k,outstandingFeesError:y,adminStatsLoading:E,adminStatsError:j,enrollmentDataLoading:E,enrollmentDataError:j,loading:f||x||k||E,error:w,refetchSubjects:v,refetchFinancialData:z,refetchOutstandingFees:I,refetchAdminStats:K}},fn=({isCustomLineColors:t=!1,isDashboard:s=!1})=>{const n=M(),i=d.useMemo(()=>R(n.palette.mode),[n.palette.mode]),{financialData:o,financialDataLoading:c,financialDataError:r}=st(),f=x=>`hsl(${x*360/2%360}, 70%, 60%)`,u=d.useMemo(()=>{var D,C;const x=(o==null?void 0:o.data)||o||{primary:[],secondary:[]};return!((D=x.primary)!=null&&D.length)&&!((C=x.secondary)!=null&&C.length)?[]:["primary","secondary"].filter(k=>{var g;return(g=x[k])==null?void 0:g.length}).map((k,g)=>({id:k.charAt(0).toUpperCase()+k.slice(1),color:t?f(g):void 0,data:x[k].map(y=>({x:y.label.split(" ")[0],y:y.value||0}))}))},[o,t]),m=d.useMemo(()=>{var C,k;const x=(o==null?void 0:o.data)||o||{primary:[],secondary:[]},h=((C=x.primary)==null?void 0:C.reduce((g,y)=>g+(y.value||0),0))||0,D=((k=x.secondary)==null?void 0:k.reduce((g,y)=>g+(y.value||0),0))||0;return h+D},[o]);return c?e.jsx(l,{children:"Loading data..."}):r?e.jsxs(l,{children:["Error: ",r.message||"Failed to load financial data"]}):u.length?e.jsxs(l,{width:"98%",height:s?"300px":"400px",children:[e.jsxs(a,{variant:"subtitle1",sx:{mb:2,color:i.grey[100]},children:["Total Revenue: ₦",m.toLocaleString("en-NG")]}),e.jsx(xt,{data:u,animate:!0,motionConfig:"default",theme:{axis:{domain:{line:{stroke:i.grey[100]}},legend:{text:{fill:i.grey[100],fontSize:8}},ticks:{line:{stroke:i.grey[100],strokeWidth:1},text:{fill:i.grey[100],fontSize:8}}},legends:{text:{fill:i.grey[100],fontSize:8}},tooltip:{container:{background:i.primary[500],color:i.grey[100],fontSize:12},format:x=>`₦${x.toLocaleString("en-NG")}`}},colors:t?{datum:"color"}:{scheme:"nivo"},margin:{top:50,right:110,bottom:50,left:60},xScale:{type:"point"},yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:x=>`₦${x.toLocaleString("en-NG")}`,curve:"catmullRom",axisTop:null,axisRight:null,axisBottom:{tickSize:0,tickPadding:5,tickRotation:45,legend:s?void 0:"Academic Year",legendOffset:36,legendPosition:"middle"},axisLeft:{tickValues:5,tickSize:3,tickPadding:5,tickRotation:0,legend:s?void 0:"Revenue (₦)",legendOffset:-50,legendPosition:"middle",format:x=>`₦${x.toLocaleString("en-NG")}`},enableGridX:!1,enableGridY:!1,pointSize:8,pointColor:{theme:"background"},pointBorderWidth:2,pointBorderColor:{from:"serieColor"},enablePoints:!0,enablePointLabel:!0,pointLabel:"y",pointLabelYOffset:-12,useMesh:!0,legends:[{anchor:"bottom-right",direction:"column",justify:!1,translateX:100,translateY:0,itemsSpacing:0,itemDirection:"left-to-right",itemWidth:80,itemHeight:20,itemOpacity:.75,symbolSize:12,symbolShape:"circle",symbolBorderColor:"rgba(0, 0, 0, .5)",effects:[{on:"hover",style:{itemBackground:"rgba(0, 0, 0, .03)",itemOpacity:1}}]}]})]}):e.jsx(l,{children:"No financial data available."})},pn=()=>{const t=M(),s=R(t.palette.mode),{error:n,callApi:i}=H(),[o,c]=d.useState([]),[r,f]=d.useState(!1),[u,m]=d.useState(!1),[x,h]=d.useState(!1),[D,C]=d.useState(""),[k,g]=d.useState(!1),[y,S]=d.useState(!1),[E,p]=d.useState(null),[j,N]=d.useState({title:"",description:"",day:"",startDate:"",endDate:""}),[v,z]=d.useState(null),[I,K]=d.useState(null),[G,V]=d.useState(!1),[te,w]=d.useState(null);d.useEffect(()=>{if(te){const b=setTimeout(()=>w(null),5e3);return()=>clearTimeout(b)}},[te]),d.useEffect(()=>{(async()=>{const $=await i(P.EVENT,"GET");if($){console.log("Fetched events:",$);const A=$.data.map(B=>({id:B._id,title:B.title,start:B.startDate,end:B.endDate,allDay:B.startDate===B.endDate}));c(A)}else w(n||"Failed to fetch events")})()},[i,n]);const Q=b=>{const $=new Date(b.startStr),A=new Date($.getTime()+60*60*1e3);K(b),N({title:"",description:"",day:Ne(b.start,{weekday:"long"}),startDate:$.toISOString(),endDate:A.toISOString()}),f(!0)},J=async()=>{if(!sessionStorage.getItem("accessToken")){w("Please log in to add events");return}if(!j.title||!j.description||!j.day||!j.startDate||!j.endDate){w("All fields are required");return}const $=await i(P.EVENT,"POST",{title:j.title,description:j.description,day:j.day,startDate:j.startDate,endDate:j.endDate});if($){const A=$.data;c([...o,{id:A._id,title:A.title,start:A.startDate,end:A.endDate,allDay:A.startDate===A.endDate}]),f(!1),N({title:"",description:"",day:"",startDate:"",endDate:""}),C("Event created successfully"),h(!0),w(null)}else{const A=n||"Failed to create event";A.includes("Authentication required")||A.includes("No token provided")||A.includes("Invalid or expired token")?w("Please log in again to add events"):A.includes("admin only")?w("Only admins can add events"):w(A)}},q=b=>{if(!o.find(B=>B.id===b.event.id))return;const A={_id:b.event.id,title:b.event.title,description:"",day:Ne(b.event.start,{weekday:"long"}),startDate:b.event.start.toISOString(),endDate:b.event.end?b.event.end.toISOString():b.event.start.toISOString()};console.log("Selected event:",A),p(A),g(!0)},ae=()=>{g(!1),z(E),m(!0)},L=()=>{g(!1),S(!0)},me=async()=>{if(!sessionStorage.getItem("accessToken")){w("Please log in to update events");return}if(!v.title||!v.description||!v.day||!v.startDate||!v.endDate){w("All fields are required");return}const $=await i(`${P.EVENT}/${v._id}`,"PATCH",{title:v.title,description:v.description,day:v.day,startDate:v.startDate,endDate:v.endDate});if($){const A=$.data;c(o.map(B=>B.id===A._id?{id:A._id,title:A.title,start:A.startDate,end:A.endDate,allDay:A.startDate===A.endDate}:B)),m(!1),z(null),C("Event edited successfully"),h(!0),w(null)}else{const A=n||"Failed to update event";A.includes("Authentication required")||A.includes("No token provided")||A.includes("Invalid or expired token")?w("Please log in again to update events"):A.includes("admin only")?w("Only admins can update events"):w(A)}},ie=async()=>{if(!sessionStorage.getItem("accessToken")){w("Please log in to delete events");return}if(await i(`${P.EVENT}/${E._id}`,"DELETE"))c(o.filter(A=>A.id!==E._id)),S(!1),p(null),C("Event deleted successfully"),h(!0),w(null);else{const A=n||"Failed to delete event";A.includes("Authentication required")||A.includes("No token provided")||A.includes("Invalid or expired token")?w("Please log in again to delete events"):A.includes("admin only")?w("Only admins can delete events"):w(A)}},Z=()=>{f(!1),N({title:"",description:"",day:"",startDate:"",endDate:""}),w(null)},he=()=>{m(!1),z(null),w(null)},ye=()=>{g(!1),p(null)},Me=()=>{S(!1),p(null)},Se=()=>{h(!1),C("")},Le=()=>{V(b=>!b)};return e.jsxs(l,{my:"10px",children:[te&&e.jsx(Ue,{severity:"error",sx:{mb:2},onClose:()=>w(null),children:te}),e.jsxs(l,{display:"flex",justifyContent:"center",flexDirection:"column",children:[e.jsxs(l,{flex:"1 1 20%",backgroundColor:s.primary[400],py:"15px",borderRadius:"4px",sx:{width:"100%",height:"75vh",overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(l,{display:"flex",alignItems:"center",marginBottom:"10px",children:[e.jsx(Xe,{onClick:Le,sx:{backgroundColor:s.blueAccent[500],"&:hover":{backgroundColor:s.blueAccent[700]},padding:"10px",borderRadius:"50%"},children:G?e.jsx(Je,{}):e.jsx(Ke,{})}),e.jsx(a,{variant:"h6",sx:{marginLeft:"10px",fontWeight:"800"},children:G?"Hide Events":"Show Events"})]}),G&&e.jsx(a,{variant:"h4",sx:{marginBottom:"10px"},children:"Events"}),G&&e.jsx(ke,{children:o.length===0?e.jsx(a,{children:"No events available"}):o.map(b=>e.jsx(we,{sx:{backgroundColor:s.blueAccent[500],margin:"10px 0",borderRadius:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(Te,{primary:b.title,secondary:e.jsx(a,{sx:{fontSize:"0.7em",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:Ne(b.start,{year:"numeric",month:"short",day:"numeric"})})})},b.id))})]}),e.jsx(l,{flex:"1 1 100%",sx:{width:"100%"},children:e.jsx(Ye,{height:"75vh",plugins:[He,Ge,ft,qe],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:"dayGridMonth",editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,select:Q,eventClick:q,events:o})})]}),e.jsx(se,{open:r,onClose:Z,title:"Add Event",onConfirm:J,confirmText:"Create",cancelText:"Cancel",showCancel:!0,children:e.jsxs(l,{p:"20px",children:[e.jsx(_,{label:"Event Title",fullWidth:!0,value:j.title,onChange:b=>N({...j,title:b.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Description",fullWidth:!0,value:j.description,onChange:b=>N({...j,description:b.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Day",fullWidth:!0,value:j.day,InputProps:{readOnly:!0},sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Start Date",type:"datetime-local",fullWidth:!0,value:j.startDate.slice(0,16),onChange:b=>N({...j,startDate:new Date(b.target.value).toISOString()}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"End Date",type:"datetime-local",fullWidth:!0,value:j.endDate.slice(0,16),onChange:b=>N({...j,endDate:new Date(b.target.value).toISOString()}),sx:{marginBottom:"20px"}})]})}),e.jsx(se,{open:u,onClose:he,title:"Edit Event",onConfirm:me,confirmText:"Save",cancelText:"Cancel",showCancel:!0,children:e.jsxs(l,{p:"20px",children:[e.jsx(_,{label:"Event Title",fullWidth:!0,value:(v==null?void 0:v.title)||"",onChange:b=>z({...v,title:b.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Description",fullWidth:!0,value:(v==null?void 0:v.description)||"",onChange:b=>z({...v,description:b.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Day",fullWidth:!0,value:(v==null?void 0:v.day)||"",onChange:b=>z({...v,day:b.target.value}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"Start Date",type:"datetime-local",fullWidth:!0,value:(v==null?void 0:v.startDate.slice(0,16))||"",onChange:b=>z({...v,startDate:new Date(b.target.value).toISOString()}),sx:{marginBottom:"20px"}}),e.jsx(_,{label:"End Date",type:"datetime-local",fullWidth:!0,value:(v==null?void 0:v.endDate.slice(0,16))||"",onChange:b=>z({...v,endDate:new Date(b.target.value).toISOString()}),sx:{marginBottom:"20px"}})]})}),e.jsx(se,{open:k,onClose:ye,title:`Manage Event: ${(E==null?void 0:E.title)||""}`,onConfirm:ae,confirmText:"Edit",onCancel:L,cancelText:"Delete",showCancel:!0,children:e.jsx(l,{p:"20px",children:e.jsxs(a,{children:['Select an action for the event "',E==null?void 0:E.title,'".']})})}),e.jsx(se,{open:y,onClose:Me,title:"Confirm Delete",onConfirm:ie,confirmText:"Confirm",cancelText:"Cancel",showCancel:!0,children:e.jsx(l,{p:"20px",children:e.jsxs(a,{children:['Do you want to delete the event "',E==null?void 0:E.title,'"?']})})}),e.jsx(se,{open:x,onClose:Se,title:"Success",onConfirm:Se,confirmText:"OK",showCancel:!1,children:e.jsx(l,{p:"20px",children:e.jsx(a,{children:D})})})]})},jn=({outstandingFeesData:t})=>{const s=M(),n=R(s.palette.mode);if(console.log("Outstanding Fees Data:",t),!t||!Array.isArray(t)||t.length===0)return e.jsx(l,{children:e.jsx(a,{variant:"body1",align:"center",sx:{mt:2},children:"No outstanding fees data available"})});const i=u=>u&&typeof u=="object"&&u.id&&u.label&&typeof u.value=="number",o=["rgba(75, 192, 192, 0.6)","rgba(255, 159, 64, 0.6)","rgba(153, 102, 255, 0.6)","rgba(60, 179, 113, 0.6)","rgba(100, 149, 237, 0.6)","rgba(255, 99, 132, 0.6)"],c=u=>{const m=Math.abs(u.split("").reduce((x,h)=>x+h.charCodeAt(0),0))%o.length;return o[m]},r=t.filter(u=>i(u)&&u.value>0).map(u=>({id:u.id,label:u.label,value:u.value,color:c(u.id)})),f=t.filter(i).map(u=>({id:u.id,label:u.label,value:u.value}));return e.jsxs(l,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,color:n.grey[100]},children:"Outstanding Fees by Academic Year"}),r.length===0?e.jsx(a,{variant:"body1",align:"center",children:"No outstanding fees to display"}):e.jsx("div",{style:{height:"350px"},children:e.jsx(ht,{data:r,theme:{axis:{domain:{line:{stroke:n.grey[100]}},legend:{text:{fill:n.grey[100]}},ticks:{line:{stroke:n.grey[100],strokeWidth:1},text:{fill:n.grey[100]}}},legends:{text:{fill:n.grey[100]}},tooltip:{container:{background:n.primary[400],color:n.grey[100],fontSize:12}}},margin:{top:40,right:80,bottom:80,left:80},innerRadius:.5,padAngle:.7,cornerRadius:3,activeOuterRadiusOffset:8,borderColor:{from:"color",modifiers:[["darker",.2]]},arcLinkLabelsSkipAngle:10,arcLinkLabelsTextColor:n.grey[100],arcLinkLabelsThickness:2,arcLinkLabelsColor:{from:"color"},arcLinkLabel:u=>u.data.label,enableArcLabels:!0,arcLabelsRadiusOffset:.4,arcLabelsSkipAngle:7,arcLabelsTextColor:{from:"color",modifiers:[["darker",2]]},arcLabelsText:u=>`₦${u.value.toLocaleString()}`,colors:r.map(u=>u.color),defs:[{id:"dots",type:"patternDots",background:"inherit",color:"rgba(255, 255, 255, 0.3)",size:4,padding:1,stagger:!0},{id:"lines",type:"patternLines",background:"inherit",color:"rgba(255, 255, 255, 0.3)",rotation:-45,lineWidth:6,spacing:10}],legends:[{anchor:"bottom",direction:"row",justify:!1,translateX:0,translateY:56,itemsSpacing:0,itemWidth:100,itemHeight:18,itemTextColor:"#999",itemDirection:"left-to-right",itemOpacity:1,symbolSize:18,symbolShape:"circle",effects:[{on:"hover",style:{itemTextColor:"#000"}}],data:r.map(u=>({id:u.id,label:u.label}))}]})}),e.jsx(l,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:f.length>0?f.map(u=>e.jsxs(a,{sx:{color:n.grey[100],fontSize:12,minWidth:120},children:[u.label,": ₦",u.value.toLocaleString()]},u.id)):e.jsx(a,{variant:"body1",align:"center",children:"No valid outstanding fees data to display"})})]})},vn=({topTeachers:t})=>{const s=M(),n=R(s.palette.mode);console.log(t);const i=t&&Array.isArray(t)&&t.length>0?t.map(o=>({name:`${o.name}`.trim()||"Unnamed Teacher",subject:o.subject&&Array.isArray(o.subject)&&o.subject.length>0?o.subject[0].name:"No Subject",rating:o.rating||0})).sort((o,c)=>c.rating-o.rating).slice(0,5):[];return e.jsx(l,{sx:{height:"350px",overflowY:"auto"},children:i.length>0?e.jsx(ke,{children:i.map((o,c)=>e.jsx(we,{sx:{backgroundColor:n.primary[400],mb:1,borderRadius:"4px"},children:e.jsx(Te,{primary:`${o.name} (${o.subject})`,secondary:`Rating: ${o.rating}/5`,sx:{color:n.grey[100]}})},c))}):e.jsx(l,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx(a,{color:n.grey[100],children:"No teachers available"})})})},bn=()=>{var r;const t=M(),s=R(t.palette.mode),{enrollmentData:n,enrollmentDataLoading:i,enrollmentDataError:o}=st();if(i)return e.jsx(l,{children:"Loading..."});if(o)return e.jsxs(l,{children:["Error: ",o.message||"Failed to load data"]});if(!n||!((r=n.total)!=null&&r.length))return e.jsx(l,{children:"No enrollment data available."});const c=n.total.map(f=>({academicYear:f.academicYear,Total:f.value}));return console.log("Enrollment Chart Data:",c),e.jsxs(l,{height:"300px",children:[e.jsx(a,{variant:"h6",sx:{mb:1,color:s.grey[100],fontSize:"14px"},children:"Enrollment"}),e.jsx(zt,{data:c,keys:["Total"],indexBy:"academicYear",theme:{axis:{domain:{line:{stroke:s.grey[100]}},legend:{text:{fill:s.grey[100],fontSize:8}},ticks:{line:{stroke:s.grey[100],strokeWidth:1},text:{fill:s.grey[100],fontSize:8}}},legends:{text:{fill:s.grey[100],fontSize:8}},tooltip:{container:{background:s.primary[400],color:s.grey[100],fontSize:8}}},margin:{top:20,right:60,bottom:40,left:40},padding:.4,colors:{scheme:"nivo"},animate:!0,motionConfig:"default",axisTop:null,axisRight:null,axisBottom:{tickSize:3,tickPadding:3,tickRotation:45,legend:"Academic Year",legendPosition:"middle",legendOffset:30,truncateTickAt:0},axisLeft:{tickSize:3,tickPadding:3,tickRotation:0,legend:"Students",legendPosition:"middle",legendOffset:-30},labelSkipWidth:12,labelSkipHeight:12,labelTextColor:{from:"color",modifiers:[["darker",1.6]]},legends:[{dataFrom:"keys",anchor:"bottom-right",direction:"column",justify:!1,translateX:50,translateY:0,itemsSpacing:1,itemWidth:50,itemHeight:15,itemDirection:"left-to-right",itemOpacity:.85,symbolSize:12,effects:[{on:"hover",style:{itemOpacity:1}}]}]})]})},yn=()=>{const t=M(),s=R(t.palette.mode),[n,i]=d.useState(!0),[o,c]=d.useState(0),[r,f]=d.useState(0),[u,m]=d.useState(0),[x,h]=d.useState(null),{usersData:D,unreadEnquiriesCount:C,classLevels:k,financialData:g,outstandingFeesData:y,enrollmentData:S,loading:E,error:p}=st();if(d.useEffect(()=>{D&&(i(!1),c(D.totalStudents||0),f(D.totalTeachers||0),m(D.currentYearStudents||0)),p&&h(p.message||"An error occurred while fetching data.")},[D,p]),n||E)return e.jsx(_e,{});if(x)return e.jsx(l,{m:"20px",children:e.jsxs(a,{variant:"h4",color:"error",children:["Error: ",x]})});const j={mt:"15px",fontWeight:"bold"};return g&&[...g.primary,...g.secondary].reduce((N,v)=>N+(v.value||0),0),e.jsxs(l,{m:"20px",children:[e.jsx(a,{variant:"h3",fontWeight:"600",mb:"20px",children:"School Administration Dashboard"}),e.jsxs(nt,{children:[e.jsxs(X,{children:[e.jsx(F,{sm:6,md:3,children:e.jsxs(T,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Students"}),e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(bt,{sx:{fontSize:"70px",color:s.blueAccent[200]}}),e.jsx(a,{variant:"h4",color:s.blueAccent[200],sx:j,children:`${o} students`}),e.jsx(a,{children:"Total active students"})]})]})}),e.jsx(F,{sm:6,md:3,children:e.jsxs(T,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Teachers"}),e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(Be,{sx:{fontSize:"70px",color:s.blueAccent[200]}}),e.jsx(a,{variant:"h4",color:s.blueAccent[200],sx:j,children:`${r} teachers`}),e.jsx(a,{children:"Total teachers"})]})]})}),e.jsx(F,{sm:6,md:3,children:e.jsxs(T,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"New Students"}),e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(St,{sx:{fontSize:"70px",color:s.blueAccent[200]}}),e.jsx(a,{variant:"h4",color:s.blueAccent[200],sx:j,children:`${u} students`}),e.jsx(a,{children:"New students this academic year"})]})]})}),e.jsx(F,{sm:6,md:3,children:e.jsxs(T,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Unread Enquiries"}),e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(yt,{sx:{fontSize:"70px",color:s.blueAccent[200]}}),e.jsx(a,{variant:"h4",color:s.blueAccent[200],sx:j,children:C}),e.jsx(a,{children:"Total unread enquiries"})]})]})})]}),e.jsxs(X,{children:[e.jsx(F,{md:8,children:e.jsxs(T,{noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"School Fees Data"}),e.jsx(l,{mt:"10px",children:e.jsx(fn,{financialData:g})})]})}),e.jsx(F,{md:4,children:e.jsxs(T,{noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Outstanding Payments"}),e.jsx(l,{mt:"10px",children:e.jsx(jn,{outstandingFeesData:y})})]})})]}),e.jsxs(X,{children:[e.jsx(F,{md:4,children:e.jsxs(T,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",gutterBottom:!0,children:"Enrollment Stats"}),e.jsx(l,{mt:"10px",children:e.jsx(bn,{enrollmentData:S})})]})}),e.jsx(F,{md:4,children:e.jsxs(T,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",gutterBottom:!0,children:"Top Teachers"}),e.jsx(l,{mt:"10px",children:e.jsx(vn,{topTeachers:D.topTeachers})})]})}),e.jsx(F,{md:4,children:e.jsxs(T,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",gutterBottom:!0,children:"Class Distribution"}),e.jsx(l,{mt:"10px",children:e.jsx(gn,{classLevels:k})})]})})]}),e.jsx(X,{children:e.jsx(F,{md:12,children:e.jsxs(T,{noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"School Activities"}),e.jsx(l,{mt:"10px",children:e.jsx(pn,{})})]})})})]})]})},ue=({progress:t=.75,size:s=40})=>{const n=M(),i=R(n.palette.mode),o=t*360,r=(f=>f>=.75?i.greenAccent[400]:f>=.5?i.greenAccent[700]:i.redAccent[700])(t);return e.jsx(l,{sx:{background:`radial-gradient(${i.primary[400]} 55%, transparent 56%),
            conic-gradient(${r} 0deg ${o}deg, ${i.blueAccent[200]} ${o}deg 360deg),
            ${i.primary[400]}`,borderRadius:"50%",width:`${s}px`,height:`${s}px`}})},Sn=({progress:t})=>!t&&t!==0?e.jsx(a,{children:"No session progress data available"}):e.jsxs(l,{children:[e.jsx(a,{variant:"h6",fontWeight:"600",mb:"5px",children:"Session Progress"}),e.jsx(ue,{size:"125",progress:t/100}),e.jsxs(a,{variant:"body2",mt:"10px",children:["Academic year completion: ",t,"%"]})]}),An=({attendance:t})=>!t&&t!==0?e.jsx(a,{children:"No attendance data available"}):e.jsxs(l,{children:[e.jsx(a,{variant:"h6",fontWeight:"600",mb:"5px",children:"Term Attendance"}),e.jsx(ue,{size:"125",progress:t/100}),e.jsxs(a,{variant:"body2",mt:"10px",children:["Current term attendance: ",t,"%"]})]}),Cn=({feesStatus:t})=>t?e.jsxs(l,{children:[e.jsxs(a,{variant:"h6",fontWeight:"600",mb:"5px",children:["Fee Payment Status (",parseInt(t.percentagePaid),"%)"]}),e.jsx(ue,{size:"125",progress:t.percentagePaid/100}),e.jsxs(a,{variant:"body2",mt:"10px",children:["Outstanding Fees: $",t.totalOutstanding]})]}):e.jsx(a,{children:"No payment data available"});function At(){const t=gt(),s=de(m=>{var x;return(x=m.users.user)==null?void 0:x._id}),n=de(m=>{var x;return(x=m.users.user)==null?void 0:x.userId}),i=de(m=>m.adminData.currentAcademicYear),{callApi:o}=H(),[c,r]=d.useState({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:null}),f=d.useCallback(async()=>{if(!s){r({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:"Student ID not found. Please log in."});return}r(m=>({...m,loading:!0,error:null}));try{const m=await o(`${lt}/student-dashboard`,"GET");if(m&&m.status==="success"){const{data:x}=m;t(Dt(x.currentAcademicYear||null)),r({sessionProgress:x.sessionProgress||0,termAttendance:x.termAttendance||0,feeStatus:x.feeStatus||{percentagePaid:0,totalOutstanding:0},nextClass:x.nextClass||null,missedClasses:x.missedClasses||[],subjectPerformance:x.subjectPerformance||null,allResources:x.allResources||[],assignments:x.assignments||[],timetable:x.timetable||[],loading:!1,error:null})}else r({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:(m==null?void 0:m.message)||"Failed to fetch student dashboard data"})}catch(m){r({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:m.message||"Failed to fetch student dashboard data"})}},[s,o,t]);return d.useEffect(()=>{f()},[f]),console.log(c),{...c,currentAcademicYear:i,formatDateToDDMMYYYY:m=>new Date(m).toLocaleDateString("en-GB"),userId:n}}const Dn=({nextClass:t})=>{const s=M(),n=R(s.palette.mode);return t?e.jsxs(l,{textAlign:"center",children:[e.jsx(a,{variant:"h6",fontWeight:"600",mb:"5px",children:"Next Class"}),e.jsxs(l,{children:[e.jsx(Be,{sx:{fontSize:"30px",color:n.blueAccent[400]}}),e.jsx(a,{variant:"h6",children:t.subject}),e.jsx(a,{children:t.date}),e.jsx(a,{children:t.time}),e.jsxs(a,{children:["Location: ",t.location]})]})]}):e.jsx(a,{children:"No upcoming classes"})},En=({subjectPerformance:t})=>{const s=M(),n=R(s.palette.mode);return!t||t.length===0?e.jsx(a,{children:"No performance data available"}):e.jsx("div",{style:{height:"350px"},children:e.jsx(xt,{data:t,animate:!0,motionConfig:"default",theme:{axis:{domain:{line:{stroke:n.grey[100]}},legend:{text:{fill:n.grey[100],fontSize:8}},ticks:{line:{stroke:n.grey[100],strokeWidth:1},text:{fill:n.grey[100],fontSize:8}}},legends:{text:{fill:n.grey[100],fontSize:8}},tooltip:{container:{color:n.primary[500]}}},colors:{datum:"color"},margin:{top:50,right:110,bottom:50,left:60},xScale:{type:"point"},yScale:{type:"linear",min:0,max:100,stacked:!1,reverse:!1},yFormat:" >-.2f",curve:"catmullRom",axisTop:null,axisRight:null,axisBottom:{tickSize:0,tickPadding:5,tickRotation:0,legend:"Month",legendOffset:36,legendPosition:"middle"},axisLeft:{tickValues:5,tickSize:3,tickPadding:5,tickRotation:0,legend:"Score (%)",legendOffset:-40,legendPosition:"middle"},enableGridX:!1,enableGridY:!1,pointSize:8,pointColor:{theme:"background"},pointBorderWidth:1,pointBorderColor:{from:"serieColor"},pointLabelYOffset:-12,useMesh:!0,legends:[{anchor:"bottom-right",direction:"column",justify:!1,translateX:100,translateY:0,itemsSpacing:0,itemDirection:"left-to-right",itemWidth:80,itemHeight:20,itemOpacity:.75,symbolSize:12,symbolShape:"circle",symbolBorderColor:"rgba(0, 0, 0, .5)",effects:[{on:"hover",style:{itemBackground:"rgba(0, 0, 0, .03)",itemOpacity:1}}]}]})})},kn=({missedClasses:t,formatDateToDDMMYYYY:s})=>{const n=M(),i=R(n.palette.mode),o=n.palette.mode==="light"?i.blueAccent[800]:i.greenAccent[600];return t?e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Missed Classes"}),t.length>0?t.map(c=>e.jsx(Fe,{sx:{mb:2},children:e.jsxs(Re,{sx:{backgroundColor:o,textAlign:"left"},children:[e.jsx(a,{variant:"h6",children:c.subject}),e.jsx(a,{children:s(c.date)}),e.jsx(a,{children:c.time}),e.jsxs(a,{children:["Location: ",c.location]})]})},c.id)):e.jsx(a,{children:"You attended all classes"})]}):e.jsx(a,{children:"No missed classes data available"})},wn=()=>{const t=M(),s=R(t.palette.mode),{callApi:n}=H(),[i,o]=d.useState(null);d.useEffect(()=>{(async()=>{try{const m=await n(P.ANNOUNCEMENT,"GET");m&&m.data&&o(m.data)}catch(m){console.error("Error fetching announcements:",m)}})()},[n]);const c=t.palette.mode==="light"?s.blueAccent[800]:s.greenAccent[600],f=i||[{id:"1",title:"End of Term Exams",message:"Exams start on July 1, 2025.",date:"2025-06-20"},{id:"2",title:"Sports Day",message:"Join us on July 15, 2025.",date:"2025-06-18"}];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Announcements"}),f.length>0?f.map(u=>e.jsx(Fe,{sx:{mb:2},children:e.jsxs(Re,{sx:{backgroundColor:c,textAlign:"left"},children:[e.jsx(a,{variant:"h6",children:u.title}),e.jsx(a,{variant:"body2",children:u.message}),e.jsx(a,{variant:"caption",color:"gray",children:u.date})]})},u.id)):e.jsx(a,{children:"No announcements available"})]})},Tn=()=>{const t=M(),s=R(t.palette.mode),{allResources:n}=At(),o=n||[{title:"Math Textbook",url:"https://example.com/math-textbook.pdf"},{title:"Science Notes",url:"https://example.com/science-notes.pdf"}],c=t.palette.mode==="light"?s.blueAccent[800]:s.greenAccent[600];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Useful Resources"}),o.length>0?o.map((r,f)=>e.jsx(Fe,{sx:{mb:2},children:e.jsxs(Re,{sx:{backgroundColor:c,textAlign:"left"},children:[e.jsx(a,{variant:"h6",children:r.title}),e.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",children:r.url})]})},f)):e.jsx(a,{children:"No Resources Available"})]})},Fn=()=>{const t=M(),s=R(t.palette.mode),{error:n,callApi:i}=H(),[o,c]=d.useState([]),[r,f]=d.useState(!1),[u,m]=d.useState(null);d.useEffect(()=>{if(u){const h=setTimeout(()=>m(null),5e3);return()=>clearTimeout(h)}},[u]),d.useEffect(()=>{(async()=>{const D=sessionStorage.getItem("accessToken"),C=D?{Authorization:`Bearer ${D}`}:{},k=await i(P.EVENT,"GET",null,C);if(k){console.log("Fetched events:",k);const g=k.data.map(y=>({id:y._id,title:y.title,start:y.startDate,end:y.endDate,allDay:y.startDate===y.endDate}));c(g)}else{const g=n||"Failed to fetch events";g.includes("Authentication required")||g.includes("No token provided")||g.includes("Invalid or expired token")?m("Please log in to view events"):m(g)}})()},[i,n]);const x=()=>{f(h=>!h)};return e.jsxs(l,{my:"10px",children:[u&&e.jsx(Ue,{severity:"error",sx:{mb:2},onClose:()=>m(null),children:u}),e.jsxs(l,{display:"flex",justifyContent:"center",flexDirection:"column",children:[e.jsxs(l,{flex:"1 1 20%",backgroundColor:s.primary[400],py:"15px",borderRadius:"4px",sx:{width:"100%",height:"70vh",overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(l,{display:"flex",alignItems:"center",marginBottom:"10px",children:[e.jsx(Xe,{onClick:x,sx:{backgroundColor:s.blueAccent[500],"&:hover":{backgroundColor:s.blueAccent[700]},padding:"10px",borderRadius:"50%"},children:r?e.jsx(Je,{}):e.jsx(Ke,{})}),e.jsx(a,{variant:"h6",sx:{marginLeft:"10px",fontWeight:"800"},children:r?"Hide Events":"Show Events"})]}),r&&e.jsx(a,{variant:"h4",sx:{marginBottom:"10px"},children:"Events"}),r&&e.jsx(ke,{children:o.length===0?e.jsx(a,{children:"No events available"}):o.map(h=>e.jsx(we,{sx:{backgroundColor:s.blueAccent[500],margin:"10px 0",borderRadius:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(Te,{primary:h.title,secondary:e.jsx(a,{sx:{fontSize:"0.7em",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:new Date(h.start).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})})},h.id))})]}),e.jsx(l,{flex:"1 1 100%",sx:{width:"100%"},children:e.jsx(Ye,{height:"70vh",plugins:[He,Ge,qe],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:"dayGridMonth",editable:!1,selectable:!1,dayMaxEvents:!0,events:o})})]})]})},Rn=()=>{const t=M();R(t.palette.mode);const[s,n]=d.useState(!0),[i,o]=d.useState(null),{loading:c,error:r,sessionProgress:f,termAttendance:u,feeStatus:m,missedClasses:x,nextClass:h,subjectPerformance:D,allResources:C}=At();return d.useEffect(()=>{c||n(!1),r&&o(r.message||"An error occurred while fetching data.")},[c,r]),s||c?e.jsx(_e,{}):i?e.jsx(l,{m:"20px",children:e.jsxs(a,{variant:"h4",color:"error",children:["Error: ",i]})}):e.jsxs(l,{m:"20px",children:[e.jsx(a,{variant:"h3",fontWeight:"600",mb:"20px",children:"Student Dashboard"}),e.jsxs(nt,{children:[e.jsxs(X,{children:[e.jsx(F,{sm:6,md:3,children:e.jsx(T,{children:e.jsx(Sn,{progress:f})})}),e.jsx(F,{sm:6,md:3,children:e.jsx(T,{children:e.jsx(An,{attendance:u})})}),e.jsx(F,{sm:6,md:3,children:e.jsx(T,{children:e.jsx(Cn,{feesStatus:m})})}),e.jsx(F,{sm:6,md:3,children:e.jsx(T,{noFlex:!0,children:e.jsx(Dn,{nextClass:h})})})]}),e.jsxs(X,{children:[e.jsx(F,{md:8,children:e.jsxs(T,{height:"350px",noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",mb:"10px",children:"Subject Performance"}),e.jsx(En,{subjectPerformance:D})]})}),e.jsx(F,{md:4,children:e.jsx(T,{noFlex:!0,children:e.jsx(kn,{missedClasses:x})})})]}),e.jsxs(X,{children:[e.jsx(F,{md:6,children:e.jsx(T,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx(wn,{})})}),e.jsx(F,{md:6,children:e.jsx(T,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx(Tn,{allResources:C})})})]}),e.jsx(X,{children:e.jsx(F,{md:12,children:e.jsxs(T,{noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",mb:"10px",children:"School Activities"}),e.jsx(Fn,{})]})})})]})]})};function oe(){const[t,s]=d.useState({termProgress:0,studentAttendance:0,assignmentSubmissionRate:{totalAssignmentRate:0},nextClass:null,topStudents:[],leastActiveStudents:[],loading:!1,error:null}),{callApi:n}=H(),i=de(c=>{var r;return(r=c.users.user)==null?void 0:r._id}),o=d.useCallback(async()=>{if(!i){s(c=>({...c,loading:!1,error:"Teacher ID not found. Please log in."}));return}s(c=>({...c,loading:!0,error:null}));try{const c=await n(`${lt}/teacher-dashboard/${i}`,"GET");if(c&&c.status==="success"){const{data:r}=c;s({termProgress:r.termProgress||0,studentAttendance:r.studentAttendance||0,assignmentSubmissionRate:r.assignmentSubmissionRate||{totalAssignmentRate:0},nextClass:r.nextClass||null,topStudents:r.topStudents||[],leastActiveStudents:r.leastActiveStudents||[],loading:!1,error:null})}else s(r=>({...r,loading:!1,error:(c==null?void 0:c.message)||"Failed to fetch teacher dashboard data"}))}catch(c){s(r=>({...r,loading:!1,error:c.message||"Failed to fetch teacher dashboard data"}))}},[i,n]);return d.useEffect(()=>{o()},[o]),t}const Mn=()=>{const t=M(),s=R(t.palette.mode),{termProgress:n}=oe();return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Term Progress"}),e.jsx(l,{mt:"25px",children:n>0?e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:"125",progress:n/100}),e.jsx(a,{variant:"h5",color:s.blueAccent[500],sx:{mt:"15px"},children:`${n}% completed`}),e.jsx(a,{children:"Current term completion"})]}):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No term progress available."})})]})},Ln=()=>{const t=M(),s=R(t.palette.mode),{studentAttendance:n}=oe();return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Student Attendance"}),e.jsx(l,{mt:"25px",children:n>0?e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:"125",progress:n/100}),e.jsx(a,{variant:"h5",color:s.blueAccent[500],sx:{mt:"15px"},children:`${n}% attendance rate`}),e.jsx(a,{children:"Average student attendance"})]}):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No attendance data available."})})]})},On=()=>{const t=M(),s=R(t.palette.mode),{assignmentSubmissionRate:n}=oe();return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Assignment Submissions"}),e.jsx(l,{mt:"25px",children:n&&n.totalAssignmentRate>0?e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:"125",progress:n.totalAssignmentRate/100}),e.jsx(a,{variant:"h5",color:s.blueAccent[500],sx:{mt:"15px"},children:`${n.totalAssignmentRate}% submission rate`}),e.jsx(a,{children:"Average assignment submission rate"})]}):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No submission data available."})})]})},Pn=()=>{const t=M(),s=R(t.palette.mode),{nextClass:n}=oe();return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",textAlign:"center",children:"Next Class"}),n?e.jsxs(l,{textAlign:"center",children:[e.jsx(Be,{sx:{fontSize:"50px",color:s.blueAccent[500]}}),e.jsx(a,{variant:"h6",children:n.subject}),e.jsx(a,{children:n.date}),e.jsx(a,{children:n.time}),e.jsxs(a,{children:["Location: ",n.location]})]}):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No upcoming classes scheduled."})]})},Nn=()=>{const t=M(),s=R(t.palette.mode),{error:n,callApi:i}=H(),[o,c]=d.useState([]),[r,f]=d.useState(!1),[u,m]=d.useState(null);d.useEffect(()=>{if(u){const h=setTimeout(()=>m(null),5e3);return()=>clearTimeout(h)}},[u]),d.useEffect(()=>{(async()=>{const D=sessionStorage.getItem("accessToken"),C=D?{Authorization:`Bearer ${D}`}:{},k=await i(P.EVENT,"GET",null,C);if(k){console.log("Fetched events:",k);const g=k.data.map(y=>({id:y._id,title:y.title,start:y.startDate,end:y.endDate,allDay:y.startDate===y.endDate}));c(g)}else{const g=n||"Failed to fetch events";g.includes("Authentication required")||g.includes("No token provided")||g.includes("Invalid or expired token")?m("Please log in to view events"):m(g)}})()},[i,n]);const x=()=>{f(h=>!h)};return e.jsxs(l,{my:"10px",children:[u&&e.jsx(Ue,{severity:"error",sx:{mb:2},onClose:()=>m(null),children:u}),e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Event Calendar"}),e.jsxs(l,{display:"flex",justifyContent:"center",flexDirection:"column",children:[e.jsxs(l,{flex:"1 1 20%",backgroundColor:s.primary[400],py:"15px",borderRadius:"4px",sx:{width:"100%",height:"70vh",overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(l,{display:"flex",alignItems:"center",marginBottom:"10px",children:[e.jsx(Xe,{onClick:x,sx:{backgroundColor:s.blueAccent[500],"&:hover":{backgroundColor:s.blueAccent[700]},padding:"10px",borderRadius:"50%"},children:r?e.jsx(Je,{}):e.jsx(Ke,{})}),e.jsx(a,{variant:"h6",sx:{marginLeft:"10px",fontWeight:"800"},children:r?"Hide Events":"Show Events"})]}),r&&e.jsx(a,{variant:"h4",sx:{marginBottom:"10px"},children:"Events"}),r&&e.jsx(ke,{children:o.length===0?e.jsx(a,{children:"No events available"}):o.map(h=>e.jsx(we,{sx:{backgroundColor:s.blueAccent[500],margin:"10px 0",borderRadius:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(Te,{primary:h.title,secondary:e.jsx(a,{sx:{fontSize:"0.7em",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:new Date(h.start).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})})},h.id))})]}),e.jsx(l,{flex:"1 1 100%",sx:{width:"100%"},children:e.jsx(Ye,{height:"70vh",plugins:[He,Ge,qe,ft],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:"dayGridMonth",editable:!1,selectable:!1,dayMaxEvents:!0,events:o})})]})]})},zn=()=>{const t=M(),s=R(t.palette.mode),{callApi:n}=H(),[i,o]=d.useState(null);d.useEffect(()=>{(async()=>{try{const m=await n(P.ANNOUNCEMENT,"GET");m&&m.data&&o(m.data)}catch(m){console.error("Error fetching announcements:",m)}})()},[n]);const c=t.palette.mode==="light"?s.blueAccent[800]:s.greenAccent[600],f=i||[{id:"1",title:"End of Term Exams",message:"Exams start on July 1, 2025.",date:"2025-06-20"},{id:"2",title:"Teachers Meeting",message:"Meeting on July 10, 2025.",date:"2025-06-18"}];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Announcements"}),f.length>0?f.map(u=>e.jsx(Fe,{sx:{mb:2},children:e.jsxs(Re,{sx:{backgroundColor:c,textAlign:"left"},children:[e.jsx(a,{variant:"h6",children:u.title}),e.jsx(a,{variant:"body2",children:u.message}),e.jsx(a,{variant:"caption",color:"gray",children:u.date})]})},u.id)):e.jsx(a,{children:"No announcements available"})]})},In=()=>{const t=M(),s=R(t.palette.mode),{topStudents:n}=oe(),i=t.palette.mode==="light"?s.greenAccent[300]:s.primary[500];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Top Students by Performance"}),n&&n.length>0?n.map((o,c)=>e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"flex-start",mb:2,backgroundColor:i,p:"15px",borderRadius:"8px",sx:{boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx(mt,{src:o.profilePicture||"",alt:`${o.firstName} ${o.lastName}`,sx:{width:50,height:50,mr:2}}),e.jsxs(l,{children:[e.jsx(a,{variant:"h6",color:"white",children:`${o.firstName} ${o.lastName}`}),e.jsxs(a,{variant:"body2",color:"white",children:["Performance Score: ",o.performanceScore,"%"]})]})]},c)):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No top students available."})]})},$n=()=>{const t=M(),s=R(t.palette.mode),{leastActiveStudents:n}=oe(),i=t.palette.mode==="light"?s.greenAccent[300]:s.primary[500];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Least Active Students"}),n&&n.length>0?n.map((o,c)=>e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"flex-start",mb:2,backgroundColor:i,p:"15px",borderRadius:"8px",sx:{boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx(mt,{src:o.profilePicture||"",alt:`${o.firstName} ${o.lastName}`,sx:{width:50,height:50,mr:2}}),e.jsxs(l,{children:[e.jsx(a,{variant:"h6",color:"white",children:`${o.firstName} ${o.lastName}`}),e.jsxs(a,{variant:"body2",color:"white",children:["Activity Rate: ",o.activityRate,"%"]})]})]},c)):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No least active students available."})]})},Wn=()=>{const t=M();R(t.palette.mode),ot(t.breakpoints.down("sm")),ot(t.breakpoints.between("sm","md"));const[s,n]=d.useState(!0),[i,o]=d.useState(null),{loading:c,error:r}=oe();return d.useEffect(()=>{c||n(!1),r&&o(r.message||"An error occurred while fetching data.")},[c,r]),s||c?e.jsx(_e,{}):i?e.jsx(l,{m:"20px",children:e.jsxs(a,{variant:"h4",color:"error",children:["Error: ",i]})}):e.jsxs(l,{m:"20px",children:[e.jsx(a,{variant:"h3",fontWeight:"600",mb:"20px",children:"Teacher Dashboard"}),e.jsxs(nt,{children:[e.jsxs(X,{children:[e.jsx(F,{sm:6,md:3,children:e.jsx(T,{children:e.jsx(Mn,{})})}),e.jsx(F,{sm:6,md:3,children:e.jsx(T,{children:e.jsx(Ln,{})})}),e.jsx(F,{sm:6,md:3,children:e.jsx(T,{children:e.jsx(On,{})})}),e.jsx(F,{sm:6,md:3,children:e.jsx(T,{children:e.jsx(Pn,{})})})]}),e.jsxs(X,{children:[e.jsx(F,{md:8,children:e.jsx(T,{noFlex:!0,moreStyles:{height:"500px",overflowY:"auto"},children:e.jsx(Nn,{})})}),e.jsx(F,{md:4,children:e.jsx(T,{noFlex:!0,moreStyles:{height:"500px",overflowY:"auto"},children:e.jsx(zn,{})})})]}),e.jsxs(X,{children:[e.jsx(F,{md:6,children:e.jsx(T,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx(In,{})})}),e.jsx(F,{md:6,children:e.jsx(T,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx($n,{})})})]})]})]})};var at={},_n=be;Object.defineProperty(at,"__esModule",{value:!0});var pe=at.default=void 0,Vn=_n(ve()),Bn=e;pe=at.default=(0,Vn.default)((0,Bn.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-7 9h-2V5h2zm0 4h-2v-2h2z"}),"Announcement");const Yn=({openAnnouncementModal:t,setModalOpen:s})=>{var y;const n=de(S=>S.users.user),[i,o]=d.useState({title:"",message:"",dueDate:"",classLevel:"",subclass:""}),[c,r]=d.useState([]),{data:f,loading:u,callApi:m}=H(),[x,h]=d.useState(!1),[D,C]=d.useState("");d.useEffect(()=>{if(!n||!n._id){C("User not authenticated. Please log in again."),h(!0);return}n.role==="teacher"&&t&&(async()=>{try{const E=await m(`${P.ACADEMIC_CLASSES}/assigned`,"GET");E&&E.data?r(E.data):(C("No assigned classes found."),h(!0))}catch(E){C("Failed to load assigned classes: "+E.message),h(!0)}})()},[t,n,m]);const k=S=>{const{name:E,value:p}=S.target;o(j=>({...j,[E]:p,...E==="classLevel"?{subclass:""}:{}}))},g=async()=>{if(!n||!n._id){C("User not authenticated. Please log in again."),h(!0);return}const{title:S,message:E,dueDate:p,classLevel:j,subclass:N}=i;if(!S||!E||!p){C("Please fill all required fields (title, message, due date)."),h(!0);return}if(n.role==="teacher"&&(!j||!N)){C("Please select a class level and subclass."),h(!0);return}const v=n.role==="teacher"?{title:S,message:E,date:p,createdBy:n._id,targets:[{classLevel:j,subclass:N}]}:{title:S,message:E,date:p,createdBy:n._id},z=n.role==="teacher"?`${P.ANNOUNCEMENT}/class`:`${P.ANNOUNCEMENT}/general`;try{const I=await m(z,"POST",v);I&&I.status==="success"&&I.data&&I.data.announcement?(o({title:"",message:"",dueDate:"",classLevel:"",subclass:""}),C(""),s(!1),h(!0)):(C("Failed to submit announcement. Please try again."),h(!0))}catch(I){C(I.message||"Failed to submit announcement."),h(!0)}};return!n||!n._id?e.jsx(se,{open:t,onClose:()=>s(!1),title:"Make Announcement",children:e.jsx(l,{sx:{display:"flex",justifyContent:"center",padding:2},children:e.jsx($t,{})})}):e.jsxs(e.Fragment,{children:[e.jsx(se,{open:t,onClose:()=>s(!1),title:"Make Announcement",onConfirm:g,children:e.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(_,{label:"Title",name:"title",value:i.title,onChange:k,fullWidth:!0,required:!0}),e.jsx(_,{label:"Message",name:"message",value:i.message,onChange:k,fullWidth:!0,multiline:!0,rows:4,required:!0}),e.jsx(_,{label:"Due Date",name:"dueDate",type:"date",value:i.dueDate,onChange:k,fullWidth:!0,InputLabelProps:{shrink:!0},required:!0}),n.role==="teacher"&&e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{fullWidth:!0,children:[e.jsx($e,{children:"Class Level"}),e.jsx(We,{name:"classLevel",value:i.classLevel,onChange:k,required:!0,children:c.map(S=>e.jsxs(je,{value:S._id,children:[S.section," ",S.name]},S._id))})]}),e.jsxs(Ie,{fullWidth:!0,children:[e.jsx($e,{children:"Subclass"}),e.jsx(We,{name:"subclass",value:i.subclass,onChange:k,required:!0,disabled:!i.classLevel,children:i.classLevel&&((y=c.find(S=>S._id===i.classLevel))==null?void 0:y.subclasses.map(S=>e.jsx(je,{value:S.letter,children:S.letter},S.letter)))})]})]})]})}),e.jsx(pt,{open:x,isLoading:u,onClose:()=>h(!1),title:"Announcement Submission",message:f&&f.status==="success"?"Announcement submitted successfully!":D||"Could not submit announcement. Please try again."})]})},Hn=({openFeedbackModal:t,setModalOpen:s})=>{const[n,i]=d.useState(""),[o,c]=d.useState(""),[r,f]=d.useState(""),[u,m]=d.useState(""),{data:x,loading:h,error:D,callApi:C}=H(),[k,g]=d.useState(!1),y=async()=>{const S={name:n,role:o,date:r,comments:u};await C(P.FEEDBACKS,"POST",S),D?console.error("Error submitting feedback:",D):(g(!0),i(""),c(""),f(""),m(""))};return e.jsxs(e.Fragment,{children:[e.jsx(se,{open:t,onClose:()=>s(!1),title:"Send Feedbacks",onConfirm:y,children:e.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(_,{label:"Name",value:n,onChange:S=>i(S.target.value),fullWidth:!0,margin:"normal"}),e.jsxs(Ie,{fullWidth:!0,margin:"normal",children:[e.jsx($e,{children:"Role"}),e.jsxs(We,{value:o,onChange:S=>c(S.target.value),children:[e.jsx(je,{value:"Student",children:"Student"}),e.jsx(je,{value:"Instructor",children:"Instructor"}),e.jsx(je,{value:"Worker",children:"Worker"})]})]}),e.jsx(_,{label:"Date",type:"date",value:r,onChange:S=>f(S.target.value),fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0}}),e.jsx(_,{label:"Comments",value:u,onChange:S=>m(S.target.value),fullWidth:!0,margin:"normal",multiline:!0,rows:4})]})}),e.jsx(pt,{open:k,isLoading:h,onClose:()=>g(!1),title:"Feedback confirmation",message:x?"Feedback submitted successfully!":"Could not submit announcement."})]})},Gn=({home:t})=>{const[s,n]=d.useState(!1),[i,o]=d.useState(!1),c=M();R(c.palette.mode);const r=de(f=>f.users.user);return console.log("user:",r),!r||!r.firstName?e.jsx(l,{children:e.jsx(a,{children:"Loading user data..."})}):e.jsxs(l,{children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(Nt,{home:!0,title:r.firstName,subtitle:"Welcome to your dashboard"}),e.jsxs(l,{sx:{display:"flex",gap:"10px"},children:[r.role==="admin"&&e.jsxs(l,{sx:{display:"flex",flexDirection:{xs:"column",sm:"column",md:"row"},alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(ge,{icon:e.jsx(vt,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Download Reports"}),e.jsx(ge,{icon:e.jsx(pe,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Make announcement",onClick:()=>o(!0)})]}),r.role==="teacher"&&e.jsxs(l,{sx:{display:"flex",flexDirection:{xs:"column",sm:"column",md:"row"},alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(ge,{icon:e.jsx(pe,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Make announcement",onClick:()=>o(!0)}),e.jsx(ge,{icon:e.jsx(pe,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Submit Feedback",onClick:()=>n(!0)}),e.jsxs(l,{children:[e.jsx(tn,{sx:{fontSize:{xs:"1em",sm:"1.2em"}},value:r.rating,readOnly:!0,precision:.1}),e.jsxs(a,{variant:"h6",sx:{fontSize:{xs:"0.8em",sm:"1em"}},children:["Rating: ",r.rating]})]})]}),r.role==="student"&&e.jsx(l,{sx:{display:"flex",flexDirection:{xs:"column",sm:"column",md:"row"},alignItems:"center",justifyContent:"center",gap:"10px"},children:e.jsx(ge,{icon:e.jsx(pe,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Submit Feedback",onClick:()=>n(!0)})}),e.jsx(Yn,{openAnnouncementModal:i,setModalOpen:o}),e.jsx(Hn,{openFeedbackModal:s,setModalOpen:n})]})]}),r.role==="admin"||r.role==="superadmin"?e.jsx(yn,{user:r}):r.role==="student"?e.jsx(Rn,{user:r}):r.role==="teacher"?e.jsx(Wn,{user:r}):null]})},qn=It(Gn),ys=()=>e.jsx("div",{children:e.jsx(qn,{home:!0})});export{ys as default};
