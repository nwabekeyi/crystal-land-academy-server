import{r as i,f as M,j as e,a as Ta}from"./index-BO-TmkzE.js";import{M as fe,t as va}from"./modal-CG0C6vpP.js";import{H as sa}from"./Header-DSApfQWn.js";import{a as Aa,b as na,T as Ne}from"./table-vaeRJyjp.js";import{w as Ma}from"./dasboardPagesContainer-DENYBOMz.js";import{u as w}from"./useApi-bPe3HYn1.js";import{G as m,U as ka}from"./index-BJVcWxQk.js";import{v as D,T,y as $,a1 as L,a2 as W,a3 as R,x as E,j as Da}from"./TextField-CigEBK4R.js";import{M as k}from"./MenuItem-Cm8_Zc8l.js";import{C as ya}from"./confirmationModal-DjrrgVpa.js";import"./IconButton-DnpiNGo6.js";import"./useMediaQuery-CPLNVO1b.js";import"./index-nsUM-GnQ.js";import"./loadingButton-CiJH9dFC.js";import"./CircularProgress-oo0vmEJK.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-DtaxXO1z.js";const _a=({userId:h})=>{const[b,a]=i.useState(0),[c,p]=i.useState(""),[f,B]=i.useState(""),[Q,q]=i.useState(!1),[te,P]=i.useState(!1),[C,H]=i.useState(!1),[o,N]=i.useState(!1),[se,A]=i.useState(!1),[le,z]=i.useState(!1),[ce,O]=i.useState(""),[Y,n]=i.useState(null),[x,y]=i.useState(null),[V,je]=i.useState(null),[d,G]=i.useState(null),[Ce,we]=i.useState([]),[j,ne]=i.useState({question:"",optionA:"",optionB:"",optionC:"",optionD:"",correctAnswer:"",marks:""}),[u,J]=i.useState({name:"",description:"",subject:"",classLevel:"",passMark:"",totalMark:"",duration:"",examDate:"",examTime:"",examType:"test",academicTerm:"",academicYear:"",startDate:"",startTime:""}),[de,ge]=i.useState([]),[ue,Ee]=i.useState([]),[me,qe]=i.useState([]),[I,Oe]=i.useState([]),[Be,v]=i.useState(""),{data:K,loading:Qe,error:Se,callApi:Te}=w(),{data:Z,loading:Pe,error:ve,callApi:Ae}=w(),{data:U,loading:Le,error:Me,callApi:ke}=w(),{data:ee,loading:We,error:De,callApi:F}=w(),{data:ae,loading:s,error:_,callApi:re}=w(),{data:ie,loading:Re,error:He,callApi:ia}=w(),{data:ye,loading:Ye,error:Ge,callApi:oa}=w(),{data:pe,loading:la,error:Ue,callApi:Fe}=w(),{data:he,loading:ca,error:Xe,callApi:ze}=w(),{data:xe,loading:da,error:Ve,callApi:oe}=w(),{data:_e,loading:ua,error:Je,callApi:ma}=w(),{data:$e,loading:pa,error:Ie,callApi:ha}=w(),{data:X,loading:Ke,error:Ze,callApi:xa}=w(),{data:be,loading:ba,error:ea,callApi:aa}=w();i.useEffect(()=>{h&&(Te(`${M.CLASS_LEVEL}/teacher/${h}`,"GET"),ze(`${M.CURRENT_ACADEMIC_YEAR}`,"GET"))},[Te,ze]),i.useEffect(()=>{h?(Fe(`${M.CURRENT_ACADEMIC_TERM}`,"GET"),F(`${M.TEACHER_EXAM}?teacherId=${h}`,"GET")):v("User not authenticated")},[Fe,F,h]),i.useEffect(()=>{var t;if((t=K==null?void 0:K.data)!=null&&t.assignedClasses){const r=K.data.assignedClasses||[];Oe(r.map(l=>({_id:l._id,name:l.name,displayName:l.name,subclasses:l.subclasses.map(g=>g.letter),section:l.section})))}},[K]),i.useEffect(()=>{pe!=null&&pe.data&&Ee([pe.data]),he!=null&&he.data&&qe([he.data])},[pe,he]),i.useEffect(()=>{ee!=null&&ee.data&&ge(ee.data||[])},[ee]),i.useEffect(()=>{xe!=null&&xe.data&&we(xe.data||[])},[xe]),i.useEffect(()=>{((ae==null?void 0:ae.status)==="success"||(ie==null?void 0:ie.status)==="success")&&F(`${M.TEACHER_EXAM}?teacherId=${h}`,"GET"),((_e==null?void 0:_e.status)==="success"||($e==null?void 0:$e.status)==="success"||(X==null?void 0:X.status)==="success")&&oe(`${M.TEACHER_EXAM}/${d==null?void 0:d._id}/questions`,"GET")},[ae,ie,_e,$e,X,F,oe,h,d]),i.useEffect(()=>{(ye==null?void 0:ye.status)==="success"&&(O("Exam deleted successfully"),z(!0),F(`${M.TEACHER_EXAM}?teacherId=${h}`,"GET"))},[ye,F,h]),i.useEffect(()=>{(X==null?void 0:X.status)==="success"&&(O("Question deleted successfully"),z(!0),oe(`${M.TEACHER_EXAM}/${d==null?void 0:d._id}/questions`,"GET"))},[X,oe,d]),i.useEffect(()=>{c&&h&&Ae(`${M.SUBJECT}/class/${c}/teacher/${h}`,"GET")},[c,h,Ae]),i.useEffect(()=>{x&&h&&f&&ke(`${M.SUBJECT}/class/${x.classId}/subclassLetter/${f}/students`,"GET")},[x,f,h,ke]),i.useEffect(()=>{d!=null&&d._id&&oe(`${M.TEACHER_EXAM}/${d._id}/questions`,"GET")},[d,oe]),i.useEffect(()=>{d!=null&&d._id&&aa(`${M.TEACHER_EXAM}/${d._id}/scores`,"GET")},[d,aa]),i.useEffect(()=>{const r=[Se,ve,Me,De,Ue,Xe,_,He,Ge,Ve,Je,Ie,Ze,ea].find(l=>l)||"";v(r)},[Se,ve,Me,De,Ue,Xe,_,He,Ge,Ve,Je,Ie,Ze,ea]);const fa=i.useCallback(t=>Z!=null&&Z.data?Z.data.map(r=>({name:r.name.name,_id:r._id})):[],[Z]),ja=i.useCallback((t,r)=>{if(!(U!=null&&U.data)||!t)return[];const l=I.find(S=>S._id===t);if(!l)return[];const g=U.data.find(S=>S.subjectName===r);return g?g.students.map((S,ta)=>({studentId:S.studentId,name:`${S.firstName} ${S.lastName}`,className:`${l.name} ${f||""}`,section:l.section,details:{role:"student",firstName:S.firstName,lastName:S.lastName,middleName:S.middleName||"",email:S.email||"",studentId:S.studentId||"",gender:S.gender||"",currentClassLevel:{className:l.name,subclass:f||""},boardingStatus:S.boardingStatus||"",boardingDetails:S.boardingDetails||null,viewedByRole:"teacher",phoneNumber:null,address:null,tribe:null,religion:null,dob:null,rating:null},sn:ta+1})):[]},[U,I,f]),Ca=i.useCallback(t=>{const r=I.find(l=>l._id===t);return r?`${r.name} ${f||""}`:"Class"},[I,f]),ga=i.useCallback((t,r)=>de.filter(l=>l.classLevel._id===t&&l.subject._id===r),[de]),Sa=i.useCallback(t=>!(be!=null&&be.data)||!t?[]:be.data.map((r,l)=>({sn:l+1,studentName:`${r.student.firstName} ${r.student.lastName}`,score:r.score,date:new Date(r.date).toLocaleDateString()})),[be]);return{mainTabValue:b,selectedClass:c,subclassLetter:f,studentModalOpen:Q,questionsModalOpen:te,detailsModalOpen:C,examModalOpen:o,deleteConfirmModalOpen:se,successModalOpen:le,confirmationMessage:ce,confirmationAction:Y,selectedSubject:x,selectedStudent:V,selectedExam:d,questions:Ce,newQuestion:j,newExam:u,exams:de,academicTerms:ue,academicYears:me,classes:I,error:Be,loading:Qe||Pe||Le||We||la||ca||da||s||Re||Ye||ua||pa||Ke||ba,getSubjectsForClass:fa,getStudentsForSubject:ja,getClassName:Ca,getExamsForSubject:ga,getTestScoresData:Sa,handleMainTabChange:(t,r)=>{a(r)},handleClassChange:t=>{p(t.target.value),B(""),y(null),q(!1)},handleSubclassChange:t=>{B(t.target.value),y(null),q(!1)},openStudentModal:(t,r)=>{if(!f){v("Please select a subclass to view students");return}y({subject:t,classId:r}),q(!0)},openQuestionsModal:t=>{G(t),P(!0)},openDetailsModal:t=>{je(t),H(!0)},openExamModal:(t=null)=>{var r,l;t?(G(t),J({name:t.name,description:t.description,subject:t.subject._id,classLevel:t.classLevel._id,passMark:t.passMark,totalMark:t.totalMark,duration:t.duration,examDate:t.examDate.split("T")[0],examTime:t.examTime,examType:t.examType,academicTerm:t.academicTerm._id,academicYear:t.academicYear._id,startDate:t.startDate?t.startDate.split("T")[0]:"",startTime:t.startTime||""})):(G(null),J({name:"",description:"",subject:"",classLevel:c||"",passMark:"",totalMark:"",duration:"",examDate:"",examTime:"",examType:"test",academicTerm:((r=ue[0])==null?void 0:r._id)||"",academicYear:((l=me[0])==null?void 0:l._id)||"",startDate:"",startTime:""})),N(!0)},handleQuestionInputChange:t=>{const{name:r,value:l}=t.target;ne(g=>({...g,[r]:l}))},handleOptionChange:(t,r)=>{ne(l=>{const g=[l.optionA,l.optionB,l.optionC,l.optionD];return g[t]=r,{...l,optionA:g[0],optionB:g[1],optionC:g[2],optionD:g[3]}})},handleAddQuestion:async()=>{if(!j.question||!j.optionA||!j.optionB||!j.optionC||!j.optionD||!j.correctAnswer||!j.marks){v("Please fill all question fields, including marks");return}const t=Number(j.marks);if(t<=0){v("Marks must be greater than zero");return}if(!d){v("No exam selected");return}if(Ce.reduce((g,S)=>g+(S.marks||0),0)+t>d.totalMark){v("Total marks for questions cannot exceed examâ€™s total mark");return}if(![j.optionA,j.optionB,j.optionC,j.optionD].includes(j.correctAnswer)){v("Correct answer must match one of the provided options");return}const l={question:j.question,optionA:j.optionA,optionB:j.optionB,optionC:j.optionC,optionD:j.optionD,correctAnswer:j.correctAnswer,marks:t};try{await ma(`${M.TEACHER_EXAM}/${d._id}/questions`,"POST",l),ne({question:"",optionA:"",optionB:"",optionC:"",optionD:"",correctAnswer:"",marks:""})}catch{v("Failed to add question")}},handleUpdateQuestion:async(t,r)=>{try{await ha(`${M.TEACHER_EXAM}/${d._id}/questions/${t}`,"PATCH",{question:r.question,optionA:r.optionA,optionB:r.optionB,optionC:r.optionC,optionD:r.optionD,correctAnswer:r.correctAnswer,marks:Number(r.marks)}),v("")}catch(l){v(l.message||"Failed to update question")}},handleDeleteQuestion:t=>{O("Are you sure you want to delete this question?"),n(()=>async()=>{try{await xa(`${M.TEACHER_EXAM}/${d._id}/questions/${t}`,"DELETE"),A(!1)}catch{v("Failed to delete question"),A(!1)}}),A(!0)},handleExamInputChange:t=>{const{name:r,value:l}=t.target;J(g=>({...g,[r]:l}))},handleSaveExam:async()=>{var g,S;if(!u.name||!u.description||!u.subject||!u.classLevel||!u.passMark||!u.totalMark||!u.duration||!u.examDate||!u.examTime||!u.examType||!u.academicTerm||!u.academicYear){v("Please fill all required exam fields");return}const t=Number(u.totalMark),r=Number(u.passMark);if(t>100){v("Total mark cannot exceed 100");return}if(r>t){v("Pass mark cannot exceed total mark");return}const l={name:u.name,description:u.description,subject:u.subject,classLevel:u.classLevel,passMark:r,totalMark:t,duration:u.duration,examDate:u.examDate,examTime:u.examTime,examType:u.examType,academicTerm:u.academicTerm,academicYear:u.academicYear,startDate:u.startDate||null,startTime:u.startTime||null};try{d?await ia(`${M.TEACHER_EXAM}/${d._id}`,"PATCH",l):await re(M.TEACHER_EXAM,"POST",l),N(!1),J({name:"",description:"",subject:"",classLevel:"",passMark:"",totalMark:"",duration:"",examDate:"",examTime:"",examType:"test",academicTerm:((g=ue[0])==null?void 0:g._id)||"",academicYear:((S=me[0])==null?void 0:S._id)||"",startDate:"",startTime:""}),G(null)}catch{v("Failed to save exam")}},handleDeleteExam:t=>{O("Are you sure you want to delete this exam?"),n(()=>async()=>{try{await oa(`${M.TEACHER_EXAM}/${t}`,"DELETE"),A(!1)}catch{v("Failed to delete exam"),A(!1)}}),A(!0)},setStudentModalOpen:q,setQuestionsModalOpen:P,setDetailsModalOpen:H,setExamModalOpen:N,setDeleteConfirmModalOpen:A,setSuccessModalOpen:z,setSelectedSubject:y,setSelectedStudent:je,setSelectedExam:G,setNewQuestion:ne,setNewExam:J,loadingDeleteExam:Ye,loadingDeleteQuestion:Ke}},$a=({open:h,onClose:b,selectedSubject:a,getStudentsForSubject:c,getClassName:p,studentColumns:f,colors:B,TableComponent:Q})=>e.jsx(fe,{open:h,onClose:b,title:a?`Students for ${a.subject} (${p(a.classId)})`:"Students",noConfirm:!0,children:a&&e.jsx(D,{children:e.jsx(Q,{columns:f,tableHeader:`Students for ${a.subject}`,data:c(a.classId,a.subject),page:0,rowsPerPage:5,sortBy:"name",sortDirection:"asc",hiddenColumnsSmallScreen:[]})})}),Na=({open:h,onClose:b,selectedStudent:a,colors:c})=>e.jsx(fe,{open:h,onClose:b,title:a?`${a.name}'s Details`:"Student Details",noConfirm:!0,children:a&&e.jsx(D,{children:e.jsx(ka,{user:a.details})})}),wa=({open:h,onClose:b,selectedExam:a,questions:c,newQuestion:p,handleQuestionInputChange:f,handleOptionChange:B,handleAddQuestion:Q,handleUpdateQuestion:q,handleDeleteQuestion:te,getTestScoresData:P,colors:C,TableComponent:H})=>{const[o,N]=i.useState(null),[se,A]=i.useState(""),le=[{id:"sn",label:"S/N",flex:.5},{id:"question",label:"Question",flex:2},{id:"correctAnswer",label:"Correct Answer",flex:1},{id:"marks",label:"Marks",flex:1},{id:"actions",label:"Actions",flex:1,renderCell:n=>e.jsxs(D,{display:"flex",gap:"10px",children:[e.jsx(E,{variant:"contained",color:"secondary",size:"small",onClick:()=>N(n),disabled:(a==null?void 0:a.examStatus)==="approved",children:"Edit"}),e.jsx(E,{variant:"contained",color:"error",size:"small",onClick:()=>te(n._id),disabled:(a==null?void 0:a.examStatus)==="approved",children:"Delete"})]})}],z=()=>{if(!o.question||!o.optionA||!o.optionB||!o.optionC||!o.optionD||!o.correctAnswer||!o.marks){A("Please fill all question fields, including marks");return}const n=Number(o.marks);if(n<=0){A("Marks must be greater than zero");return}if(c.filter(y=>y._id!==o._id).reduce((y,V)=>y+(V.marks||0),0)+n>a.totalMark){A("Total marks for questions cannot exceed examâ€™s total mark");return}if(![o.optionA,o.optionB,o.optionC,o.optionD].includes(o.correctAnswer)){A("Correct answer must match one of the provided options");return}q(o._id,{question:o.question,optionA:o.optionA,optionB:o.optionB,optionC:o.optionC,optionD:o.optionD,correctAnswer:o.correctAnswer,marks:n}),N(null),A("")},ce=()=>{N(null),A("")},O=c.reduce((n,x)=>n+(x.marks||0),0),Y=a?a.totalMark-O:0;return e.jsx(fe,{open:h,onClose:()=>{b(),N(null),A("")},title:a?`Manage Questions for ${a.name}`:"Manage Questions",noConfirm:!0,children:e.jsxs(D,{children:[se&&e.jsx(T,{color:"error",sx:{mb:2},children:se}),a&&e.jsxs(T,{sx:{mb:2},children:["Total Marks: ",a.totalMark," | Current Total: ",O," | Remaining: ",Y]}),e.jsx(T,{variant:"h6",sx:{mb:2},children:"Add New Question"}),e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,children:e.jsx($,{fullWidth:!0,label:"Question",name:"question",value:p.question,onChange:f,variant:"outlined",disabled:(a==null?void 0:a.examStatus)==="approved"})}),["optionA","optionB","optionC","optionD"].map((n,x)=>e.jsx(m,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:`Option ${x+1}`,value:p[n],onChange:y=>B(x,y.target.value),variant:"outlined",disabled:(a==null?void 0:a.examStatus)==="approved"})},x)),e.jsx(m,{item:!0,xs:6,children:e.jsxs(L,{fullWidth:!0,children:[e.jsx(W,{children:"Correct Answer"}),e.jsxs(R,{name:"correctAnswer",value:p.correctAnswer,onChange:f,label:"Correct Answer",disabled:(a==null?void 0:a.examStatus)==="approved",children:[e.jsx(k,{value:"",children:e.jsx("em",{children:"Select correct answer"})}),[p.optionA,p.optionB,p.optionC,p.optionD].map((n,x)=>e.jsx(k,{value:n,disabled:!n,children:n||`Option ${x+1}`},x))]})]})}),e.jsx(m,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Marks",name:"marks",type:"number",value:p.marks,onChange:f,variant:"outlined",inputProps:{min:1,max:Y},disabled:(a==null?void 0:a.examStatus)==="approved"})}),e.jsx(m,{item:!0,xs:12,children:e.jsx(E,{variant:"contained",color:"primary",onClick:Q,disabled:(a==null?void 0:a.examStatus)==="approved",children:"Add Question"})})]}),o&&e.jsxs(D,{sx:{mt:4},children:[e.jsx(T,{variant:"h6",sx:{mb:2},children:"Edit Question"}),e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,children:e.jsx($,{fullWidth:!0,label:"Question",value:o.question||"",onChange:n=>N({...o,question:n.target.value}),variant:"outlined",disabled:(a==null?void 0:a.examStatus)==="approved"})}),["optionA","optionB","optionC","optionD"].map((n,x)=>e.jsx(m,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:`Option ${x+1}`,value:o[n]||"",onChange:y=>N({...o,[n]:y.target.value}),variant:"outlined",disabled:(a==null?void 0:a.examStatus)==="approved"})},x)),e.jsx(m,{item:!0,xs:6,children:e.jsxs(L,{fullWidth:!0,children:[e.jsx(W,{children:"Correct Answer"}),e.jsxs(R,{value:o.correctAnswer||"",onChange:n=>N({...o,correctAnswer:n.target.value}),label:"Correct Answer",disabled:(a==null?void 0:a.examStatus)==="approved",children:[e.jsx(k,{value:"",children:e.jsx("em",{children:"Select correct answer"})}),[o.optionA,o.optionB,o.optionC,o.optionD].map((n,x)=>e.jsx(k,{value:n,disabled:!n,children:n||`Option ${x+1}`},x))]})]})}),e.jsx(m,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Marks",type:"number",value:o.marks||"",onChange:n=>N({...o,marks:n.target.value}),variant:"outlined",inputProps:{min:1,max:Y+(Number(o.marks)||0)},disabled:(a==null?void 0:a.examStatus)==="approved"})}),e.jsxs(m,{item:!0,xs:12,children:[e.jsx(E,{variant:"contained",color:"primary",onClick:z,disabled:(a==null?void 0:a.examStatus)==="approved",children:"Save Changes"}),e.jsx(E,{variant:"outlined",color:"secondary",onClick:ce,sx:{ml:2},disabled:(a==null?void 0:a.examStatus)==="approved",children:"Cancel"})]})]})]}),e.jsxs(D,{sx:{mt:4},children:[e.jsx(T,{variant:"h6",children:"Existing Questions"}),e.jsx(H,{columns:le,tableHeader:"Questions",data:c.map((n,x)=>({sn:x+1,_id:n._id,question:n.question,correctAnswer:n.correctAnswer,marks:n.marks,optionA:n.optionA,optionB:n.optionB,optionC:n.optionC,optionD:n.optionD})),page:0,rowsPerPage:5,sortBy:"question",sortDirection:"asc",hiddenColumnsSmallScreen:[]})]}),e.jsxs(D,{sx:{mt:4},children:[e.jsx(T,{variant:"h6",children:"Test Scores"}),e.jsx(H,{columns:[{id:"sn",label:"S/N",flex:.5},{id:"studentName",label:"Student Name",flex:2},{id:"score",label:"Score",flex:1},{id:"date",label:"Date",flex:1}],tableHeader:"Scores",data:a?P(a):[],page:0,rowsPerPage:5,sortBy:"studentName",sortDirection:"asc",hiddenColumnsSmallScreen:[]})]})]})})},Ea=({open:h,onClose:b,newExam:a,handleExamInputChange:c,handleSaveExam:p,classes:f,subjects:B,academicTerms:Q,academicYears:q,colors:te,isEditing:P})=>e.jsx(fe,{open:h,onClose:b,title:P?"Edit Exam":"Create New Exam",onConfirm:p,confirmText:P?"Save Changes":"Create Exam",children:e.jsx(D,{children:e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,children:e.jsx($,{fullWidth:!0,label:"Exam Name",name:"name",value:a.name,onChange:c,variant:"outlined",required:!0})}),e.jsx(m,{item:!0,xs:12,children:e.jsx($,{fullWidth:!0,label:"Description",name:"description",value:a.description,onChange:c,variant:"outlined",multiline:!0,rows:3,required:!0})}),e.jsx(m,{item:!0,xs:12,children:e.jsxs(L,{fullWidth:!0,required:!0,children:[e.jsx(W,{children:"Class"}),e.jsxs(R,{name:"classLevel",value:a.classLevel,onChange:c,label:"Class",children:[e.jsx(k,{value:"",children:e.jsx("em",{children:"Select a class"})}),f.map(C=>e.jsx(k,{value:C._id,children:C.displayName},C._id))]})]})}),e.jsx(m,{item:!0,xs:12,children:e.jsxs(L,{fullWidth:!0,required:!0,children:[e.jsx(W,{children:"Subject"}),e.jsxs(R,{name:"subject",value:a.subject,onChange:c,label:"Subject",children:[e.jsx(k,{value:"",children:e.jsx("em",{children:"Select a subject"})}),B.map(C=>e.jsx(k,{value:C._id,children:C.name},C._id))]})]})}),e.jsx(m,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Pass Mark",name:"passMark",type:"number",value:a.passMark,onChange:c,variant:"outlined",required:!0,inputProps:{max:a.totalMark||100,min:0}})}),e.jsx(m,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Total Mark",name:"totalMark",type:"number",value:a.totalMark,onChange:c,variant:"outlined",required:!0,inputProps:{max:100,min:0}})}),e.jsx(m,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Duration",name:"duration",value:a.duration,onChange:c,variant:"outlined",required:!0,placeholder:"e.g., 1 hour 30 minutes"})}),e.jsx(m,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Exam Date",name:"examDate",type:"date",value:a.examDate,onChange:c,variant:"outlined",InputLabelProps:{shrink:!0},required:!0})}),e.jsx(m,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Exam Time",name:"examTime",type:"time",value:a.examTime,onChange:c,variant:"outlined",InputLabelProps:{shrink:!0},required:!0})}),e.jsx(m,{item:!0,xs:6,children:e.jsxs(L,{fullWidth:!0,required:!0,children:[e.jsx(W,{children:"Exam Type"}),e.jsxs(R,{name:"examType",value:a.examType,onChange:c,label:"Exam Type",children:[e.jsx(k,{value:"test",children:"Test"}),e.jsx(k,{value:"exam",children:"Exam"})]})]})}),e.jsx(m,{item:!0,xs:6,children:e.jsxs(L,{fullWidth:!0,required:!0,children:[e.jsx(W,{children:"Academic Term"}),e.jsxs(R,{name:"academicTerm",value:a.academicTerm,onChange:c,label:"Academic Term",children:[e.jsx(k,{value:"",children:e.jsx("em",{children:"Select a term"})}),Q.map(C=>e.jsx(k,{value:C._id,children:C.name},C._id))]})]})}),e.jsx(m,{item:!0,xs:6,children:e.jsxs(L,{fullWidth:!0,required:!0,children:[e.jsx(W,{children:"Academic Year"}),e.jsxs(R,{name:"academicYear",value:a.academicYear,onChange:c,label:"Academic Year",children:[e.jsx(k,{value:"",children:e.jsx("em",{children:"Select a year"})}),q.map(C=>e.jsx(k,{value:C._id,children:C.name},C._id))]})]})}),e.jsx(m,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Start Date (Optional)",name:"startDate",type:"date",value:a.startDate,onChange:c,variant:"outlined",InputLabelProps:{shrink:!0}})}),e.jsx(m,{item:!0,xs:6,children:e.jsx($,{fullWidth:!0,label:"Start Time (Optional)",name:"startTime",type:"time",value:a.startTime,onChange:c,variant:"outlined",InputLabelProps:{shrink:!0}})})]})})});function ra(h){const{children:b,value:a,index:c,...p}=h;return e.jsx("div",{role:"tabpanel",hidden:a!==c,id:`tabpanel-${c}`,"aria-labelledby":`tab-${c}`,...p,children:a===c&&e.jsx(D,{sx:{p:3},children:b})})}const qa=()=>{var ae;const h=Da(),b=va(h.palette.mode),a=Ta(s=>{var _,re;return(re=(_=s.users)==null?void 0:_.user)==null?void 0:re._id});if(!a)return e.jsxs(D,{children:[e.jsx(sa,{title:"SUBJECT MANAGEMENT",subtitle:"Manage Subjects, Exams, and Questions"}),e.jsx(T,{color:"error",sx:{mt:2},children:"Please log in to access subject management."})]});const{mainTabValue:c,selectedClass:p,subclassLetter:f,studentModalOpen:B,questionsModalOpen:Q,detailsModalOpen:q,examModalOpen:te,deleteConfirmModalOpen:P,successModalOpen:C,confirmationMessage:H,confirmationAction:o,selectedSubject:N,selectedStudent:se,selectedExam:A,questions:le,newQuestion:z,newExam:ce,academicTerms:O,academicYears:Y,classes:n,error:x,loading:y,getSubjectsForClass:V,getStudentsForSubject:je,getClassName:d,getExamsForSubject:G,getTestScoresData:Ce,handleMainTabChange:we,handleClassChange:j,handleSubclassChange:ne,openStudentModal:u,openQuestionsModal:J,openDetailsModal:de,openExamModal:ge,handleQuestionInputChange:ue,handleOptionChange:Ee,handleAddQuestion:me,handleUpdateQuestion:qe,handleDeleteQuestion:I,handleExamInputChange:Oe,handleSaveExam:Be,handleDeleteExam:v,setStudentModalOpen:K,setQuestionsModalOpen:Qe,setDetailsModalOpen:Se,setExamModalOpen:Te,setDeleteConfirmModalOpen:Z,setSuccessModalOpen:Pe,setSelectedSubject:ve,setSelectedStudent:Ae,setSelectedExam:U,setNewQuestion:Le,setNewExam:Me,loadingDeleteExam:ke,loadingDeleteQuestion:ee}=_a({userId:a}),We=[{id:"sn",label:"S/N",flex:.5},{id:"subject",label:"Subject",flex:2,renderCell:s=>e.jsx(T,{children:s.subject})},{id:"actions",label:"Actions",flex:1,renderCell:s=>e.jsx(E,{variant:"contained",color:"primary",size:"small",onClick:()=>u(s.subject,s.classId),disabled:!f,children:"View Students"})}],De=[{id:"sn",label:"S/N",flex:.5},{id:"name",label:"Student Name",flex:2,renderCell:s=>e.jsx(T,{children:s.name})},{id:"className",label:"Class",flex:1,renderCell:s=>e.jsx(T,{children:s.className})},{id:"actions",label:"Actions",flex:1,renderCell:s=>e.jsx(D,{display:"flex",gap:"10px",children:e.jsx(E,{variant:"contained",color:"primary",size:"small",onClick:()=>de(s),children:"View Details"})})}],F=[{id:"sn",label:"S/N",flex:.5},{id:"name",label:"Exam Name",flex:2,renderCell:s=>e.jsx(T,{children:s.name})},{id:"examType",label:"Type",flex:1,renderCell:s=>e.jsx(T,{children:s.examType})},{id:"examStatus",label:"Status",flex:1,renderCell:s=>e.jsx(T,{children:s.examStatus})},{id:"actions",label:"Actions",flex:2,renderCell:s=>e.jsxs(D,{display:"flex",gap:"10px",children:[e.jsx(E,{variant:"contained",color:"primary",size:"small",onClick:()=>J(s),children:"Manage Questions"}),e.jsx(E,{variant:"contained",color:"secondary",size:"small",onClick:()=>ge(s),disabled:s.examStatus==="approved",children:"Edit"}),e.jsx(E,{variant:"contained",color:"error",size:"small",onClick:()=>v(s._id),disabled:s.examStatus==="approved",children:"Delete"})]})}];return e.jsxs(D,{children:[e.jsx(sa,{title:"SUBJECT MANAGEMENT",subtitle:"Manage Subjects, Exams, and Questions"}),x&&e.jsx(T,{color:"error",sx:{mb:2},children:x}),e.jsxs(D,{sx:{mt:3,mb:3},children:[e.jsxs(Aa,{value:c,onChange:we,"aria-label":"main tabs",sx:{backgroundColor:b.primary[400],"& .MuiTabs-indicator":{backgroundColor:b.blueAccent[700]}},children:[e.jsx(na,{label:"Subjects",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:b.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:b.primary[400]}}),e.jsx(na,{label:"Exams",sx:{color:"white !important",textTransform:"none",fontWeight:"bold","&.Mui-selected":{color:"white !important",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.3)",backgroundColor:b.blueAccent[700]},boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",backgroundColor:b.primary[400]}})]}),e.jsxs(ra,{value:c,index:0,children:[e.jsxs(D,{sx:{display:"flex",gap:2,mb:3},children:[e.jsxs(L,{fullWidth:!0,children:[e.jsx(W,{id:"class-select-label",children:"Select Class"}),e.jsxs(R,{labelId:"class-select-label",value:p,label:"Select Class",onChange:j,disabled:y,children:[e.jsx(k,{value:"",children:e.jsx("em",{children:"Select a class"})}),n.map(s=>e.jsx(k,{value:s._id,children:s.displayName},s._id))]})]}),p&&e.jsxs(L,{fullWidth:!0,children:[e.jsx(W,{id:"subclass-select-label",children:"Select Subclass"}),e.jsxs(R,{labelId:"subclass-select-label",value:f,label:"Select Subclass",onChange:ne,disabled:y,children:[e.jsx(k,{value:"",children:e.jsx("em",{children:"Select a subclass"})}),(ae=n.find(s=>s._id===p))==null?void 0:ae.subclasses.map(s=>e.jsx(k,{value:s,children:s},s))]})]})]}),y&&e.jsx(T,{children:"Loading..."}),p&&f&&e.jsx(Ne,{columns:We,tableHeader:`Subjects for ${d(p)}`,data:V(p).map((s,_)=>({sn:_+1,subject:s.name,classId:p})),page:0,rowsPerPage:5,sortBy:"subject",sortDirection:"asc",hiddenColumnsSmallScreen:[]}),(!p||!f)&&e.jsx(T,{children:"Please select a class and subclass to view subjects"})]}),e.jsxs(ra,{value:c,index:1,children:[e.jsx(D,{display:"flex",justifyContent:"flex-end",mb:2,children:e.jsx(E,{variant:"contained",color:"primary",onClick:()=>ge(),disabled:!p,children:"Create New Exam"})}),n.length>0?e.jsx(m,{container:!0,spacing:2,children:n.map(s=>V(s._id).map((_,re)=>e.jsx(m,{item:!0,xs:12,children:e.jsxs(D,{p:2,borderRadius:"8px",boxShadow:2,bgcolor:b.primary[400],children:[e.jsxs(T,{variant:"h6",children:[_.name," (",s.displayName,")"]}),G(s._id,_._id).length>0?e.jsx(Ne,{columns:F,tableHeader:`Exams for ${_.name}`,data:G(s._id,_._id).map((ie,Re)=>({sn:Re+1,...ie})),page:0,rowsPerPage:5,sortBy:"name",sortDirection:"asc",hiddenColumnsSmallScreen:[]}):e.jsx(T,{children:"No exams set for this subject and class."})]})},`${s._id}_${_.name}_${re}`)))}):e.jsx(T,{children:"No subjects or classes assigned"})]})]}),e.jsx($a,{open:B,onClose:()=>{K(!1),ve(null)},selectedSubject:N,getStudentsForSubject:je,getClassName:d,studentColumns:De,colors:b,TableComponent:Ne}),e.jsx(wa,{open:Q,onClose:()=>{Qe(!1),U(null),Le({question:"",optionA:"",optionB:"",optionC:"",optionD:"",correctAnswer:"",marks:""})},selectedExam:A,questions:le,newQuestion:z,handleQuestionInputChange:ue,handleOptionChange:Ee,handleAddQuestion:me,handleUpdateQuestion:qe,handleDeleteQuestion:I,getTestScoresData:Ce,colors:b,TableComponent:Ne}),e.jsx(Na,{open:q,onClose:()=>{Se(!1),Ae(null)},selectedStudent:se,colors:b}),e.jsx(Ea,{open:te,onClose:()=>{var s,_;Te(!1),U(null),Me({name:"",description:"",subject:"",classLevel:"",passMark:"",totalMark:"",duration:"",examDate:"",examTime:"",examType:"test",academicTerm:((s=O[0])==null?void 0:s._id)||"",academicYear:((_=Y[0])==null?void 0:_._id)||"",startDate:"",startTime:""})},newExam:ce,handleExamInputChange:Oe,handleSaveExam:Be,classes:n,subjects:p?V(p):[],academicTerms:O,academicYears:Y,colors:b,isEditing:!!A}),e.jsx(fe,{open:P,onClose:()=>Z(!1),title:"Confirm Deletion",onConfirm:o,confirmText:"Confirm",children:e.jsx(T,{children:H})}),e.jsx(ya,{open:C,onClose:()=>Pe(!1),title:"Success",message:H,isLoading:ke||ee})]})},pt=Ma(qa);export{pt as default};
