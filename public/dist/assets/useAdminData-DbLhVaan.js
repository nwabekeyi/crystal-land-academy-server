import{r as a,a as b,e as s,M as ie,N as u,K as le,E as de,O as ue,P as ge}from"./index-BC37bsQa.js";import{u as g}from"./useApi-CayfBA9a.js";import{u as fe}from"./MenuItem-Boxsdccj.js";const Ce=()=>{var V;const[me,$]=a.useState([]),[Ee,K]=a.useState([]),[Q,W]=a.useState(0),t=fe(),X=b(e=>e.adminData.academicYears)||[],Z=b(e=>e.adminData.currentAcademicYear),ee=b(e=>e.adminData.classLevels)||[],ae=b(e=>e.adminData.subjects)||[],{loading:R,data:r,error:f,callApi:w}=g(),{loading:te,data:d,error:F,callApi:U}=g(),{loading:j,data:c,error:m,callApi:k}=g(),{loading:se,data:S,error:T,callApi:v}=g(),{loading:re,data:i,error:L,callApi:z}=g(),{loading:oe,data:h,error:Y,callApi:I}=g(),{loading:M,data:o,error:E,callApi:q}=g(),{loading:J,data:l,error:A,callApi:H}=g(),P=a.useCallback(async()=>{try{const e=await fetch(`${s.ENQUIRIES}?status=unread`);if(!e.ok)throw new Error("Failed to fetch unread enquiries");const n=(await e.json()).data||[];W(n.length)}catch(e){console.error("Error fetching unread enquiries:",e)}},[]),x=a.useCallback(()=>(console.log("Fetching students from:",s.STUDENTS),w(s.STUDENTS,"GET")),[w]),B=a.useCallback(()=>(console.log("Fetching teachers from:",s.TEACHERS),U(s.TEACHERS,"GET")),[U]),p=a.useCallback(()=>(console.log("Fetching academic years from:",s.ACADEMIC_YEARS),k(s.ACADEMIC_YEARS,"GET")),[k]),G=a.useCallback(()=>(console.log("Fetching current academic year from:",s.CURRENT_ACADEMIC_YEAR),v(s.CURRENT_ACADEMIC_YEAR,"GET")),[v]),O=a.useCallback(()=>(console.log("Fetching class levels from:",s.CLASS_LEVEL),z(s.CLASS_LEVEL,"GET")),[z]),_=a.useCallback(()=>(console.log("Fetching subjects from:",s.SUBJECT),I(s.SUBJECT,"GET")),[I]),D=a.useCallback(()=>(console.log("Fetching financial data from:",s.SCHOOL_FEES_DATA),q(s.SCHOOL_FEES_DATA,"GET")),[q]),N=a.useCallback(()=>(console.log("Fetching outstanding fees from:",s.OUTSTANDING_FEES_DATA),H(s.OUTSTANDING_FEES_DATA,"GET")),[H]);a.useEffect(()=>{x(),B(),p(),G(),P(),O(),_(),D(),N()},[x,B,p,G,P,O,_,D,N]),a.useEffect(()=>{if(r||d){const e=(r==null?void 0:r.data)||[],C=(d==null?void 0:d.data)||[];console.log("Students Data:",e),$(n=>JSON.stringify(n)!==JSON.stringify(e)?e:n),K(n=>JSON.stringify(n)!==JSON.stringify(C)?C:n),t(ie({students:e,teachers:C}))}f&&(console.error("Students Error:",f),t(u(f.message||"Failed to fetch students."))),F&&t(u(F.message||"Failed to fetch teachers."))},[r,d,f,F,t]),a.useEffect(()=>{if(c){const e=(c==null?void 0:c.data)||[];console.log("Academic Years Data:",e),t(le(e))}m&&(console.error("Academic Years Error:",m),t(u(m.message||"Failed to fetch academic years.")))},[c,m,t]),a.useEffect(()=>{if(S){const e=(S==null?void 0:S.data)||null;t(de(e))}T&&t(u(T.message||"Failed to fetch current academic year."))},[S,T,t]),a.useEffect(()=>{if(i){const e=Array.isArray(i)?i:(i==null?void 0:i.data)||(i==null?void 0:i.classLevels)||[];t(ue(e))}L&&t(u(L.message||"Failed to fetch class levels."))},[i,L,t]),a.useEffect(()=>{if(h){const e=(h==null?void 0:h.data)||[];t(ge(e))}Y&&t(u(Y.message||"Failed to fetch subjects."))},[h,Y,t]),a.useEffect(()=>{var e;o&&(console.log("Raw Financial Data:",o),console.log("Processed Financial Data:",((e=o==null?void 0:o.data)==null?void 0:e.data)||(o==null?void 0:o.data)||{})),E&&(console.error("Financial Data Error:",E),t(u(E.message||"Failed to fetch financial data.")))},[o,E,t]),a.useEffect(()=>{l&&(console.log("Raw Outstanding Fees Data:",l),console.log("Processed Outstanding Fees Data:",(l==null?void 0:l.data)||[])),A&&(console.error("Outstanding Fees Error:",A),t(u(A.message||"Failed to fetch outstanding fees data.")))},[l,A,t]);const y=a.useMemo(()=>{if(!(c!=null&&c.data))return console.log("Missing academicYearsData:",c),{total:[]};const e=c.data;return console.log("Academic Years Data:",e),console.log("Students Data:",r==null?void 0:r.data),{total:e.map(n=>(((r==null?void 0:r.data)||[]).filter(ce=>n.students.includes(String(ce._id))),{id:`Total-${n.name}`,academicYear:n.name,value:n.students.length})).filter(n=>n.value>0)}},[c,r]);a.useEffect(()=>{console.log("Enrollment Data:",y)},[y]);const ne=[f,F,m,T,L,Y,E,A].find(e=>e)||null;return{usersData:{students:(r==null?void 0:r.data)||[],teachers:(d==null?void 0:d.data)||[]},academicYears:X,currentAcademicYear:Z,unreadEnquiriesCount:Q,classLevels:ee,subjects:ae,financialData:((V=o==null?void 0:o.data)==null?void 0:V.data)||(o==null?void 0:o.data)||{primary:[],secondary:[]},outstandingFeesData:Array.isArray(l==null?void 0:l.data)?l.data:[],enrollmentData:y,financialDataLoading:M,financialDataError:E,outstandingFeesLoading:J,outstandingFeesError:A,enrollmentDataLoading:R||j,enrollmentDataError:f||m,loading:R||te||j||se||re||oe||M||J,error:ne,refetchAcademicYears:p,refetchCurrentYear:G,refetchClassLevels:O,refetchSubjects:_,refetchFinancialData:D,refetchOutstandingFees:N}};export{Ce as u};
