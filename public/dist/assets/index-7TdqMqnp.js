import{r as j,a as Ee,f as _,j as O,i as Pe}from"./index-Dia3dXnv.js";import{u as ye}from"./useApi-CcDc2KeG.js";import{C as Ie}from"./confirmationModal-CIDTnzxs.js";import{t as Fe}from"./modal-CRceNtXl.js";import{A as Me}from"./actionButton-BwgkxJSG.js";import{j as Te,v as be,T as $e,a1 as _e,a2 as Re,a3 as Ve,y as we}from"./TextField-CiACpH9R.js";import{A as Oe}from"./Alert-DzwxKnjn.js";import{M as Be}from"./MenuItem-9u3wVos-.js";const ge=o=>/^[0-9a-fA-F]{24}$/.test(o),Ge=({role:o,selectedUser:t})=>{var F,U,ie,pe,fe,he,ve,Le,Ae,Ne,Se,Ce,qe,De,je;const[ee,S]=j.useState(""),{error:oe,callApi:R}=ye(),[se,ae]=j.useState(!1),[J,te]=j.useState(""),[B,D]=j.useState(!1),{callApi:ue}=ye(),Q=Ee(b=>{var l;return(l=b.auth)==null?void 0:l.user}),[h,ne]=j.useState([]),[w,Z]=j.useState([]),[G,K]=j.useState([]),[H,X]=j.useState([]),[Y,i]=j.useState([]),[e,r]=j.useState({}),[A,I]=j.useState(null),le=j.useRef(null);j.useEffect(()=>{(async()=>{try{const l=await R(`${_.CLASS_LEVEL}/sign-up-data`,"GET");l.status==="success"?(console.log("ClassLevelData fetched:",l.data),ne(l.data)):S(l.message||"Failed to fetch class level data")}catch(l){console.error("Error fetching class level data:",l),S("Failed to load class level data. Please try again.")}})()},[R]),j.useEffect(()=>{if(h.length===0){console.log("ClassLevelData not loaded yet"),Z([]);return}const b=h.map(l=>({value:l.section,label:l.section}));Z(b),console.log("Updated sections:",b)},[h]),j.useEffect(()=>{if(h.length===0){console.log("ClassLevelData not loaded yet for formData");return}console.log("Initializing formData with classLevelData:",h);const b=k(o,t);r(b)},[o,t,h]),j.useEffect(()=>{var a,x,p,c;if(h.length===0){K([]),console.log("Cleared classLevelOptions: classLevelData empty");return}const b=o==="student"?(a=e.currentClassLevel)==null?void 0:a.section:(p=(x=e.teachingAssignments)==null?void 0:x[0])==null?void 0:p.section;if(!b){K([]),console.log("Cleared classLevelOptions: No section selected");return}const l=((c=h.find(u=>u.section===b))==null?void 0:c.classNames.map(u=>({value:u.classLevel,label:u.name})))||[];K(l),console.log("Updated classLevelOptions for section",b,":",l),r(u=>{var L,f,C,q,m,N;if(o==="student"){const g=((L=u.currentClassLevel)==null?void 0:L.classLevel)||"";if(!l.some(s=>s.value===g)&&l.length>0&&!t)return{...u,currentClassLevel:{...u.currentClassLevel,classLevel:((f=l[0])==null?void 0:f.value)||"",subclass:""}}}else if(o==="teacher"){const g=((q=(C=u.teachingAssignments)==null?void 0:C[0])==null?void 0:q.classLevel)||"";if(!l.some(s=>s.value===g)&&l.length>0&&!t)return{...u,teachingAssignments:[{...(m=u.teachingAssignments)==null?void 0:m[0],classLevel:((N=l[0])==null?void 0:N.value)||"",subclasses:[""],subject:""}]}}return u})},[(F=e.currentClassLevel)==null?void 0:F.section,(ie=(U=e.teachingAssignments)==null?void 0:U[0])==null?void 0:ie.section,h,o,t]),j.useEffect(()=>{var x,p,c,u,L,f,C,q;if(h.length===0){X([]),console.log("Cleared subclassOptions: classLevelData empty");return}const b=o==="student"?(x=e.currentClassLevel)==null?void 0:x.section:(c=(p=e.teachingAssignments)==null?void 0:p[0])==null?void 0:c.section,l=o==="student"?(u=e.currentClassLevel)==null?void 0:u.classLevel:(f=(L=e.teachingAssignments)==null?void 0:L[0])==null?void 0:f.classLevel;if(!b||!l){X([]),console.log("Cleared subclassOptions: No section or classLevel selected");return}const a=((q=(C=h.find(m=>m.section===b))==null?void 0:C.classNames.find(m=>m.classLevel===l))==null?void 0:q.subclasses.map(m=>({value:m.letter,label:m.letter})))||[];X(a),console.log("Updated subclassOptions for classLevel",l,":",a),r(m=>{var N,g,y,s,v,E,P;if(o==="student"){const M=((N=m.currentClassLevel)==null?void 0:N.subclass)||"";if(!a.some(T=>T.value===M)&&a.length>0&&!t)return{...m,currentClassLevel:{...m.currentClassLevel,subclass:((g=a[0])==null?void 0:g.value)||""}}}else if(o==="teacher"){const M=((v=(s=(y=m.teachingAssignments)==null?void 0:y[0])==null?void 0:s.subclasses)==null?void 0:v[0])||"";if(!a.some(T=>T.value===M)&&a.length>0&&!t)return{...m,teachingAssignments:[{...(E=m.teachingAssignments)==null?void 0:E[0],subclasses:[((P=a[0])==null?void 0:P.value)||""],subject:""}]}}return m})},[(pe=e.currentClassLevel)==null?void 0:pe.classLevel,(he=(fe=e.teachingAssignments)==null?void 0:fe[0])==null?void 0:he.classLevel,(ve=e.currentClassLevel)==null?void 0:ve.section,(Ae=(Le=e.teachingAssignments)==null?void 0:Le[0])==null?void 0:Ae.section,h,o,t]),j.useEffect(async()=>{var u,L,f,C,q,m,N,g,y;if(o!=="teacher"||h.length===0||!((L=(u=e.teachingAssignments)==null?void 0:u[0])!=null&&L.section)||!((C=(f=e.teachingAssignments)==null?void 0:f[0])!=null&&C.classLevel)||!((N=(m=(q=e.teachingAssignments)==null?void 0:q[0])==null?void 0:m.subclasses)!=null&&N[0])){i([]),console.log("Cleared subjectOptions: Not teacher or missing section/classLevel/subclass");return}const b=e.teachingAssignments[0].section,l=e.teachingAssignments[0].classLevel,a=e.teachingAssignments[0].subclasses[0],x=(y=(g=h.find(s=>s.section===b))==null?void 0:g.classNames.find(s=>s.classLevel===l))==null?void 0:y.subclasses.find(s=>s.letter===a),p=(x==null?void 0:x.subjects)||[];console.log(p);const c=await Promise.all(p.map(async s=>{try{const v=`${_.SUBJECT}/${s._id}`,E=await ue(v),P=E.status==="success"&&E.data?E.data:E;return console.log(P),!P||!P.name?(console.warn(`No valid name returned for subject ID ${s._id}, falling back to local name`),{value:s._id.toString(),label:s.name.name||`Subject ${s._id}`}):{value:s._id.toString(),label:P.name.name}}catch(v){return console.error(`Failed to fetch subject ${s._id}:`,v.message),{value:s._id.toString(),label:s.name.name.name||`Subject ${s._id}`}}}));i(c),console.log("Updated subjectOptions for section:",b,"classLevel:",l,"subclass:",a,"subjects:",c),o==="teacher"&&!t&&r(s=>{var P,M,V,T;const v=((M=(P=s.teachingAssignments)==null?void 0:P[0])==null?void 0:M.subject)||"";return!c.some(re=>re.value===v)&&c.length>0?{...s,teachingAssignments:[{...(V=s.teachingAssignments)==null?void 0:V[0],subject:((T=c[0])==null?void 0:T.value)||""}]}:s})},[(Se=(Ne=e.teachingAssignments)==null?void 0:Ne[0])==null?void 0:Se.subclasses,(qe=(Ce=e.teachingAssignments)==null?void 0:Ce[0])==null?void 0:qe.classLevel,(je=(De=e.teachingAssignments)==null?void 0:De[0])==null?void 0:je.section,h,o,t]);const k=(b,l)=>{var x,p,c,u,L,f,C,q,m,N,g,y;const a={};if(!W[b])return console.error("Invalid role:",b),a;if(l&&ge(l._id)){console.log("Using selectedUser data:",l);const s=l;return a.firstName=s.firstName||"",a.lastName=s.lastName||"",a.middleName=s.middleName||"",a.email=s.email||"",a.gender=s.gender||"",a.NIN=s.NIN||"",a.tribe=s.tribe||"",a.religion=s.religion||"",a.formalSchool=s.formalSchool||"",a.boardingStatus=s.boardingStatus||"Day Student",a.profilePicture="",a.profilePictureUrl=s.profilePictureUrl||"",b==="student"?(a.currentClassLevel={section:((x=s.currentClassLevel)==null?void 0:x.section)||"",classLevel:((p=s.currentClassLevel)==null?void 0:p.classLevel)||"",subclass:((c=s.currentClassLevel)==null?void 0:c.subclass)||""},a.boardingDetails=s.boardingStatus==="Boarder"?{hall:((u=s.boardingDetails)==null?void 0:u.hall)||"",roomNumber:((L=s.boardingDetails)==null?void 0:L.roomNumber)||"",bedNumber:((f=s.boardingDetails)==null?void 0:f.bedNumber)||"",houseMaster:((C=s.boardingDetails)==null?void 0:C.houseMaster)||""}:void 0,a.guardians=(q=s.guardians)!=null&&q.length?[{name:s.guardians[0].name||"",relationship:s.guardians[0].relationship||"",phone:s.guardians[0].phone||"",email:s.guardians[0].email||"",address:s.guardians[0].address||""}]:[{}]):b==="teacher"&&(a.address=s.address||"",a.qualification=s.qualification||"",a.phoneNumber=s.phoneNumber||"",a.tribe=s.tribe||"",a.religion=s.religion||"",a.bankAccountDetails=s.bankAccountDetails?{accountName:s.bankAccountDetails.accountName||"",accountNumber:s.bankAccountDetails.accountNumber||"",bank:s.bankAccountDetails.bank||""}:{},a.teachingAssignments=(m=s.teachingAssignments)!=null&&m.length?[{section:s.teachingAssignments[0].section||"",classLevel:s.teachingAssignments[0].classLevel||"",subclasses:s.teachingAssignments[0].subclasses||[""],subject:((N=s.teachingAssignments[0].subject)==null?void 0:N._id.toString())||""}]:[{}],a.linkedInProfile=s.linkedInProfile||""),console.log("getInitialFormData result (selectedUser):",a),a}if(W[b].forEach(s=>{if(s.name.includes("currentClassLevel")||s.name.includes("guardians")||s.name.includes("bankAccountDetails")||s.name.includes("teachingAssignments")){const[v,E,P]=s.name.split(/\.|\[|\]/).filter(Boolean);v==="guardians"||v==="teachingAssignments"?(a[v]=a[v]||[{}],a[v][0][E]=""):(a[v]=a[v]||{},a[v][E]="")}else a[s.name]=(s.type==="select","")}),b==="student"&&h.length>0){const s=h.map(v=>({value:v.section,label:v.section}));a.currentClassLevel={section:((g=s[0])==null?void 0:g.value)||"",classLevel:"",subclass:""},a.boardingStatus="Day Student"}else if(b==="teacher"&&h.length>0){const s=h.map(v=>({value:v.section,label:v.section}));a.teachingAssignments=[{section:((y=s[0])==null?void 0:y.value)||"",classLevel:"",subclasses:[""],subject:""}]}else b==="admin"&&(a.firstName="",a.lastName="",a.email="");return console.log("getInitialFormData result (new user):",a),a},W={student:[{label:"First Name",name:"firstName",type:"text",required:!t},{label:"Last Name",name:"lastName",type:"text",required:!t},{label:"Middle Name",name:"middleName",type:"text",required:!1},{label:"Email",name:"email",type:"email",required:!t},{label:"Profile Picture",name:"profilePicture",type:"file",required:!t},{label:"Gender",name:"gender",type:"select",required:!t,options:[{value:"Male",label:"Male"},{value:"Female",label:"Female"},{value:"Other",label:"Other"}]},{label:"NIN",name:"NIN",type:"text",required:!1},{label:"Tribe",name:"tribe",type:"text",required:!1},{label:"Religion",name:"religion",type:"text",required:!1},{label:"Formal School",name:"formalSchool",type:"text",required:!1},{label:"Class Section",name:"currentClassLevel.section",type:"select",required:!t,options:w},{label:"Class Level",name:"currentClassLevel.classLevel",type:"select",required:!t,options:G},{label:"Subclass",name:"currentClassLevel.subclass",type:"select",required:!t,options:H},{label:"Boarding Status",name:"boardingStatus",type:"select",required:!t,options:[{value:"Boarder",label:"Boarder"},{value:"Day Student",label:"Day Student"}]},{label:"Boarding Hall",name:"boardingDetails.hall",type:"text",required:!1},{label:"Room Number",name:"boardingDetails.roomNumber",type:"text",required:!1},{label:"Bed Number",name:"boardingDetails.bedNumber",type:"text",required:!1},{label:"House Master",name:"boardingDetails.houseMaster",type:"text",required:!1},{label:"Guardian Name",name:"guardians[0].name",type:"text",required:!t},{label:"Guardian Relationship",name:"guardians[0].relationship",type:"text",required:!t},{label:"Guardian Phone",name:"guardians[0].phone",type:"text",required:!t},{label:"Guardian Email",name:"guardians[0].email",type:"email",required:!1},{label:"Guardian Address",name:"guardians[0].address",type:"text",required:!1}].filter(Boolean),teacher:[{label:"First Name",name:"firstName",type:"text",required:!t},{label:"Last Name",name:"lastName",type:"text",required:!t},{label:"Middle Name",name:"middleName",type:"text",required:!1},{label:"Email",name:"email",type:"email",required:!t},{label:"Profile Picture",name:"profilePicture",type:"file",required:!t},{label:"Gender",name:"gender",type:"select",required:!t,options:[{value:"Male",label:"Male"},{value:"Female",label:"Female"},{value:"Other",label:"Other"}]},{label:"NIN",name:"NIN",type:"text",required:!t},{label:"Address",name:"address",type:"text",required:!t},{label:"Qualification",name:"qualification",type:"select",required:!t,options:[{value:"SSCE",label:"SSCE"},{value:"OND",label:"OND"},{value:"HND",label:"HND"},{value:"BSc",label:"BSc"},{value:"MBA",label:"MBA"},{value:"BTech",label:"BTech"},{value:"MSc",label:"MSc"},{value:"PhD",label:"PhD"},{value:"Other",label:"Other"}]},{label:"Phone Number",name:"phoneNumber",type:"tel",required:!t},{label:"Tribe",name:"tribe",type:"text",required:!t},{label:"Religion",name:"religion",type:"select",required:!t,options:[{value:"Christianity",label:"Christianity"},{value:"Islam",label:"Islam"},{value:"Hinduism",label:"Hinduism"},{value:"Buddhism",label:"Buddhism"},{value:"Atheism",label:"Atheism"},{value:"Other",label:"Other"}]},{label:"Teaching Section",name:"teachingAssignments[0].section",type:"select",required:!t,options:w},{label:"Teaching Class Level",name:"teachingAssignments[0].classLevel",type:"select",required:!t,options:G},{label:"Teaching Subclass",name:"teachingAssignments[0].subclasses[0]",type:"select",required:!t,options:H},{label:"Subclass Subject",name:"teachingAssignments[0].subject",type:"select",required:!1,options:Y},{label:"Bank Account Name",name:"bankAccountDetails.accountName",type:"text",required:!t},{label:"Bank Account Number",name:"bankAccountDetails.accountNumber",type:"text",required:!t},{label:"Bank Name",name:"bankAccountDetails.bank",type:"text",required:!t},{label:"LinkedIn Profile",name:"linkedInProfile",type:"text",required:!1}].filter(Boolean),admin:[{label:"First Name",name:"firstName",type:"text",required:!t},{label:"Last Name",name:"lastName",type:"text",required:!t},{label:"Email",name:"email",type:"email",required:!t},{label:"Profile Picture",name:"profilePicture",type:"file",required:!t}].filter(Boolean)};return console.log(Y),{formRef:le,formData:e,error:ee,loading:B,handleChange:b=>{const{name:l,value:a,files:x}=b.target;if(l==="profilePicture")I(x[0]);else if(l.includes("currentClassLevel")){const[,p]=l.split(".");r(c=>{var L,f,C,q,m;const u={...c.currentClassLevel,[p]:a};if(p==="section"){const N=((L=h.find(g=>g.section===a))==null?void 0:L.classNames.map(g=>({value:g.classLevel,label:g.name})))||[];u.classLevel=((f=N[0])==null?void 0:f.value)||"",u.subclass=""}else if(p==="classLevel"){const N=((q=(C=h.find(g=>g.section===c.currentClassLevel.section))==null?void 0:C.classNames.find(g=>g.classLevel===a))==null?void 0:q.subclasses.map(g=>({value:g.letter,label:g.letter})))||[];u.subclass=((m=N[0])==null?void 0:m.value)||""}return{...c,currentClassLevel:u}})}else if(l.includes("teachingAssignments")){const[,p,c,u]=l.split(/\.|\[|\]/).filter(Boolean);r(L=>{var C,q,m,N,g;const f=[...L.teachingAssignments||[{}]];if(c==="subclasses"&&u==="0")f[0]={...f[0],subclasses:[a],subject:""};else if(c==="subject")f[0]={...f[0],subject:a};else if(c==="section"){const y=((C=h.find(s=>s.section===a))==null?void 0:C.classNames.map(s=>({value:s.classLevel,label:s.name})))||[];f[0]={...f[0],section:a,classLevel:((q=y[0])==null?void 0:q.value)||"",subclasses:[""],subject:""}}else if(c==="classLevel"){const y=((N=(m=h.find(s=>s.section===L.teachingAssignments[0].section))==null?void 0:m.classNames.find(s=>s.classLevel===a))==null?void 0:N.subclasses.map(s=>({value:s.letter,label:s.letter})))||[];f[0]={...f[0],classLevel:a,subclasses:[((g=y[0])==null?void 0:g.value)||""],subject:""}}else f[0]={...f[0],[c]:a};return{...L,teachingAssignments:f}})}else if(l.includes("boardingDetails")){const[,p]=l.split(".");r(c=>({...c,boardingDetails:{...c.boardingDetails,[p]:a}}))}else if(l.includes("guardians")){const[,p,c]=l.split(/\.|\[|\]/).filter(Boolean);r(u=>{const L=[...u.guardians||[{}]];return L[0]={...L[0],[c]:a},{...u,guardians:L}})}else if(l.includes("bankAccountDetails")){const[,p]=l.split(".");r(c=>({...c,bankAccountDetails:{...c.bankAccountDetails,[p]:a}}))}else r(l==="boardingStatus"?p=>({...p,boardingStatus:a,boardingDetails:a==="Boarder"?p.boardingDetails||{}:void 0}):p=>({...p,[l]:a}))},handleSubmit:async b=>{var l,a,x,p,c,u,L,f,C,q,m,N,g,y,s,v,E,P,M,V,T,re;if(b.preventDefault(),D(!0),S(""),o==="admin"&&(Q==null?void 0:Q.role)!=="superadmin"){S("Only superadmins can create or update admins."),D(!1);return}if(t&&!ge(t._id)){S("Invalid user ID format"),D(!1);return}if(!t){if(!e.firstName||!e.lastName||!e.email||!e.gender){S("First name, last name, email, and gender are required"),D(!1);return}if(o==="student"){if(!((l=e.currentClassLevel)!=null&&l.section)||!((a=e.currentClassLevel)!=null&&a.classLevel)||!((x=e.currentClassLevel)!=null&&x.subclass)){S("Class level section, class level, and subclass are required"),D(!1);return}if(!((c=(p=e.guardians)==null?void 0:p[0])!=null&&c.name)||!((L=(u=e.guardians)==null?void 0:u[0])!=null&&L.relationship)||!((C=(f=e.guardians)==null?void 0:f[0])!=null&&C.phone)){S("Guardian name, relationship, and phone are required"),D(!1);return}if(!["Boarder","Day Student"].includes(e.boardingStatus)){S("Boarding status must be 'Boarder' or 'Day Student'"),D(!1);return}if(e.boardingStatus==="Boarder"&&(!((q=e.boardingDetails)!=null&&q.hall)||!((m=e.boardingDetails)!=null&&m.roomNumber))){S("Boarding Hall and Room Number are required for Boarder students"),D(!1);return}}else if(o==="teacher"){if(!e.NIN||!e.address||!e.qualification||!e.phoneNumber||!e.tribe||!e.religion||!((N=e.bankAccountDetails)!=null&&N.accountName)||!((g=e.bankAccountDetails)!=null&&g.accountNumber)||!((y=e.bankAccountDetails)!=null&&y.bank)||!((v=(s=e.teachingAssignments)==null?void 0:s[0])!=null&&v.section)||!((P=(E=e.teachingAssignments)==null?void 0:E[0])!=null&&P.classLevel)||!((T=(V=(M=e.teachingAssignments)==null?void 0:M[0])==null?void 0:V.subclasses)!=null&&T.length)){S("All required teacher fields, including section, class level, and subclass, must be filled"),D(!1);return}if(!/^\d{11}$/.test(e.NIN)){S("NIN must be 11 digits"),D(!1);return}if(!/^\d{10}$/.test(e.bankAccountDetails.accountNumber)){S("Bank account number must be 10 digits"),D(!1);return}if(!e.teachingAssignments[0].subclasses.every(n=>/^[A-Z]$/.test(n))){S("Subclasses must be single uppercase letters"),D(!1);return}const d=h.find(n=>n.section===e.teachingAssignments[0].section),z=d==null?void 0:d.classNames.find(n=>n.classLevel===e.teachingAssignments[0].classLevel);if(!z){S("Invalid class level selection. Please select a valid class."),D(!1);return}if(!z.subclasses.some(n=>n.letter===e.teachingAssignments[0].subclasses[0])){S("Invalid subclass selection. Please select a valid subclass."),D(!1);return}}else if(o==="admin"&&(!e.firstName||!e.lastName||!e.email)){S("First name, last name, and email are required for admins"),D(!1);return}if(!A){S("Profile picture is required"),D(!1);return}}try{const d=new FormData;Object.keys(e).forEach(n=>{var ce,xe;n==="currentClassLevel"&&e[n]?(d.append("currentClassLevel[section]",e[n].section||""),d.append("currentClassLevel[classLevel]",e[n].classLevel||""),d.append("currentClassLevel[subclass]",e[n].subclass||"")):n==="boardingDetails"&&e[n]&&e.boardingStatus==="Boarder"?(d.append("boardingDetails[hall]",e[n].hall||""),d.append("boardingDetails[roomNumber]",e[n].roomNumber||""),d.append("boardingDetails[bedNumber]",e[n].bedNumber||""),d.append("boardingDetails[houseMaster]",e[n].houseMaster||"")):n==="guardians"&&((ce=e[n])!=null&&ce.length)?(d.append("guardians[0][name]",e[n][0].name||""),d.append("guardians[0][relationship]",e[n][0].relationship||""),d.append("guardians[0][phone]",e[n][0].phone||""),d.append("guardians[0][email]",e[n][0].email||""),d.append("guardians[0][address]",e[n][0].address||"")):n==="bankAccountDetails"&&e[n]?(d.append("bankAccountDetails[accountName]",e[n].accountName||""),d.append("bankAccountDetails[accountNumber]",e[n].accountNumber||""),d.append("bankAccountDetails[bank]",e[n].bank||"")):n==="teachingAssignments"&&((xe=e[n])!=null&&xe.length)&&e[n][0].section?(d.append("section",e[n][0].section||""),d.append("classLevel",e[n][0].classLevel||""),d.append("subclassLetter",e[n][0].subclasses[0]||""),e[n][0].subject&&d.append("subject",e[n][0].subject)):n==="isWithdrawn"||n==="isSuspended"?d.append(n,e[n]==="true"):(n==="applicationStatus"&&e[n]||!t||e[n]&&e[n]!==""&&n!=="boardingDetails"&&n!=="profilePictureUrl")&&d.append(n,e[n])}),A&&d.append("profilePicture",A),console.log("Payload being sent:");for(let[n,ce]of d.entries())console.log(`${n}: ${ce}`);let z;t&&ge(t._id)?z=o==="student"?`${_.STUDENTS}/${t._id}`:o==="teacher"?`${_.TEACHERS}/update/${t._id}`:`${_.ADMINS}/${t._id}`:z=o==="student"?_.CREATE_STUDENT:o==="teacher"?_.CREATE_TEACHER:_.CREATE_ADMIN;const $=await R(z,t?"PATCH":"POST",d,{"Content-Type":"multipart/form-data"});$&&$.status==="success"?(te(`${$.data.firstName} ${$.data.lastName} has been successfully ${t?"updated":"registered"}`),r(k(o,null)),I(null)):(console.log("Submit error:",oe),te(($==null?void 0:$.message)||"An error occurred")),ae(!0)}catch(d){console.error("Error submitting form:",d),S(((re=d.response)==null?void 0:re.message)||"Failed to submit the form. Please try again.")}finally{D(!1)}},roleFields:W,profilePicture:A,modalOpen:se,modalMessage:J,setModalOpen:ae,subjectOptions:Y,classLevelOptions:G,subclassOptions:H,sections:w}},Ye=({role:o,selectedUser:t,studentReg:ee,offline:S})=>{const oe=Te();Fe(oe.palette.mode);const{roleFields:R,error:se,loading:ae,handleChange:J,handleSubmit:te,formData:B,formRef:D,modalOpen:ue,modalMessage:Q,setModalOpen:h,subjectOptions:ne,classLevelOptions:w,subclassOptions:Z,sections:G}=Ge({role:o,selectedUser:t});console.log("SignUpForm - role:",o,"selectedUser:",t,"studentReg:",ee,"formData:",B,"subjectOptions:",ne,"classLevelOptions:",w,"subclassOptions:",Z,"sections:",G);const K=()=>{h(!1)};if(ae||!B||Object.keys(B).length===0)return O.jsx(Pe,{});if(!R[o])return O.jsx(Oe,{severity:"error",children:"Invalid role specified"});const H=i=>{if(!B)return"";if(i.includes(".")){const e=i.split(/\.|\[|\]/).filter(Boolean);let r=B;for(const A of e)if(Array.isArray(r)&&A.match(/^\d+$/)?r=r[parseInt(A)]:r=r==null?void 0:r[A],r==null)return"";return r}return B[i]||""},X=(i,e)=>{if(i==="currentClassLevel.section"||i==="teachingAssignments[0].section"){const r=G.find(A=>A.value===e);return r?r.label:""}else if(i==="currentClassLevel.classLevel"||i==="teachingAssignments[0].classLevel"){const r=w.find(A=>A.value===e);return r?r.label:""}else if(i==="currentClassLevel.subclass"||i==="teachingAssignments[0].subclasses[0]"){const r=Z.find(A=>A.value===e);return r?r.label:""}else if(i==="teachingAssignments[0].subject"){const r=ne.find(A=>A.value===e);return r?r.label:""}else if(i==="gender"||i==="qualification"||i==="religion"||i==="boardingStatus"){const r=R[o].find(I=>I.name===i),A=r==null?void 0:r.options.find(I=>I.value===e);return A?A.label:""}return e},Y=R[o].filter(i=>o==="student"&&i.name.includes("boardingDetails")?B.boardingStatus==="Boarder":!0);return O.jsxs(be,{sx:{paddingBottom:ee&&"20px"},children:[O.jsxs($e,{variant:"h4",children:[t?"Update":"Sign Up"," (",o.charAt(0).toUpperCase()+o.slice(1),")"]}),O.jsxs("form",{onSubmit:te,ref:D,children:[Y.map(i=>{var e,r,A,I,le,k,W,me,de;return O.jsx(be,{mb:2,children:i.type==="select"?O.jsxs(_e,{fullWidth:!0,children:[O.jsx(Re,{children:i.label}),O.jsxs(Ve,{name:i.name,value:X(i.name,H(i.name))||"",onChange:F=>{const U=i.options.find(ie=>ie.label===F.target.value);J({target:{name:i.name,value:U?U.value:F.target.value}})},required:i.required,disabled:i.name==="currentClassLevel.classLevel"&&!((e=B.currentClassLevel)!=null&&e.section)||i.name==="currentClassLevel.subclass"&&!((r=B.currentClassLevel)!=null&&r.classLevel)||i.name==="teachingAssignments[0].classLevel"&&!((I=(A=B.teachingAssignments)==null?void 0:A[0])!=null&&I.section)||i.name==="teachingAssignments[0].subclasses[0]"&&!((k=(le=B.teachingAssignments)==null?void 0:le[0])!=null&&k.classLevel)||i.name==="teachingAssignments[0].subject"&&!((de=(me=(W=B.teachingAssignments)==null?void 0:W[0])==null?void 0:me.subclasses)!=null&&de[0]),children:[!i.required&&O.jsx(Be,{value:"",children:"None"}),i.options.map(F=>O.jsx(Be,{value:F.label,children:F.label},F.value))]})]}):i.type==="file"?O.jsx(be,{children:O.jsx("input",{type:"file",name:i.name,id:i.name,onChange:J,required:i.required,accept:"image/*",style:{display:"block",width:"100%"}})}):O.jsx(we,{label:i.label,name:i.name,type:i.type,value:H(i.name),onChange:J,required:i.required,fullWidth:!0})},i.name)}),se&&O.jsx(Oe,{severity:"error",children:se}),O.jsx(Me,{content:t?"Update":"Sign Up",submit:!0})]}),O.jsx(Ie,{open:ue,message:Q,title:"User Registration Confirmation",onClose:K})]})};export{Ye as S};
