import{a as ve,r as n,j as e,f as M}from"./index-pj4csjMx.js";import{t as _e,M as Te,r as ze,D as Me,a as ke,b as Le,c as $e}from"./modal-DLk5G-pL.js";import{H as Fe}from"./Header-DgiuZ9AO.js";import{T as Ue}from"./table-CYy185Xe.js";import{d as Ve}from"./Visibility-D8FG8VWc.js";import{C as Ye}from"./confirmationModal-DFIgAcnF.js";import{A as He}from"./actionButton-CSimhR6O.js";import{u as Oe}from"./useApi-CgK0isv2.js";import{j as qe,v as E,T as c,y as ae,x as O,q as Be,a1 as Se,a2 as ye,a3 as Ce}from"./TextField-nY0Yhgij.js";import{C as re}from"./CircularProgress-B7Fe9zn4.js";import{T as Pe}from"./Tooltip-C-65a1jX.js";import{I as Je}from"./IconButton-BgFdEAdd.js";import{d as Ke}from"./CheckCircle-v4weqz8N.js";import{C as Qe}from"./accordion-DZZodzn5.js";import{M as K}from"./MenuItem-BBZ-BCC-.js";import{w as Xe}from"./dasboardPagesContainer-VPbF8DwQ.js";import"./index-yPFRd-aU.js";import"./index-yUwIHc-_.js";import"./loadingButton-CqVpuJvD.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-C9IJxz6s.js";import"./useMediaQuery-CJL06RsU.js";const Ze=()=>{var de;const m=qe(),S=_e(m.palette.mode),N=ve(t=>{var r;return((r=t.users)==null?void 0:r.user)||{}}),d=N==null?void 0:N._id,{loading:j,error:q,callApi:y}=Oe(),[F,k]=n.useState([]),[A,G]=n.useState([]),[w,ue]=n.useState(""),[T,me]=n.useState(""),[L,Ie]=n.useState(""),[i,U]=n.useState(null),[ge,W]=n.useState(!1),[he,Q]=n.useState(!1),[fe,l]=n.useState(!1),[z,h]=n.useState(null),[ne,p]=n.useState("id"),[le,b]=n.useState("asc"),[u,P]=n.useState(0),[V,X]=n.useState(5),[R,x]=n.useState({error:null,message:null}),[$,Z]=n.useState(!1);n.useEffect(()=>{console.log("Redux user data:",N),console.log("Student ID:",d),console.log("Access Token:",sessionStorage.getItem("accessToken"))},[N,d]),n.useEffect(()=>{const t=sessionStorage.getItem("accessToken");d?t||(x({error:"Authentication token not found. Please log in again.",message:null}),l(!0)):(x({error:"Student ID not found. Please log in again.",message:null}),l(!0))},[d]),n.useEffect(()=>{(async()=>{try{const r=await y(M.CURRENT_ACADEMIC_YEAR);console.log("fetchAcademicYear response:",r),r&&r.status==="success"?ue(r.data.name):(x({error:"Failed to fetch current academic year.",message:null}),l(!0))}catch(r){console.error("fetchAcademicYear error:",r),x({error:`Error fetching academic year: ${r.message}`,message:null}),l(!0)}})()},[y]),n.useEffect(()=>{(async()=>{try{const r=await y(M.CURRENT_ACADEMIC_TERM);console.log("fetchAcademicTerm response:",r),r&&r.status==="success"?me(r.data.name):(x({error:"Failed to fetch current academic term.",message:null}),l(!0))}catch(r){console.error("fetchAcademicTerm error:",r),x({error:`Error fetching academic term: ${r.message}`,message:null}),l(!0)}})()},[y]),n.useEffect(()=>{q&&(x({error:`Error: ${q}`,message:null}),l(!0))},[q]),n.useEffect(()=>{(async()=>{var r,f;if(d)try{const o=await y(`${M.CLASS_LEVEL}?studentId=${d}`);if(console.log("fetchClasses response:",o),o&&o.status==="success"){const I=Array.isArray((r=o.data)==null?void 0:r.data)?o.data.data:Array.isArray(o.data)?o.data:Array.isArray((f=o.data)==null?void 0:f.classLevels)?o.data.classLevels:[];G(I),console.log("Classes set:",I),I.length===0&&(x({error:"No classes assigned to this student.",message:null}),l(!0))}else G([]),x({error:"No classes found for this student.",message:null}),l(!0)}catch(o){console.error("fetchClasses error:",o),G([]),x({error:`Error fetching classes: ${o.message}`,message:null}),l(!0)}})()},[d,y]),n.useEffect(()=>{(async()=>{var r;if(!(!d||!w||!T))try{const f=new URLSearchParams({studentId:d,session:w,term:T,...L&&{classLevelId:L},page:u+1,limit:V}).toString();console.log("fetchAssignments query:",f);const o=await y(`${M.ASSIGNMENT}/student?${f}`);if(console.log("fetchAssignments raw response:",o),o&&o.status==="success"){const I=Array.isArray((r=o.data)==null?void 0:r.data)?o.data.data:Array.isArray(o.data)?o.data:[];k(I),I.length===0&&u===0&&(x({error:"No assignments found for the current session and term.",message:null}),l(!0))}else console.log("Invalid response structure:",o),k([]),x({error:`Failed to fetch assignments: ${(o==null?void 0:o.message)||"Invalid response from server"}`,message:null}),l(!0)}catch(f){console.error("fetchAssignments error:",f.message,f.stack),k([]),x({error:`Error fetching assignments: ${f.message}`,message:null}),l(!0)}})()},[d,w,T,L,u,V,y]);const se=F.map((t,r)=>{var f;return{id:r+1,title:t.title,dueDate:t.dueDate?new Date(t.dueDate).toLocaleDateString():"N/A",description:String(t.description||"N/A"),className:Array.isArray(A)&&((f=A.find(o=>o._id===t.classLevelId))==null?void 0:f.name)||"N/A",assignmentId:t.id,hasSubmitted:t.submissions.some(o=>o.studentId._id===d),submission:t.submissions.find(o=>o.studentId._id===d),canSubmit:t.canSubmit}}),pe=(t=null)=>{U(t),W(!0)},H=()=>{W(!1),U(null)},te=(t=null)=>{U(t),Q(!0)},B=()=>{Q(!1),h(null),U(null)},be=()=>{l(!1),x({error:null,message:null})},D=t=>{const r=t.target.files[0];r&&!["application/pdf","image/jpeg","image/png"].includes(r.type)?(x({error:"Only PDF, JPEG, or PNG files are allowed.",message:null}),l(!0),h(null)):h(r)},J=async t=>{if(!z){x({error:"No file selected.",message:null}),l(!0);return}Z(!0);try{const r=new FormData;r.append("assignmentId",t),r.append("studentId",d),r.append("file",z);for(let[o,I]of r.entries())console.log(`FormData ${o}:`,I instanceof File?I.name:I);const f=await y(`${M.ASSIGNMENT}/submit`,"POST",r);console.log("handleFileSubmit response:",f),f&&f.status==="success"?(k(F.map(o=>o.id===t?f.data:o)),x({error:null,message:"Assignment submitted successfully!"}),l(!0)):(x({error:`Failed to submit assignment: ${(f==null?void 0:f.message)||"No response from server"}`,message:null}),l(!0))}catch(r){console.error("handleFileSubmit error:",r.message,r.stack),x({error:`Error submitting assignment: ${r.message}`,message:null}),l(!0)}finally{Z(!1),B()}},_=async t=>{if(!z){x({error:"No file selected.",message:null}),l(!0);return}Z(!0);try{const r=new FormData;r.append("assignmentId",t),r.append("studentId",d),r.append("file",z);for(let[o,I]of r.entries())console.log(`FormData ${o}:`,I instanceof File?I.name:I);const f=await y(`${M.ASSIGNMENT}/submit`,"POST",r);console.log("handleFileResubmit response:",f),f&&f.status==="success"?(k(F.map(o=>o.id===t?f.data:o)),x({error:null,message:"Assignment resubmitted successfully!"}),l(!0)):(x({error:`Failed to resubmit assignment: ${(f==null?void 0:f.message)||"No response from server"}`,message:null}),l(!0))}catch(r){console.error("handleFileResubmit error:",r.message,r.stack),x({error:`Error resubmitting assignment: ${r.message}`,message:null}),l(!0)}finally{Z(!1),B()}},ie=[{id:"id",label:"ID",flex:.5},{id:"title",label:"Title",flex:1,renderCell:t=>e.jsx(c,{children:String(t.title||"N/A")})},{id:"className",label:"Class",flex:1,renderCell:t=>e.jsx(c,{children:t.className})},{id:"dueDate",label:"Due Date",flex:1,renderCell:t=>e.jsx(c,{children:t.dueDate||"N/A"})},{id:"description",label:"Description",flex:2,renderCell:t=>e.jsx(c,{children:String(t.description||"N/A")})},{id:"status",label:"Status",flex:1,renderCell:t=>e.jsx(c,{color:t.hasSubmitted?"success.main":t.canSubmit?"warning.main":"error.main",children:t.hasSubmitted?"Submitted":t.canSubmit?"Pending":"Closed"})},{id:"actions",label:"Actions",flex:1,renderCell:t=>e.jsxs(e.Fragment,{children:[e.jsx(Pe,{title:"View assignment",children:e.jsx(Je,{onClick:()=>pe(t),disabled:j||$,children:e.jsx(Ve,{})})}),t.canSubmit&&e.jsx(Pe,{title:t.hasSubmitted?"Resubmit assignment":"Submit assignment",children:e.jsx(O,{onClick:()=>te(t),variant:"contained",color:t.hasSubmitted?"secondary":"primary",disabled:j||$||!t.canSubmit,children:t.hasSubmitted?"Resubmit":"Submit"})})]})}],Y=t=>{b(ne===t&&le==="asc"?"desc":"asc"),p(t)},oe=(t,r)=>{P(r)},ce=t=>{X(parseInt(t.target.value,10)),P(0)},xe=t=>{console.log("Row clicked:",t)},Ae={columns:ie,tableHeader:`Assignments for ${w}, ${T}${L&&Array.isArray(A)?`, ${((de=A.find(t=>t._id===L))==null?void 0:de.name)||""}`:""}`,data:se,sortBy:ne,sortDirection:le,onSortChange:Y,page:u,rowsPerPage:V,onPageChange:oe,onRowsPerPageChange:ce,onRowClick:xe,hiddenColumnsSmallScreen:["description","status"]};return e.jsxs(E,{py:"20px",children:[e.jsx(Fe,{title:"STUDENT ASSIGNMENTS",subtitle:"View and Submit Assignments"}),e.jsxs(E,{mb:"20px",display:"flex",gap:"20px",alignItems:"center",children:[e.jsxs(c,{variant:"h6",children:["Session: ",w||"Loading..."]}),e.jsxs(c,{variant:"h6",children:["Term: ",T||"Loading..."]})]}),e.jsx(E,{children:j?e.jsx(c,{children:"Loading..."}):se.length>0?e.jsx(Ue,{...Ae}):e.jsx(c,{children:"No assignments available for the current session and term."})}),e.jsx(Te,{open:ge,onClose:H,title:"Assignment Details",onConfirm:H,confirmText:"Close",cancelText:null,confirmDisabled:j||$,children:i&&e.jsxs(E,{display:"flex",flexDirection:"column",gap:"16px",children:[e.jsxs(c,{variant:"h6",children:["Title: ",i.title]}),e.jsxs(c,{variant:"body1",children:["Class: ",i.className]}),e.jsxs(c,{variant:"body1",children:["Due Date: ",i.dueDate]}),e.jsxs(c,{variant:"body2",children:["Description: ",i.description]}),i.hasSubmitted&&i.submission&&e.jsxs(E,{children:[e.jsx(c,{variant:"h6",children:"Your Submission"}),e.jsxs(c,{variant:"body2",children:["Submission Link:"," ",i.submission.cloudinaryLink?e.jsx("a",{href:i.submission.cloudinaryLink,target:"_blank",rel:"noopener noreferrer",style:{color:S.blueAccent[500]},children:"View Submission"}):"No file submitted"]}),e.jsxs(c,{variant:"body2",children:["Submitted on: ",new Date(i.submission.submissionDate).toLocaleDateString()]}),e.jsxs(c,{variant:"body2",children:["Viewed: ",i.submission.viewed?`Yes (on ${new Date(i.submission.viewedAt).toLocaleDateString()})`:"No"]}),e.jsx(c,{variant:"h6",children:"Teacher Comments"}),i.submission.comments.length>0?i.submission.comments.map((t,r)=>e.jsx(c,{variant:"body2",children:t.text||t},r)):e.jsx(c,{variant:"body2",children:"No comments yet."})]})]})}),e.jsx(Te,{open:he,onClose:B,title:`Submit Assignment: ${i==null?void 0:i.title}`,noConfirm:!0,cancelText:"Cancel",cancelDisabled:j||$,children:e.jsxs(E,{display:"flex",flexDirection:"column",gap:"16px",children:[e.jsx(ae,{type:"file",onChange:D,fullWidth:!0,inputProps:{accept:"application/pdf,image/jpeg,image/png"},helperText:"Accepted formats: PDF, JPEG, PNG",disabled:$}),e.jsx(He,{onClick:()=>i!=null&&i.hasSubmitted?_(i==null?void 0:i.assignmentId):J(i==null?void 0:i.assignmentId),content:$?"Submitting...":i!=null&&i.hasSubmitted?"Resubmit":"Submit",sx:{margin:"10px"},disabled:$||!z||!(i!=null&&i.canSubmit),startIcon:$?e.jsx(re,{size:20}):null})]})}),e.jsx(Ye,{open:fe,onClose:be,isLoading:j||$,title:"Assignment Submission Confirmation",message:R.message||R.error,isSuccess:R.message!==null})]})},v=[];for(let m=0;m<256;++m)v.push((m+256).toString(16).slice(1));function es(m,S=0){return(v[m[S+0]]+v[m[S+1]]+v[m[S+2]]+v[m[S+3]]+"-"+v[m[S+4]]+v[m[S+5]]+"-"+v[m[S+6]]+v[m[S+7]]+"-"+v[m[S+8]]+v[m[S+9]]+"-"+v[m[S+10]]+v[m[S+11]]+v[m[S+12]]+v[m[S+13]]+v[m[S+14]]+v[m[S+15]]).toLowerCase()}let je;const ss=new Uint8Array(16);function ts(){if(!je){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");je=crypto.getRandomValues.bind(crypto)}return je(ss)}const as=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Re={randomUUID:as};function rs(m,S,N){var j;if(Re.randomUUID&&!m)return Re.randomUUID();m=m||{};const d=m.random??((j=m.rng)==null?void 0:j.call(m))??ts();if(d.length<16)throw new Error("Random bytes length must be >= 16");return d[6]=d[6]&15|64,d[8]=d[8]&63|128,es(d)}var De={},ns=Be;Object.defineProperty(De,"__esModule",{value:!0});var Ge=De.default=void 0,ls=ns(ze()),is=e;Ge=De.default=(0,ls.default)((0,is.jsx)("path",{d:"M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4zM18 14H6v-2h12zm0-3H6V9h12zm0-3H6V6h12z"}),"Comment");const os=()=>{var Ee,Ne,we;const m=qe(),S=_e(m.palette.mode),N=ve(s=>{var a;return((a=s.users)==null?void 0:a.user)||{}}),d=N==null?void 0:N._id,{loading:j,error:q,callApi:y}=Oe(),[F,k]=n.useState([]),[A,G]=n.useState([]),[w,ue]=n.useState(""),[T,me]=n.useState(""),[L,Ie]=n.useState(""),[i,U]=n.useState(null),[ge,W]=n.useState(!1),[he,Q]=n.useState(!1),[fe,l]=n.useState(!1),[z,h]=n.useState(""),[ne,p]=n.useState("error"),[le,b]=n.useState("Assignment Action"),[u,P]=n.useState({title:"",dueDate:"",description:"",classLevelId:"",subclass:""}),[V,X]=n.useState(""),[R,x]=n.useState(null),[$,Z]=n.useState("id"),[se,pe]=n.useState("asc"),[H,te]=n.useState(0),[B,be]=n.useState(5),[D,J]=n.useState(!1),[_,ie]=n.useState(!1),[Y,oe]=n.useState(!1);n.useEffect(()=>{console.log("Redux user data:",N),console.log("Teacher ID:",d),console.log("Access Token:",sessionStorage.getItem("accessToken"))},[N,d]),n.useEffect(()=>{const s=sessionStorage.getItem("accessToken");d?s||(h("Authentication token not found. Please log in again."),p("error"),b("Authentication Error"),l(!0)):(h("Teacher ID not found. Please log in again."),p("error"),b("Authentication Error"),l(!0))},[d]),n.useEffect(()=>{(async()=>{try{const a=await y(M.CURRENT_ACADEMIC_YEAR);console.log("fetchAcademicYear response:",a),a&&a.status==="success"?ue(a.data.name):(h("Failed to fetch current academic year."),p("error"),b("Error Fetching Academic Year"),l(!0))}catch(a){console.error("fetchAcademicYear error:",a),h(`Error fetching academic year: ${a.message}`),p("error"),b("Error Fetching Academic Year"),l(!0)}})()},[y]),n.useEffect(()=>{(async()=>{try{const a=await y(M.CURRENT_ACADEMIC_TERM);console.log("fetchAcademicTerm response:",a),a&&a.status==="success"?me(a.data.name):(h("Failed to fetch current academic term."),p("error"),b("Error Fetching Academic Term"),l(!0))}catch(a){console.error("fetchAcademicTerm error:",a),h(`Error fetching academic term: ${a.message}`),p("error"),b("Error Fetching Academic Term"),l(!0)}})()},[y]),n.useEffect(()=>{q&&(h(`Error: ${q}`),p("error"),b("API Error"),l(!0))},[q]),n.useEffect(()=>{(async()=>{var a,g;if(d)try{const C=await y(`${M.CLASS_LEVEL}?teacherId=${d}`);if(console.log("fetchClasses response:",C),C&&C.status==="success"){const ee=Array.isArray((a=C.data)==null?void 0:a.data)?C.data.data:Array.isArray(C.data)?C.data:Array.isArray((g=C.data)==null?void 0:g.classLevels)?C.data.classLevels:[];G(ee),console.log("Classes set:",ee),ee.length===0&&(h("No classes assigned to this teacher."),p("error"),b("No Classes Found"),l(!0))}else G([]),h("No classes found for this teacher."),p("error"),b("No Classes Found"),l(!0)}catch(C){console.error("fetchClasses error:",C),G([]),h(`Error fetching classes: ${C.message}`),p("error"),b("Error Fetching Classes"),l(!0)}})()},[d,y]),n.useEffect(()=>{(async()=>{if(!(!d||!w||!T))try{const a=new URLSearchParams({teacherId:d,session:w,term:T,...L&&{classLevelId:L},page:H+1,limit:B}).toString();console.log("fetchAssignments query:",a);const g=await y(`${M.ASSIGNMENT}/teacher?${a}`);console.log("fetchAssignments response:",g),g&&g.status==="success"?(k(g.data.data||[]),g.data.data.length===0&&H===0&&(h("No assignments found for the current session and term."),p("error"),b("No Assignments Found"),l(!0))):(k([]),h(`Failed to fetch assignments: ${(g==null?void 0:g.message)||"Unknown error"}`),p("error"),b("Error Fetching Assignments"),l(!0))}catch(a){console.error("fetchAssignments error:",a),k([]),h(`Error fetching assignments: ${a.message}`),p("error"),b("Error Fetching Assignments"),l(!0)}})()},[d,w,T,L,H,B,y]);const ce=F.map((s,a)=>{var g;return console.log("Mapping assignment:",s),console.log("Classes state:",A),{id:a+1,title:s.title,dueDate:s.dueDate?new Date(s.dueDate).toLocaleDateString():"N/A",description:String(s.description||"N/A"),className:Array.isArray(A)&&((g=A.find(C=>{var ee;return C._id===(((ee=s.classLevelId)==null?void 0:ee._id)||s.classLevelId)}))==null?void 0:g.name)||"N/A",assignmentId:s.id,submissions:s.submissions||[],teacherId:s.teacherId}}),xe=async()=>{J(!0);const s=new Date(u.dueDate);if(isNaN(s)||s<=new Date){h("Please enter a valid future due date (YYYY-MM-DD)."),p("error"),b("Invalid Due Date"),l(!0),J(!1);return}if(!u.title||!u.dueDate||!u.description||!u.classLevelId||!u.subclass){h("Please fill all fields, including subclass."),p("error"),b("Missing Fields"),l(!0),J(!1);return}const a=A.find(g=>g._id===u.classLevelId);if(!a||!a.subclasses.some(g=>g.letter===u.subclass)){h(`Invalid subclass: ${u.subclass} for selected class`),p("error"),b("Invalid Subclass"),l(!0),J(!1);return}try{const g={id:rs(),session:w,term:T,classLevelId:u.classLevelId,subclass:u.subclass,title:u.title,dueDate:s.toISOString(),description:u.description,teacherId:d};console.log("handleAddAssignment payload:",g);const C=await y(M.ASSIGNMENT,"POST",g);console.log("handleAddAssignment response:",C),C&&C.status==="success"?(k([...F,C.data]),h("Assignment created successfully!"),p("success"),b("Assignment Created"),l(!0),P({title:"",dueDate:"",description:"",classLevelId:"",subclass:""}),W(!1)):(h(`Failed to create assignment: ${(C==null?void 0:C.message)||"Unknown error"}`),p("error"),b("Error Creating Assignment"),l(!0))}catch(g){console.error("handleAddAssignment error:",g),h(`Error creating assignment: ${g.message}`),p("error"),b("Error Creating Assignment"),l(!0)}finally{J(!1)}},Ae=async s=>{if(!V.trim()){h("Comment cannot be empty."),p("error"),b("Invalid Comment"),l(!0);return}ie(!0);try{const a=await y(`${M.ASSIGNMENT}/comment`,"POST",{assignmentId:i.assignmentId,studentId:s.studentId._id,comments:[...(s.comments||[]).map(g=>g.text||g),V],teacherId:d});console.log("handleAddComment response:",a),a&&a.status==="success"?(k(F.map(g=>g.id===i.assignmentId?a.data:g)),X(""),x(null),h("Comment added successfully!"),p("success"),b("Comment Posted"),l(!0)):(h(`Failed to add comment: ${(a==null?void 0:a.message)||"Unknown error"}`),p("error"),b("Error Adding Comment"),l(!0))}catch(a){console.error("handleAddComment error:",a),h(`Error adding comment: ${a.message}`),p("error"),b("Error Adding Comment"),l(!0)}finally{ie(!1)}},de=async s=>{oe(!0);try{const a=await y(`${M.ASSIGNMENT}/view`,"POST",{assignmentId:i.assignmentId,studentId:s.studentId._id,teacherId:d});console.log("handleMarkAsViewed response:",a),a&&a.status==="success"?(k(F.map(g=>g.id===i.assignmentId?a.data:g)),h("Submission marked as viewed! Note: The submission file will be deleted after 7 days."),p("success"),b("Submission Viewed"),l(!0)):(h(`Failed to mark submission as viewed: ${(a==null?void 0:a.message)||"Unknown error"}`),p("error"),b("Error Marking Submission"),l(!0))}catch(a){console.error("handleMarkAsViewed error:",a),h(`Error marking submission as viewed: ${a.message}`),p("error"),b("Error Marking Submission"),l(!0)}finally{oe(!1)}},t=[{id:"id",label:"ID",flex:.5},{id:"title",label:"Title",flex:1,renderCell:s=>e.jsx(c,{children:String(s.title||"N/A")})},{id:"className",label:"Class",flex:1,renderCell:s=>e.jsx(c,{children:s.className})},{id:"dueDate",label:"Due Date",flex:1,renderCell:s=>e.jsx(c,{children:s.dueDate||"N/A"})},{id:"description",label:"Description",flex:2,renderCell:s=>e.jsx(c,{children:String(s.description||"N/A")})},{id:"submissions",label:"Submissions",flex:1,renderCell:s=>e.jsx(c,{color:s.submissions.length===0?"error":"inherit",children:s.submissions.length>0?`${s.submissions.length} student(s) submitted`:"No submissions"})},{id:"actions",label:"Actions",flex:1,renderCell:s=>e.jsx(O,{variant:"contained",color:"primary",size:"small",onClick:()=>{U(s),Q(!0)},startIcon:e.jsx(Ve,{}),disabled:j||_||Y,children:"View"})}],r=s=>{pe($===s&&se==="asc"?"desc":"asc"),Z(s)},f=(s,a)=>{te(a)},o=s=>{be(parseInt(s.target.value,10)),te(0)},I=s=>{console.log("Row clicked:",s)},We={columns:t,tableHeader:`Assignments for ${w}, ${T}${L&&Array.isArray(A)?`, ${((Ee=A.find(s=>s._id===L))==null?void 0:Ee.name)||""}`:""}`,data:ce,sortBy:$,sortDirection:se,onSortChange:r,page:H,rowsPerPage:B,onPageChange:f,onRowsPerPageChange:o,onRowClick:I,hiddenColumnsSmallScreen:["description","submissions"]};return e.jsxs(E,{py:"20px",children:[e.jsx(Fe,{title:"TEACHER ASSIGNMENTS",subtitle:"Manage Assignments for Classes"}),e.jsxs(E,{mb:"20px",display:"flex",gap:"20px",alignItems:"center",children:[e.jsxs(c,{variant:"h6",children:["Session: ",w||"Loading..."]}),e.jsxs(c,{variant:"h6",children:["Term: ",T||"Loading..."]}),e.jsxs(Se,{sx:{minWidth:150},children:[e.jsx(ye,{id:"class-select-label",children:"Class"}),e.jsxs(Ce,{labelId:"class-select-label",value:L,label:"Class",onChange:s=>{Ie(s.target.value),te(0)},disabled:j||D||!Array.isArray(A)||A.length===0,children:[e.jsx(K,{value:"",children:"All Classes"}),Array.isArray(A)&&A.length>0?A.map(s=>e.jsx(K,{value:s._id,children:s.name},s._id)):e.jsx(K,{disabled:!0,children:"No classes available"})]})]}),e.jsx(O,{variant:"contained",color:"secondary",onClick:()=>W(!0),sx:{ml:"auto"},disabled:j||D||!d||!sessionStorage.getItem("accessToken")||!Array.isArray(A)||A.length===0||!w||!T,startIcon:D?e.jsx(re,{size:20}):null,children:D?"Adding...":"Add Assignment"})]}),e.jsx(E,{children:j?e.jsx(c,{children:"Loading..."}):ce.length>0?e.jsx(Ue,{...We}):e.jsx(c,{children:"No assignments available for the current session and term."})}),e.jsxs(Me,{open:ge,onClose:()=>{W(!1),P({title:"",dueDate:"",description:"",classLevelId:"",subclass:""})},children:[e.jsx(ke,{children:"Add New Assignment"}),e.jsx(Le,{children:e.jsxs(E,{display:"flex",flexDirection:"column",gap:"16px",mt:"10px",children:[e.jsxs(Se,{fullWidth:!0,required:!0,children:[e.jsx(ye,{id:"add-class-select-label",children:"Class"}),e.jsx(Ce,{labelId:"add-class-select-label",value:u.classLevelId,label:"Class",onChange:s=>P({...u,classLevelId:s.target.value,subclass:""}),disabled:j||D||!Array.isArray(A)||A.length===0,children:Array.isArray(A)&&A.length>0?A.map(s=>e.jsx(K,{value:s._id,children:s.name},s._id)):e.jsx(K,{disabled:!0,children:"No classes available"})})]}),e.jsxs(Se,{fullWidth:!0,required:!0,children:[e.jsx(ye,{id:"add-subclass-select-label",children:"Subclass"}),e.jsx(Ce,{labelId:"add-subclass-select-label",value:u.subclass,label:"Subclass",onChange:s=>P({...u,subclass:s.target.value}),disabled:j||D||!u.classLevelId,children:Array.isArray(A)&&((we=(Ne=A.find(s=>s._id===u.classLevelId))==null?void 0:Ne.subclasses)==null?void 0:we.length)>0?A.find(s=>s._id===u.classLevelId).subclasses.map(s=>e.jsx(K,{value:s.letter,children:s.letter},s.letter)):e.jsx(K,{disabled:!0,children:"No subclasses available"})})]}),e.jsx(ae,{label:"Title",value:u.title,onChange:s=>P({...u,title:s.target.value}),fullWidth:!0,required:!0,disabled:D}),e.jsx(ae,{label:"Due Date (YYYY-MM-DD)",value:u.dueDate,onChange:s=>P({...u,dueDate:s.target.value}),fullWidth:!0,required:!0,type:"date",InputLabelProps:{shrink:!0},disabled:D}),e.jsx(ae,{label:"Description",value:u.description,onChange:s=>P({...u,description:s.target.value}),multiline:!0,rows:4,fullWidth:!0,required:!0,disabled:D})]})}),e.jsxs($e,{children:[e.jsx(O,{onClick:()=>{W(!1),P({title:"",dueDate:"",description:"",classLevelId:"",subclass:""})},disabled:j||D,children:"Cancel"}),e.jsx(O,{onClick:xe,color:"primary",disabled:D||!u.title||!u.dueDate||!u.description||!u.classLevelId||!u.subclass,startIcon:D?e.jsx(re,{size:20}):null,children:D?"Adding...":"Add"})]})]}),e.jsxs(Me,{open:he,onClose:()=>{Q(!1),U(null),x(null),X("")},maxWidth:"md",fullWidth:!0,children:[e.jsx(ke,{children:"Assignment Details"}),e.jsx(Le,{children:i&&e.jsxs(E,{display:"flex",flexDirection:"column",gap:"16px",children:[e.jsxs(c,{variant:"h6",children:["Title: ",i.title]}),e.jsxs(c,{variant:"body1",children:["Class: ",i.className]}),e.jsxs(c,{variant:"body1",children:["Due Date: ",i.dueDate]}),e.jsxs(c,{variant:"body2",children:["Description: ",i.description]}),e.jsx(c,{variant:"h6",sx:{mt:2},children:"Submissions"}),i.submissions.length>0?i.submissions.map(s=>e.jsx(Qe,{title:`${s.name||s.studentId.firstName+" "+s.studentId.lastName} (Submitted: ${new Date(s.submissionDate).toLocaleDateString()})`,details:e.jsxs(E,{display:"flex",flexDirection:"column",gap:"16px",children:[e.jsxs(c,{variant:"body1",children:["Submission Link:"," ",s.cloudinaryLink?e.jsx("a",{href:s.cloudinaryLink,target:"_blank",rel:"noopener noreferrer",style:{color:S.blueAccent[500]},children:"View Submission"}):"No file submitted"]}),e.jsxs(c,{variant:"body2",children:["Submitted on: ",new Date(s.submissionDate).toLocaleDateString()]}),e.jsxs(c,{variant:"body2",children:["Viewed: ",s.viewed?`Yes (on ${new Date(s.viewedAt).toLocaleDateString()})`:"No"]}),e.jsxs(E,{children:[e.jsx(c,{variant:"h6",children:"Comments"}),s.comments.length>0?s.comments.map((a,g)=>e.jsx(E,{sx:{mb:1},children:e.jsx(c,{variant:"body2",children:a.text||a})},g)):e.jsx(c,{variant:"body2",children:"No comments yet."})]}),e.jsxs(E,{display:"flex",flexDirection:"column",gap:"8px",children:[e.jsx(ae,{label:"Add Comment",value:(R==null?void 0:R.studentId._id)===s.studentId._id?V:"",onChange:a=>{x(s),X(a.target.value)},fullWidth:!0,multiline:!0,rows:2,sx:{mb:2},disabled:_}),e.jsxs(E,{display:"flex",gap:"8px",children:[e.jsx(O,{variant:"contained",color:"primary",onClick:()=>Ae(s),disabled:_||!V.trim()||(R==null?void 0:R.studentId._id)!==s.studentId._id,startIcon:_?e.jsx(re,{size:20}):e.jsx(Ge,{}),children:_?"Adding Comment...":"Add Comment"}),e.jsx(O,{variant:"contained",color:"secondary",onClick:()=>de(s),disabled:Y||s.viewed,startIcon:Y?e.jsx(re,{size:20}):e.jsx(Ke,{}),children:Y?"Marking...":"Mark as Viewed"})]})]})]}),defaultExpanded:!1},s.studentId._id)):e.jsx(c,{children:"No submissions"})]})}),e.jsx($e,{children:e.jsx(O,{onClick:()=>{Q(!1),U(null),x(null),X("")},disabled:j||_||Y,children:"Close"})})]}),e.jsx(Ye,{open:fe,onClose:()=>{l(!1),h(""),p("error"),b("Assignment Action")},isLoading:j||D||_||Y,title:le,message:z,isSuccess:ne==="success"})]})},cs=()=>{const m=ve(N=>N.users.user),S=m.role;return e.jsx("div",{children:S==="student"?e.jsx(Ze,{}):e.jsx(os,{babtechUser:m})})},ks=Xe(cs);export{ks as default};
