import{a as De,r as l,j as e,f as L}from"./index-BgVW12L4.js";import{t as Fe,M as ke,r as Ke,D as Le,a as Me,b as $e,c as _e}from"./modal-BA-eVLt_.js";import{H as Oe}from"./Header-CogA_8fZ.js";import{T as Ue}from"./table-D9OC5aph.js";import{d as Ve}from"./Visibility-BeUCKiWc.js";import{C as Ye}from"./confirmationModal-CMKhpNuH.js";import{A as Qe}from"./actionButton-Bx_NG6Vl.js";import{u as Be}from"./useApi-TIUFMcqH.js";import{j as Ge,v as E,T as c,y as le,x as V,q as Xe,a1 as ye,a2 as Ce,a3 as je}from"./TextField-NDbbILhh.js";import{C as te}from"./CircularProgress-ELwt6FEm.js";import{T as Pe}from"./Tooltip-BsTx_eI4.js";import{I as Ze}from"./IconButton-4sz3Qd6x.js";import{d as es}from"./CheckCircle-gUBwIDHI.js";import{d as ss}from"./Download-DtIgek1B.js";import{C as ts}from"./accordion-D5e2Uz4A.js";import{M as X}from"./MenuItem-B4LKlkvK.js";import{w as as}from"./dasboardPagesContainer-p6UpWRgj.js";import"./index-CjZWgTm8.js";import"./index-D41-9XSs.js";import"./loadingButton-DGhAAS35.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-DfBjlVf_.js";import"./useMediaQuery-DmlQxk2V.js";const rs=()=>{var ge;const g=Ge(),y=Fe(g.palette.mode),N=De(a=>{var r;return((r=a.users)==null?void 0:r.user)||{}}),u=N==null?void 0:N._id,{loading:v,error:q,callApi:C}=Be(),[Y,M]=l.useState([]),[A,z]=l.useState([]),[T,he]=l.useState(""),[k,fe]=l.useState(""),[$,we]=l.useState(""),[o,B]=l.useState(null),[pe,W]=l.useState(!1),[be,Z]=l.useState(!1),[xe,n]=l.useState(!1),[H,h]=l.useState(null),[oe,f]=l.useState("id"),[ie,p]=l.useState("asc"),[m,P]=l.useState(0),[G,ee]=l.useState(5),[R,x]=l.useState({error:null,message:null}),[_,se]=l.useState(!1);l.useEffect(()=>{console.log("Redux user data:",N),console.log("Student ID:",u),console.log("Access Token:",sessionStorage.getItem("accessToken"))},[N,u]),l.useEffect(()=>{const a=sessionStorage.getItem("accessToken");u?a||(x({error:"Authentication token not found. Please log in again.",message:null}),n(!0)):(x({error:"Student ID not found. Please log in again.",message:null}),n(!0))},[u]),l.useEffect(()=>{(async()=>{try{const r=await C(L.CURRENT_ACADEMIC_YEAR);console.log("fetchAcademicYear response:",r),r&&r.status==="success"?he(r.data.name):(x({error:"Failed to fetch current academic year.",message:null}),n(!0))}catch(r){console.error("fetchAcademicYear error:",r),x({error:`Error fetching academic year: ${r.message}`,message:null}),n(!0)}})()},[C]),l.useEffect(()=>{(async()=>{try{const r=await C(L.CURRENT_ACADEMIC_TERM);console.log("fetchAcademicTerm response:",r),r&&r.status==="success"?fe(r.data.name):(x({error:"Failed to fetch current academic term.",message:null}),n(!0))}catch(r){console.error("fetchAcademicTerm error:",r),x({error:`Error fetching academic term: ${r.message}`,message:null}),n(!0)}})()},[C]),l.useEffect(()=>{q&&(x({error:`Error: ${q}`,message:null}),n(!0))},[q]),l.useEffect(()=>{(async()=>{var r,b;if(u)try{const i=await C(`${L.CLASS_LEVEL}?studentId=${u}`);if(console.log("fetchClasses response:",i),i&&i.status==="success"){const w=Array.isArray((r=i.data)==null?void 0:r.data)?i.data.data:Array.isArray(i.data)?i.data:Array.isArray((b=i.data)==null?void 0:b.classLevels)?i.data.classLevels:[];z(w),console.log("Classes set:",w),w.length===0&&(x({error:"No classes assigned to this student.",message:null}),n(!0))}else z([]),x({error:"No classes found for this student.",message:null}),n(!0)}catch(i){console.error("fetchClasses error:",i),z([]),x({error:`Error fetching classes: ${i.message}`,message:null}),n(!0)}})()},[u,C]),l.useEffect(()=>{(async()=>{var r;if(!(!u||!T||!k))try{const b=new URLSearchParams({studentId:u,session:T,term:k,...$&&{classLevelId:$},page:m+1,limit:G}).toString();console.log("fetchAssignments query:",b);const i=await C(`${L.ASSIGNMENT}/student?${b}`);if(console.log("fetchAssignments raw response:",i),i&&i.status==="success"){const w=Array.isArray((r=i.data)==null?void 0:r.data)?i.data.data:Array.isArray(i.data)?i.data:[];M(w),w.length===0&&m===0&&(x({error:"No assignments found for the current session and term.",message:null}),n(!0))}else console.log("Invalid response structure:",i),M([]),x({error:`Failed to fetch assignments: ${(i==null?void 0:i.message)||"Invalid response from server"}`,message:null}),n(!0)}catch(b){console.error("fetchAssignments error:",b.message,b.stack),M([]),x({error:"No assignment for this class yet.",message:null}),n(!0)}})()},[u,T,k,$,m,G,C]);const ae=Y.map((a,r)=>{var b;return{id:r+1,title:a.title,dueDate:a.dueDate?new Date(a.dueDate).toLocaleDateString():"N/A",description:String(a.description||"N/A"),className:Array.isArray(A)&&((b=A.find(i=>i._id===a.classLevelId))==null?void 0:b.name)||"N/A",assignmentId:a.id,hasSubmitted:a.submissions.some(i=>i.studentId._id===u),submission:a.submissions.find(i=>i.studentId._id===u),canSubmit:a.canSubmit}}),Ae=(a=null)=>{B(a),W(!0)},J=()=>{W(!1),B(null)},re=(a=null)=>{B(a),Z(!0)},K=()=>{Z(!1),h(null),B(null)},Se=()=>{n(!1),x({error:null,message:null})},I=a=>{const r=a.target.files[0];r&&!["application/pdf","image/jpeg","image/png"].includes(r.type)?(x({error:"Only PDF, JPEG, or PNG files are allowed.",message:null}),n(!0),h(null)):h(r)},Q=async a=>{if(!H){x({error:"No file selected.",message:null}),n(!0);return}se(!0);try{const r=new FormData;r.append("assignmentId",a),r.append("studentId",u),r.append("file",H);for(let[i,w]of r.entries())console.log(`FormData ${i}:`,w instanceof File?w.name:w);const b=await C(`${L.ASSIGNMENT}/submit`,"POST",r);console.log("handleFileSubmit response:",b),b&&b.status==="success"?(M(Y.map(i=>i.id===a?b.data:i)),x({error:null,message:"Assignment submitted successfully!"}),n(!0)):(x({error:`Failed to submit assignment: ${(b==null?void 0:b.message)||"No response from server"}`,message:null}),n(!0))}catch(r){console.error("handleFileSubmit error:",r.message,r.stack),x({error:`Error submitting assignment: ${r.message}`,message:null}),n(!0)}finally{se(!1),K()}},F=async a=>{if(!H){x({error:"No file selected.",message:null}),n(!0);return}se(!0);try{const r=new FormData;r.append("assignmentId",a),r.append("studentId",u),r.append("file",H);for(let[i,w]of r.entries())console.log(`FormData ${i}:`,w instanceof File?w.name:w);const b=await C(`${L.ASSIGNMENT}/submit`,"POST",r);console.log("handleFileResubmit response:",b),b&&b.status==="success"?(M(Y.map(i=>i.id===a?b.data:i)),x({error:null,message:"Assignment resubmitted successfully!"}),n(!0)):(x({error:`Failed to resubmit assignment: ${(b==null?void 0:b.message)||"No response from server"}`,message:null}),n(!0))}catch(r){console.error("handleFileResubmit error:",r.message,r.stack),x({error:`Error resubmitting assignment: ${r.message}`,message:null}),n(!0)}finally{se(!1),K()}},ce=[{id:"id",label:"ID",flex:.5},{id:"title",label:"Title",flex:1,renderCell:a=>e.jsx(c,{children:String(a.title||"N/A")})},{id:"className",label:"Class",flex:1,renderCell:a=>e.jsx(c,{children:a.className})},{id:"dueDate",label:"Due Date",flex:1,renderCell:a=>e.jsx(c,{children:a.dueDate||"N/A"})},{id:"description",label:"Description",flex:2,renderCell:a=>e.jsx(c,{children:String(a.description||"N/A")})},{id:"status",label:"Status",flex:1,renderCell:a=>e.jsx(c,{color:a.hasSubmitted?"success.main":a.canSubmit?"warning.main":"error.main",children:a.hasSubmitted?"Submitted":a.canSubmit?"Pending":"Closed"})},{id:"actions",label:"Actions",flex:1,renderCell:a=>e.jsxs(e.Fragment,{children:[e.jsx(Pe,{title:"View assignment",children:e.jsx(Ze,{onClick:()=>Ae(a),disabled:v||_,children:e.jsx(Ve,{})})}),a.canSubmit&&e.jsx(Pe,{title:a.hasSubmitted?"Resubmit assignment":"Submit assignment",children:e.jsx(V,{onClick:()=>re(a),variant:"contained",color:a.hasSubmitted?"secondary":"primary",disabled:v||_||!a.canSubmit,children:a.hasSubmitted?"Resubmit":"Submit"})})]})}],O=a=>{p(oe===a&&ie==="asc"?"desc":"asc"),f(a)},de=(a,r)=>{P(r)},j=a=>{ee(parseInt(a.target.value,10)),P(0)},ue=a=>{console.log("Row clicked:",a)},me={columns:ce,tableHeader:`Assignments for ${T}, ${k}${$&&Array.isArray(A)?`, ${((ge=A.find(a=>a._id===$))==null?void 0:ge.name)||""}`:""}`,data:ae,sortBy:oe,sortDirection:ie,onSortChange:O,page:m,rowsPerPage:G,onPageChange:de,onRowsPerPageChange:j,onRowClick:ue,hiddenColumnsSmallScreen:["description","status"]};return e.jsxs(E,{py:"20px",children:[e.jsx(Oe,{title:"STUDENT ASSIGNMENTS",subtitle:"View and Submit Assignments"}),e.jsxs(E,{mb:"20px",display:"flex",gap:"20px",alignItems:"center",children:[e.jsxs(c,{variant:"h6",children:["Session: ",T||"Loading..."]}),e.jsxs(c,{variant:"h6",children:["Term: ",k||"Loading..."]})]}),e.jsx(E,{children:v?e.jsx(c,{children:"Loading..."}):ae.length>0?e.jsx(Ue,{...me}):e.jsx(c,{children:"No assignments available for the current session and term."})}),e.jsx(ke,{open:pe,onClose:J,title:"Assignment Details",onConfirm:J,confirmText:"Close",cancelText:null,confirmDisabled:v||_,children:o&&e.jsxs(E,{display:"flex",flexDirection:"column",gap:"16px",children:[e.jsxs(c,{variant:"h6",children:["Title: ",o.title]}),e.jsxs(c,{variant:"body1",children:["Class: ",o.className]}),e.jsxs(c,{variant:"body1",children:["Due Date: ",o.dueDate]}),e.jsxs(c,{variant:"body2",children:["Description: ",o.description]}),o.hasSubmitted&&o.submission&&e.jsxs(E,{children:[e.jsx(c,{variant:"h6",children:"Your Submission"}),e.jsxs(c,{variant:"body2",children:["Submission Link:"," ",o.submission.cloudinaryLink?e.jsx("a",{href:o.submission.cloudinaryLink,target:"_blank",rel:"noopener noreferrer",style:{color:y.blueAccent[500]},children:"View Submission"}):"No file submitted"]}),e.jsxs(c,{variant:"body2",children:["Submitted on: ",new Date(o.submission.submissionDate).toLocaleDateString()]}),e.jsxs(c,{variant:"body2",children:["Viewed: ",o.submission.viewed?`Yes (on ${new Date(o.submission.viewedAt).toLocaleDateString()})`:"No"]}),e.jsx(c,{variant:"h6",children:"Teacher Comments"}),o.submission.comments.length>0?o.submission.comments.map((a,r)=>e.jsx(c,{variant:"body2",children:a.text||a},r)):e.jsx(c,{variant:"body2",children:"No comments yet."})]})]})}),e.jsx(ke,{open:be,onClose:K,title:`Submit Assignment: ${o==null?void 0:o.title}`,noConfirm:!0,cancelText:"Cancel",cancelDisabled:v||_,children:e.jsxs(E,{display:"flex",flexDirection:"column",gap:"16px",children:[e.jsx(le,{type:"file",onChange:I,fullWidth:!0,inputProps:{accept:"application/pdf,image/jpeg,image/png"},helperText:"Accepted formats: PDF, JPEG, PNG",disabled:_}),e.jsx(Qe,{onClick:()=>o!=null&&o.hasSubmitted?F(o==null?void 0:o.assignmentId):Q(o==null?void 0:o.assignmentId),content:_?"Submitting...":o!=null&&o.hasSubmitted?"Resubmit":"Submit",sx:{margin:"10px"},disabled:_||!H||!(o!=null&&o.canSubmit),startIcon:_?e.jsx(te,{size:20}):null})]})}),e.jsx(Ye,{open:xe,onClose:Se,isLoading:v||_,title:"Assignment Submission Confirmation",message:R.message||R.error,isSuccess:R.message!==null})]})},D=[];for(let g=0;g<256;++g)D.push((g+256).toString(16).slice(1));function ns(g,y=0){return(D[g[y+0]]+D[g[y+1]]+D[g[y+2]]+D[g[y+3]]+"-"+D[g[y+4]]+D[g[y+5]]+"-"+D[g[y+6]]+D[g[y+7]]+"-"+D[g[y+8]]+D[g[y+9]]+"-"+D[g[y+10]]+D[g[y+11]]+D[g[y+12]]+D[g[y+13]]+D[g[y+14]]+D[g[y+15]]).toLowerCase()}let ve;const ls=new Uint8Array(16);function os(){if(!ve){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ve=crypto.getRandomValues.bind(crypto)}return ve(ls)}const is=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Re={randomUUID:is};function cs(g,y,N){var v;if(Re.randomUUID&&!g)return Re.randomUUID();g=g||{};const u=g.random??((v=g.rng)==null?void 0:v.call(g))??os();if(u.length<16)throw new Error("Random bytes length must be >= 16");return u[6]=u[6]&15|64,u[8]=u[8]&63|128,ns(u)}var Ie={},ds=Xe;Object.defineProperty(Ie,"__esModule",{value:!0});var qe=Ie.default=void 0,us=ds(Ke()),ms=e;qe=Ie.default=(0,us.default)((0,ms.jsx)("path",{d:"M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4zM18 14H6v-2h12zm0-3H6V9h12zm0-3H6V6h12z"}),"Comment");const gs=()=>{var Ee,Ne,Te;const g=Ge(),y=Fe(g.palette.mode),N=De(s=>{var t;return((t=s.users)==null?void 0:t.user)||{}}),u=N==null?void 0:N._id,{loading:v,error:q,callApi:C}=Be(),[Y,M]=l.useState([]),[A,z]=l.useState([]),[T,he]=l.useState(""),[k,fe]=l.useState(""),[$,we]=l.useState(""),[o,B]=l.useState(null),[pe,W]=l.useState(!1),[be,Z]=l.useState(!1),[xe,n]=l.useState(!1),[H,h]=l.useState(""),[oe,f]=l.useState("error"),[ie,p]=l.useState("Assignment Action"),[m,P]=l.useState({title:"",dueDate:"",description:"",classLevelId:"",subclass:""}),[G,ee]=l.useState(""),[R,x]=l.useState(null),[_,se]=l.useState("id"),[ae,Ae]=l.useState("asc"),[J,re]=l.useState(0),[K,Se]=l.useState(5),[I,Q]=l.useState(!1),[F,ce]=l.useState(!1),[O,de]=l.useState(!1),[j,ue]=l.useState({});l.useEffect(()=>{console.log("Redux user data:",N),console.log("Teacher ID:",u),console.log("Access Token:",sessionStorage.getItem("accessToken"))},[N,u]),l.useEffect(()=>{const s=sessionStorage.getItem("accessToken");u?s||(h("Authentication token not found. Please log in again."),f("error"),p("Authentication Error"),n(!0)):(h("Teacher ID not found. Please log in again."),f("error"),p("Authentication Error"),n(!0))},[u]),l.useEffect(()=>{(async()=>{try{const t=await C(L.CURRENT_ACADEMIC_YEAR);console.log("fetchAcademicYear response:",t),t&&t.status==="success"?he(t.data.name):(h("Failed to fetch current academic year."),f("error"),p("Error Fetching Academic Year"),n(!0))}catch(t){console.error("fetchAcademicYear error:",t),h(`Error fetching academic year: ${t.message}`),f("error"),p("Error Fetching Academic Year"),n(!0)}})()},[C]),l.useEffect(()=>{(async()=>{try{const t=await C(L.CURRENT_ACADEMIC_TERM);console.log("fetchAcademicTerm response:",t),t&&t.status==="success"?fe(t.data.name):(h("Failed to fetch current academic term."),f("error"),p("Error Fetching Academic Term"),n(!0))}catch(t){console.error("fetchAcademicTerm error:",t),h(`Error fetching academic term: ${t.message}`),f("error"),p("Error Fetching Academic Term"),n(!0)}})()},[C]),l.useEffect(()=>{q&&(h(`Error: ${q}`),f("error"),p("API Error"),n(!0))},[q]),l.useEffect(()=>{(async()=>{var t,d;if(u)try{const S=await C(`${L.CLASS_LEVEL}?teacherId=${u}`);if(console.log("fetchClasses response:",S),S&&S.status==="success"){const U=Array.isArray((t=S.data)==null?void 0:t.data)?S.data.data:Array.isArray(S.data)?S.data:Array.isArray((d=S.data)==null?void 0:d.classLevels)?S.data.classLevels:[];z(U),console.log("Classes set:",U),U.length===0&&(h("No classes assigned to this teacher."),f("error"),p("No Classes Found"),n(!0))}else z([]),h("No classes found for this teacher."),f("error"),p("No Classes Found"),n(!0)}catch(S){console.error("fetchClasses error:",S),z([]),h(`Error fetching classes: ${S.message}`),f("error"),p("Error Fetching Classes"),n(!0)}})()},[u,C]),l.useEffect(()=>{(async()=>{if(!(!u||!T||!k))try{const t=new URLSearchParams({teacherId:u,session:T,term:k,...$&&{classLevelId:$},page:J+1,limit:K}).toString();console.log("fetchAssignments query:",t);const d=await C(`${L.ASSIGNMENT}/teacher?${t}`);console.log("fetchAssignments response:",d),d&&d.status==="success"?(M(d.data.data||[]),d.data.data.length===0&&J===0&&(h("No assignments found for the current session and term."),f("error"),p("No Assignments Found"),n(!0))):(M([]),h(`Failed to fetch assignments: ${(d==null?void 0:d.message)||"Unknown error"}`),f("error"),p("Error Fetching Assignments"),n(!0))}catch(t){console.error("fetchAssignments error:",t),M([]),h(`Error fetching assignments: ${t.message}`),f("error"),p("Error Fetching Assignments"),n(!0)}})()},[u,T,k,$,J,K,C]);const me=Y.map((s,t)=>{var d;return console.log("Mapping assignment:",s),console.log("Classes state:",A),{id:t+1,title:s.title,dueDate:s.dueDate?new Date(s.dueDate).toLocaleDateString():"N/A",description:String(s.description||"N/A"),className:Array.isArray(A)&&((d=A.find(S=>{var U;return S._id===(((U=s.classLevelId)==null?void 0:U._id)||s.classLevelId)}))==null?void 0:d.name)||"N/A",assignmentId:s.id,submissions:s.submissions||[],teacherId:s.teacherId}}),ge=async()=>{Q(!0);const s=new Date(m.dueDate);if(isNaN(s)||s<=new Date){h("Please enter a valid future due date (YYYY-MM-DD)."),f("error"),p("Invalid Due Date"),n(!0),Q(!1);return}if(!m.title||!m.dueDate||!m.description||!m.classLevelId||!m.subclass){h("Please fill all fields, including subclass."),f("error"),p("Missing Fields"),n(!0),Q(!1);return}const t=A.find(d=>d._id===m.classLevelId);if(!t||!t.subclasses.some(d=>d.letter===m.subclass)){h(`Invalid subclass: ${m.subclass} for selected class`),f("error"),p("Invalid Subclass"),n(!0),Q(!1);return}try{const d={id:cs(),session:T,term:k,classLevelId:m.classLevelId,subclass:m.subclass,title:m.title,dueDate:s.toISOString(),description:m.description,teacherId:u};console.log("handleAddAssignment payload:",d);const S=await C(L.ASSIGNMENT,"POST",d);console.log("handleAddAssignment response:",S),S&&S.status==="success"?(M([...Y,S.data]),h("Assignment created successfully!"),f("success"),p("Assignment Created"),n(!0),P({title:"",dueDate:"",description:"",classLevelId:"",subclass:""}),W(!1)):(h(`Failed to create assignment: ${(S==null?void 0:S.message)||"Unknown error"}`),f("error"),p("Error Creating Assignment"),n(!0))}catch(d){console.error("handleAddAssignment error:",d),h(`Error creating assignment: ${d.message}`),f("error"),p("Error Creating Assignment"),n(!0)}finally{Q(!1)}},a=async s=>{if(!G.trim()){h("Comment cannot be empty."),f("error"),p("Invalid Comment"),n(!0);return}ce(!0);try{const t=await C(`${L.ASSIGNMENT}/comment`,"POST",{assignmentId:o.assignmentId,studentId:s.studentId._id,comments:[...(s.comments||[]).map(d=>d.text||d),G],teacherId:u});console.log("handleAddComment response:",t),t&&t.status==="success"?(M(Y.map(d=>d.id===o.assignmentId?t.data:d)),ee(""),x(null),h("Comment added successfully!"),f("success"),p("Comment Posted"),n(!0)):(h(`Failed to add comment: ${(t==null?void 0:t.message)||"Unknown error"}`),f("error"),p("Error Adding Comment"),n(!0))}catch(t){console.error("handleAddComment error:",t),h(`Error adding comment: ${t.message}`),f("error"),p("Error Adding Comment"),n(!0)}finally{ce(!1)}},r=async s=>{de(!0);try{const t=await C(`${L.ASSIGNMENT}/view`,"POST",{assignmentId:o.assignmentId,studentId:s.studentId._id,teacherId:u});console.log("handleMarkAsViewed response:",t),t&&t.status==="success"?(M(Y.map(d=>d.id===o.assignmentId?t.data:d)),h("Submission marked as viewed! Note: The submission file will be deleted after 7 days."),f("success"),p("Submission Viewed"),n(!0)):(h(`Failed to mark submission as viewed: ${(t==null?void 0:t.message)||"Unknown error"}`),f("error"),p("Error Marking Submission"),n(!0))}catch(t){console.error("handleMarkAsViewed error:",t),h(`Error marking submission as viewed: ${t.message}`),f("error"),p("Error Marking Submission"),n(!0)}finally{de(!1)}},b=async s=>{if(!s.cloudinaryLink){h("No file available for download."),f("error"),p("Download Error"),n(!0);return}ue(t=>({...t,[s._id]:!0}));try{console.log("Downloading cloudinaryLink:",s.cloudinaryLink);const t=await C(s.cloudinaryLink,"GET",null,{responseType:"blob"});console.log("Download response:",t);const d=s.cloudinaryLink.split("."),S=d.length>1?`.${d.pop()}`:"",U=window.URL.createObjectURL(new Blob([t.data])),ne=document.createElement("a");ne.href=U,ne.download=s.name?`${s.name.replace(/\s+/g,"_")}_submission${S}`:`submission_${s._id}${S}`,document.body.appendChild(ne),ne.click(),document.body.removeChild(ne),window.URL.revokeObjectURL(U),h("File downloaded successfully."),f("success"),p("Download Success"),n(!0)}catch(t){console.error("handleDownloadFile error:",t),h(`Error downloading file: ${t.message}`),f("error"),p("Download Error"),n(!0)}finally{ue(t=>({...t,[s._id]:!1}))}},i=[{id:"id",label:"ID",flex:.5},{id:"title",label:"Title",flex:1,renderCell:s=>e.jsx(c,{children:String(s.title||"N/A")})},{id:"className",label:"Class",flex:1,renderCell:s=>e.jsx(c,{children:s.className})},{id:"dueDate",label:"Due Date",flex:1,renderCell:s=>e.jsx(c,{children:s.dueDate||"N/A"})},{id:"description",label:"Description",flex:2,renderCell:s=>e.jsx(c,{children:String(s.description||"N/A")})},{id:"submissions",label:"Submissions",flex:1,renderCell:s=>e.jsx(c,{color:s.submissions.length===0?"error":"inherit",children:s.submissions.length>0?`${s.submissions.length} student(s) submitted`:"No submissions"})},{id:"actions",label:"Actions",flex:1,renderCell:s=>e.jsx(V,{variant:"contained",color:"primary",size:"small",onClick:()=>{B(s),Z(!0)},startIcon:e.jsx(Ve,{}),disabled:v||F||O||Object.values(j).some(Boolean),children:"View"})}],w=s=>{Ae(_===s&&ae==="asc"?"desc":"asc"),se(s)},ze=(s,t)=>{re(t)},We=s=>{Se(parseInt(s.target.value,10)),re(0)},He=s=>{console.log("Row clicked:",s)},Je={columns:i,tableHeader:`Assignments for ${T}, ${k}${$&&Array.isArray(A)?`, ${((Ee=A.find(s=>s._id===$))==null?void 0:Ee.name)||""}`:""}`,data:me,sortBy:_,sortDirection:ae,onSortChange:w,page:J,rowsPerPage:K,onPageChange:ze,onRowsPerPageChange:We,onRowClick:He,hiddenColumnsSmallScreen:["description","submissions"]};return e.jsxs(E,{py:"20px",children:[e.jsx(Oe,{title:"TEACHER ASSIGNMENTS",subtitle:"Manage Assignments for Classes"}),e.jsxs(E,{mb:"20px",display:"flex",gap:"20px",alignItems:"center",children:[e.jsxs(c,{variant:"h6",children:["Session: ",T||"Loading..."]}),e.jsxs(c,{variant:"h6",children:["Term: ",k||"Loading..."]}),e.jsxs(ye,{sx:{minWidth:150},children:[e.jsx(Ce,{id:"class-select-label",children:"Class"}),e.jsxs(je,{labelId:"class-select-label",value:$,label:"Class",onChange:s=>{we(s.target.value),re(0)},disabled:v||I||Object.values(j).some(Boolean)||!Array.isArray(A)||A.length===0,children:[e.jsx(X,{value:"",children:"All Classes"}),Array.isArray(A)&&A.length>0?A.map(s=>e.jsx(X,{value:s._id,children:s.name},s._id)):e.jsx(X,{disabled:!0,children:"No classes available"})]})]}),e.jsx(V,{variant:"contained",color:"secondary",onClick:()=>W(!0),sx:{ml:"auto"},disabled:v||I||Object.values(j).some(Boolean)||!u||!sessionStorage.getItem("accessToken")||!Array.isArray(A)||A.length===0||!T||!k,startIcon:I?e.jsx(te,{size:20}):null,children:I?"Adding...":"Add Assignment"})]}),e.jsx(E,{children:v?e.jsx(c,{children:"Loading..."}):me.length>0?e.jsx(Ue,{...Je}):e.jsx(c,{children:"No assignments available for the current session and term."})}),e.jsxs(Le,{open:pe,onClose:()=>{W(!1),P({title:"",dueDate:"",description:"",classLevelId:"",subclass:""})},children:[e.jsx(Me,{children:"Add New Assignment"}),e.jsx($e,{children:e.jsxs(E,{display:"flex",flexDirection:"column",gap:"16px",mt:"10px",children:[e.jsxs(ye,{fullWidth:!0,required:!0,children:[e.jsx(Ce,{id:"add-class-select-label",children:"Class"}),e.jsx(je,{labelId:"add-class-select-label",value:m.classLevelId,label:"Class",onChange:s=>P({...m,classLevelId:s.target.value,subclass:""}),disabled:v||I||Object.values(j).some(Boolean)||!Array.isArray(A)||A.length===0,children:Array.isArray(A)&&A.length>0?A.map(s=>e.jsx(X,{value:s._id,children:s.name},s._id)):e.jsx(X,{disabled:!0,children:"No classes available"})})]}),e.jsxs(ye,{fullWidth:!0,required:!0,children:[e.jsx(Ce,{id:"add-subclass-select-label",children:"Subclass"}),e.jsx(je,{labelId:"add-subclass-select-label",value:m.subclass,label:"Subclass",onChange:s=>P({...m,subclass:s.target.value}),disabled:v||I||Object.values(j).some(Boolean)||!m.classLevelId,children:Array.isArray(A)&&((Te=(Ne=A.find(s=>s._id===m.classLevelId))==null?void 0:Ne.subclasses)==null?void 0:Te.length)>0?A.find(s=>s._id===m.classLevelId).subclasses.map(s=>e.jsx(X,{value:s.letter,children:s.letter},s.letter)):e.jsx(X,{disabled:!0,children:"No subclasses available"})})]}),e.jsx(le,{label:"Title",value:m.title,onChange:s=>P({...m,title:s.target.value}),fullWidth:!0,required:!0,disabled:I||Object.values(j).some(Boolean)}),e.jsx(le,{label:"Due Date (YYYY-MM-DD)",value:m.dueDate,onChange:s=>P({...m,dueDate:s.target.value}),fullWidth:!0,required:!0,type:"date",InputLabelProps:{shrink:!0},disabled:I||Object.values(j).some(Boolean)}),e.jsx(le,{label:"Description",value:m.description,onChange:s=>P({...m,description:s.target.value}),multiline:!0,rows:4,fullWidth:!0,required:!0,disabled:I||Object.values(j).some(Boolean)})]})}),e.jsxs(_e,{children:[e.jsx(V,{onClick:()=>{W(!1),P({title:"",dueDate:"",description:"",classLevelId:"",subclass:""})},disabled:v||I||Object.values(j).some(Boolean),children:"Cancel"}),e.jsx(V,{onClick:ge,color:"primary",disabled:I||Object.values(j).some(Boolean)||!m.title||!m.dueDate||!m.description||!m.classLevelId||!m.subclass,startIcon:I?e.jsx(te,{size:20}):null,children:I?"Adding...":"Add"})]})]}),e.jsxs(Le,{open:be,onClose:()=>{Z(!1),B(null),x(null),ee("")},maxWidth:"md",fullWidth:!0,children:[e.jsx(Me,{children:"Assignment Details"}),e.jsx($e,{children:o&&e.jsxs(E,{display:"flex",flexDirection:"column",gap:"16px",children:[e.jsxs(c,{variant:"h6",children:["Title: ",o.title]}),e.jsxs(c,{variant:"body1",children:["Class: ",o.className]}),e.jsxs(c,{variant:"body1",children:["Due Date: ",o.dueDate]}),e.jsxs(c,{variant:"body2",children:["Description: ",o.description]}),e.jsx(c,{variant:"h6",sx:{mt:2},children:"Submissions"}),o.submissions.length>0?o.submissions.map(s=>e.jsx(ts,{title:`${s.name||s.studentId.firstName+" "+s.studentId.lastName} (Submitted: ${new Date(s.submissionDate).toLocaleDateString()})`,details:e.jsxs(E,{display:"flex",flexDirection:"column",gap:"16px",children:[e.jsxs(c,{variant:"body1",children:["Submission Link:"," ",s.cloudinaryLink?e.jsx("a",{href:s.cloudinaryLink,target:"_blank",rel:"noopener noreferrer",style:{color:y.blueAccent[500]},children:"View Submission"}):"No file submitted"]}),e.jsxs(c,{variant:"body2",children:["Submitted on: ",new Date(s.submissionDate).toLocaleDateString()]}),e.jsxs(c,{variant:"body2",children:["Viewed: ",s.viewed?`Yes (on ${new Date(s.viewedAt).toLocaleDateString()})`:"No"]}),e.jsxs(E,{children:[e.jsx(c,{variant:"h6",children:"Comments"}),s.comments.length>0?s.comments.map((t,d)=>e.jsx(E,{sx:{mb:1},children:e.jsx(c,{variant:"body2",children:t.text||t})},d)):e.jsx(c,{variant:"body2",children:"No comments yet."})]}),e.jsxs(E,{display:"flex",flexDirection:"column",gap:"8px",children:[e.jsx(le,{label:"Add Comment",value:(R==null?void 0:R.studentId._id)===s.studentId._id?G:"",onChange:t=>{x(s),ee(t.target.value)},fullWidth:!0,multiline:!0,rows:2,sx:{mb:2},disabled:F||j[s._id]}),e.jsxs(E,{display:"flex",gap:"8px",children:[e.jsx(V,{variant:"contained",color:"primary",onClick:()=>a(s),disabled:F||j[s._id]||!G.trim()||(R==null?void 0:R.studentId._id)!==s.studentId._id,startIcon:F?e.jsx(te,{size:20}):e.jsx(qe,{}),children:F?"Adding Comment...":"Add Comment"}),e.jsx(V,{variant:"contained",color:"secondary",onClick:()=>r(s),disabled:O||j[s._id]||s.viewed,startIcon:O?e.jsx(te,{size:20}):e.jsx(es,{}),children:O?"Marking...":"Mark as Viewed"}),s.cloudinaryLink&&e.jsx(V,{variant:"contained",color:"info",onClick:()=>b(s),disabled:j[s._id]||F||O,startIcon:j[s._id]?e.jsx(te,{size:20}):e.jsx(ss,{}),children:j[s._id]?"Downloading...":"Download"})]})]})]}),defaultExpanded:!1},s.studentId._id)):e.jsx(c,{children:"No submissions"})]})}),e.jsx(_e,{children:e.jsx(V,{onClick:()=>{Z(!1),B(null),x(null),ee("")},disabled:v||F||O||Object.values(j).some(Boolean),children:"Close"})})]}),e.jsx(Ye,{open:xe,onClose:()=>{n(!1),h(""),f("error"),p("Assignment Action")},isLoading:v||I||F||O||Object.values(j).some(Boolean),title:ie,message:H,isSuccess:oe==="success"})]})},hs=()=>{const g=De(N=>N.users.user),y=g.role;return e.jsx("div",{children:y==="student"?e.jsx(rs,{}):e.jsx(gs,{babtechUser:g})})},Fs=as(hs);export{Fs as default};
