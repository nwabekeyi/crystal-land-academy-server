import{r as n,j as t,a as pe,P as fe}from"./index-22HUb1_z.js";import{g as xe,a as Se,s as Ce,T as z,r as je,u as De,b as Ae,_ as K,d as be,e as ye,a1 as Te,a2 as Ue,a3 as Ne,A as ve,j as Me,y as L,w as b}from"./constants-BJW4J9P5.js";import{M as J,u as Ee}from"./MenuItem-38XN_-vW.js";import{S as R}from"./index-Cq8adCwn.js";import{H as Ie}from"./Header-CXtHvVsg.js";import{T as O}from"./table-iQGSzLj8.js";import{a as Pe}from"./index-dxrUZtLq.js";import{d as Re}from"./Edit-C8fyuzwg.js";import{d as we}from"./Visibility-CAQTlKmU.js";import{u as W}from"./useApi-BivKV4bK.js";import{I as _}from"./IconButton-xWupQFdG.js";import{t as $e,D as Le,a as Oe,b as _e,c as ke,M as Be}from"./modal-CFzM2TvC.js";import{w as Fe}from"./dasboardPagesContainer-qh7jt9JW.js";import{C as He}from"./confirmationModal-BxJ-28ob.js";import{T as Ve,a as k}from"./Tabs-BoMh39Zo.js";import"./Alert-Bl6PSDrU.js";import"./useSlot-Bb0ot7dQ.js";import"./useMediaQuery-vabypUKQ.js";import"./index-DF2Knd0X.js";import"./loadingButton-DUprIo-A.js";function Je(s){return Se("MuiDialogContentText",s)}xe("MuiDialogContentText",["root"]);const We=["children","className"],ze=s=>{const{classes:i}=s,l=ye({root:["root"]},Je,i);return K({},i,l)},Ke=Ce(z,{shouldForwardProp:s=>je(s)||s==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(s,i)=>i.root})({}),qe=n.forwardRef(function(i,m){const l=De({props:i,name:"MuiDialogContentText"}),{className:c}=l,d=Ae(l,We),o=ze(d);return t.jsx(Ke,K({component:"p",variant:"body1",color:"text.secondary",ref:m,ownerState:d,className:be(o.root,c)},l,{classes:o}))}),Ge=({label:s,options:i,onSelect:m})=>{const[l,c]=n.useState(""),d=o=>{const r=o.target.value;c(r),m(r)};return t.jsxs(Te,{sx:{width:"170px",paddingBottom:"2%"},variant:"outlined",children:[t.jsx(Ue,{id:`${s}-select-label`,children:s}),t.jsxs(Ne,{labelId:`${s}-select-label`,value:l,onChange:d,label:s,children:[t.jsx(J,{value:"",disabled:!0,children:`Select ${s}`}),i.map(o=>t.jsx(J,{value:o.value,children:o.label},o.value))]})]})},Qe=()=>t.jsx(R,{role:"student"}),Xe=()=>t.jsx(R,{role:"teacher"}),Ye=()=>t.jsx(R,{role:"admin"}),q=()=>{const s=Ee(),i=pe(e=>e.adminData.usersData||{}),{students:m=[],teachers:l=[],admins:c=[]}=i;console.log("Teachers data:",l);const d=(e,a)=>a==="student"?m.find(S=>S.studentId===e):a==="teacher"?l.find(S=>S.teacherId===e):a==="admin"?c.find(S=>S._id===e):null,[o,r]=n.useState(""),[g,p]=n.useState("id"),[h,j]=n.useState("asc"),[v,f]=n.useState(0),[y,u]=n.useState(20),[x,C]=n.useState(null),[M,D]=n.useState({}),[A,T]=n.useState(!1),[U,N]=n.useState(!1),[E,I]=n.useState(!1),[w,G]=n.useState(0),[Q,F]=n.useState(!1),{callApi:X,loading:Y,data:Z,error:ee}=W(),{callApi:st,loading:te,error:se}=W(),[ae,H]=n.useState(!1),[P,$]=n.useState(!1),ne=e=>{r(e),I(!0)};n.useEffect(()=>{$(!P)},[U,E]);const oe=e=>{j(g===e&&h==="asc"?"desc":"asc"),p(e)},le=(e,a)=>{f(a)},re=e=>{u(parseInt(e.target.value,10)),f(0)},ie=e=>{const a=d(e.id,e.role);a&&(sessionStorage.setItem("selectedUser",JSON.stringify({...a,role:e.role})),D(a),T(!0))},V=e=>{const a=d(e.id,e.role);a&&(sessionStorage.setItem("selectedUser",JSON.stringify({...a,role:e.role})),D(a),N(!0))},de=()=>{H(!1)},ce=async()=>{const e=JSON.parse(sessionStorage.getItem("selectedUser"));if(e)try{const a={id:e.studentId||e.teacherId||e._id,role:e.role};await X(ve.USER,"DELETE",a),Z&&(s(fe({id:a.id,role:a.role})),sessionStorage.removeItem("selectedUser"),sessionStorage.setItem("confirmModal","true"),T(!1),C(null),$(!P))}catch(a){console.error("Error deleting user:",a),sessionStorage.setItem("confirmModal","true"),$(!P)}},me=[{id:"sn",label:"S/N",width:90},{id:"id",label:"ID",width:100,renderCell:e=>t.jsx(z,{children:(e.role==="student"||e.role==="teacher",String(e.id))})},{id:"name",label:"Name",flex:1},{id:"email",label:"Email",flex:1},{id:"details",label:"Details",flex:1,renderCell:e=>e.role==="student"?`${e.classLevel||"N/A"} (${e.boardingStatus||"N/A"})`:e.role==="teacher"?e.subject||"N/A":"Admin"},{id:"createdAt",label:"Registered Date",flex:1},{id:"actions",label:"Actions",width:200,renderCell:e=>t.jsxs("div",{style:{display:"flex"},children:[t.jsx(_,{onClick:()=>V(e),children:t.jsx(Re,{})}),t.jsx(_,{onClick:()=>ie(e),children:t.jsx(Pe,{})}),t.jsx(_,{onClick:()=>{C(e),F(!0)},children:t.jsx(we,{})})]})}],ge=Array.isArray(m)?m.map((e,a)=>(console.log("Student:",e),{id:e.studentId??"N/A",sn:a+1,role:"student",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",classLevel:e.currentClassLevel?`${e.currentClassLevel.className} ${e.currentClassLevel.subclass}`:"N/A",boardingStatus:e.boardingStatus||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"})).sort((e,a)=>e.sn-a.sn):[],he=Array.isArray(l)?l.map((e,a)=>{var S;return{id:e.teacherId||"N/A",sn:a+1,role:"teacher",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",subject:((S=e.subject)==null?void 0:S.name)||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"}}).sort((e,a)=>e.sn-a.sn):[],ue=Array.isArray(c)?c.map((e,a)=>({id:e._id||"N/A",sn:a+1,role:"admin",name:`${e.firstName||"N/A"} ${e.lastName||"N/A"}`,email:e.email||"N/A",createdAt:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"})).sort((e,a)=>e.sn-a.sn):[];return{studentData:ge,teacherData:he,adminData:ue,selectedRole:o,setSelectedRole:r,sortBy:g,sortDirection:h,page:v,rowsPerPage:y,selectedUser:x,setSelectedUser:C,editUserDetailsState:M,openDeleteModal:A,setOpenDeleteModal:T,editDialogOpen:U,setEditDialogOpen:N,signUpDialogOpen:E,setSignUpDialogOpen:I,viewUserDetails:Q,setViewUserDetails:F,confirmModalOpen:ae,setConfirmModalOpen:H,handleRoleSelect:ne,handleSortChange:oe,handlePageChange:le,handleRowsPerPageChange:re,handleEdit:V,handleDelete:ce,handleConfirmationModalClose:de,columns:me,tabIndex:w,handleTabChange:(e,a)=>{G(a),f(0)},loading:Y||te,deleteError:ee,updateError:se,rerender:P}},B=({confirm:s,buttonLabel:i,dialogTitle:m,dialogContent:l,scrollType:c="paper",actionText1:d="Cancel",actionText2:o="Confirm",open:r=!1,onClose:g,onConfirm:p,maxWidth:h="sm"})=>{const[j,v]=n.useState(c),f=n.useRef(null),y=Me(),u=$e(y.palette.mode);return n.useEffect(()=>{if(r){const{current:x}=f;x!==null&&x.focus()}},[r]),t.jsxs(n.Fragment,{children:[t.jsx(L,{onClick:()=>g(),children:i}),t.jsxs(Le,{open:r,onClose:g,scroll:j,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",maxWidth:h,fullWidth:!0,children:[t.jsx(Oe,{id:"scroll-dialog-title",children:m}),t.jsx(_e,{dividers:j==="paper",children:t.jsx(qe,{id:"scroll-dialog-description",ref:f,tabIndex:-1,children:l})}),t.jsxs(ke,{children:[t.jsx(L,{sx:{color:u.redAccent[500],border:`solis 2px ${u.redAccent[500]}`},onClick:g,children:d}),s&&t.jsx(L,{sx:{color:u.greenAccent[500],border:`solis 2px ${u.greenAccent[500]}`},onClick:p,children:o})]})]})]})},Ze=({selectedRole:s,editDialogOpen:i,setEditDialogOpen:m,handleEdit:l})=>{const[c,d]=n.useState(null);return n.useEffect(()=>{const o=sessionStorage.getItem("selectedUser");if(o){const r=JSON.parse(o);console.log(r),d(r),console.log(c)}},[]),t.jsx(b,{children:t.jsx(B,{buttonLabel:"Edit User",dialogTitle:"Edit User",dialogContent:c&&t.jsx(R,{role:s,selectedUser:c._id}),scrollType:"body",actionText1:"Cancel",actionText2:"Confirm",open:i,onClose:()=>m(!1),onConfirm:l})})},et=({open:s,onClose:i})=>{const{handleDelete:m,loading:l,deleteData:c,rerender:d,deleteError:o}=q(),[r,g]=n.useState(!1);n.useEffect(()=>{const h=sessionStorage.getItem("confrimModal");h&&(g(h),console.log(r))},[d]);const p=()=>{g(!1),sessionStorage.removeItem("confrimModal")};return t.jsxs(t.Fragment,{children:[t.jsx(Be,{open:s,onClose:i,title:"Confirm delete",onConfirm:m,children:t.jsxs("p",{children:["Confirm deletion of user."," ",t.jsx("span",{style:{color:"#EB433D",fontWeight:"900",fontSize:"large"},children:"Kindly note that this cannot be reversed"})]})}),t.jsx(He,{open:r&&r,isLoading:l,onClose:p,title:"Delete confirmation",message:c?"User successfully deleted":o})]})},tt=()=>{const{selectedUser:s,editDialogOpen:i,studentData:m,teacherData:l,adminData:c,selectedRole:d,setSelectedRole:o,sortBy:r,sortDirection:g,page:p,rowsPerPage:h,setEditDialogOpen:j,signUpDialogOpen:v,setSignUpDialogOpen:f,handleRoleSelect:y,handleSortChange:u,handlePageChange:x,handleRowsPerPageChange:C,handleEdit:M,columns:D,tabIndex:A,handleTabChange:T,viewUserDetails:U,setViewUserDetails:N,openDeleteModal:E,setOpenDeleteModal:I,rerender:w}=q();return n.useEffect(()=>{s&&N(!0)},[s]),t.jsxs(b,{children:[t.jsx(Ie,{title:"User Management",subtitle:"Manage users"}),t.jsx(Ge,{label:"Add Users",options:[{value:"student",label:"Student"},{value:"teacher",label:"Teacher"},{value:"admin",label:"Admin"}],onSelect:y}),t.jsx(b,{mt:2,children:t.jsxs(Ve,{value:A,onChange:T,children:[t.jsx(k,{label:"Students"}),t.jsx(k,{label:"Teachers"}),t.jsx(k,{label:"Admins"})]})}),A===0&&t.jsx(b,{m:"20px 0 0 0",height:"75vh",children:t.jsx(O,{columns:D,tableHeader:"Student Management",data:m,sortBy:r,sortDirection:g,onSortChange:u,page:p,rowsPerPage:h,onPageChange:x,onRowsPerPageChange:C,onRowClick:()=>o("student"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})}),A===1&&t.jsx(b,{m:"20px 0 0 0",height:"75vh",children:t.jsx(O,{columns:D,tableHeader:"Teacher Management",data:l,sortBy:r,sortDirection:g,onSortChange:u,page:p,rowsPerPage:h,onPageChange:x,onRowsPerPageChange:C,onRowClick:()=>o("teacher"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})}),A===2&&t.jsx(b,{m:"20px 0 0 0",height:"75vh",children:t.jsx(O,{columns:D,tableHeader:"Admin Management",data:c,sortBy:r,sortDirection:g,onSortChange:u,page:p,rowsPerPage:h,onPageChange:x,onRowsPerPageChange:C,onRowClick:()=>o("admin"),hiddenColumnsSmallScreen:["email","createdAt"],hiddenColumnsTabScreen:["createdAt","details"]})}),U&&s&&t.jsx(B,{buttonLabel:"View User Details",dialogTitle:"User Details",dialogContent:t.jsxs(t.Fragment,{children:[t.jsxs(Typography,{children:["ID: ",s.id]}),t.jsxs(Typography,{children:["Name: ",`${s.name}`]}),t.jsxs(Typography,{children:["Email: ",s.email]}),s.role==="student"&&t.jsxs(t.Fragment,{children:[t.jsxs(Typography,{children:["Class: ",s.classLevel]}),t.jsxs(Typography,{children:["Boarding Status: ",s.boardingStatus]})]}),s.role==="teacher"&&t.jsxs(Typography,{children:["Subject: ",s.subject]}),t.jsxs(Typography,{children:["Role: ",s.role]}),t.jsxs(Typography,{children:["Registered Date: ",s.createdAt]})]}),scrollType:"paper",actionText1:"Close",actionText2:"Edit",open:U,onClose:()=>N(!1),onAction2:()=>M(s)}),t.jsx(et,{open:E,onClose:()=>I(!1)}),t.jsx(Ze,{selectedRole:d,editDialogOpen:i,setEditDialogOpen:j,handleEdit:M,rerender:w}),t.jsx(B,{buttonLabel:"Sign Up",dialogTitle:"Sign Up User",dialogContent:d==="student"?t.jsx(Qe,{}):d==="teacher"?t.jsx(Xe,{}):d==="admin"?t.jsx(Ye,{}):null,scrollType:"body",actionText1:"Cancel",actionText2:"Confirm",open:v,onClose:()=>f(!1)})]})},yt=Fe(tt);export{yt as default};
