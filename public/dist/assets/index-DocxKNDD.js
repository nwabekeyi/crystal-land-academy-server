import{a as Q,W as X,r as n,e as D,U as re,j as e,q as ne}from"./index-CFm5FUDz.js";import{t as ie,M as H}from"./modal-CGQB-OdF.js";import{H as oe}from"./Header-DuaJzItp.js";import{T as le}from"./table-ByZlExWb.js";import{u as z}from"./useApi-CJvuMKus.js";import{C as R}from"./customIconButton-CCrlLtVX.js";import{h as de,f as ce,i as me}from"./index.esm-DX2FUGDk.js";import{u as ue,M as I}from"./MenuItem-Bl0c-FiE.js";import{c as he,L as U,a as J}from"./index-DEDwNO_F.js";import{w as pe}from"./dasboardPagesContainer-CRC60AsQ.js";import{j as fe,w as v,y as $,T as M,z as y,a1 as xe,x as K}from"./TextField-D31oTOPm.js";import{I as Ce}from"./IconButton-CBoSefry.js";import"./useMediaQuery-B2qIVE6J.js";import"./index-BQNoxMBA.js";import"./loadingButton-BvWQ0Fjl.js";import"./CircularProgress-Ca-7iBDz.js";import"./confirmationModal-u8w1H2AU.js";import"./useSlot-BSMtljHD.js";const ge=()=>{const u=ue(),{classLevels:C,academicYears:w}=Q(X),[_,k]=n.useState("_id"),[g,l]=n.useState("asc"),[j,S]=n.useState(0),[Y,q]=n.useState(5),[V,b]=n.useState(!1),[h,O]=n.useState("create"),[T,B]=n.useState(null),[r,d]=n.useState({section:"",name:"",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],description:"",academicYear:""}),[G,L]=n.useState(""),{data:p,loading:W,callApi:f}=z(),{callApi:P,loading:i,error:E}=z();n.useEffect(()=>{f(D.CLASS_LEVEL,"GET")},[f]),n.useEffect(()=>{p&&Array.isArray(p.data)&&u(re(p.data))},[p,u]);const F=a=>{_===a?l(g==="asc"?"desc":"asc"):(k(a),l("asc"))},N=(a,t)=>{S(t)},s=a=>{q(parseInt(a.target.value,10)),S(0)},o=(a,t=null)=>{var m,c;O(a),B(t),a==="create"?d({section:"",name:"",feesPerTerm:[{termName:"1st Term",amount:0,description:""}],description:"",academicYear:((m=w.find(A=>A.isCurrent))==null?void 0:m._id)||""}):t&&d({section:t.section||"",name:t.name||"",feesPerTerm:t.feesPerTerm||[{termName:"1st Term",amount:0,description:""}],description:t.description||"",academicYear:((c=t.academicYear)==null?void 0:c._id)||""}),b(!0)},x=a=>{const{name:t,value:m}=a.target;d(c=>({...c,[t]:m}))},Z=(a,t,m)=>{d(c=>{const A=[...c.feesPerTerm];return A[a]={...A[a],[t]:m},{...c,feesPerTerm:A}})},ee=()=>{d(a=>({...a,feesPerTerm:[...a.feesPerTerm,{termName:`${a.feesPerTerm.length+1} Term`,amount:0,description:""}]}))},ae=a=>{d(t=>({...t,feesPerTerm:t.feesPerTerm.filter((m,c)=>c!==a)}))},se=()=>r.section?r.name?r.academicYear?r.feesPerTerm.every(a=>a.termName&&a.amount>=0)?"":"All fees must have a term name and a valid amount":"Academic year is required":"Class name is required":"Section is required",te=n.useCallback(async()=>{const a=se();if(a){L(a);return}const t={section:r.section,name:r.name,description:r.description,academicYear:r.academicYear,feesPerTerm:r.feesPerTerm};try{h==="create"?await P(D.CLASS_LEVEL,"POST",t):h==="edit"?await P(`${D.CLASS_LEVEL}/${T._id}`,"PATCH",t):h==="delete"&&await P(`${D.CLASS_LEVEL}/${T._id}`,"DELETE"),f(D.CLASS_LEVEL,"GET"),b(!1),L("")}catch{L(E||"Failed to process request")}},[h,r,T,P,f,E]);return{tableProps:{columns:[{id:"_id",label:"ID",flex:.5},{id:"section",label:"Section",flex:1},{id:"name",label:"Class Name",flex:1},{id:"studentsCount",label:"Students",flex:1,renderCell:a=>{var t;return((t=a.students)==null?void 0:t.length)||0}},{id:"academicYear",label:"Academic Year",flex:1,renderCell:a=>{var t;return((t=a.academicYear)==null?void 0:t.name)||"N/A"}},{id:"actions",label:"Actions",flex:1,renderCell:a=>e.jsxs(e.Fragment,{children:[e.jsx(R,{icon:e.jsx(de,{}),title:"View Class",onClick:()=>o("view",a),sx:{mx:.5}}),e.jsx(R,{icon:e.jsx(ce,{}),title:"Edit Class",onClick:()=>o("edit",a),sx:{mx:.5}}),e.jsx(R,{icon:e.jsx(me,{}),title:"Delete Class",onClick:()=>o("delete",a),sx:{mx:.5}})]})}],tableHeader:"Class Management",data:C||[],sortBy:_,sortDirection:g,onSortChange:F,page:j,rowsPerPage:Y,onPageChange:N,onRowsPerPageChange:s,onRowClick:a=>o("view",a),hiddenColumnsSmallScreen:["_id","description"],hiddenColumnsTabScreen:["_id"]},modalOpen:V,setModalOpen:b,modalMode:h,formData:r,handleFormChange:x,handleFeesChange:Z,addTermFee:ee,removeTermFee:ae,handleSubmit:te,error:G,loadingClasses:W,loadingSubmit:i,openModal:o,academicYears:w,selectedClass:T}},je=()=>{const u=fe(),C=ie(u.palette.mode),{tableProps:w,modalOpen:_,setModalOpen:k,modalMode:g,formData:l,handleFormChange:j,handleFeesChange:S,addTermFee:Y,removeTermFee:q,handleSubmit:V,error:b,loadingClasses:h,loadingSubmit:O,openModal:T,academicYears:B,selectedClass:r}=ge(),{usersData:d,classLevels:G}=Q(X),[L,p]=n.useState(!1),[W,f]=n.useState(!1),P={create:"Create Class Level",edit:"Edit Class Level",view:"View Class Level",delete:"Delete Class Level"}[g],i=g==="view",E=g==="delete",F=r!=null&&r.students?d.students.filter(s=>r.students.includes(s._id)):[],N=r!=null&&r.teachers?d.teachers.filter(s=>r.teachers.includes(s._id)):[];return e.jsxs(v,{children:[e.jsx(oe,{title:"Class Management",subtitle:"Manage class levels and their details"}),e.jsxs(v,{sx:{mt:3,mb:3},children:[e.jsx($,{variant:"contained",sx:{mb:2},onClick:()=>T("create"),children:"Create New Class"}),h?e.jsx(ne,{}):e.jsx(v,{height:"75vh",sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{borderBottom:"none"},"& .MuiDataGrid-columnHeaders":{backgroundColor:C.blueAccent[700],borderBottom:"none"},"& .MuiDataGrid-virtualScroller":{backgroundColor:C.primary[400]},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:C.blueAccent[700]},"& .MuiCheckbox-root":{color:`${C.greenAccent[200]} !important`}},children:e.jsx(le,{...w,classLevels:G})})]}),e.jsx(H,{open:_,onClose:()=>k(!1),title:P,onConfirm:V,confirmMessage:E?"Delete":"Save",noConfirm:i,styleProps:{padding:u.spacing(3)},children:E?e.jsx(M,{children:"Are you sure you want to delete this class level?"}):e.jsxs(v,{component:"form",sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(y,{label:"Section",name:"section",value:l.section,onChange:j,fullWidth:!0,disabled:i,required:!0,select:!0,children:[e.jsx(I,{value:"Primary",children:"Primary"}),e.jsx(I,{value:"Secondary",children:"Secondary"})]}),e.jsx(y,{label:"Class Name",name:"name",value:l.name,onChange:j,fullWidth:!0,disabled:i,required:!0}),e.jsx(xe,{label:"Academic Year",name:"academicYear",value:l.academicYear,onChange:j,fullWidth:!0,disabled:i,required:!0,children:B.map(s=>e.jsx(I,{value:s._id,children:s.name},s._id))}),e.jsx(y,{label:"Description",name:"description",value:l.description,onChange:j,fullWidth:!0,disabled:i,multiline:!0,rows:3}),e.jsx(M,{variant:"h6",children:"Fees Per Term"}),l.feesPerTerm.map((s,o)=>e.jsxs(v,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(y,{label:"Term Name",value:s.termName,onChange:x=>S(o,"termName",x.target.value),disabled:i,required:!0}),e.jsx(y,{label:"Amount",type:"number",value:s.amount,onChange:x=>S(o,"amount",parseFloat(x.target.value)),disabled:i,required:!0}),e.jsx(y,{label:"Description",value:s.description,onChange:x=>S(o,"description",x.target.value),disabled:i}),!i&&e.jsx(Ce,{onClick:()=>q(o),disabled:l.feesPerTerm.length===1,children:e.jsx(he,{})})]},o)),i&&e.jsxs(v,{sx:{display:"flex",gap:2,mt:2},children:[e.jsx($,{variant:"contained",onClick:()=>p(!0),children:"View Students"}),e.jsx($,{variant:"contained",onClick:()=>f(!0),children:"View Teachers"})]}),!i&&e.jsx($,{onClick:Y,sx:{alignSelf:"flex-start"},children:"Add Term Fee"}),b&&e.jsx(M,{color:"error",children:b}),O&&e.jsx(M,{children:"Processing..."})]})}),e.jsx(H,{open:L,onClose:()=>p(!1),title:"Students",noConfirm:!0,styleProps:{padding:u.spacing(3)},children:F.length>0?e.jsx(K,{children:F.map(s=>e.jsx(U,{children:e.jsx(J,{primary:`${s.firstName} ${s.lastName}`,secondary:`Email: ${s.email}${s.phone?` | Phone: ${s.phone}`:""}`})},s._id))}):e.jsx(M,{children:"No students assigned to this class."})}),e.jsx(H,{open:W,onClose:()=>f(!1),title:"Teachers",noConfirm:!0,styleProps:{padding:u.spacing(3)},children:N.length>0?e.jsx(K,{children:N.map(s=>e.jsx(U,{children:e.jsx(J,{primary:`${s.firstName} ${s.lastName}`,secondary:`Email: ${s.email}${s.phone?` | Phone: ${s.phone}`:""}`})},s._id))}):e.jsx(M,{children:"No teachers assigned to this class."})})]})},Oe=pe(je);export{Oe as default};
