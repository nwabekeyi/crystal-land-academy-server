import{r as u,j as e}from"./index-BjRj4E9N.js";import{t as Q,D as L,a as V,b as z,c as U}from"./modal-CJ-lRFD-.js";import{H as X}from"./Header-ThX5g57D.js";import{T as G}from"./table-BJp1M4rf.js";import{C as q}from"./accordion-BnGhDMbN.js";import{C as K}from"./confirmationModal-BI-pjpWY.js";import{j as Z,v as m,a1 as M,a2 as Y,a3 as D,T as a,x as h}from"./TextField-Bo9w-J2w.js";import{M as E}from"./MenuItem-Bx5V02DH.js";import"./IconButton-B7MXtFvX.js";import"./index-CQ12Fn6g.js";import"./index-BGu1pMcL.js";import"./loadingButton-DayLTEo4.js";import"./CircularProgress-BuKH8eBu.js";import"./useApi-Dc_17l6o.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-sOt9ICpO.js";import"./useMediaQuery-BWJ9OGap.js";const n={academicYears:[{_id:"year_1",name:"2023–2024"},{_id:"year_2",name:"2024–2025"}],classes:[{_id:"class_1",academicYearId:"year_2",section:"Primary",displayName:"Primary 1A",students:["stu_1","stu_2"],subjectsTaught:["Mathematics","English"]},{_id:"class_2",academicYearId:"year_2",section:"Secondary",displayName:"Secondary 1B",students:["stu_3"],subjectsTaught:["Science"]}],students:[{_id:"stu_1",firstName:"John",lastName:"Doe",classId:"class_1",subjects:["Mathematics","English"]},{_id:"stu_2",firstName:"Jane",lastName:"Smith",classId:"class_1",subjects:["Mathematics"]},{_id:"stu_3",firstName:"Alice",lastName:"Brown",classId:"class_2",subjects:["Science"]}],testQuestions:[{id:"q_1",classId:"class_1",subject:"Mathematics",question:"What is the solution to 2x + 3 = 7?",options:["x = 1","x = 2","x = 3","x = 4"],correctAnswer:"x = 2"},{id:"q_2",classId:"class_1",subject:"Mathematics",question:"What is 3 + 5?",options:["6","7","8","9"],correctAnswer:"8"},{id:"q_3",classId:"class_1",subject:"English",question:'What is a synonym for "happy"?',options:["Sad","Joyful","Angry","Tired"],correctAnswer:"Joyful"},{id:"q_4",classId:"class_1",subject:"English",question:'What is the past tense of "run"?',options:["Ran","Run","Running","Runs"],correctAnswer:"Ran"},{id:"q_5",classId:"class_2",subject:"Science",question:"What gas do plants absorb during photosynthesis?",options:["Oxygen","Nitrogen","Carbon Dioxide","Hydrogen"],correctAnswer:"Carbon Dioxide"},{id:"q_6",classId:"class_2",subject:"Science",question:"What is the chemical symbol for water?",options:["H2O","CO2","O2","N2"],correctAnswer:"H2O"}],tests:[{id:"test_1",classId:"class_1",subject:"Mathematics",questionIds:["q_1","q_2"],duration:300},{id:"test_2",classId:"class_1",subject:"English",questionIds:["q_3","q_4"],duration:300},{id:"test_3",classId:"class_2",subject:"Science",questionIds:["q_5","q_6"],duration:300}],testScores:[{id:"score_1",testId:"test_1",studentId:"stu_1",score:100,date:"2024-09-20",academicYearId:"year_2",approvalStatus:"pending",answers:{q_1:"x = 2",q_2:"8"}},{id:"score_2",testId:"test_1",studentId:"stu_2",score:50,date:"2024-09-20",academicYearId:"year_2",approvalStatus:"approved",answers:{q_1:"x = 1",q_2:"8"}},{id:"score_3",testId:"test_2",studentId:"stu_1",score:50,date:"2024-09-21",academicYearId:"year_2",approvalStatus:"rejected",answers:{q_3:"Sad",q_4:"Ran"}}],examScores:[{id:"exam_1",studentId:"stu_1",subject:"Mathematics",score:85,academicYearId:"year_2",term:"First Term"},{id:"exam_2",studentId:"stu_1",subject:"English",score:"90",academicYearId:"year_2",term:"First Term"},{id:"exam_3",studentId:"stu_2",subject:"Mathematics",score:80,academicYearId:"year_2",term:"First Term"},{id:"exam_4",studentId:"stu_1",subject:"Mathematics",score:80,academicYearId:"year_1",term:"First Term"}]},bs=()=>{var A,w;const O=Z(),b=Q(O.palette.mode),[j,R]=u.useState("year_2"),[_,v]=u.useState(""),[$,S]=u.useState(!1),[o,x]=u.useState(null),[I,W]=u.useState(n.testScores),[k,g]=u.useState(!1),[B,F]=u.useState(""),f=n.classes.filter(s=>s.academicYearId===j),N=_?n.tests.filter(s=>s.classId===_):n.tests.filter(s=>f.some(t=>t._id===s.classId)),H=[...new Set(N.map(s=>s.subject))],C=f.map((s,t)=>({id:t+1,className:s.displayName,subjects:n.tests.filter(i=>i.classId===s._id).map(i=>i.subject),tests:n.tests.filter(i=>i.classId===s._id)})),T=(s,t)=>{const i=I.map(c=>c.id===s?{...c,approvalStatus:t}:c);W(i),F(`Test score ${t} successfully!`),g(!0)},J=[{id:"id",label:"ID",flex:.5},{id:"className",label:"Class",flex:2},{id:"subjects",label:"Subjects",flex:2,renderCell:s=>e.jsx(a,{children:s.subjects.join(", ")||"No subjects"})},{id:"tests",label:"Tests",flex:1,renderCell:s=>e.jsxs(a,{children:[s.tests.length," test(s)"]})},{id:"actions",label:"Actions",flex:1,renderCell:s=>e.jsx(h,{variant:"contained",color:"primary",size:"small",onClick:()=>{var t;v(((t=s.tests[0])==null?void 0:t.classId)||""),S(!0),x(null)},disabled:s.tests.length===0,children:"View Tests"})}],P=s=>f.filter(t=>t.academicYearId===s).map(t=>{const i=n.tests.filter(r=>r.classId===t._id),c=I.filter(r=>i.some(d=>d.id===r.testId)),l=n.examScores.filter(r=>n.students.some(d=>d.classId===t._id&&d._id===r.studentId));return{className:t.displayName,subjects:[...new Set(i.map(r=>r.subject))],testScores:c.map(r=>{const d=n.students.find(y=>y._id===r.studentId),p=n.tests.find(y=>y.id===r.testId);return{studentName:`${d==null?void 0:d.firstName} ${d==null?void 0:d.lastName}`,subject:p==null?void 0:p.subject,score:r.score,date:new Date(r.date).toLocaleDateString(),approvalStatus:r.approvalStatus}}),examScores:l.map(r=>{const d=n.students.find(p=>p._id===r.studentId);return{studentName:`${d==null?void 0:d.firstName} ${d==null?void 0:d.lastName}`,subject:r.subject,score:r.score,term:r.term}})}});return e.jsxs(m,{py:"20px",children:[e.jsx(X,{title:"ADMIN TESTS & EXAMS",subtitle:"Manage Test Approvals and View Records"}),e.jsxs(m,{mb:"20px",children:[e.jsxs(M,{sx:{minWidth:200,mb:3},children:[e.jsx(Y,{id:"academic-year-select-label",children:"Academic Year"}),e.jsx(D,{labelId:"academic-year-select-label",value:j,label:"Academic Year",onChange:s=>{R(s.target.value),v("")},children:n.academicYears.map(s=>e.jsx(E,{value:s._id,children:s.name},s._id))})]}),e.jsx(a,{variant:"h5",sx:{mb:2},children:"Classes and Tests"}),C.length>0?e.jsx(G,{columns:J,tableHeader:`Classes for ${(A=n.academicYears.find(s=>s._id===j))==null?void 0:A.name}`,data:C,page:0,rowsPerPage:5,sortBy:"className",sortDirection:"asc",hiddenColumnsSmallScreen:["subjects","tests"]}):e.jsx(a,{children:"No classes available."}),e.jsx(a,{variant:"h5",sx:{mt:4,mb:2},children:"Records Breakdown"}),n.academicYears.map(s=>e.jsx(q,{title:s.name,details:e.jsx(m,{children:P(s._id).map((t,i)=>e.jsxs(m,{sx:{mb:2},children:[e.jsx(a,{variant:"h6",children:t.className}),e.jsxs(a,{variant:"body1",children:["Subjects: ",t.subjects.join(", ")||"None"]}),e.jsx(a,{variant:"body1",sx:{mt:1},children:"Test Scores:"}),t.testScores.length>0?e.jsx("ul",{children:t.testScores.map((c,l)=>e.jsx("li",{children:e.jsxs(a,{variant:"body2",children:[c.studentName,": ",c.subject," - ",c.score,"% (",c.date,", ",c.approvalStatus,")"]})},l))}):e.jsx(a,{variant:"body2",children:"No test scores available."}),e.jsx(a,{variant:"body1",sx:{mt:1},children:"Exam Scores:"}),t.examScores.length>0?e.jsx("ul",{children:t.examScores.map((c,l)=>e.jsx("li",{children:e.jsxs(a,{variant:"body2",children:[c.studentName,": ",c.subject," - ",c.score,"% (",c.term,")"]})},l))}):e.jsx(a,{variant:"body2",children:"No exam scores available."})]},i))}),defaultExpanded:s._id===j},s._id))]}),e.jsxs(L,{open:$,onClose:()=>{S(!1),x(null)},children:[e.jsx(V,{children:"Test Details"}),e.jsx(z,{children:e.jsxs(m,{display:"flex",flexDirection:"column",gap:"16px",children:[e.jsxs(M,{fullWidth:!0,children:[e.jsx(Y,{id:"subject-select-label",children:"Subject"}),e.jsx(D,{labelId:"subject-select-label",value:(o==null?void 0:o.subject)||"",label:"Subject",onChange:s=>{const t=N.find(i=>i.subject===s.target.value&&i.classId===_);x(t||null)},children:H.map(s=>e.jsx(E,{value:s,children:s},s))})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"h6",children:[o.subject," Test"]}),e.jsxs(a,{variant:"body1",children:["Class: ",(w=n.classes.find(s=>s._id===o.classId))==null?void 0:w.displayName]}),e.jsxs(a,{variant:"body1",children:["Duration: ",o.duration/60," minutes"]}),e.jsx(a,{variant:"body2",children:"Questions:"}),n.testQuestions.filter(s=>o.questionIds.includes(s.id)).map((s,t)=>e.jsxs(m,{sx:{mb:2},children:[e.jsxs(a,{variant:"body2",children:[t+1,". ",s.question]}),e.jsxs(a,{variant:"caption",children:["Options: ",s.options.join(", ")]}),e.jsxs(a,{variant:"caption",color:b.greenAccent[500],children:["Correct: ",s.correctAnswer]})]},s.id)),e.jsx(a,{variant:"body2",children:"Submissions:"}),I.filter(s=>s.testId===o.id).map(s=>{const t=n.students.find(i=>i._id===s.studentId);return e.jsx(q,{title:`${t==null?void 0:t.firstName} ${t==null?void 0:t.lastName} (${s.score}%, ${s.approvalStatus})`,details:e.jsxs(m,{children:[Object.entries(s.answers).map(([i,c])=>{const l=n.testQuestions.find(r=>r.id===i);return e.jsxs(m,{sx:{mb:1},children:[e.jsxs(a,{variant:"body2",children:[l==null?void 0:l.question,": ",c]}),e.jsx(a,{variant:"caption",color:c===(l==null?void 0:l.correctAnswer)?b.greenAccent[500]:b.redAccent[500],children:c===(l==null?void 0:l.correctAnswer)?"Correct":"Incorrect"})]},i)}),e.jsxs(m,{sx:{mt:2},children:[e.jsx(h,{variant:"contained",color:"primary",onClick:()=>T(s.id,"approved"),disabled:s.approvalStatus!=="pending",sx:{mr:1},children:"Approve"}),e.jsx(h,{variant:"contained",color:"secondary",onClick:()=>T(s.id,"rejected"),disabled:s.approvalStatus!=="pending",children:"Reject"})]})]})},s.id)})]})]})}),e.jsx(U,{children:e.jsx(h,{onClick:()=>{S(!1),x(null)},children:"Close"})})]}),e.jsx(K,{open:k,onClose:()=>g(!1),isLoading:!1,title:"Test Approval",message:B})]})};export{bs as default};
