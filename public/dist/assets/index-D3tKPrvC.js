import{j as e,r as i,a as _,v as U}from"./index-22HUb1_z.js";import{T as Y}from"./table-iQGSzLj8.js";import{u as B}from"./useApi-BivKV4bK.js";import{c as K,w as u,T as s,y as q,t as J,C as Q,z as X,A as D,j as Z}from"./constants-BJW4J9P5.js";import{r as ee,M as F,t as te}from"./modal-CFzM2TvC.js";import{D as O,G as o,h as ae,E as se}from"./index-dxrUZtLq.js";import{H as ne}from"./Header-CXtHvVsg.js";import{u as re,L as oe}from"./useStudentData-IzmCYJmW.js";import{w as ie}from"./dasboardPagesContainer-qh7jt9JW.js";import{A as ce}from"./confirmationModal-BxJ-28ob.js";import{u as le}from"./MenuItem-38XN_-vW.js";import{I as de}from"./IconButton-xWupQFdG.js";import"./useMediaQuery-vabypUKQ.js";import"./index-DF2Knd0X.js";import"./loadingButton-DUprIo-A.js";import"./useSlot-Bb0ot7dQ.js";const ue=K(e.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),me=({receipt:a})=>{const m=i.useRef(),h=async()=>{if(m.current)try{const l=await ae(m.current,{useCORS:!0}),y=l.toDataURL("image/png"),p=new se("portrait","px","a4"),x=p.internal.pageSize.getWidth(),j=l.height*x/l.width;p.addImage(y,"PNG",0,0,x,j),p.save(`receipt_${a.transactionId}.pdf`)}catch(l){console.error("Error generating PDF:",l)}};return e.jsxs(u,{ref:m,sx:{padding:"20px",maxWidth:"500px",margin:"auto",backgroundColor:"#fff",color:"#000",borderRadius:"10px",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.1)",fontFamily:"Arial, sans-serif"},children:[e.jsx(s,{variant:"h6",align:"center",gutterBottom:!0,children:"Crystal land academy"}),e.jsx(s,{variant:"subtitle2",align:"center",gutterBottom:!0,children:"Payment Receipt"}),e.jsx(O,{sx:{my:2}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{fontWeight:"bold",children:"Transaction ID:"})}),e.jsx(o,{item:!0,xs:6,align:"right",children:e.jsx(s,{children:a.transactionId})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{fontWeight:"bold",children:"Student Name:"})}),e.jsx(o,{item:!0,xs:6,align:"right",children:e.jsx(s,{children:a.userName})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{fontWeight:"bold",children:"Program:"})}),e.jsx(o,{item:!0,xs:6,align:"right",children:e.jsx(s,{children:a.program})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{fontWeight:"bold",children:"Amount Paid:"})}),e.jsx(o,{item:!0,xs:6,align:"right",children:e.jsxs(s,{children:["₦",a.amount.toFixed(2)]})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{fontWeight:"bold",children:"Status:"})}),e.jsx(o,{item:!0,xs:6,align:"right",children:e.jsx(s,{children:a.status})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{fontWeight:"bold",children:"Date:"})}),e.jsx(o,{item:!0,xs:6,align:"right",children:e.jsx(s,{children:a.date})})]}),e.jsx(O,{sx:{my:2}}),e.jsx(s,{variant:"body2",align:"center",children:"Thank you for your payment!"}),e.jsx(q,{variant:"contained",color:"primary",fullWidth:!0,onClick:h,sx:{mt:2},children:"Download Receipt"})]})};var M={},pe=J;Object.defineProperty(M,"__esModule",{value:!0});var H=M.default=void 0,he=pe(ee()),xe=e;H=M.default=(0,he.default)((0,xe.jsx)("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4v-6h16zm0-10H4V6h16z"}),"Payment");const ge=({onSuccess:a=()=>{}})=>{const[m,h]=i.useState(!1),[l,y]=i.useState(!1),[p,x]=i.useState(""),{userId:j,studentId:$}=_(d=>d.users.user),w=le(),{data:R,callApi:A}=B(),S=()=>{y(!0)},C=()=>{y(!1)},T=()=>{v(),C()},v=async()=>{h(!0);try{const r=await(await fetch(D.PAYSTACK_INIT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:j,paymentAmount:parseFloat(p)})})).json();r&&r.payment_url&&r.reference&&window.PaystackPop.setup({key:"pk_test_8293ca0c4f5b0e4b8da1dad753cbc602cebade30",email:r.email,currency:"NGN",amount:r.amount*100,reference:r.reference,metadata:{userId:r.userId},onClose:function(){b(r.reference)},callback:function(I){const P=I.reference;b(P)}}).openIframe()}catch(d){console.error("Error initializing payment:",d)}finally{h(!1)}},b=async d=>{try{const g=await(await fetch(`${D.PAYSTACK_PAYMENT}/${d}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();if(g.status==="success"){x(""),a();const f=await A(`${D.USER}/${j}`,"GET");f&&f.student&&(w(U(f.student)),console.log(f.student))}else console.error("Verification failed:",g),console.log("Payment failed")}catch(r){console.error("Error verifying transaction:",r)}};return e.jsxs(u,{children:[e.jsx(ce,{icon:e.jsx(H,{}),disabled:m,onClick:S,content:m?e.jsx(Q,{size:24}):"Pay Now"}),e.jsx(F,{open:l,onClose:C,title:"Enter Payment Amount",onConfirm:T,confirmMessage:"Proceed with Payment",children:e.jsx(X,{label:"Amount (Naira)",type:"number",value:p,onChange:d=>x(d.target.value),fullWidth:!0})})]})},fe=()=>{const a=_(t=>t.users.user),{loading:m,data:h,callApi:l}=B(),[y,p]=i.useState([]),[x,j]=i.useState(0),[$,w]=i.useState(10),[R,A]=i.useState("date"),[S,C]=i.useState("asc"),[T,v]=i.useState(!1),[b,d]=i.useState(null),r=Z(),g=te(r.palette.mode),{outstandings:f}=re();console.log(a);const{totalOutstanding:I,amountPaid:P}=f,k=I+P,W=k>0?P/k*100:0;i.useEffect(()=>{a!=null&&a.userId&&l(`${D.PAYMENT}/student/${a.userId}`,"GET")},[a==null?void 0:a.userId]),i.useEffect(()=>{if(!m&&h){const t=h.receipts.map((n,E)=>({id:E+1,transactionId:n.paymentDetails.transactionId,amount:n.paymentDetails.amount,status:n.paymentDetails.status,date:new Date(n.paymentDetails.timestamp).toLocaleDateString(),userName:`${n.userDetails.firstName} ${n.userDetails.lastName}`,program:n.userDetails.program}));p(t)}},[m,h]);const L=t=>{const n=R===t&&S==="asc";A(t),C(n?"desc":"asc")},G=t=>{d(t),v(!0)},z=async()=>{if(a!=null&&a.userId)try{const t=await l(`${D.PAYMENT}/student/${a.userId}`,"GET");if(t){const n=t.receipts.map((c,N)=>({id:N+1,transactionId:c.paymentDetails.transactionId,amount:c.paymentDetails.amount,status:c.paymentDetails.status,date:new Date(c.paymentDetails.timestamp).toLocaleDateString(),userName:`${c.userDetails.firstName} ${c.userDetails.lastName}`,program:c.userDetails.program}));p(c=>[...n,...c]);const E=n.reduce((c,N)=>c+N.amount,P),ye=I-E}}catch(t){console.error("Error fetching payment data:",t)}},V=[{id:"transactionId",label:"Transaction ID"},{id:"amount",label:"Amount (₦)",renderCell:t=>`₦${t.amount.toFixed(2)}`},{id:"status",label:"Status",renderCell:t=>t.status.charAt(0).toUpperCase()+t.status.slice(1)},{id:"date",label:"Date"},{id:"actions",label:"Actions",renderCell:t=>e.jsx(u,{display:"flex",gap:"10px",children:e.jsx(de,{onClick:()=>G(t),children:e.jsx(ue,{})})})}];return e.jsxs(u,{children:[e.jsx(ne,{title:"Payment History",subtitle:"Overview of Payments Made"}),e.jsxs(u,{backgroundColor:g.primary[400],p:"20px",borderRadius:"4px",children:[e.jsx(s,{variant:"h5",fontWeight:"600",mb:"15px",children:"Payment Summary"}),e.jsxs(u,{mb:"20px",children:[e.jsxs(u,{sx:{display:"flex",alignItems:"end",marginBottom:"15px",justifyContent:"space-between",width:"100%"},children:[e.jsxs(u,{children:[e.jsxs(s,{variant:"h6",mb:"5px",children:["Total Amount Due: ₦",k.toFixed(2)]}),e.jsxs(s,{variant:"h6",mb:"5px",children:["Total Paid: ₦",P.toFixed(2)]}),e.jsxs(s,{variant:"h6",children:["Payment Percentage: ",W.toFixed(2),"%"]})]}),e.jsx(u,{children:e.jsxs(u,{children:[e.jsx(ge,{onSuccess:z})," "]})})]}),e.jsx(oe,{variant:"determinate",value:W,sx:{height:10,borderRadius:5,backgroundColor:g.grey[300],"& .MuiLinearProgress-bar":{backgroundColor:g.greenAccent[500]}}})]}),e.jsx(Y,{columns:V,tableHeader:"Payment Records",data:y,sortBy:R,sortDirection:S,onSortChange:L,page:x,rowsPerPage:$,onPageChange:(t,n)=>j(n),hiddenColumnsSmallScreen:["status","transactionId"],onRowsPerPageChange:t=>w(parseInt(t.target.value,10)),onRowClick:t=>console.log("Row clicked:",t)}),e.jsx(F,{open:T,onClose:()=>v(!1),title:"Receipt Details",noConfirm:!0,children:b&&e.jsx(me,{receipt:b})})]})]})},$e=ie(fe);export{$e as default};
