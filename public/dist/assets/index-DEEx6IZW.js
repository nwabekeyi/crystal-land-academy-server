import{r as j,f as M,j as e,a as R}from"./index-BS_BC2tr.js";import{t as L}from"./modal-CK3pldlK.js";import{H as k}from"./Header-DOCwOtvn.js";import{C as E}from"./accordion-B0lTP9X5.js";import{w as D}from"./dasboardPagesContainer-yho97Fx0.js";import{u as F}from"./useApi-DCSO45YJ.js";import{j as N,M as V,v as u,T as n,x as $,a1 as O,a2 as W,a3 as q}from"./TextField-fQlpn0uP.js";import{M as _}from"./MenuItem-CF61DAnp.js";import{C as B}from"./CircularProgress-CWhgGay0.js";import"./IconButton-D2nNlubr.js";import"./index-BQvLIGJ0.js";import"./confirmationModal-BW1sOx-H.js";import"./index-C6B4bUaP.js";import"./loadingButton-BtJ3fS50.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-DndnS7Ni.js";const H=()=>{const{loading:h,error:t,callApi:s}=F(),[x,a]=j.useState([]),[g,I]=j.useState([]);return{loading:h,error:t,curricula:x,subjects:g,fetchCurricula:async(p,v="")=>{try{const m=[`classLevelId=${p}`];v&&m.push(`subjectId=${v}`);const A=`${M.CURRICULUM}?${m.join("&")}`,c=await s(A,"GET");if(c&&c.status==="success"){const S=c.data.map(o=>{var b,C,y,f;return{_id:o._id,subject:((b=o.subjectId)==null?void 0:b.name)||"Unknown Subject",subjectId:(C=o.subjectId)==null?void 0:C._id,classLevel:((y=o.classLevelId)==null?void 0:y.name)||"Unknown Class",classLevelId:(f=o.classLevelId)==null?void 0:f._id,topics:o.topics.map((i,r)=>({_id:i._id||`topic_${r}`,topic:i.topic||"Untitled Topic",description:i.description||"No description available",resources:i.resources||[],isCompleted:i.isCompleted||!1})),completionRate:o.completionRate||0}});a(S);const w=[...new Set(c.data.map(o=>({_id:o.subjectId._id,name:o.subjectId.name}).filter(b=>b._id)))];I(w)}return c}catch(m){throw new Error(m.message||"Failed to fetch curricula")}}}},G=({open:h,onClose:t,topic:s})=>{const x=N(),a=L(x.palette.mode);return e.jsx(V,{open:h,onClose:t,children:e.jsxs(u,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:a.primary[400],p:4,borderRadius:1},children:[e.jsx(n,{variant:"h6",sx:{mb:2,color:a.grey[100]},children:"Topic Details"}),e.jsxs(n,{variant:"body1",sx:{mb:1,color:a.grey[100]},children:[e.jsx("strong",{children:"Topic:"})," ",(s==null?void 0:s.topic)||"Untitled Topic"]}),e.jsxs(n,{variant:"body1",sx:{mb:1,color:a.grey[100]},children:[e.jsx("strong",{children:"Description:"})," ",(s==null?void 0:s.description)||"No description available"]}),e.jsxs(n,{variant:"body1",sx:{mb:1,color:a.blueAccent[200]},children:[e.jsx("strong",{children:"Resources:"})," ",Array.isArray(s==null?void 0:s.resources)?s.resources.join(", "):"No resources available"]}),e.jsxs(n,{variant:"body1",sx:{mb:2,color:s!=null&&s.isCompleted?a.greenAccent[500]:a.redAccent[500]},children:[e.jsx("strong",{children:"Status:"})," ",s!=null&&s.isCompleted?"Completed":"Not Completed"]}),e.jsx(u,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx($,{variant:"contained",onClick:t,sx:{bgcolor:a.blueAccent[700]},children:"Close"})})]})})},P=()=>{var f,i;const h=N(),t=L(h.palette.mode),{loading:s,error:x,curricula:a,subjects:g,fetchCurricula:I}=H(),{user:l}=R(r=>r.users),p=l==null?void 0:l.classLevelId,v=((f=l==null?void 0:l.currentClassLevel)==null?void 0:f.className)||"Unknown Class",m=((i=l==null?void 0:l.currentClassLevel)==null?void 0:i.subclass)||"",[A,c]=j.useState(!1),[S,w]=j.useState(null),[o,b]=j.useState({subjectId:""});j.useEffect(()=>{p&&I(p,o.subjectId)},[p,o.subjectId]);const C=r=>{b({subjectId:r.target.value})},y=r=>{w(r),c(!0)};return e.jsxs(u,{sx:{p:3},children:[e.jsx(k,{title:"Curriculum Overview",subtitle:`Explore the curriculum for ${v}${m?` (${m})`:""}`}),e.jsx(u,{sx:{display:"flex",mb:2},children:e.jsxs(O,{sx:{minWidth:200},children:[e.jsx(W,{children:"Subject"}),e.jsxs(q,{name:"subjectId",value:o.subjectId,onChange:C,children:[e.jsx(_,{value:"",children:"All Subjects"}),g.map(r=>e.jsx(_,{value:r._id,children:r.name||"Unknown Subject"},r._id))]})]})}),s?e.jsx(u,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(B,{color:"primary"})}):x?e.jsx(n,{variant:"body1",color:t.redAccent[500],sx:{mt:2},children:x}):a.length>0?a.map((r,U)=>e.jsxs(u,{sx:{mb:4},children:[e.jsx(n,{variant:"h2",sx:{color:t.blueAccent[200],mb:2,fontWeight:"bold"},children:r.subject}),r.topics.length>0?r.topics.map((d,T)=>e.jsx(u,{sx:{mb:1},children:e.jsx(E,{title:`${T+1}. ${d.topic}`,details:e.jsxs(u,{children:[e.jsx(n,{variant:"body1",color:t.grey[100],sx:{mb:1},children:d.description||"No description available"}),e.jsxs(n,{variant:"body1",sx:{color:t.blueAccent[200],mb:1},children:["Resources:"," ",Array.isArray(d.resources)?d.resources.join(", "):"No resources available"]}),e.jsxs(n,{variant:"body1",sx:{color:d.isCompleted?t.greenAccent[500]:t.redAccent[500],mb:1},children:["Status: ",d.isCompleted?"Completed":"Not Completed"]}),e.jsx($,{onClick:()=>y(d),sx:{color:t.blueAccent[200]},children:"View Details"})]}),defaultExpanded:!1})},d._id||T)):e.jsxs(n,{variant:"body1",color:t.grey[100],children:["No topics available for ",r.subject,"."]})]},r._id||U)):e.jsx(n,{variant:"body1",color:t.grey[100],children:"No curriculum available for your class."}),e.jsx(G,{open:A,onClose:()=>c(!1),topic:S})]})},ie=D(P);export{ie as default};
