import{r,f as x,j as t}from"./index-BuRqVy2o.js";import{d as $}from"./confirmationModal-DFTnOKbM.js";import{H as O}from"./Header-CPyALzpz.js";import{t as w,M as G}from"./modal-Dtd90-ui.js";import{T as W}from"./table-FnUq2aNO.js";import{u as v}from"./useApi-D4lIDwWM.js";import{w as _}from"./dasboardPagesContainer-2WDa4n00.js";import{j as L,v as y}from"./TextField-DPEWop0l.js";import{I as M}from"./IconButton-DN-FrFOr.js";import"./CircularProgress-CZOZaR_c.js";import"./index-CdkazARq.js";import"./MenuItem-DAhVz_SE.js";import"./index-gjfgqqyg.js";import"./loadingButton-WtJYv-TH.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-BNYqSIw-.js";import"./useMediaQuery-BTDwy9WG.js";const U=()=>{var j,T;const D=L();w(D.palette.mode);const[E,m]=r.useState(!1),[o,p]=r.useState(null),[l,C]=r.useState(0),[d,R]=r.useState(10),[h,S]=r.useState("generatedDate"),[u,b]=r.useState("desc"),A=[{id:"sn",label:"S/N",minWidth:50},{id:"code",label:"Code",minWidth:100},{id:"generatedDate",label:"Generated Date",minWidth:100},{id:"generatedTime",label:"Generated Time",minWidth:100},{id:"expiresAt",label:"Expires At",minWidth:100,type:"date"},{id:"used",label:"Used",minWidth:50,renderCell:e=>e.used?"true":"false"},{id:"usedBy",label:"Used By",minWidth:100,renderCell:e=>e.usedBy?e.usedBy.firstName||e.usedBy._id:"N/A"},{id:"actions",label:"Actions",minWidth:50,renderCell:e=>t.jsx(M,{onClick:()=>{p(e),m(!0)},"aria-label":"delete",color:"error",children:t.jsx($,{})})}],{loading:a,data:s,error:g,callApi:c}=v();r.useEffect(()=>{const e=`${x.REGISTRATION_CODE}?page=${l+1}&limit=${d}&sort=${h}&order=${u}`;console.log("Fetching from:",e),c(e,"GET")},[l,d,h,u,c]);const B=async()=>{try{const e=`${x.REGISTRATION_CODE}/${o._id}`;console.log("Deleting code at:",e),await c(e,"DELETE"),m(!1),p(null);const n=`${x.REGISTRATION_CODE}?page=${l+1}&limit=${d}&sort=${h}&order=${u}`;c(n,"GET")}catch(e){console.error("Failed to delete code:",e)}},I=(e,n)=>{C(n)},N=e=>{R(parseInt(e.target.value,10)),C(0)},P=e=>{S(e),b(n=>n==="asc"?"desc":"asc")},f=(((j=s==null?void 0:s.data)==null?void 0:j.data)||[]).map((e,n)=>({...e,sn:n+1})),i=g||(typeof s=="string"&&s.includes("<!doctype html>")?"Invalid response from server: Expected JSON but received HTML":null);return r.useEffect(()=>{console.log("API Response:",{loading:a,data:s,error:g})},[a,s,g]),t.jsxs(y,{children:[t.jsx(O,{title:"REGISTRATION CODES",subtitle:"List of Registration Codes"}),a&&t.jsx("p",{children:"Loading..."}),i&&t.jsx("p",{style:{color:"red"},children:i}),!a&&!i&&f.length===0&&t.jsx("p",{children:"No registration codes found."}),!a&&!i&&f.length>0&&t.jsx(y,{m:"40px 0 0 0",height:"75vh",children:t.jsx(W,{columns:A,tableHeader:"List of Registration Codes",data:f,page:l,rowsPerPage:d,totalRows:((T=s==null?void 0:s.data)==null?void 0:T.totalRows)||0,onPageChange:I,onRowsPerPageChange:N,onSortChange:P,loading:a,error:i})}),o&&t.jsx(G,{open:E,onClose:()=>{m(!1),p(null)},title:"Confirm Deletion",onConfirm:B,confirmText:"Delete",cancelText:"Cancel",children:t.jsxs("div",{className:"modal-content",children:[t.jsx("h2",{children:"Are you sure you want to delete this registration code?"}),t.jsxs("p",{children:[t.jsx("strong",{children:"Code: "}),o.code]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Generated Date: "}),o.generatedDate]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Used: "}),o.used?"true":"false"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Used By: "}),o.usedBy?o.usedBy.firstName||o.usedBy._id:"N/A"]})]})})]})},ne=_(U);export{ne as default};
