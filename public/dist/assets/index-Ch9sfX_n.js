import{e as D,u as U,r as n,f as A,j as e}from"./index-B-gfigdE.js";import{M as X}from"./modal-CjM-E6bY.js";import{u as I}from"./useApi-BpL-F3eV.js";import{T as c,v as E,x as C}from"./TextField-CvoFiyNY.js";import{R as z,a as H}from"./RadioGroup-BpAkOzOn.js";import{F as J}from"./FormControlLabel-8SjwIHrT.js";import{G as M}from"./index-DvYUmvmj.js";import"./IconButton-DXPrO4pt.js";import"./index-CfhEgBJ4.js";import"./loadingButton-B4jIQRMH.js";import"./CircularProgress-Cjpv5aMd.js";import"./MenuItem-Cq1E3Tk4.js";import"./confirmationModal-BhSIITCd.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-DYcMRowa.js";const K=(i,o)=>{const[t,u]=n.useState(i*60);return n.useEffect(()=>{if(t<=0){o();return}const r=setInterval(()=>{u(a=>a-1)},1e3);return()=>clearInterval(r)},[t,o]),{timeLeft:t,formatTime:()=>{const r=Math.floor(t/60),a=t%60;return`${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}}},V=()=>{const i=D(),o=U(),{examId:t,classLevelId:u,subclassLetter:d,duration:r}=o.state||{},[a,p]=n.useState([]),[m,h]=n.useState(0),[S,g]=n.useState({}),[j,l]=n.useState(!1),{data:s,loading:Q,error:b,callApi:L}=I(),{loading:R,error:O,callApi:w}=I();n.useEffect(()=>{if(u&&t&&r){const x=`${A.STUDENT_EXAM_QUESTIONS}?classLevelId=${u}${d?`&subclassLetter=${d}`:""}`;L(x,"GET")}else p([]),v("Missing class level, exam ID, or duration")},[u,d,t,r,L]),n.useEffect(()=>{s!=null&&s.data&&p(s.data.questions||[]),b&&v(b)},[s,b]);const{timeLeft:N,formatTime:q}=K(r,()=>{y()}),B=(x,f)=>{g(T=>({...T,[x]:f}))},$=()=>{m<a.length-1&&h(m+1)},_=()=>{m>0&&h(m-1)},y=async()=>{const x=Object.entries(S).map(([f,T])=>({questionId:f,selectedOption:T}));try{await w(A.EXAM_RESULTS,"POST",{examId:t,answeredQuestions:x}),i("/student/results",{state:{examId:t}})}catch(f){v(f.message||"Failed to submit exam results"),l(!1)}},G=()=>{l(!0)},P=()=>{l(!1)},v=x=>{p([]),F(x)},[k,F]=n.useState(null);return{questions:a,currentQuestionIndex:m,answers:S,loading:Q||R,error:k||b||O,isModalOpen:j,timeLeft:N,formatTime:q,handleOptionSelect:B,handleNext:$,handlePrevious:_,openSubmitModal:G,closeSubmitModal:P,handleSubmit:y}},me=()=>{const{questions:i,currentQuestionIndex:o,answers:t,loading:u,error:d,isModalOpen:r,formatTime:a,handleOptionSelect:p,handleNext:m,handlePrevious:h,openSubmitModal:S,closeSubmitModal:g,handleSubmit:j}=V();if(u)return e.jsx(c,{sx:{mt:4,textAlign:"center"},children:"Loading questions..."});if(d)return e.jsx(c,{color:"error",sx:{mt:4,textAlign:"center"},children:d});if(!i.length)return e.jsx(c,{sx:{mt:4,textAlign:"center"},children:"No questions available"});const l=i[o];return e.jsxs(E,{sx:{p:4},children:[e.jsx(c,{variant:"h4",sx:{mb:2,color:"#000"},children:"Computer-Based Test"}),e.jsxs(E,{sx:{mb:2},children:[e.jsxs(c,{variant:"h6",children:["Time Left: ",a()]}),e.jsxs(c,{variant:"body2",children:["Question ",o+1," of ",i.length]})]}),e.jsxs(E,{sx:{p:2,border:"1px solid #ccc",borderRadius:"4px",bgcolor:"#f5f5f5"},children:[e.jsx(c,{variant:"h6",sx:{mb:2},children:l.question}),e.jsx(z,{value:t[l._id]||"",onChange:s=>p(l._id,s.target.value),children:["optionA","optionB","optionC","optionD"].map(s=>e.jsx(J,{value:s,control:e.jsx(H,{}),label:l[s]},s))})]}),e.jsxs(M,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(M,{item:!0,children:e.jsx(C,{variant:"contained",color:"secondary",onClick:h,disabled:o===0,children:"Previous"})}),e.jsx(M,{item:!0,children:o<i.length-1?e.jsx(C,{variant:"contained",color:"primary",onClick:m,children:"Next"}):e.jsx(C,{variant:"contained",color:"success",onClick:S,children:"Submit Exam"})})]}),e.jsx(X,{open:r,onClose:g,onConfirm:j,title:"Submit Exam",confirmText:"Submit",showCancel:!0,cancelText:"Cancel",children:e.jsx(c,{children:"Are you sure you want to submit your exam? This action cannot be undone."})})]})};export{me as default};
