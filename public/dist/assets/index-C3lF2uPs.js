import{j as e,r as d,f as z,D as Ne,i as Ve,a as ue,E as ct,F as Et}from"./index-BjRj4E9N.js";import{r as je,t as M,M as se}from"./modal-CJ-lRFD-.js";import{c as De,a as kt,g as wt,u as Tt,_ as dt,K as ut,af as Ft,ap as Rt,$ as Mt,o as Lt,b as H,s as Ee,d as Ae,h as mt,e as Ot,aq as Pt,ar as Nt,q as ve,j as L,v as l,T as a,w as ke,y as V,a1 as $e,a2 as We,a3 as _e,x as ot}from"./TextField-Bo9w-J2w.js";import{H as It}from"./Header-ThX5g57D.js";import{G as Be,L as we,a as Te,C as Fe,b as Re,A as ht,d as Ce}from"./index-CQ12Fn6g.js";import{t as xt}from"./nivo-pie-CggnOzbW.js";import{p as gt}from"./nivo-line.es-CuovLlys.js";import{u as G}from"./useApi-Dc_17l6o.js";import{u as ft}from"./index-BGu1pMcL.js";import{f as Ie,F as Ye,m as He,a as Ge,b as pt}from"./main-DNR1gWtV.js";import{m as qe}from"./main-CmZwJv80.js";import{A as Ue}from"./Alert-CgPIs6Fg.js";import{I as Xe}from"./IconButton-B7MXtFvX.js";import{X as zt}from"./nivo-bar-BKJeZicN.js";import{u as it}from"./useMediaQuery-BWJ9OGap.js";import{w as $t}from"./dasboardPagesContainer-r2iyGt_q.js";import{C as jt}from"./confirmationModal-BI-pjpWY.js";import{C as Wt}from"./CircularProgress-BuKH8eBu.js";import{M as oe}from"./MenuItem-Bx5V02DH.js";import{A as fe}from"./actionButton-DtGJv9hI.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-sOt9ICpO.js";import"./isEqual-BTJ6AIXL.js";import"./_baseIsEqual-Bb5myMgJ.js";import"./_baseForOwn-CySMoLIj.js";import"./loadingButton-DayLTEo4.js";import"./_baseSlice-z0Zd1-Ev.js";const _t={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"},Vt=De(e.jsx("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),Bt=De(e.jsx("path",{d:"M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"}),"StarBorder");function Yt(t){return wt("MuiRating",t)}const pe=kt("MuiRating",["root","sizeSmall","sizeMedium","sizeLarge","readOnly","disabled","focusVisible","visuallyHidden","pristine","label","labelEmptyValueActive","icon","iconEmpty","iconFilled","iconHover","iconFocus","iconActive","decimal"]),Ht=["value"],Gt=["className","defaultValue","disabled","emptyIcon","emptyLabelText","getLabelText","highlightSelectedOnly","icon","IconContainerComponent","max","name","onChange","onChangeActive","onMouseLeave","onMouseMove","precision","readOnly","size","value"];function qt(t){const s=t.toString().split(".")[1];return s?s.length:0}function ze(t,s){if(t==null)return t;const n=Math.round(t/s)*s;return Number(n.toFixed(qt(s)))}const Ut=t=>{const{classes:s,size:n,readOnly:i,disabled:o,emptyValueFocused:c,focusVisible:r}=t,j={root:["root",`size${mt(n)}`,o&&"disabled",r&&"focusVisible",i&&"readOnly"],label:["label","pristine"],labelEmptyValue:[c&&"labelEmptyValueActive"],icon:["icon"],iconEmpty:["iconEmpty"],iconFilled:["iconFilled"],iconHover:["iconHover"],iconFocus:["iconFocus"],iconActive:["iconActive"],decimal:["decimal"],visuallyHidden:["visuallyHidden"]};return Ot(j,Yt,s)},Xt=Ee("span",{name:"MuiRating",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:n}=t;return[{[`& .${pe.visuallyHidden}`]:s.visuallyHidden},s.root,s[`size${mt(n.size)}`],n.readOnly&&s.readOnly]}})(({theme:t,ownerState:s})=>H({display:"inline-flex",position:"relative",fontSize:t.typography.pxToRem(24),color:"#faaf00",cursor:"pointer",textAlign:"left",width:"min-content",WebkitTapHighlightColor:"transparent",[`&.${pe.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${pe.focusVisible} .${pe.iconActive}`]:{outline:"1px solid #999"},[`& .${pe.visuallyHidden}`]:_t},s.size==="small"&&{fontSize:t.typography.pxToRem(18)},s.size==="large"&&{fontSize:t.typography.pxToRem(30)},s.readOnly&&{pointerEvents:"none"})),vt=Ee("label",{name:"MuiRating",slot:"Label",overridesResolver:({ownerState:t},s)=>[s.label,t.emptyValueFocused&&s.labelEmptyValueActive]})(({ownerState:t})=>H({cursor:"inherit"},t.emptyValueFocused&&{top:0,bottom:0,position:"absolute",outline:"1px solid #999",width:"100%"})),Jt=Ee("span",{name:"MuiRating",slot:"Icon",overridesResolver:(t,s)=>{const{ownerState:n}=t;return[s.icon,n.iconEmpty&&s.iconEmpty,n.iconFilled&&s.iconFilled,n.iconHover&&s.iconHover,n.iconFocus&&s.iconFocus,n.iconActive&&s.iconActive]}})(({theme:t,ownerState:s})=>H({display:"flex",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest}),pointerEvents:"none"},s.iconActive&&{transform:"scale(1.2)"},s.iconEmpty&&{color:(t.vars||t).palette.action.disabled})),Kt=Ee("span",{name:"MuiRating",slot:"Decimal",shouldForwardProp:t=>Pt(t)&&t!=="iconActive",overridesResolver:(t,s)=>{const{iconActive:n}=t;return[s.decimal,n&&s.iconActive]}})(({iconActive:t})=>H({position:"relative"},t&&{transform:"scale(1.2)"}));function Qt(t){const s=dt(t,Ht);return e.jsx("span",H({},s))}function lt(t){const{classes:s,disabled:n,emptyIcon:i,focus:o,getLabelText:c,highlightSelectedOnly:r,hover:j,icon:u,IconContainerComponent:h,isActive:m,itemValue:g,labelProps:v,name:k,onBlur:w,onChange:f,onClick:C,onFocus:O,readOnly:P,ownerState:b,ratingValue:x,ratingValueRounded:D}=t,p=r?g===x:g<=x,y=g<=j,$=g<=o,U=g===D,B=ut(),T=e.jsx(Jt,{as:h,value:g,className:Ae(s.icon,p?s.iconFilled:s.iconEmpty,y&&s.iconHover,$&&s.iconFocus,m&&s.iconActive),ownerState:H({},b,{iconEmpty:!p,iconFilled:p,iconHover:y,iconFocus:$,iconActive:m}),children:i&&!p?i:u});return P?e.jsx("span",H({},v,{children:T})):e.jsxs(d.Fragment,{children:[e.jsxs(vt,H({ownerState:H({},b,{emptyValueFocused:void 0}),htmlFor:B},v,{children:[T,e.jsx("span",{className:s.visuallyHidden,children:c(g)})]})),e.jsx("input",{className:s.visuallyHidden,onFocus:O,onBlur:w,onChange:f,onClick:C,disabled:n,value:g,id:B,type:"radio",name:k,checked:U})]})}const Zt=e.jsx(Vt,{fontSize:"inherit"}),en=e.jsx(Bt,{fontSize:"inherit"});function tn(t){return`${t} Star${t!==1?"s":""}`}const nn=d.forwardRef(function(s,n){const i=Tt({name:"MuiRating",props:s}),{className:o,defaultValue:c=null,disabled:r=!1,emptyIcon:j=en,emptyLabelText:u="Empty",getLabelText:h=tn,highlightSelectedOnly:m=!1,icon:g=Zt,IconContainerComponent:v=Qt,max:k=5,name:w,onChange:f,onChangeActive:C,onMouseLeave:O,onMouseMove:P,precision:b=1,readOnly:x=!1,size:D="medium",value:p}=i,y=dt(i,Gt),$=ut(w),[U,B]=Ft({controlled:p,default:c,name:"Rating"}),T=ze(U,b),q=Rt(),[{hover:E,focus:Z},Q]=d.useState({hover:-1,focus:-1});let X=T;E!==-1&&(X=E),Z!==-1&&(X=Z);const{isFocusVisibleRef:ae,onBlur:N,onFocus:he,ref:le}=Mt(),[ee,xe]=d.useState(!1),be=d.useRef(),Le=Lt(le,be,n),ye=I=>{P&&P(I);const _=be.current,{right:J,left:Se,width:ce}=_.getBoundingClientRect();let de;q?de=(J-I.clientX)/ce:de=(I.clientX-Se)/ce;let te=ze(k*de+b/2,b);te=Nt(te,b,k),Q(re=>re.hover===te&&re.focus===te?re:{hover:te,focus:te}),xe(!1),C&&E!==te&&C(I,te)},Oe=I=>{O&&O(I);const _=-1;Q({hover:_,focus:_}),C&&E!==_&&C(I,_)},S=I=>{let _=I.target.value===""?null:parseFloat(I.target.value);E!==-1&&(_=E),B(_),f&&f(I,_)},W=I=>{I.clientX===0&&I.clientY===0||(Q({hover:-1,focus:-1}),B(null),f&&parseFloat(I.target.value)===T&&f(I,null))},A=I=>{he(I),ae.current===!0&&xe(!0);const _=parseFloat(I.target.value);Q(J=>({hover:J.hover,focus:_}))},Y=I=>{if(E!==-1)return;N(I),ae.current===!1&&xe(!1);const _=-1;Q(J=>({hover:J.hover,focus:_}))},[Dt,rt]=d.useState(!1),ge=H({},i,{defaultValue:c,disabled:r,emptyIcon:j,emptyLabelText:u,emptyValueFocused:Dt,focusVisible:ee,getLabelText:h,icon:g,IconContainerComponent:v,max:k,precision:b,readOnly:x,size:D}),ne=Ut(ge);return e.jsxs(Xt,H({ref:Le,onMouseMove:ye,onMouseLeave:Oe,className:Ae(ne.root,o,x&&"MuiRating-readOnly"),ownerState:ge,role:x?"img":null,"aria-label":x?h(X):null},y,{children:[Array.from(new Array(k)).map((I,_)=>{const J=_+1,Se={classes:ne,disabled:r,emptyIcon:j,focus:Z,getLabelText:h,highlightSelectedOnly:m,hover:E,icon:g,IconContainerComponent:v,name:$,onBlur:Y,onChange:S,onClick:W,onFocus:A,ratingValue:X,ratingValueRounded:T,readOnly:x,ownerState:ge},ce=J===Math.ceil(X)&&(E!==-1||Z!==-1);if(b<1){const de=Array.from(new Array(1/b));return e.jsx(Kt,{className:Ae(ne.decimal,ce&&ne.iconActive),ownerState:ge,iconActive:ce,children:de.map((te,re)=>{const Pe=ze(J-1+(re+1)*b,b);return e.jsx(lt,H({},Se,{isActive:!1,itemValue:Pe,labelProps:{style:de.length-1===re?{}:{width:Pe===X?`${(re+1)*b*100}%`:"0%",overflow:"hidden",position:"absolute"}}}),Pe)})},J)}return e.jsx(lt,H({},Se,{isActive:ce,itemValue:J}),J)}),!x&&!r&&e.jsxs(vt,{className:Ae(ne.label,ne.labelEmptyValue),ownerState:ge,children:[e.jsx("input",{className:ne.visuallyHidden,value:"",id:`${$}-empty`,type:"radio",name:$,checked:T==null,onFocus:()=>rt(!0),onBlur:()=>rt(!1),onChange:S}),e.jsx("span",{className:ne.visuallyHidden,children:u})]})]}))}),Je=De(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),Ke=De(e.jsx("path",{d:"M3 13h2v-2H3zm0 4h2v-2H3zm0-8h2V7H3zm4 4h14v-2H7zm0 4h14v-2H7zM7 7v2h14V7z"}),"List");var Qe={},sn=ve;Object.defineProperty(Qe,"__esModule",{value:!0});var Me=Qe.default=void 0,an=sn(je()),rn=e;Me=Qe.default=(0,an.default)((0,rn.jsx)("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17zM12 3 1 9l11 6 9-4.91V17h2V9z"}),"School");var Ze={},on=ve;Object.defineProperty(Ze,"__esModule",{value:!0});var bt=Ze.default=void 0,ln=on(je()),cn=e;bt=Ze.default=(0,ln.default)((0,cn.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7zm-8 2V5h2v6h1.17L12 13.17 9.83 11zm-6 7h14v2H5z"}),"DownloadOutlined");var et={},dn=ve;Object.defineProperty(et,"__esModule",{value:!0});var yt=et.default=void 0,un=dn(je()),mn=e;yt=et.default=(0,un.default)((0,mn.jsx)("path",{d:"M12 12.75c1.63 0 3.07.39 4.24.9 1.08.48 1.76 1.56 1.76 2.73V18H6v-1.61c0-1.18.68-2.26 1.76-2.73 1.17-.52 2.61-.91 4.24-.91M4 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m1.13 1.1c-.37-.06-.74-.1-1.13-.1-.99 0-1.93.21-2.78.58C.48 14.9 0 15.62 0 16.43V18h4.5v-1.61c0-.83.23-1.61.63-2.29M20 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m4 3.43c0-.81-.48-1.53-1.22-1.85-.85-.37-1.79-.58-2.78-.58-.39 0-.76.04-1.13.1.4.68.63 1.46.63 2.29V18H24zM12 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3"}),"Groups");var tt={},hn=ve;Object.defineProperty(tt,"__esModule",{value:!0});var St=tt.default=void 0,xn=hn(je()),gn=e;St=tt.default=(0,xn.default)((0,gn.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 14H4V8l8 5 8-5zm-8-7L4 6h16z"}),"MailOutline");var nt={},fn=ve;Object.defineProperty(nt,"__esModule",{value:!0});var Ct=nt.default=void 0,pn=fn(je()),jn=e;Ct=nt.default=(0,pn.default)((0,jn.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const F=({children:t,noFlex:s,height:n,moreStyles:i={}})=>{const o=L(),c=M(o.palette.mode);return e.jsxs(l,{backgroundColor:c.primary[400],p:"20px",borderRadius:"10px",textAlign:"center",display:!s&&"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",sx:{height:n||"100%",boxShadow:o.palette.mode==="light"?"0px 2px 10px rgba(0, 0, 0, 0.1)":"0px 4px 12px rgba(0, 0, 0, 0.3)",...i},children:[t," "]})},st=({children:t,...s})=>e.jsxs(Be,{container:!0,spacing:2,...s,children:[t," "]}),K=({children:t})=>e.jsxs(Be,{container:!0,item:!0,xs:12,spacing:2,children:[t," "]}),R=({children:t,...s})=>e.jsxs(Be,{item:!0,xs:12,...s,children:[t," "]}),vn=({classLevels:t})=>{const s=L(),n=M(s.palette.mode);if(console.log("Class Levels Data:",t),!t||!Array.isArray(t)||t.length===0)return e.jsx(l,{children:e.jsx(a,{variant:"body1",align:"center",sx:{mt:2,color:n.grey[100]},children:"No class distribution data available for the current academic year"})});const i=r=>r&&typeof r=="object"&&r.name&&r.section&&r.academicYear&&typeof r.studentCount=="number",o=t.filter(r=>i(r)&&r.studentCount>0).map(r=>({id:r.name,label:`${r.name} (${r.section})`,value:r.studentCount,color:r.section==="Primary"?"rgba(75, 192, 192, 0.6)":"rgba(255, 159, 64, 0.6)"})),c=t.filter(i).map(r=>({id:r.id,label:`${r.name} (${r.section})`,studentCount:r.studentCount}));return e.jsxs(l,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,color:n.grey[100]},children:"Class Distribution (Students)"}),o.length===0?e.jsx(a,{variant:"body1",align:"center",sx:{color:n.grey[100]},children:"No active students to display in the current academic year"}):e.jsx("div",{style:{height:"350px"},children:e.jsx(xt,{data:o,theme:{axis:{domain:{line:{stroke:n.grey[100]}},legend:{text:{fill:n.grey[100]}},ticks:{line:{stroke:n.grey[100],strokeWidth:1},text:{fill:n.grey[100]}}},legends:{text:{fill:n.grey[100]}},tooltip:{container:{background:n.primary[400],color:n.grey[100],fontSize:12}}},margin:{top:40,right:80,bottom:80,left:80},innerRadius:.5,padAngle:.7,cornerRadius:3,activeOuterRadiusOffset:8,borderColor:{from:"color",modifiers:[["darker",.2]]},arcLinkLabelsSkipAngle:10,arcLinkLabelsTextColor:n.grey[100],arcLinkLabelsThickness:2,arcLinkLabelsColor:{from:"color"},enableArcLabels:!0,arcLabelsRadiusOffset:.4,arcLabelsSkipAngle:7,arcLabelsTextColor:{from:"color",modifiers:[["darker",2]]},colors:o.map(r=>r.color),defs:[{id:"dots",type:"patternDots",background:"inherit",color:"rgba(255, 255, 255, 0.3)",size:4,padding:1,stagger:!0},{id:"lines",type:"patternLines",background:"inherit",color:"rgba(255, 255, 255, 0.3)",rotation:-45,lineWidth:6,spacing:10}],legends:[{anchor:"bottom",direction:"row",justify:!1,translateX:0,translateY:56,itemsSpacing:0,itemWidth:100,itemHeight:18,itemTextColor:"#999",itemDirection:"left-to-right",itemOpacity:1,symbolSize:18,symbolShape:"circle",effects:[{on:"hover",style:{itemTextColor:"#000"}}]}]})}),e.jsx(l,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:c.length>0?c.map(r=>e.jsxs(a,{sx:{color:n.grey[100],fontSize:12,minWidth:120},children:[r.label,": ",r.studentCount," students"]},r.id)):e.jsx(a,{variant:"body1",align:"center",sx:{color:n.grey[100]},children:"No valid class distribution data to display for the current academic year"})})]})},at=()=>{var Z,Q,X,ae;const[t,s]=d.useState(0),n=ft(),[i,o]=d.useState([]),[c,r]=d.useState([]),{loading:j,error:u,callApi:h}=G(),{loading:m,data:g,error:v,callApi:k}=G(),{loading:w,data:f,error:C,callApi:O}=G(),{loading:P,data:b,error:x,callApi:D}=G(),p=d.useCallback(()=>(console.log("Fetching subjects from:",z.SUBJECT),h(z.SUBJECT,"GET")),[h]),y=d.useCallback(()=>(console.log("Fetching financial data from:",z.FINANCIAL_DATA),k(z.FINANCIAL_DATA,"GET")),[k]),$=d.useCallback(()=>(console.log("Fetching outstanding fees from:",z.OUTSTANDING_FEES_DATA),O(z.OUTSTANDING_FEES_DATA,"GET")),[O]),U=d.useCallback(()=>(console.log("Fetching admin stats from:",z.ADMIN_DATA),D(z.ADMIN_DATA,"GET")),[D]);d.useEffect(()=>{const N=new AbortController;return(async()=>{await Promise.all([p(),y(),$(),U()])})(),()=>{console.log("Cleaning up useAdminData API calls"),N.abort()}},[p,y,$,U]),d.useEffect(()=>{if(b){console.log("Raw Admin Stats Data:",b);const N=b.data||{};console.log("Processed Admin Stats Data:",N),o(N.classLevels||[]),s(N.unreadEnquiries||0)}x&&(console.error("Admin Stats Error:",x),n(Ne(x.message||"Failed to fetch admin stats.")))},[b,x,n]),d.useEffect(()=>{g&&(console.log("Raw Financial Data:",g),console.log("Processed Financial Data:",(g==null?void 0:g.data)||{})),v&&(console.error("Financial Data Error:",v),n(Ne(v.message||"Failed to fetch financial data.")))},[g,v,n]),d.useEffect(()=>{f&&(console.log("Raw Outstanding Fees Data:",f),console.log("Processed Outstanding Fees Data:",(f==null?void 0:f.data)||[])),C&&(console.error("Outstanding Fees Error:",C),n(Ne(C.message||"Failed to fetch outstanding fees data.")))},[f,C,n]);const B=d.useMemo(()=>{var le;const N=((le=b==null?void 0:b.data)==null?void 0:le.enrollmentsPerAcademicYear)||[];return console.log("Enrollments Data:",N),{total:N.map(ee=>({id:`Total-${ee.academicYear}`,academicYear:ee.academicYear,value:ee.enrollmentCount})).filter(ee=>ee.value>0)}},[b]),T=d.useMemo(()=>i.map(N=>({id:N.id,name:N.name,section:N.section,academicYear:N.academicYear,studentCount:N.studentCount})),[i]);d.useEffect(()=>{console.log("Class Distribution Data:",T)},[T]);const q=d.useMemo(()=>{const N=(f==null?void 0:f.data)||[];return console.log("Memoized Outstanding Fees Data:",N),N},[f]),E=[u,v,C,x].find(N=>N)||null;return{usersData:{totalStudents:((Z=b==null?void 0:b.data)==null?void 0:Z.totalStudents)||0,totalTeachers:((Q=b==null?void 0:b.data)==null?void 0:Q.totalTeachers)||0,currentYearStudents:((X=b==null?void 0:b.data)==null?void 0:X.currentYearStudents)||0,topTeachers:((ae=b==null?void 0:b.data)==null?void 0:ae.topTeachers)||[]},unreadEnquiriesCount:t,classLevels:T,subjects:c,financialData:(g==null?void 0:g.data)||{primary:[],secondary:[]},outstandingFeesData:q,enrollmentData:B,financialDataLoading:m,financialDataError:v,outstandingFeesLoading:w,outstandingFeesError:C,adminStatsLoading:P,adminStatsError:x,enrollmentDataLoading:P,enrollmentDataError:x,loading:j||m||w||P,error:E,refetchSubjects:p,refetchFinancialData:y,refetchOutstandingFees:$,refetchAdminStats:U}},bn=({isCustomLineColors:t=!1,isDashboard:s=!1})=>{const n=L(),i=d.useMemo(()=>M(n.palette.mode),[n.palette.mode]),{financialData:o,financialDataLoading:c,financialDataError:r}=at(),j=m=>`hsl(${m*360/2%360}, 70%, 60%)`,u=d.useMemo(()=>{var v,k;const m=(o==null?void 0:o.data)||o||{primary:[],secondary:[]};return!((v=m.primary)!=null&&v.length)&&!((k=m.secondary)!=null&&k.length)?[]:["primary","secondary"].filter(w=>{var f;return(f=m[w])==null?void 0:f.length}).map((w,f)=>({id:w.charAt(0).toUpperCase()+w.slice(1),color:t?j(f):void 0,data:m[w].map(C=>({x:C.label.split(" ")[0],y:C.value||0}))}))},[o,t]),h=d.useMemo(()=>{var k,w;const m=(o==null?void 0:o.data)||o||{primary:[],secondary:[]},g=((k=m.primary)==null?void 0:k.reduce((f,C)=>f+(C.value||0),0))||0,v=((w=m.secondary)==null?void 0:w.reduce((f,C)=>f+(C.value||0),0))||0;return g+v},[o]);return c?e.jsx(l,{children:"Loading data..."}):r?e.jsxs(l,{children:["Error: ",r.message||"Failed to load financial data"]}):u.length?e.jsxs(l,{width:"98%",height:s?"300px":"400px",children:[e.jsxs(a,{variant:"subtitle1",sx:{mb:2,color:i.grey[100]},children:["Total Revenue: ₦",h.toLocaleString("en-NG")]}),e.jsx(gt,{data:u,animate:!0,motionConfig:"default",theme:{axis:{domain:{line:{stroke:i.grey[100]}},legend:{text:{fill:i.grey[100],fontSize:8}},ticks:{line:{stroke:i.grey[100],strokeWidth:1},text:{fill:i.grey[100],fontSize:8}}},legends:{text:{fill:i.grey[100],fontSize:8}},tooltip:{container:{background:i.primary[500],color:i.grey[100],fontSize:12},format:m=>`₦${m.toLocaleString("en-NG")}`}},colors:t?{datum:"color"}:{scheme:"nivo"},margin:{top:50,right:110,bottom:50,left:60},xScale:{type:"point"},yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:m=>`₦${m.toLocaleString("en-NG")}`,curve:"catmullRom",axisTop:null,axisRight:null,axisBottom:{tickSize:0,tickPadding:5,tickRotation:45,legend:s?void 0:"Academic Year",legendOffset:36,legendPosition:"middle"},axisLeft:{tickValues:5,tickSize:3,tickPadding:5,tickRotation:0,legend:s?void 0:"Revenue (₦)",legendOffset:-50,legendPosition:"middle",format:m=>`₦${m.toLocaleString("en-NG")}`},enableGridX:!1,enableGridY:!1,pointSize:8,pointColor:{theme:"background"},pointBorderWidth:2,pointBorderColor:{from:"serieColor"},enablePoints:!0,enablePointLabel:!0,pointLabel:"y",pointLabelYOffset:-12,useMesh:!0,legends:[{anchor:"bottom-right",direction:"column",justify:!1,translateX:100,translateY:0,itemsSpacing:0,itemDirection:"left-to-right",itemWidth:80,itemHeight:20,itemOpacity:.75,symbolSize:12,symbolShape:"circle",symbolBorderColor:"rgba(0, 0, 0, .5)",effects:[{on:"hover",style:{itemBackground:"rgba(0, 0, 0, .03)",itemOpacity:1}}]}]})]}):e.jsx(l,{children:"No financial data available."})},yn=()=>{const t=L(),s=M(t.palette.mode),{error:n,callApi:i}=G(),[o,c]=d.useState([]),[r,j]=d.useState(!1),[u,h]=d.useState(!1),[m,g]=d.useState(!1),[v,k]=d.useState(""),[w,f]=d.useState(!1),[C,O]=d.useState(!1),[P,b]=d.useState(null),[x,D]=d.useState({title:"",description:"",day:"",startDate:"",endDate:""}),[p,y]=d.useState(null),[$,U]=d.useState(null),[B,T]=d.useState(!1),[q,E]=d.useState(null);d.useEffect(()=>{if(q){const S=setTimeout(()=>E(null),5e3);return()=>clearTimeout(S)}},[q]),d.useEffect(()=>{(async()=>{const W=await i(z.EVENT,"GET");if(W){console.log("Fetched events:",W);const A=W.data.map(Y=>({id:Y._id,title:Y.title,start:Y.startDate,end:Y.endDate,allDay:Y.startDate===Y.endDate}));c(A)}else E(n||"Failed to fetch events")})()},[i,n]);const Z=S=>{const W=new Date(S.startStr),A=new Date(W.getTime()+60*60*1e3);U(S),D({title:"",description:"",day:Ie(S.start,{weekday:"long"}),startDate:W.toISOString(),endDate:A.toISOString()}),j(!0)},Q=async()=>{if(!sessionStorage.getItem("accessToken")){E("Please log in to add events");return}if(!x.title||!x.description||!x.day||!x.startDate||!x.endDate){E("All fields are required");return}const W=await i(z.EVENT,"POST",{title:x.title,description:x.description,day:x.day,startDate:x.startDate,endDate:x.endDate});if(W){const A=W.data;c([...o,{id:A._id,title:A.title,start:A.startDate,end:A.endDate,allDay:A.startDate===A.endDate}]),j(!1),D({title:"",description:"",day:"",startDate:"",endDate:""}),k("Event created successfully"),g(!0),E(null)}else{const A=n||"Failed to create event";A.includes("Authentication required")||A.includes("No token provided")||A.includes("Invalid or expired token")?E("Please log in again to add events"):A.includes("admin only")?E("Only admins can add events"):E(A)}},X=S=>{if(!o.find(Y=>Y.id===S.event.id))return;const A={_id:S.event.id,title:S.event.title,description:"",day:Ie(S.event.start,{weekday:"long"}),startDate:S.event.start.toISOString(),endDate:S.event.end?S.event.end.toISOString():S.event.start.toISOString()};console.log("Selected event:",A),b(A),f(!0)},ae=()=>{f(!1),y(P),h(!0)},N=()=>{f(!1),O(!0)},he=async()=>{if(!sessionStorage.getItem("accessToken")){E("Please log in to update events");return}if(!p.title||!p.description||!p.day||!p.startDate||!p.endDate){E("All fields are required");return}const W=await i(`${z.EVENT}/${p._id}`,"PATCH",{title:p.title,description:p.description,day:p.day,startDate:p.startDate,endDate:p.endDate});if(W){const A=W.data;c(o.map(Y=>Y.id===A._id?{id:A._id,title:A.title,start:A.startDate,end:A.endDate,allDay:A.startDate===A.endDate}:Y)),h(!1),y(null),k("Event edited successfully"),g(!0),E(null)}else{const A=n||"Failed to update event";A.includes("Authentication required")||A.includes("No token provided")||A.includes("Invalid or expired token")?E("Please log in again to update events"):A.includes("admin only")?E("Only admins can update events"):E(A)}},le=async()=>{if(!sessionStorage.getItem("accessToken")){E("Please log in to delete events");return}if(await i(`${z.EVENT}/${P._id}`,"DELETE"))c(o.filter(A=>A.id!==P._id)),O(!1),b(null),k("Event deleted successfully"),g(!0),E(null);else{const A=n||"Failed to delete event";A.includes("Authentication required")||A.includes("No token provided")||A.includes("Invalid or expired token")?E("Please log in again to delete events"):A.includes("admin only")?E("Only admins can delete events"):E(A)}},ee=()=>{j(!1),D({title:"",description:"",day:"",startDate:"",endDate:""}),E(null)},xe=()=>{h(!1),y(null),E(null)},be=()=>{f(!1),b(null)},Le=()=>{O(!1),b(null)},ye=()=>{g(!1),k("")},Oe=()=>{T(S=>!S)};return e.jsxs(l,{my:"10px",children:[q&&e.jsx(Ue,{severity:"error",sx:{mb:2},onClose:()=>E(null),children:q}),e.jsxs(l,{display:"flex",justifyContent:"center",flexDirection:"column",children:[e.jsxs(l,{flex:"1 1 20%",backgroundColor:s.primary[400],py:"15px",borderRadius:"4px",sx:{width:"100%",height:"75vh",overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(l,{display:"flex",alignItems:"center",marginBottom:"10px",children:[e.jsx(Xe,{onClick:Oe,sx:{backgroundColor:s.blueAccent[500],"&:hover":{backgroundColor:s.blueAccent[700]},padding:"10px",borderRadius:"50%"},children:B?e.jsx(Je,{}):e.jsx(Ke,{})}),e.jsx(a,{variant:"h6",sx:{marginLeft:"10px",fontWeight:"800"},children:B?"Hide Events":"Show Events"})]}),B&&e.jsx(a,{variant:"h4",sx:{marginBottom:"10px"},children:"Events"}),B&&e.jsx(ke,{children:o.length===0?e.jsx(a,{children:"No events available"}):o.map(S=>e.jsx(we,{sx:{backgroundColor:s.blueAccent[500],margin:"10px 0",borderRadius:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(Te,{primary:S.title,secondary:e.jsx(a,{sx:{fontSize:"0.7em",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:Ie(S.start,{year:"numeric",month:"short",day:"numeric"})})})},S.id))})]}),e.jsx(l,{flex:"1 1 100%",sx:{width:"100%"},children:e.jsx(Ye,{height:"75vh",plugins:[He,Ge,pt,qe],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:"dayGridMonth",editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,select:Z,eventClick:X,events:o})})]}),e.jsx(se,{open:r,onClose:ee,title:"Add Event",onConfirm:Q,confirmText:"Create",cancelText:"Cancel",showCancel:!0,children:e.jsxs(l,{p:"20px",children:[e.jsx(V,{label:"Event Title",fullWidth:!0,value:x.title,onChange:S=>D({...x,title:S.target.value}),sx:{marginBottom:"20px"}}),e.jsx(V,{label:"Description",fullWidth:!0,value:x.description,onChange:S=>D({...x,description:S.target.value}),sx:{marginBottom:"20px"}}),e.jsx(V,{label:"Day",fullWidth:!0,value:x.day,InputProps:{readOnly:!0},sx:{marginBottom:"20px"}}),e.jsx(V,{label:"Start Date",type:"datetime-local",fullWidth:!0,value:x.startDate.slice(0,16),onChange:S=>D({...x,startDate:new Date(S.target.value).toISOString()}),sx:{marginBottom:"20px"}}),e.jsx(V,{label:"End Date",type:"datetime-local",fullWidth:!0,value:x.endDate.slice(0,16),onChange:S=>D({...x,endDate:new Date(S.target.value).toISOString()}),sx:{marginBottom:"20px"}})]})}),e.jsx(se,{open:u,onClose:xe,title:"Edit Event",onConfirm:he,confirmText:"Save",cancelText:"Cancel",showCancel:!0,children:e.jsxs(l,{p:"20px",children:[e.jsx(V,{label:"Event Title",fullWidth:!0,value:(p==null?void 0:p.title)||"",onChange:S=>y({...p,title:S.target.value}),sx:{marginBottom:"20px"}}),e.jsx(V,{label:"Description",fullWidth:!0,value:(p==null?void 0:p.description)||"",onChange:S=>y({...p,description:S.target.value}),sx:{marginBottom:"20px"}}),e.jsx(V,{label:"Day",fullWidth:!0,value:(p==null?void 0:p.day)||"",onChange:S=>y({...p,day:S.target.value}),sx:{marginBottom:"20px"}}),e.jsx(V,{label:"Start Date",type:"datetime-local",fullWidth:!0,value:(p==null?void 0:p.startDate.slice(0,16))||"",onChange:S=>y({...p,startDate:new Date(S.target.value).toISOString()}),sx:{marginBottom:"20px"}}),e.jsx(V,{label:"End Date",type:"datetime-local",fullWidth:!0,value:(p==null?void 0:p.endDate.slice(0,16))||"",onChange:S=>y({...p,endDate:new Date(S.target.value).toISOString()}),sx:{marginBottom:"20px"}})]})}),e.jsx(se,{open:w,onClose:be,title:`Manage Event: ${(P==null?void 0:P.title)||""}`,onConfirm:ae,confirmText:"Edit",onCancel:N,cancelText:"Delete",showCancel:!0,children:e.jsx(l,{p:"20px",children:e.jsxs(a,{children:['Select an action for the event "',P==null?void 0:P.title,'".']})})}),e.jsx(se,{open:C,onClose:Le,title:"Confirm Delete",onConfirm:le,confirmText:"Confirm",cancelText:"Cancel",showCancel:!0,children:e.jsx(l,{p:"20px",children:e.jsxs(a,{children:['Do you want to delete the event "',P==null?void 0:P.title,'"?']})})}),e.jsx(se,{open:m,onClose:ye,title:"Success",onConfirm:ye,confirmText:"OK",showCancel:!1,children:e.jsx(l,{p:"20px",children:e.jsx(a,{children:v})})})]})},Sn=({outstandingFeesData:t})=>{const s=L(),n=M(s.palette.mode);if(console.log("Outstanding Fees Data:",t),!t||!Array.isArray(t)||t.length===0)return e.jsx(l,{children:e.jsx(a,{variant:"body1",align:"center",sx:{mt:2},children:"No outstanding fees data available"})});const i=u=>u&&typeof u=="object"&&u.id&&u.label&&typeof u.value=="number",o=["rgba(75, 192, 192, 0.6)","rgba(255, 159, 64, 0.6)","rgba(153, 102, 255, 0.6)","rgba(60, 179, 113, 0.6)","rgba(100, 149, 237, 0.6)","rgba(255, 99, 132, 0.6)"],c=u=>{const h=Math.abs(u.split("").reduce((m,g)=>m+g.charCodeAt(0),0))%o.length;return o[h]},r=t.filter(u=>i(u)&&u.value>0).map(u=>({id:u.id,label:u.label,value:u.value,color:c(u.id)})),j=t.filter(i).map(u=>({id:u.id,label:u.label,value:u.value}));return e.jsxs(l,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,color:n.grey[100]},children:"Outstanding Fees by Academic Year"}),r.length===0?e.jsx(a,{variant:"body1",align:"center",children:"No outstanding fees to display"}):e.jsx("div",{style:{height:"350px"},children:e.jsx(xt,{data:r,theme:{axis:{domain:{line:{stroke:n.grey[100]}},legend:{text:{fill:n.grey[100]}},ticks:{line:{stroke:n.grey[100],strokeWidth:1},text:{fill:n.grey[100]}}},legends:{text:{fill:n.grey[100]}},tooltip:{container:{background:n.primary[400],color:n.grey[100],fontSize:12}}},margin:{top:40,right:80,bottom:80,left:80},innerRadius:.5,padAngle:.7,cornerRadius:3,activeOuterRadiusOffset:8,borderColor:{from:"color",modifiers:[["darker",.2]]},arcLinkLabelsSkipAngle:10,arcLinkLabelsTextColor:n.grey[100],arcLinkLabelsThickness:2,arcLinkLabelsColor:{from:"color"},arcLinkLabel:u=>u.data.label,enableArcLabels:!0,arcLabelsRadiusOffset:.4,arcLabelsSkipAngle:7,arcLabelsTextColor:{from:"color",modifiers:[["darker",2]]},arcLabelsText:u=>`₦${u.value.toLocaleString()}`,colors:r.map(u=>u.color),defs:[{id:"dots",type:"patternDots",background:"inherit",color:"rgba(255, 255, 255, 0.3)",size:4,padding:1,stagger:!0},{id:"lines",type:"patternLines",background:"inherit",color:"rgba(255, 255, 255, 0.3)",rotation:-45,lineWidth:6,spacing:10}],legends:[{anchor:"bottom",direction:"row",justify:!1,translateX:0,translateY:56,itemsSpacing:0,itemWidth:100,itemHeight:18,itemTextColor:"#999",itemDirection:"left-to-right",itemOpacity:1,symbolSize:18,symbolShape:"circle",effects:[{on:"hover",style:{itemTextColor:"#000"}}],data:r.map(u=>({id:u.id,label:u.label}))}]})}),e.jsx(l,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:j.length>0?j.map(u=>e.jsxs(a,{sx:{color:n.grey[100],fontSize:12,minWidth:120},children:[u.label,": ₦",u.value.toLocaleString()]},u.id)):e.jsx(a,{variant:"body1",align:"center",children:"No valid outstanding fees data to display"})})]})},Cn=({topTeachers:t})=>{const s=L(),n=M(s.palette.mode);console.log(t);const i=t&&Array.isArray(t)&&t.length>0?t.map(o=>({name:`${o.name}`.trim()||"Unnamed Teacher",subject:o.subject&&Array.isArray(o.subject)&&o.subject.length>0?o.subject[0].name:"No Subject",rating:o.rating||0})).sort((o,c)=>c.rating-o.rating).slice(0,5):[];return e.jsx(l,{sx:{height:"350px",overflowY:"auto"},children:i.length>0?e.jsx(ke,{children:i.map((o,c)=>e.jsx(we,{sx:{backgroundColor:n.primary[400],mb:1,borderRadius:"4px"},children:e.jsx(Te,{primary:`${o.name} (${o.subject})`,secondary:`Rating: ${o.rating}/5`,sx:{color:n.grey[100]}})},c))}):e.jsx(l,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx(a,{color:n.grey[100],children:"No teachers available"})})})},An=()=>{var r;const t=L(),s=M(t.palette.mode),{enrollmentData:n,enrollmentDataLoading:i,enrollmentDataError:o}=at();if(i)return e.jsx(l,{children:"Loading..."});if(o)return e.jsxs(l,{children:["Error: ",o.message||"Failed to load data"]});if(!n||!((r=n.total)!=null&&r.length))return e.jsx(l,{children:"No enrollment data available."});const c=n.total.map(j=>({academicYear:j.academicYear,Total:j.value}));return console.log("Enrollment Chart Data:",c),e.jsxs(l,{height:"300px",children:[e.jsx(a,{variant:"h6",sx:{mb:1,color:s.grey[100],fontSize:"14px"},children:"Enrollment"}),e.jsx(zt,{data:c,keys:["Total"],indexBy:"academicYear",theme:{axis:{domain:{line:{stroke:s.grey[100]}},legend:{text:{fill:s.grey[100],fontSize:8}},ticks:{line:{stroke:s.grey[100],strokeWidth:1},text:{fill:s.grey[100],fontSize:8}}},legends:{text:{fill:s.grey[100],fontSize:8}},tooltip:{container:{background:s.primary[400],color:s.grey[100],fontSize:8}}},margin:{top:20,right:60,bottom:40,left:40},padding:.4,colors:{scheme:"nivo"},animate:!0,motionConfig:"default",axisTop:null,axisRight:null,axisBottom:{tickSize:3,tickPadding:3,tickRotation:45,legend:"Academic Year",legendPosition:"middle",legendOffset:30,truncateTickAt:0},axisLeft:{tickSize:3,tickPadding:3,tickRotation:0,legend:"Students",legendPosition:"middle",legendOffset:-30},labelSkipWidth:12,labelSkipHeight:12,labelTextColor:{from:"color",modifiers:[["darker",1.6]]},legends:[{dataFrom:"keys",anchor:"bottom-right",direction:"column",justify:!1,translateX:50,translateY:0,itemsSpacing:1,itemWidth:50,itemHeight:15,itemDirection:"left-to-right",itemOpacity:.85,symbolSize:12,effects:[{on:"hover",style:{itemOpacity:1}}]}]})]})},Dn=()=>{const t=L(),s=M(t.palette.mode),[n,i]=d.useState(!0),[o,c]=d.useState(0),[r,j]=d.useState(0),[u,h]=d.useState(0),[m,g]=d.useState(null),{usersData:v,unreadEnquiriesCount:k,classLevels:w,financialData:f,outstandingFeesData:C,enrollmentData:O,loading:P,error:b}=at();if(d.useEffect(()=>{v&&(i(!1),c(v.totalStudents||0),j(v.totalTeachers||0),h(v.currentYearStudents||0)),b&&g(b.message||"An error occurred while fetching data.")},[v,b]),n||P)return e.jsx(Ve,{});if(m)return e.jsx(l,{m:"20px",children:e.jsxs(a,{variant:"h4",color:"error",children:["Error: ",m]})});const x={mt:"15px",fontWeight:"bold"};return f&&[...f.primary,...f.secondary].reduce((D,p)=>D+(p.value||0),0),e.jsxs(l,{m:"20px",children:[e.jsx(a,{variant:"h3",fontWeight:"600",mb:"20px",children:"School Administration Dashboard"}),e.jsxs(st,{children:[e.jsxs(K,{children:[e.jsx(R,{sm:6,md:3,children:e.jsxs(F,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Students"}),e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(yt,{sx:{fontSize:"70px",color:s.blueAccent[200]}}),e.jsx(a,{variant:"h4",color:s.blueAccent[200],sx:x,children:`${o} students`}),e.jsx(a,{children:"Total active students"})]})]})}),e.jsx(R,{sm:6,md:3,children:e.jsxs(F,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Teachers"}),e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(Me,{sx:{fontSize:"70px",color:s.blueAccent[200]}}),e.jsx(a,{variant:"h4",color:s.blueAccent[200],sx:x,children:`${r} teachers`}),e.jsx(a,{children:"Total teachers"})]})]})}),e.jsx(R,{sm:6,md:3,children:e.jsxs(F,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"New Students"}),e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(Ct,{sx:{fontSize:"70px",color:s.blueAccent[200]}}),e.jsx(a,{variant:"h4",color:s.blueAccent[200],sx:x,children:`${u} students`}),e.jsx(a,{children:"New students this academic year"})]})]})}),e.jsx(R,{sm:6,md:3,children:e.jsxs(F,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Unread Enquiries"}),e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",mt:"25px",children:[e.jsx(St,{sx:{fontSize:"70px",color:s.blueAccent[200]}}),e.jsx(a,{variant:"h4",color:s.blueAccent[200],sx:x,children:k}),e.jsx(a,{children:"Total unread enquiries"})]})]})})]}),e.jsxs(K,{children:[e.jsx(R,{md:8,children:e.jsxs(F,{noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"School Fees Data"}),e.jsx(l,{mt:"10px",children:e.jsx(bn,{financialData:f})})]})}),e.jsx(R,{md:4,children:e.jsxs(F,{noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Outstanding Payments"}),e.jsx(l,{mt:"10px",children:e.jsx(Sn,{outstandingFeesData:C})})]})})]}),e.jsxs(K,{children:[e.jsx(R,{md:4,children:e.jsxs(F,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",gutterBottom:!0,children:"Enrollment Stats"}),e.jsx(l,{mt:"10px",children:e.jsx(An,{enrollmentData:O})})]})}),e.jsx(R,{md:4,children:e.jsxs(F,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",gutterBottom:!0,children:"Top Teachers"}),e.jsx(l,{mt:"10px",children:e.jsx(Cn,{topTeachers:v.topTeachers})})]})}),e.jsx(R,{md:4,children:e.jsxs(F,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",gutterBottom:!0,children:"Class Distribution"}),e.jsx(l,{mt:"10px",children:e.jsx(vn,{classLevels:w})})]})})]}),e.jsx(K,{children:e.jsx(R,{md:12,children:e.jsxs(F,{noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"School Activities"}),e.jsx(l,{mt:"10px",children:e.jsx(yn,{})})]})})})]})]})},me=({progress:t=.75,size:s=40})=>{const n=L(),i=M(n.palette.mode),o=t*360,r=(j=>j>=.75?i.greenAccent[400]:j>=.5?i.greenAccent[700]:i.redAccent[700])(t);return e.jsx(l,{sx:{background:`radial-gradient(${i.primary[400]} 55%, transparent 56%),
            conic-gradient(${r} 0deg ${o}deg, ${i.blueAccent[200]} ${o}deg 360deg),
            ${i.primary[400]}`,borderRadius:"50%",width:`${s}px`,height:`${s}px`}})},En=({progress:t})=>!t&&t!==0?e.jsx(a,{children:"No session progress data available"}):e.jsxs(l,{children:[e.jsx(a,{variant:"h6",fontWeight:"600",mb:"5px",children:"Session Progress"}),e.jsx(me,{size:"125",progress:t/100}),e.jsxs(a,{variant:"body2",mt:"10px",children:["Academic year completion: ",t,"%"]})]}),kn=({attendance:t})=>!t&&t!==0?e.jsx(a,{children:"No attendance data available"}):e.jsxs(l,{children:[e.jsx(a,{variant:"h6",fontWeight:"600",mb:"5px",children:"Term Attendance"}),e.jsx(me,{size:"125",progress:t/100}),e.jsxs(a,{variant:"body2",mt:"10px",children:["Current term attendance: ",t,"%"]})]}),wn=({feesStatus:t})=>t?e.jsxs(l,{children:[e.jsxs(a,{variant:"h6",fontWeight:"600",mb:"5px",children:["Fee Payment Status (",parseInt(t.percentagePaid),"%)"]}),e.jsx(me,{size:"125",progress:t.percentagePaid/100}),e.jsxs(a,{variant:"body2",mt:"10px",children:["Outstanding Fees: $",t.totalOutstanding]})]}):e.jsx(a,{children:"No payment data available"});function At(){const t=ft(),s=ue(h=>{var m;return(m=h.users.user)==null?void 0:m._id}),n=ue(h=>{var m;return(m=h.users.user)==null?void 0:m.userId}),i=ue(h=>h.adminData.currentAcademicYear),{callApi:o}=G(),[c,r]=d.useState({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:null}),j=d.useCallback(async()=>{if(!s){r({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:"Student ID not found. Please log in."});return}r(h=>({...h,loading:!0,error:null}));try{const h=await o(`${ct}/student-dashboard`,"GET");if(h&&h.status==="success"){const{data:m}=h;t(Et(m.currentAcademicYear||null)),r({sessionProgress:m.sessionProgress||0,termAttendance:m.termAttendance||0,feeStatus:m.feeStatus||{percentagePaid:0,totalOutstanding:0},nextClass:m.nextClass||null,missedClasses:m.missedClasses||[],subjectPerformance:m.subjectPerformance||null,allResources:m.allResources||[],assignments:m.assignments||[],timetable:m.timetable||[],loading:!1,error:null})}else r({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:(h==null?void 0:h.message)||"Failed to fetch student dashboard data"})}catch(h){r({sessionProgress:0,termAttendance:0,feeStatus:{percentagePaid:0,totalOutstanding:0},nextClass:null,missedClasses:[],subjectPerformance:null,allResources:[],assignments:[],timetable:[],loading:!1,error:h.message||"Failed to fetch student dashboard data"})}},[s,o,t]);return d.useEffect(()=>{j()},[j]),console.log(c),{...c,currentAcademicYear:i,formatDateToDDMMYYYY:h=>new Date(h).toLocaleDateString("en-GB"),userId:n}}const Tn=({nextClass:t})=>{const s=L(),n=M(s.palette.mode);return t?e.jsxs(l,{textAlign:"center",children:[e.jsx(a,{variant:"h6",fontWeight:"600",mb:"5px",children:"Next Class"}),e.jsxs(l,{children:[e.jsx(Me,{sx:{fontSize:"30px",color:n.blueAccent[400]}}),e.jsx(a,{variant:"h6",children:t.subject}),e.jsx(a,{children:t.date}),e.jsx(a,{children:t.time}),e.jsxs(a,{children:["Location: ",t.location]})]})]}):e.jsx(a,{children:"No upcoming classes"})},Fn=({subjectPerformance:t})=>{const s=L(),n=M(s.palette.mode);return!t||t.length===0?e.jsx(a,{children:"No performance data available"}):e.jsx("div",{style:{height:"350px"},children:e.jsx(gt,{data:t,animate:!0,motionConfig:"default",theme:{axis:{domain:{line:{stroke:n.grey[100]}},legend:{text:{fill:n.grey[100],fontSize:8}},ticks:{line:{stroke:n.grey[100],strokeWidth:1},text:{fill:n.grey[100],fontSize:8}}},legends:{text:{fill:n.grey[100],fontSize:8}},tooltip:{container:{color:n.primary[500]}}},colors:{datum:"color"},margin:{top:50,right:110,bottom:50,left:60},xScale:{type:"point"},yScale:{type:"linear",min:0,max:100,stacked:!1,reverse:!1},yFormat:" >-.2f",curve:"catmullRom",axisTop:null,axisRight:null,axisBottom:{tickSize:0,tickPadding:5,tickRotation:0,legend:"Month",legendOffset:36,legendPosition:"middle"},axisLeft:{tickValues:5,tickSize:3,tickPadding:5,tickRotation:0,legend:"Score (%)",legendOffset:-40,legendPosition:"middle"},enableGridX:!1,enableGridY:!1,pointSize:8,pointColor:{theme:"background"},pointBorderWidth:1,pointBorderColor:{from:"serieColor"},pointLabelYOffset:-12,useMesh:!0,legends:[{anchor:"bottom-right",direction:"column",justify:!1,translateX:100,translateY:0,itemsSpacing:0,itemDirection:"left-to-right",itemWidth:80,itemHeight:20,itemOpacity:.75,symbolSize:12,symbolShape:"circle",symbolBorderColor:"rgba(0, 0, 0, .5)",effects:[{on:"hover",style:{itemBackground:"rgba(0, 0, 0, .03)",itemOpacity:1}}]}]})})},Rn=({missedClasses:t,formatDateToDDMMYYYY:s})=>{const n=L(),i=M(n.palette.mode),o=n.palette.mode==="light"?i.blueAccent[800]:i.greenAccent[600];return t?e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Missed Classes"}),t.length>0?t.map(c=>e.jsx(Fe,{sx:{mb:2},children:e.jsxs(Re,{sx:{backgroundColor:o,textAlign:"left"},children:[e.jsx(a,{variant:"h6",children:c.subject}),e.jsx(a,{children:s(c.date)}),e.jsx(a,{children:c.time}),e.jsxs(a,{children:["Location: ",c.location]})]})},c.id)):e.jsx(a,{children:"You attended all classes"})]}):e.jsx(a,{children:"No missed classes data available"})},Mn=()=>{const t=L(),s=M(t.palette.mode),{callApi:n}=G(),[i,o]=d.useState(null);d.useEffect(()=>{(async()=>{try{const h=await n(z.ANNOUNCEMENT,"GET");h&&h.data&&o(h.data)}catch(h){console.error("Error fetching announcements:",h)}})()},[n]);const c=t.palette.mode==="light"?s.blueAccent[800]:s.greenAccent[600],j=i||[{id:"1",title:"End of Term Exams",message:"Exams start on July 1, 2025.",date:"2025-06-20"},{id:"2",title:"Sports Day",message:"Join us on July 15, 2025.",date:"2025-06-18"}];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Announcements"}),j.length>0?j.map(u=>e.jsx(Fe,{sx:{mb:2},children:e.jsxs(Re,{sx:{backgroundColor:c,textAlign:"left"},children:[e.jsx(a,{variant:"h6",children:u.title}),e.jsx(a,{variant:"body2",children:u.message}),e.jsx(a,{variant:"caption",color:"gray",children:u.date})]})},u.id)):e.jsx(a,{children:"No announcements available"})]})},Ln=()=>{const t=L(),s=M(t.palette.mode),{allResources:n}=At(),o=n||[{title:"Math Textbook",url:"https://example.com/math-textbook.pdf"},{title:"Science Notes",url:"https://example.com/science-notes.pdf"}],c=t.palette.mode==="light"?s.blueAccent[800]:s.greenAccent[600];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Useful Resources"}),o.length>0?o.map((r,j)=>e.jsx(Fe,{sx:{mb:2},children:e.jsxs(Re,{sx:{backgroundColor:c,textAlign:"left"},children:[e.jsx(a,{variant:"h6",children:r.title}),e.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",children:r.url})]})},j)):e.jsx(a,{children:"No Resources Available"})]})},On=()=>{const t=L(),s=M(t.palette.mode),{error:n,callApi:i}=G(),[o,c]=d.useState([]),[r,j]=d.useState(!1),[u,h]=d.useState(null);d.useEffect(()=>{if(u){const g=setTimeout(()=>h(null),5e3);return()=>clearTimeout(g)}},[u]),d.useEffect(()=>{(async()=>{const v=sessionStorage.getItem("accessToken"),k=v?{Authorization:`Bearer ${v}`}:{},w=await i(z.EVENT,"GET",null,k);if(w){console.log("Fetched events:",w);const f=w.data.map(C=>({id:C._id,title:C.title,start:C.startDate,end:C.endDate,allDay:C.startDate===C.endDate}));c(f)}else{const f=n||"Failed to fetch events";f.includes("Authentication required")||f.includes("No token provided")||f.includes("Invalid or expired token")?h("Please log in to view events"):h(f)}})()},[i,n]);const m=()=>{j(g=>!g)};return e.jsxs(l,{my:"10px",children:[u&&e.jsx(Ue,{severity:"error",sx:{mb:2},onClose:()=>h(null),children:u}),e.jsxs(l,{display:"flex",justifyContent:"center",flexDirection:"column",children:[e.jsxs(l,{flex:"1 1 20%",backgroundColor:s.primary[400],py:"15px",borderRadius:"4px",sx:{width:"100%",height:"70vh",overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(l,{display:"flex",alignItems:"center",marginBottom:"10px",children:[e.jsx(Xe,{onClick:m,sx:{backgroundColor:s.blueAccent[500],"&:hover":{backgroundColor:s.blueAccent[700]},padding:"10px",borderRadius:"50%"},children:r?e.jsx(Je,{}):e.jsx(Ke,{})}),e.jsx(a,{variant:"h6",sx:{marginLeft:"10px",fontWeight:"800"},children:r?"Hide Events":"Show Events"})]}),r&&e.jsx(a,{variant:"h4",sx:{marginBottom:"10px"},children:"Events"}),r&&e.jsx(ke,{children:o.length===0?e.jsx(a,{children:"No events available"}):o.map(g=>e.jsx(we,{sx:{backgroundColor:s.blueAccent[500],margin:"10px 0",borderRadius:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(Te,{primary:g.title,secondary:e.jsx(a,{sx:{fontSize:"0.7em",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:new Date(g.start).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})})},g.id))})]}),e.jsx(l,{flex:"1 1 100%",sx:{width:"100%"},children:e.jsx(Ye,{height:"70vh",plugins:[He,Ge,qe],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:"dayGridMonth",editable:!1,selectable:!1,dayMaxEvents:!0,events:o})})]})]})},Pn=()=>{const t=L();M(t.palette.mode);const[s,n]=d.useState(!0),[i,o]=d.useState(null),{loading:c,error:r,sessionProgress:j,termAttendance:u,feeStatus:h,missedClasses:m,nextClass:g,subjectPerformance:v,allResources:k}=At();return d.useEffect(()=>{c||n(!1),r&&o(r.message||"An error occurred while fetching data.")},[c,r]),s||c?e.jsx(Ve,{}):i?e.jsx(l,{m:"20px",children:e.jsxs(a,{variant:"h4",color:"error",children:["Error: ",i]})}):e.jsxs(l,{m:"20px",children:[e.jsx(a,{variant:"h3",fontWeight:"600",mb:"20px",children:"Student Dashboard"}),e.jsxs(st,{children:[e.jsxs(K,{children:[e.jsx(R,{sm:6,md:3,children:e.jsx(F,{children:e.jsx(En,{progress:j})})}),e.jsx(R,{sm:6,md:3,children:e.jsx(F,{children:e.jsx(kn,{attendance:u})})}),e.jsx(R,{sm:6,md:3,children:e.jsx(F,{children:e.jsx(wn,{feesStatus:h})})}),e.jsx(R,{sm:6,md:3,children:e.jsx(F,{noFlex:!0,children:e.jsx(Tn,{nextClass:g})})})]}),e.jsxs(K,{children:[e.jsx(R,{md:8,children:e.jsxs(F,{height:"350px",noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",mb:"10px",children:"Subject Performance"}),e.jsx(Fn,{subjectPerformance:v})]})}),e.jsx(R,{md:4,children:e.jsx(F,{noFlex:!0,children:e.jsx(Rn,{missedClasses:m})})})]}),e.jsxs(K,{children:[e.jsx(R,{md:6,children:e.jsx(F,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx(Mn,{})})}),e.jsx(R,{md:6,children:e.jsx(F,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx(Ln,{allResources:k})})})]}),e.jsx(K,{children:e.jsx(R,{md:12,children:e.jsxs(F,{noFlex:!0,children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",mb:"10px",children:"School Activities"}),e.jsx(On,{})]})})})]})]})};function ie(){const[t,s]=d.useState({termProgress:0,studentAttendance:0,assignmentSubmissionRate:{totalAssignmentRate:0},nextClass:null,topStudents:[],leastActiveStudents:[],loading:!1,error:null}),{callApi:n}=G(),i=ue(c=>{var r;return(r=c.users.user)==null?void 0:r._id}),o=d.useCallback(async()=>{if(!i){s(c=>({...c,loading:!1,error:"Teacher ID not found. Please log in."}));return}s(c=>({...c,loading:!0,error:null}));try{const c=await n(`${ct}/teacher-dashboard/${i}`,"GET");if(c&&c.status==="success"){const{data:r}=c;s({termProgress:r.termProgress||0,studentAttendance:r.studentAttendance||0,assignmentSubmissionRate:r.assignmentSubmissionRate||{totalAssignmentRate:0},nextClass:r.nextClass||null,topStudents:r.topStudents||[],leastActiveStudents:r.leastActiveStudents||[],loading:!1,error:null})}else s(r=>({...r,loading:!1,error:(c==null?void 0:c.message)||"Failed to fetch teacher dashboard data"}))}catch(c){s(r=>({...r,loading:!1,error:c.message||"Failed to fetch teacher dashboard data"}))}},[i,n]);return d.useEffect(()=>{o()},[o]),t}const Nn=()=>{const t=L(),s=M(t.palette.mode),{termProgress:n}=ie();return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Term Progress"}),e.jsx(l,{mt:"25px",children:n>0?e.jsxs(e.Fragment,{children:[e.jsx(me,{size:"125",progress:n/100}),e.jsx(a,{variant:"h5",color:s.blueAccent[500],sx:{mt:"15px"},children:`${n}% completed`}),e.jsx(a,{children:"Current term completion"})]}):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No term progress available."})})]})},In=()=>{const t=L(),s=M(t.palette.mode),{studentAttendance:n}=ie();return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Student Attendance"}),e.jsx(l,{mt:"25px",children:n>0?e.jsxs(e.Fragment,{children:[e.jsx(me,{size:"125",progress:n/100}),e.jsx(a,{variant:"h5",color:s.blueAccent[500],sx:{mt:"15px"},children:`${n}% attendance rate`}),e.jsx(a,{children:"Average student attendance"})]}):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No attendance data available."})})]})},zn=()=>{const t=L(),s=M(t.palette.mode),{assignmentSubmissionRate:n}=ie();return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(a,{variant:"h5",fontWeight:"600",textAlign:"center",children:"Assignment Submissions"}),e.jsx(l,{mt:"25px",children:n&&n.totalAssignmentRate>0?e.jsxs(e.Fragment,{children:[e.jsx(me,{size:"125",progress:n.totalAssignmentRate/100}),e.jsx(a,{variant:"h5",color:s.blueAccent[500],sx:{mt:"15px"},children:`${n.totalAssignmentRate}% submission rate`}),e.jsx(a,{children:"Average assignment submission rate"})]}):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No submission data available."})})]})},$n=()=>{const t=L(),s=M(t.palette.mode),{nextClass:n}=ie();return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",textAlign:"center",children:"Next Class"}),n?e.jsxs(l,{textAlign:"center",children:[e.jsx(Me,{sx:{fontSize:"50px",color:s.blueAccent[500]}}),e.jsx(a,{variant:"h6",children:n.subject}),e.jsx(a,{children:n.date}),e.jsx(a,{children:n.time}),e.jsxs(a,{children:["Location: ",n.location]})]}):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No upcoming classes scheduled."})]})},Wn=()=>{const t=L(),s=M(t.palette.mode),{error:n,callApi:i}=G(),[o,c]=d.useState([]),[r,j]=d.useState(!1),[u,h]=d.useState(null);d.useEffect(()=>{if(u){const g=setTimeout(()=>h(null),5e3);return()=>clearTimeout(g)}},[u]),d.useEffect(()=>{(async()=>{const v=sessionStorage.getItem("accessToken"),k=v?{Authorization:`Bearer ${v}`}:{},w=await i(z.EVENT,"GET",null,k);if(w){console.log("Fetched events:",w);const f=w.data.map(C=>({id:C._id,title:C.title,start:C.startDate,end:C.endDate,allDay:C.startDate===C.endDate}));c(f)}else{const f=n||"Failed to fetch events";f.includes("Authentication required")||f.includes("No token provided")||f.includes("Invalid or expired token")?h("Please log in to view events"):h(f)}})()},[i,n]);const m=()=>{j(g=>!g)};return e.jsxs(l,{my:"10px",children:[u&&e.jsx(Ue,{severity:"error",sx:{mb:2},onClose:()=>h(null),children:u}),e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Event Calendar"}),e.jsxs(l,{display:"flex",justifyContent:"center",flexDirection:"column",children:[e.jsxs(l,{flex:"1 1 20%",backgroundColor:s.primary[400],py:"15px",borderRadius:"4px",sx:{width:"100%",height:"70vh",overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(l,{display:"flex",alignItems:"center",marginBottom:"10px",children:[e.jsx(Xe,{onClick:m,sx:{backgroundColor:s.blueAccent[500],"&:hover":{backgroundColor:s.blueAccent[700]},padding:"10px",borderRadius:"50%"},children:r?e.jsx(Je,{}):e.jsx(Ke,{})}),e.jsx(a,{variant:"h6",sx:{marginLeft:"10px",fontWeight:"800"},children:r?"Hide Events":"Show Events"})]}),r&&e.jsx(a,{variant:"h4",sx:{marginBottom:"10px"},children:"Events"}),r&&e.jsx(ke,{children:o.length===0?e.jsx(a,{children:"No events available"}):o.map(g=>e.jsx(we,{sx:{backgroundColor:s.blueAccent[500],margin:"10px 0",borderRadius:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(Te,{primary:g.title,secondary:e.jsx(a,{sx:{fontSize:"0.7em",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:new Date(g.start).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})})},g.id))})]}),e.jsx(l,{flex:"1 1 100%",sx:{width:"100%"},children:e.jsx(Ye,{height:"70vh",plugins:[He,Ge,qe,pt],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:"dayGridMonth",editable:!1,selectable:!1,dayMaxEvents:!0,events:o})})]})]})},_n=()=>{const t=L(),s=M(t.palette.mode),{callApi:n}=G(),[i,o]=d.useState(null);d.useEffect(()=>{(async()=>{try{const h=await n(z.ANNOUNCEMENT,"GET");h&&h.data&&o(h.data)}catch(h){console.error("Error fetching announcements:",h)}})()},[n]);const c=t.palette.mode==="light"?s.blueAccent[800]:s.greenAccent[600],j=i||[{id:"1",title:"End of Term Exams",message:"Exams start on July 1, 2025.",date:"2025-06-20"},{id:"2",title:"Teachers Meeting",message:"Meeting on July 10, 2025.",date:"2025-06-18"}];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Announcements"}),j.length>0?j.map(u=>e.jsx(Fe,{sx:{mb:2},children:e.jsxs(Re,{sx:{backgroundColor:c,textAlign:"left"},children:[e.jsx(a,{variant:"h6",children:u.title}),e.jsx(a,{variant:"body2",children:u.message}),e.jsx(a,{variant:"caption",color:"gray",children:u.date})]})},u.id)):e.jsx(a,{children:"No announcements available"})]})},Vn=()=>{const t=L(),s=M(t.palette.mode),{topStudents:n}=ie(),i=t.palette.mode==="light"?s.greenAccent[300]:s.primary[500];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Top Students by Performance"}),n&&n.length>0?n.map((o,c)=>e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"flex-start",mb:2,backgroundColor:i,p:"15px",borderRadius:"8px",sx:{boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx(ht,{src:o.profilePicture||"",alt:`${o.firstName} ${o.lastName}`,sx:{width:50,height:50,mr:2}}),e.jsxs(l,{children:[e.jsx(a,{variant:"h6",color:"white",children:`${o.firstName} ${o.lastName}`}),e.jsxs(a,{variant:"body2",color:"white",children:["Performance Score: ",o.performanceScore,"%"]})]})]},c)):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No top students available."})]})},Bn=()=>{const t=L(),s=M(t.palette.mode),{leastActiveStudents:n}=ie(),i=t.palette.mode==="light"?s.greenAccent[300]:s.primary[500];return e.jsxs(l,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",mb:"15px",children:"Least Active Students"}),n&&n.length>0?n.map((o,c)=>e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"flex-start",mb:2,backgroundColor:i,p:"15px",borderRadius:"8px",sx:{boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx(ht,{src:o.profilePicture||"",alt:`${o.firstName} ${o.lastName}`,sx:{width:50,height:50,mr:2}}),e.jsxs(l,{children:[e.jsx(a,{variant:"h6",color:"white",children:`${o.firstName} ${o.lastName}`}),e.jsxs(a,{variant:"body2",color:"white",children:["Activity Rate: ",o.activityRate,"%"]})]})]},c)):e.jsx(a,{variant:"body2",color:s.grey[300],children:"No least active students available."})]})},Yn=()=>{const t=L();M(t.palette.mode),it(t.breakpoints.down("sm")),it(t.breakpoints.between("sm","md"));const[s,n]=d.useState(!0),[i,o]=d.useState(null),{loading:c,error:r}=ie();return d.useEffect(()=>{c||n(!1),r&&o(r.message||"An error occurred while fetching data.")},[c,r]),s||c?e.jsx(Ve,{}):i?e.jsx(l,{m:"20px",children:e.jsxs(a,{variant:"h4",color:"error",children:["Error: ",i]})}):e.jsxs(l,{m:"20px",children:[e.jsx(a,{variant:"h3",fontWeight:"600",mb:"20px",children:"Teacher Dashboard"}),e.jsxs(st,{children:[e.jsxs(K,{children:[e.jsx(R,{sm:6,md:3,children:e.jsx(F,{children:e.jsx(Nn,{})})}),e.jsx(R,{sm:6,md:3,children:e.jsx(F,{children:e.jsx(In,{})})}),e.jsx(R,{sm:6,md:3,children:e.jsx(F,{children:e.jsx(zn,{})})}),e.jsx(R,{sm:6,md:3,children:e.jsx(F,{children:e.jsx($n,{})})})]}),e.jsxs(K,{children:[e.jsx(R,{md:8,children:e.jsx(F,{noFlex:!0,moreStyles:{height:"500px",overflowY:"auto"},children:e.jsx(Wn,{})})}),e.jsx(R,{md:4,children:e.jsx(F,{noFlex:!0,moreStyles:{height:"500px",overflowY:"auto"},children:e.jsx(_n,{})})})]}),e.jsxs(K,{children:[e.jsx(R,{md:6,children:e.jsx(F,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx(Vn,{})})}),e.jsx(R,{md:6,children:e.jsx(F,{noFlex:!0,moreStyles:{height:"400px",overflowY:"auto"},children:e.jsx(Bn,{})})})]})]})]})},Hn=({openAnnouncementModal:t,setModalOpen:s})=>{const n=ue(x=>x.users.user),[i,o]=d.useState({title:"",message:"",dueDate:"",targets:[{classLevel:"",subclass:""}]}),[c,r]=d.useState([]),{loading:j,callApi:u}=G(),[h,m]=d.useState(!1),[g,v]=d.useState(""),[k,w]=d.useState(!1);d.useEffect(()=>{if(!n||!n._id){v("User not authenticated. Please log in again."),m(!0);return}n.role==="teacher"&&t&&(async()=>{try{const D=await u(`${z.CLASS_LEVEL}/teacher/${n._id}`,"GET");D&&D.data?r(D.data.assignedClasses):(v("No assigned classes found."),m(!0))}catch(D){v("Failed to load assigned classes: "+D.message),m(!0)}})()},[t,n,u]);const f=x=>{const{name:D,value:p}=x.target;o(y=>({...y,[D]:p}))},C=(x,D,p)=>{const y=[...i.targets];y[x][D]=p,D==="classLevel"&&(y[x].subclass=""),o($=>({...$,targets:y}))},O=()=>{o(x=>({...x,targets:[...x.targets,{classLevel:"",subclass:""}]}))},P=x=>{o(D=>({...D,targets:D.targets.filter((p,y)=>y!==x)}))},b=async()=>{if(!n||!n._id){v("User not authenticated. Please log in again."),m(!0);return}const{title:x,message:D,dueDate:p,targets:y}=i;if(!x||!D||!p){v("Please fill all required fields (title, message, due date)."),m(!0);return}if(n.role==="teacher"){if(y.length===0||y.some(T=>!T.classLevel||!T.subclass)){v("Please select at least one class level and subclass."),m(!0);return}for(const T of y){const q=c.find(E=>E._id===T.classLevel);if(!q){v(`Invalid class level: ${T.classLevel}`),m(!0);return}if(!q.subclasses.some(E=>E.letter===T.subclass)){v(`Invalid subclass ${T.subclass} for class ${q.name}`),m(!0);return}}}const $=p.includes("T")?p:`${p}T23:59:59.000Z`,U=n.role==="teacher"?{title:x,message:D,dueDate:$,createdBy:n._id,targets:y}:{title:x,message:D,dueDate:$,createdBy:n._id},B=n.role==="teacher"?`${z.ANNOUNCEMENT}/class`:`${z.ANNOUNCEMENT}/general`;try{const T=await u(B,"POST",U);T&&T.status==="success"?(o({title:"",message:"",dueDate:"",targets:[{classLevel:"",subclass:""}]}),v(""),s(!1),w(!0),m(!0)):(v(T.message||"Failed to submit announcement. Please try again."),m(!0))}catch(T){v(T.message||"Failed to submit announcement."),m(!0)}};return!n||!n._id?e.jsx(se,{open:t,onClose:()=>s(!1),title:"Make Announcement",children:e.jsx(l,{sx:{display:"flex",justifyContent:"center",padding:2},children:e.jsx(Wt,{})})}):e.jsxs(e.Fragment,{children:[e.jsx(se,{open:t,onClose:()=>s(!1),title:"Make Announcement",onConfirm:b,children:e.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(V,{label:"Title",name:"title",value:i.title,onChange:f,fullWidth:!0,required:!0}),e.jsx(V,{label:"Message",name:"message",value:i.message,onChange:f,fullWidth:!0,multiline:!0,rows:4,required:!0}),e.jsx(V,{label:"Due Date",name:"dueDate",type:"datetime-local",value:i.dueDate,onChange:f,fullWidth:!0,InputLabelProps:{shrink:!0},required:!0}),n.role==="teacher"&&e.jsxs(e.Fragment,{children:[i.targets.map((x,D)=>{var p;return e.jsxs(l,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsxs($e,{fullWidth:!0,children:[e.jsx(We,{children:"Class Level"}),e.jsxs(_e,{name:`classLevel-${D}`,value:x.classLevel,onChange:y=>C(D,"classLevel",y.target.value),required:!0,children:[e.jsx(oe,{value:"",children:e.jsx("em",{children:"Select Class Level"})}),c.map(y=>e.jsxs(oe,{value:y._id,children:[y.section," ",y.name]},y._id))]})]}),e.jsxs($e,{fullWidth:!0,children:[e.jsx(We,{children:"Subclass"}),e.jsxs(_e,{name:`subclass-${D}`,value:x.subclass,onChange:y=>C(D,"subclass",y.target.value),required:!0,disabled:!x.classLevel,children:[e.jsx(oe,{value:"",children:e.jsx("em",{children:"Select Subclass"})}),x.classLevel&&((p=c.find(y=>y._id===x.classLevel))==null?void 0:p.subclasses.map(y=>e.jsx(oe,{value:y.letter,children:y.letter},y.letter)))]})]}),i.targets.length>1&&e.jsx(ot,{color:"error",onClick:()=>P(D),children:"Remove"})]},D)}),e.jsx(ot,{onClick:O,variant:"outlined",sx:{mt:1},children:"Add Another Class"})]})]})}),e.jsx(jt,{open:h,isLoading:j,onClose:()=>m(!1),title:"Announcement Submission",message:k?"Announcement submitted successfully!":g||"Could not submit announcement. Please try again."})]})},Gn=({openFeedbackModal:t,setModalOpen:s})=>{const[n,i]=d.useState(""),[o,c]=d.useState(""),[r,j]=d.useState(""),[u,h]=d.useState(""),{data:m,loading:g,error:v,callApi:k}=G(),[w,f]=d.useState(!1),C=async()=>{const O={name:n,role:o,date:r,comments:u};await k(z.FEEDBACKS,"POST",O),v?console.error("Error submitting feedback:",v):(f(!0),i(""),c(""),j(""),h(""))};return e.jsxs(e.Fragment,{children:[e.jsx(se,{open:t,onClose:()=>s(!1),title:"Send Feedback",onConfirm:C,children:e.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(V,{label:"Name",value:n,onChange:O=>i(O.target.value),fullWidth:!0,margin:"normal"}),e.jsxs($e,{fullWidth:!0,margin:"normal",children:[e.jsx(We,{children:"Role"}),e.jsxs(_e,{value:o,onChange:O=>c(O.target.value),children:[e.jsx(oe,{value:"Student",children:"Student"}),e.jsx(oe,{value:"Instructor",children:"Instructor"}),e.jsx(oe,{value:"Worker",children:"Worker"})]})]}),e.jsx(V,{label:"Date",type:"date",value:r,onChange:O=>j(O.target.value),fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0}}),e.jsx(V,{label:"Comments",value:u,onChange:O=>h(O.target.value),fullWidth:!0,margin:"normal",multiline:!0,rows:4})]})}),e.jsx(jt,{open:w,isLoading:g,onClose:()=>f(!1),title:"Feedback Confirmation",message:m?"Feedback submitted successfully!":"Could not submit feedback."})]})},qn=({home:t})=>{const[s,n]=d.useState(!1),[i,o]=d.useState(!1),c=L();M(c.palette.mode);const r=ue(j=>j.users.user);return console.log("user:",r),!r||!r.firstName?e.jsx(l,{children:e.jsx(a,{children:"Loading user data..."})}):e.jsxs(l,{children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(It,{home:!0,title:r.firstName,subtitle:"Welcome to your dashboard"}),e.jsxs(l,{sx:{display:"flex",gap:"10px"},children:[r.role==="admin"&&e.jsxs(l,{sx:{display:"flex",flexDirection:{xs:"column",sm:"column",md:"row"},alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(fe,{icon:e.jsx(bt,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Download Reports"}),e.jsx(fe,{icon:e.jsx(Ce,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Make announcement",onClick:()=>o(!0)})]}),r.role==="teacher"&&e.jsxs(l,{sx:{display:"flex",flexDirection:{xs:"column",sm:"column",md:"row"},alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(fe,{icon:e.jsx(Ce,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Make announcement",onClick:()=>o(!0)}),e.jsx(fe,{icon:e.jsx(Ce,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Submit Feedback",onClick:()=>n(!0)}),e.jsxs(l,{children:[e.jsx(nn,{sx:{fontSize:{xs:"1em",sm:"1.2em"}},value:r.rating,readOnly:!0,precision:.1}),e.jsxs(a,{variant:"h6",sx:{fontSize:{xs:"0.8em",sm:"1em"}},children:["Rating: ",r.rating]})]})]}),r.role==="student"&&e.jsx(l,{sx:{display:"flex",flexDirection:{xs:"column",sm:"column",md:"row"},alignItems:"center",justifyContent:"center",gap:"10px"},children:e.jsx(fe,{icon:e.jsx(Ce,{sx:{fontSize:{xs:"16px",sm:"18px",md:"20px"}}}),content:"Submit Feedback",onClick:()=>n(!0)})}),e.jsx(Hn,{openAnnouncementModal:i,setModalOpen:o}),e.jsx(Gn,{openFeedbackModal:s,setModalOpen:n})]})]}),r.role==="admin"||r.role==="superadmin"?e.jsx(Dn,{user:r}):r.role==="student"?e.jsx(Pn,{user:r}):r.role==="teacher"?e.jsx(Yn,{user:r}):null]})},Un=$t(qn),Ss=()=>e.jsx("div",{children:e.jsx(Un,{home:!0})});export{Ss as default};
