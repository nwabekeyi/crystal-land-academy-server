import{r as i,f as F,j as e,a as O}from"./index-BGLh42TJ.js";import{t as U}from"./modal-DfySOKQn.js";import{H as P}from"./Header-BlEaZ8dh.js";import{C as W}from"./accordion-CYZnIIDj.js";import{w as q}from"./dasboardPagesContainer-BZrGlab9.js";import{u as $}from"./useApi-DN8WZFPX.js";import{j as k,M as B,v as b,T as c,x as D,a1 as H,a2 as G,a3 as z}from"./TextField-IhUWfT1k.js";import{M as R}from"./MenuItem-CxDLM7qu.js";import{C as J}from"./CircularProgress-C2yr_0Gq.js";import"./IconButton-D8odhYXc.js";import"./index-1nOsHyls.js";import"./confirmationModal-CidaOsZI.js";import"./index-BZ5_ktoT.js";import"./loadingButton-C3VBQU3Q.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-DcScONqL.js";const K=()=>{const{loading:x,error:a,callApi:r}=$(),[j,o]=i.useState([]),[w,I]=i.useState([]),[l,y]=i.useState({}),h=i.useRef(!0),{loading:C,error:A,callApi:g}=$(),N=i.useCallback(async(d,p)=>d?d.name:(console.warn("No subjectId provided in getSubjectName"),"Unknown Subject"),[g,l]),T=async(d,p="")=>{try{const u=[`classLevelId=${d}`];p&&u.push(`subjectId=${p}`);const L=`${F.CURRICULUM}?${u.join("&")}`,m=await r(L,"GET");if(m&&m.status==="success"&&h.current){const S=await Promise.all(m.data.map(async s=>{var f,_,E,M;const n=((f=s.subjectId)==null?void 0:f.name)||s.subjectId;return{_id:s._id,subject:s.subjectId.name.name,subjectId:(_=s.subjectId)==null?void 0:_._id,classLevel:((E=s.classLevelId)==null?void 0:E.name)||"Unknown Class",classLevelId:(M=s.classLevelId)==null?void 0:M._id,topics:s.topics.map((v,V)=>({_id:v._id||`topic_${V}`,topic:v.topic||"Untitled Topic",description:v.description||"No description available",resources:v.resources||[],isCompleted:v.isCompleted||!1})),completionRate:s.completionRate||0}}));o(S);const t=await Promise.all([...new Set(m.data.map(s=>{var n;return((n=s.subjectId)==null?void 0:n.name)||s.subjectId}))].filter(s=>s).map(async s=>({_id:s,name:await N(s,()=>h.current)})));I(t)}return m}catch(u){throw console.error("Error fetching curricula:",u.message),console.error("Error details:",u),new Error(u.message||"Failed to fetch curricula")}};return i.useEffect(()=>()=>{h.current=!1},[]),{loading:x||C,error:a||A,curricula:j,subjects:w,fetchCurricula:T,subjectNamesCache:l}},Q=({open:x,onClose:a,topic:r})=>{const j=k(),o=U(j.palette.mode);return e.jsx(B,{open:x,onClose:a,children:e.jsxs(b,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:o.primary[400],p:4,borderRadius:1},children:[e.jsx(c,{variant:"h6",sx:{mb:2,color:o.grey[100]},children:"Topic Details"}),e.jsxs(c,{variant:"body1",sx:{mb:1,color:o.grey[100]},children:[e.jsx("strong",{children:"Topic:"})," ",(r==null?void 0:r.topic)||"Untitled Topic"]}),e.jsxs(c,{variant:"body1",sx:{mb:1,color:o.grey[100]},children:[e.jsx("strong",{children:"Description:"})," ",(r==null?void 0:r.description)||"No description available"]}),e.jsxs(c,{variant:"body1",sx:{mb:1,color:o.blueAccent[200]},children:[e.jsx("strong",{children:"Resources:"})," ",Array.isArray(r==null?void 0:r.resources)?r.resources.join(", "):"No resources available"]}),e.jsxs(c,{variant:"body1",sx:{mb:2,color:r!=null&&r.isCompleted?o.greenAccent[500]:o.redAccent[500]},children:[e.jsx("strong",{children:"Status:"})," ",r!=null&&r.isCompleted?"Completed":"Not Completed"]}),e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(D,{variant:"contained",onClick:a,sx:{bgcolor:o.blueAccent[700]},children:"Close"})})]})})},X=()=>{var m,S;const x=k(),a=U(x.palette.mode),{loading:r,error:j,curricula:o,subjects:w,fetchCurricula:I}=K(),{user:l}=O(t=>t.users),y=l==null?void 0:l.classLevelId,h=((m=l==null?void 0:l.currentClassLevel)==null?void 0:m.className)||"Unknown Class",C=((S=l==null?void 0:l.currentClassLevel)==null?void 0:S.subclass)||"",[A,g]=i.useState(!1),[N,T]=i.useState(null),[d,p]=i.useState({subjectId:""});i.useEffect(()=>{y&&I(y,d.subjectId)},[y,d.subjectId]);const u=t=>{const s=o.find(n=>n.subject===t.target.value.name);p({foundSubject:s})},L=t=>{T(t),g(!0)};return e.jsxs(b,{sx:{p:3},children:[e.jsx(P,{title:"Curriculum Overview",subtitle:`Explore the curriculum for ${h}${C?` (${C})`:""}`}),e.jsx(b,{sx:{display:"flex",mb:2},children:e.jsxs(H,{sx:{minWidth:200},children:[e.jsx(G,{children:"Subject"}),e.jsxs(z,{name:"subjectId",value:d.subjectId,onChange:u,children:[e.jsx(R,{value:"",children:"All Subjects"}),w.map(t=>e.jsx(R,{value:t._id,children:t.name||"Unknown Subject"},t._id))]})]})}),r?e.jsx(b,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(J,{color:"primary"})}):j?e.jsx(c,{variant:"body1",color:a.redAccent[500],sx:{mt:2},children:j}):o.length>0?o.map((t,s)=>e.jsxs(b,{sx:{mb:4},children:[e.jsx(c,{variant:"h2",sx:{color:a.blueAccent[200],mb:2,fontWeight:"bold"},children:t.subject}),t.topics.length>0?t.topics.map((n,f)=>e.jsx(b,{sx:{mb:1},children:e.jsx(W,{title:`${f+1}. ${n.topic}`,details:e.jsxs(b,{children:[e.jsx(c,{variant:"body1",color:a.grey[100],sx:{mb:1},children:n.description||"No description available"}),e.jsxs(c,{variant:"body1",sx:{color:a.blueAccent[200],mb:1},children:["Resources:"," ",Array.isArray(n.resources)?n.resources.join(", "):"No resources available"]}),e.jsxs(c,{variant:"body1",sx:{color:n.isCompleted?a.greenAccent[500]:a.redAccent[500],mb:1},children:["Status: ",n.isCompleted?"Completed":"Not Completed"]}),e.jsx(D,{onClick:()=>L(n),sx:{color:a.blueAccent[200]},children:"View Details"})]}),defaultExpanded:!1})},n._id||f)):e.jsxs(c,{variant:"body1",color:a.grey[100],children:["No topics available for ",t.subject,"."]})]},t._id||s)):e.jsx(c,{variant:"body1",color:a.grey[100],children:"No curriculum available for your class."}),e.jsx(Q,{open:A,onClose:()=>g(!1),topic:N})]})},je=q(X);export{je as default};
