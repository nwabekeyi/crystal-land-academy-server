var Ie=Object.defineProperty;var ke=(s,r,u)=>r in s?Ie(s,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[r]=u;var ge=(s,r,u)=>ke(s,typeof r!="symbol"?r+"":r,u);import{j as e,r as b,a as ne,e as ee,i as Ee,K as re,E as ae,R as Fe}from"./index-Cqf_02g-.js";import{u as De}from"./useApi-CG0k0pMk.js";import{H as xe}from"./Header-DzbEG90q.js";import{t as be,M as de}from"./modal-DHHk_nL3.js";import{c as ue,a as Pe,g as Me,u as _e,_ as $e,b as te,s as Be,d as Re,h as se,e as Oe,a1 as Ne,i as ze,j as Ce,v as C,T as E,P as Le,y as Q,x as Ye,Z as qe,$ as Ue,a0 as We}from"./TextField-CTuTe783.js";import{A as He,G as ie}from"./index-BL7cbZCj.js";import{T as Ve}from"./table-D-PQDQOS.js";import{u as Ge}from"./useAdminData-C_bIp0Za.js";import{u as Qe,M as Ke}from"./MenuItem-Jxhsl5nH.js";import{S as Ze,F as je}from"./FormControlLabel-DT5n7unz.js";import{A as Se}from"./confirmationModal-B6osjM9X.js";import{j as Je,k as Xe,l as et}from"./index-DjciT8UC.js";import{I as ce}from"./IconButton-BC7LALcm.js";import{w as tt}from"./dasboardPagesContainer-F3CP2AQX.js";import"./index-j3Sz-YoR.js";import"./loadingButton-CNGXwwaA.js";import"./CircularProgress-WQtbeDcs.js";import"./crystal-land-log-removebg-DVF-nlbN.js";import"./useSlot-Bq2cA_lW.js";import"./useMediaQuery-DK0lFkLQ.js";const rt=ue(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),at=ue(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),st=ue(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function nt(s){return Me("MuiCheckbox",s)}const le=Pe("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),ot=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],it=s=>{const{classes:r,indeterminate:u,color:n,size:y}=s,Y={root:["root",u&&"indeterminate",`color${se(n)}`,`size${se(y)}`]},f=Oe(Y,nt,r);return te({},r,f)},ct=Be(Ze,{shouldForwardProp:s=>Ne(s)||s==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(s,r)=>{const{ownerState:u}=s;return[r.root,u.indeterminate&&r.indeterminate,r[`size${se(u.size)}`],u.color!=="default"&&r[`color${se(u.color)}`]]}})(({theme:s,ownerState:r})=>te({color:(s.vars||s).palette.text.secondary},!r.disableRipple&&{"&:hover":{backgroundColor:s.vars?`rgba(${r.color==="default"?s.vars.palette.action.activeChannel:s.vars.palette[r.color].mainChannel} / ${s.vars.palette.action.hoverOpacity})`:ze(r.color==="default"?s.palette.action.active:s.palette[r.color].main,s.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},r.color!=="default"&&{[`&.${le.checked}, &.${le.indeterminate}`]:{color:(s.vars||s).palette[r.color].main},[`&.${le.disabled}`]:{color:(s.vars||s).palette.action.disabled}})),lt=e.jsx(at,{}),dt=e.jsx(rt,{}),ut=e.jsx(st,{}),ye=b.forwardRef(function(r,u){var n,y;const Y=_e({props:r,name:"MuiCheckbox"}),{checkedIcon:f=lt,color:m="primary",icon:I=dt,indeterminate:j=!1,indeterminateIcon:v=ut,inputProps:x,size:i="medium",className:T}=Y,R=$e(Y,ot),_=j?v:I,w=j?v:f,M=te({},Y,{color:m,indeterminate:j,size:i}),k=it(M);return e.jsx(ct,te({type:"checkbox",inputProps:te({"data-indeterminate":j},x),icon:b.cloneElement(_,{fontSize:(n=_.props.fontSize)!=null?n:i}),checkedIcon:b.cloneElement(w,{fontSize:(y=w.props.fontSize)!=null?y:i}),ownerState:M,ref:u,className:Re(k.root,T)},R,{classes:k}))}),mt=()=>{const[s,r]=b.useState(""),[u,n]=b.useState(""),[y,Y]=b.useState([]),f=ne(v=>v.users.user),{loading:m,data:I,callApi:j}=De();return b.useEffect(()=>{j(ee.COURSES,"GET")},[]),b.useEffect(()=>{if(I&&I.courses){const v=I.courses.find(x=>x.courseName===f.program);v&&(r(v.courseName),n(v.duration),Y(v.curriculum||[]))}},[I]),{courseName:s,courseDuration:u,curriculum:y,loading:m}},ht=()=>{const s=Ce(),r=be(s.palette.mode),{courseDuration:u,courseName:n,curriculum:y,loading:Y}=mt();return e.jsxs(C,{children:[e.jsx(xe,{title:n||"Primary 2",subtitle:`${u||0} months`}),Y?e.jsx(Ee,{}):y&&y.length>0?e.jsxs(C,{children:[e.jsx(E,{variant:"h2",gutterBottom:!0,children:"Curriculum"}),e.jsx(C,{sx:{width:"100%"},children:y.map((f,m)=>e.jsxs(Le,{elevation:3,sx:{backgroundColor:r.primary[400],color:r.blueAccent[500],p:3,mb:2,display:"flex",alignItems:"flex-start",gap:2,borderRadius:"12px",boxShadow:"0 3px 10px rgba(0, 0, 0, 0.1)"},children:[e.jsx(He,{sx:{bgcolor:r.primary[500],width:40,height:40,fontSize:"18px",color:"white"},children:m+1}),e.jsxs(C,{children:[e.jsxs(E,{variant:"h3",sx:{color:r.blueAccent[200]},children:[f.topic||"No topic available"," "]}),e.jsxs(E,{variant:"body1",color:"textSecondary",sx:{mb:1},children:[f.description||"No description available"," "]}),e.jsxs(E,{variant:"body1",sx:{fontStyle:"italic"},children:["Duration: ",f.duration||"Unknown"," "]}),e.jsxs(E,{variant:"h6",sx:{color:r.blueAccent[200]},children:["Resources: ",Array.isArray(f.resources)?f.resources.join(", "):"No resources available"]})]})]},f._id||m))})]}):e.jsx(E,{variant:"body1",color:"textSecondary",children:"No curriculum available."})]})},pt=()=>{const s={id:"",name:"",fromYear:"",toYear:"",isCurrent:!1},r={academicYearId:"",terms:[{name:"1st Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1},{name:"2nd Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1},{name:"3rd Term",description:"",duration:"3 months",startDate:"",endDate:"",createdBy:"",isCurrent:!1}]},[u,n]=b.useState(s),[y,Y]=b.useState(r),[f,m]=b.useState({name:"",fromYear:"",toYear:"",general:""}),[I,j]=b.useState({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]}),[v,x]=b.useState(!1),[i,T]=b.useState(!1),{loading:R,callApi:_}=De(),w=Qe(),{academicYears:M,currentAcademicYear:k,refetchAcademicYears:B,refetchCurrentYear:O}=Ge(),F=ne(a=>{var h;return(h=a.users.user)==null?void 0:h._id}),N=a=>{const{name:h,value:l,type:D,checked:d}=a.target,t=D==="checkbox"?d:l;n(o=>({...o,[h]:t})),m(o=>({...o,[h]:"",general:""}))},K=async a=>{var h,l;if(!F)return m(D=>({...D,general:"User not authenticated. Please log in."})),!1;try{T(!0),m(d=>({...d,general:""}));const D=await _(`${ee.ACADEMIC_YEARS}/${a}`,"DELETE");if(!D||D.status!=="success")throw new Error((D==null?void 0:D.message)||"Failed to delete academic year");return w(re(M.filter(d=>d._id!==a))),(k==null?void 0:k._id)===a&&w(ae(null)),await B(),await O(),!0}catch(D){const d=((l=(h=D.response)==null?void 0:h.data)==null?void 0:l.message)||D.message||"Failed to delete academic year";return m(t=>({...t,general:d})),w(m(d)),!1}finally{T(!1)}},U=(a,h,l=!1)=>{const{name:D,value:d,type:t,checked:o}=a.target,g=t==="checkbox"?o:d;Y(c=>{const S=[...c.terms];return S[h]={...S[h],[D]:g,createdBy:F},l&&g&&S.forEach((P,oe)=>{oe!==h&&(P.isCurrent=!1)}),{...c,terms:S}}),j(c=>({...c,terms:c.terms.map((S,P)=>P===h?{...S,[D]:""}:S),general:""}))},W=()=>{const{name:a,fromYear:h,toYear:l,isCurrent:D}=u,d={name:"",fromYear:"",toYear:"",general:""};if(a.trim()?/^\d{4}\/\d{4}$/.test(a.trim())||(d.name="Name must be in format YYYY/YYYY (e.g., 2024/2025)"):d.name="Academic year name is required",h.trim()||(d.fromYear="From year is required"),l.trim()||(d.toYear="To year is required"),h&&l&&new Date(h)>=new Date(l)&&(d.toYear="To year must be after from year"),h&&l){const t=new Date(h),o=new Date(l),g=365*24*60*60*1e3;o-t<g&&(d.general="Academic year must span at least one year")}if(D&&h&&l){const t=new Date,o=new Date;o.setMonth(t.getMonth()+1);const g=new Date(h),c=new Date(l);g>o&&(d.fromYear="Current academic year cannot start more than one month in the future"),c<t&&(d.toYear="Current academic year cannot end in the past")}return m(d),!d.name&&!d.fromYear&&!d.toYear&&!d.general},z=()=>{const{terms:a,academicYearId:h}=y,l={general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]};h||(l.general="Academic year ID is required"),(!a||a.length!==3||!a.every(t=>["1st Term","2nd Term","3rd Term"].includes(t.name)))&&(l.general="Exactly three terms (1st Term, 2nd Term, 3rd Term) are required"),a.filter(t=>t.isCurrent).length>1&&(l.general="Only one term can be set as current");const d=Array.from({length:10},(t,o)=>`${o+1} month${o+1>1?"s":""}`);a.forEach((t,o)=>{if(t.description.trim()||(l.terms[o].description="Description is required"),(!t.duration||!d.includes(t.duration))&&(l.terms[o].duration="Duration must be between 1 and 10 months"),t.startDate||(l.terms[o].startDate="Start date is required"),t.endDate||(l.terms[o].endDate="End date is required"),t.startDate&&t.endDate&&new Date(t.startDate)>=new Date(t.endDate)&&(l.terms[o].endDate="End date must be after start date"),t.isCurrent&&t.startDate&&t.endDate){const g=new Date,c=new Date;c.setMonth(g.getMonth()+1);const S=new Date(t.startDate),P=new Date(t.endDate);S>c&&(l.terms[o].startDate=`Term ${t.name} cannot be current: start date is more than one month in the future`),P<g&&(l.terms[o].endDate=`Term ${t.name} cannot be current: end date is in the past`)}});for(let t=0;t<a.length;t++)for(let o=t+1;o<a.length;o++)a[t].startDate&&a[t].endDate&&a[o].startDate&&a[o].endDate&&new Date(a[t].startDate)<=new Date(a[o].endDate)&&new Date(a[o].startDate)<=new Date(a[t].endDate)&&(l.terms[o].startDate=`Terms ${a[t].name} and ${a[o].name} have overlapping dates`);return j(l),!l.general&&l.terms.every(t=>!t.description&&!t.duration&&!t.startDate&&!t.endDate)},H=async()=>{var t,o;if(!W())return!1;if(!F)return m(g=>({...g,general:"User not authenticated. Please log in."})),!1;const{name:a,fromYear:h,toYear:l,isCurrent:D}=u,d={name:a,fromYear:new Date(h).toISOString(),toYear:new Date(l).toISOString(),isCurrent:D,createdBy:F,academicTerms:[],students:[],teachers:[]};try{T(!0),m(S=>({...S,name:"",fromYear:"",toYear:"",general:""}));const g=await _(ee.ACADEMIC_YEARS,"POST",d);if(!g||g.status!=="success")throw new Error((g==null?void 0:g.message)||"Failed to create academic year");const c=g.data;return w(re([...M,c])),D&&w(ae(c)),await B(),await O(),n(s),x(!1),!0}catch(g){const c=((o=(t=g.response)==null?void 0:t.data)==null?void 0:o.message)||g.message||"Failed to create academic year";return m(S=>({...S,general:c})),w(m(c)),!1}finally{T(!1)}},L=async()=>{var D,d;if(!z())return!1;if(!F)return j(t=>({...t,general:"User not authenticated. Please log in."})),!1;const{terms:a,academicYearId:h}=y,l={academicYearId:h,terms:a.map(t=>({...t,startDate:t.startDate?new Date(t.startDate).toISOString():void 0,endDate:t.endDate?new Date(t.endDate).toISOString():void 0,createdBy:F}))};try{T(!0),j(c=>({...c,general:"",terms:c.terms.map(()=>({description:"",duration:"",startDate:"",endDate:""}))}));const t=await _(ee.ACADEMIC_TERM,"POST",l);if(!t||t.status!=="success")throw new Error((t==null?void 0:t.message)||"Failed to create academic term");const o=t.data,g=M.map(c=>c._id===h?{...c,academicTerms:[...c.academicTerms||[],o._id]}:c);return w(re(g)),await B(),Y(r),!0}catch(t){const o=((d=(D=t.response)==null?void 0:D.data)==null?void 0:d.message)||t.message||"Failed to create academic term";return j(g=>({...g,general:o})),w(m(o)),!1}finally{T(!1)}},V=async()=>{var o,g;if(!W())return!1;const{id:a,name:h,fromYear:l,toYear:D,isCurrent:d}=u;if(!F)return m(c=>({...c,general:"User not authenticated. Please log in."})),!1;const t={name:h,fromYear:new Date(l).toISOString(),toYear:new Date(D).toISOString(),isCurrent:d,createdBy:F};try{T(!0),m(P=>({...P,name:"",fromYear:"",toYear:"",general:""}));const c=await _(`${ee.ACADEMIC_YEARS}/${a}`,"PATCH",t);if(!c||c.status!=="success")throw new Error((c==null?void 0:c.message)||"Failed to update academic year");const S=c.data;return w(re(M.map(P=>P._id===a?S:P))),d?w(ae(S)):(k==null?void 0:k._id)===a&&!d&&w(ae(null)),await B(),await O(),n(s),x(!1),!0}catch(c){const S=((g=(o=c.response)==null?void 0:o.data)==null?void 0:g.message)||c.message||"Failed to update academic year";return m(P=>({...P,general:S})),w(m(S)),!1}finally{T(!1)}};return{setFormValues:n,formValues:u,handleChange:N,handleTermChange:U,handleSubmit:async()=>v?await V():await H(),handleCreateAcademicTerm:L,startEdit:a=>{n({id:a._id,name:a.name,fromYear:a.fromYear.split("T")[0],toYear:a.toYear.split("T")[0],isCurrent:a.isCurrent}),x(!0),m({name:"",fromYear:"",toYear:"",general:""})},startAddTerm:a=>{Y({...r,academicYearId:a,terms:r.terms.map(h=>({...h,createdBy:F}))}),j({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]})},editMode:v,setEditMode:x,academicYears:M,currentAcademicYear:k,loading:R,error:f,termError:I,isSubmitting:i,resetForm:()=>{n(s),m({name:"",fromYear:"",toYear:"",general:""}),x(!1)},resetTermForm:()=>{Y(r),j({general:"",terms:[{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""},{description:"",duration:"",startDate:"",endDate:""}]})},termFormValues:y,handleDeleteAcademicYear:K}},ft=({open:s,onClose:r,handleSubmit:u,error:n={},editMode:y=!1,userId:Y,formValues:f,handleChange:m,isSubmitting:I=!1})=>{const j=new Date().toISOString().split("T")[0],v=()=>{if(!f.fromYear)return j;const i=new Date(f.fromYear);return i.setFullYear(i.getFullYear()+1),i.toISOString().split("T")[0]},x=async i=>{i.preventDefault(),console.log("Form submission attempted with values:",f);try{await u(f)?(console.log("Submission successful"),r()):console.log("Submission failed, handleSubmit returned false")}catch(T){console.error("Submission error:",T)}};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            opacity: 1;
          }
          input[type="date"] {
            color-scheme: light;
          }
        `}),e.jsx(de,{open:s,onClose:r,title:y?"Edit Academic Year":"Add Academic Year",noConfirm:!0,children:e.jsxs(C,{component:"form",onSubmit:x,children:[e.jsx(C,{mb:2,children:e.jsx(Q,{label:"Academic Year Name (e.g., 2024/2025)",name:"name",value:f.name||"",onChange:m,fullWidth:!0,required:!0,error:!!n.name,helperText:n.name||"Format: YYYY/YYYY (e.g., 2024/2025)"})}),e.jsx(C,{mb:2,children:e.jsx(Q,{label:"From Year",name:"fromYear",type:"date",value:f.fromYear||"",onChange:m,fullWidth:!0,required:!0,error:!!n.fromYear,helperText:n.fromYear,InputLabelProps:{shrink:!0},inputProps:{min:j}})}),e.jsx(C,{mb:2,children:e.jsx(Q,{label:"To Year",name:"toYear",type:"date",value:f.toYear||"",onChange:m,fullWidth:!0,required:!0,error:!!n.toYear,helperText:n.toYear,InputLabelProps:{shrink:!0},inputProps:{min:v()}})}),e.jsx(C,{mb:2,children:e.jsx(je,{control:e.jsx(ye,{checked:f.isCurrent||!1,onChange:m,name:"isCurrent",color:"primary"}),label:"Set as Current Academic Year"})}),n.general&&e.jsx(E,{variant:"caption",color:"error",mb:2,children:n.general}),e.jsx(Ye,{type:"submit",variant:"contained",color:"primary",disabled:I,fullWidth:!0,children:I?"Submitting...":y?"Update Academic Year":"Submit"})]})})]})},gt=({open:s,onClose:r,handleSubmit:u,error:n={},userId:y,formValues:Y,handleChange:f,isSubmitting:m=!1})=>{const I=new Date().toISOString().split("T")[0],j=async x=>{x.preventDefault();try{await u()&&r()}catch(i){console.error("Submission error:",i)}},v=Array.from({length:10},(x,i)=>`${i+1} month${i+1>1?"s":""}`);return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
            opacity: 1;
          }
          input[type="date"] {
            color-scheme: light;
          }
        `}),e.jsx(de,{open:s,onClose:r,title:"Add Academic Term",noConfirm:!0,children:e.jsxs(C,{component:"form",onSubmit:j,children:[Y.terms.map((x,i)=>{var T,R,_,w,M,k,B,O,F,N,K,U,W,z,H,L,V,q,Z,G;return e.jsxs(C,{mb:3,sx:{border:"1px solid #ccc",p:2,borderRadius:1},children:[e.jsx(E,{variant:"h6",children:x.name}),e.jsx(C,{mb:2,children:e.jsx(Q,{label:"Term Name",name:"name",value:x.name||"",onChange:A=>f(A,i),fullWidth:!0,required:!0,disabled:!0,error:!!((R=(T=n.terms)==null?void 0:T[i])!=null&&R.name),helperText:(w=(_=n.terms)==null?void 0:_[i])==null?void 0:w.name})}),e.jsx(C,{mb:2,children:e.jsx(Q,{label:"Description",name:"description",value:x.description||"",onChange:A=>f(A,i),fullWidth:!0,required:!0,error:!!((k=(M=n.terms)==null?void 0:M[i])!=null&&k.description),helperText:(O=(B=n.terms)==null?void 0:B[i])==null?void 0:O.description})}),e.jsx(C,{mb:2,children:e.jsxs(qe,{fullWidth:!0,required:!0,error:!!((N=(F=n.terms)==null?void 0:F[i])!=null&&N.duration),children:[e.jsx(Ue,{id:`duration-label-${i}`,children:"Duration"}),e.jsx(We,{labelId:`duration-label-${i}`,name:"duration",value:x.duration||"3 months",onChange:A=>f(A,i),label:"Duration",children:v.map(A=>e.jsx(Ke,{value:A,children:A},A))}),((U=(K=n.terms)==null?void 0:K[i])==null?void 0:U.duration)&&e.jsx(E,{variant:"caption",color:"error",children:n.terms[i].duration})]})}),e.jsx(C,{mb:2,children:e.jsx(Q,{label:"Start Date",name:"startDate",type:"date",value:x.startDate||"",onChange:A=>f(A,i),fullWidth:!0,required:!0,error:!!((z=(W=n.terms)==null?void 0:W[i])!=null&&z.startDate),helperText:(L=(H=n.terms)==null?void 0:H[i])==null?void 0:L.startDate,InputLabelProps:{shrink:!0},inputProps:{min:I}})}),e.jsx(C,{mb:2,children:e.jsx(Q,{label:"End Date",name:"endDate",type:"date",value:x.endDate||"",onChange:A=>f(A,i),fullWidth:!0,required:!0,error:!!((q=(V=n.terms)==null?void 0:V[i])!=null&&q.endDate),helperText:(G=(Z=n.terms)==null?void 0:Z[i])==null?void 0:G.endDate,InputLabelProps:{shrink:!0},inputProps:{min:x.startDate||I}})}),e.jsx(C,{mb:2,children:e.jsx(je,{control:e.jsx(ye,{checked:x.isCurrent||!1,onChange:A=>f(A,i,!0),name:"isCurrent",color:"primary"}),label:"Set as Current Term"})})]},x.name)}),n.general&&e.jsx(E,{variant:"caption",color:"error",mb:2,children:n.general}),e.jsx(Ye,{type:"submit",variant:"contained",color:"primary",disabled:m,fullWidth:!0,children:m?"Submitting...":"Submit"})]})})]})};class Dt extends Fe.Component{constructor(){super(...arguments);ge(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(u){return{hasError:!0,error:u}}componentDidCatch(u,n){console.error("Error caught by boundary:",u,n)}render(){var u;return this.state.hasError?e.jsxs(C,{sx:{p:3,textAlign:"center"},children:[e.jsx(E,{variant:"h5",color:"error",children:"Something went wrong."}),e.jsx(E,{variant:"body1",mt:2,children:((u=this.state.error)==null?void 0:u.message)||"An unexpected error occurred."}),e.jsx(Se,{content:"Reload",onClick:()=>window.location.reload(),sx:{mt:2}})]}):this.props.children}}const xt=()=>{var he,pe,fe;const s=Ce(),r=be(s.palette.mode),{academicYears:u,currentAcademicYear:n,loading:y,error:Y,termError:f,handleSubmit:m,handleCreateAcademicTerm:I,handleDeleteAcademicYear:j,startEdit:v,startAddTerm:x,editMode:i,setEditMode:T,formValues:R,termFormValues:_,handleChange:w,handleTermChange:M,isSubmitting:k,resetForm:B,resetTermForm:O}=pt(),[F,N]=b.useState(!1),[K,U]=b.useState(!1),[W,z]=b.useState(!1),[H,L]=b.useState(null),V=ne(p=>{var $;return($=p.users.user)==null?void 0:$._id})||"",[q,Z]=b.useState("name"),[G,A]=b.useState("asc"),[me,a]=b.useState(0),[h,l]=b.useState(5),[D,d]=b.useState(""),t=[{id:"sn",label:"S/N"},{id:"name",label:"Name"},{id:"fromYear",label:"From Year"},{id:"toYear",label:"To Year"},{id:"isCurrent",label:"Current"},{id:"studentCount",label:"Students"},{id:"teacherCount",label:"Teachers"},{id:"actions",label:"Actions"}],o=u.map((p,$)=>{var J,X;return{sn:$+1,id:p._id,name:p.name,fromYear:new Date(p.fromYear).toLocaleDateString(),toYear:new Date(p.toYear).toLocaleDateString(),isCurrent:p.isCurrent?"Yes":"No",studentCount:((J=p.students)==null?void 0:J.length)||0,teacherCount:((X=p.teachers)==null?void 0:X.length)||0,actions:e.jsxs(C,{children:[e.jsx(ce,{onClick:()=>{console.log("EditIcon clicked for academicYearId:",p._id),g(p)},children:e.jsx(Je,{})}),e.jsx(ce,{onClick:()=>{console.log("AddCircleIcon clicked for academicYearId:",p._id),c(p._id)},children:e.jsx(Xe,{})}),e.jsx(ce,{onClick:()=>{console.log("DeleteIcon clicked for academicYearId:",p._id),S(p._id)},children:e.jsx(et,{})})]})}}),g=p=>{console.log("handleEdit called with year:",p._id),v(p),N(!0)},c=p=>{console.log("handleAddTerm called with academicYearId:",p);try{x(p),U(!0)}catch($){console.error("Error in handleAddTerm:",$)}},S=p=>{L(p),z(!0)},P=async()=>{H&&await j(H)&&(z(!1),L(null))},oe=()=>{z(!1),L(null)},we=p=>{const $=q===p&&G==="asc";Z(p),A($?"desc":"asc")},Te=(p,$)=>{a($)},ve=p=>{l(parseInt(p.target.value,10)),a(0)},Ae=[...o.filter(p=>p.name.toLowerCase().includes(D.toLowerCase()))].sort((p,$)=>{const J=p[q],X=$[q];return G==="asc"?J>X?1:-1:J<X?1:-1});return e.jsx(Dt,{children:e.jsxs(ie,{container:!0,children:[e.jsx(ie,{item:!0,xs:12,children:e.jsx(xe,{title:"Academics Management",subtitle:"Manage Academic Sessions"})}),e.jsx(ie,{item:!0,xs:12,children:y?e.jsx(C,{children:"Loading..."}):Y.general?e.jsx(C,{sx:{color:"red"},children:Y.general}):e.jsxs(e.Fragment,{children:[e.jsxs(C,{sx:{mb:3,p:2,backgroundColor:r.primary[400],borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(C,{children:[e.jsx(E,{variant:"h5",color:r.grey[100],children:"Current Academic Year"}),n?e.jsxs(E,{variant:"body1",color:r.grey[100],children:[n.name," (",new Date(n.fromYear).toLocaleDateString()," -"," ",new Date(n.toYear).toLocaleDateString(),") |"," ",((he=n.students)==null?void 0:he.length)||0," Students,"," ",((pe=n.teachers)==null?void 0:pe.length)||0," Teachers,"," ",((fe=n.academicTerms)==null?void 0:fe.length)||0," Terms"]}):e.jsx(E,{variant:"body1",color:r.redAccent[500],children:"No current academic year set."})]}),e.jsx(Se,{onClick:()=>{N(!0),T(!1),B()},content:"Add Academic Year"})]}),e.jsx(ft,{open:F,onClose:()=>{N(!1),T(!1),B()},handleSubmit:m,error:Y,editMode:i,userId:V,formValues:R,handleChange:w,isSubmitting:k}),e.jsx(gt,{open:K,onClose:()=>{U(!1),O()},handleSubmit:I,error:f,userId:V,formValues:_,handleChange:M,isSubmitting:k}),e.jsx(de,{open:W,onClose:oe,title:"Confirm Deletion",noConfirm:!1,confirmText:"Delete",onConfirm:P,cancelText:"Cancel",children:e.jsx(E,{children:"Are you sure you want to delete this academic year? This action cannot be undone."})}),e.jsx(Ve,{columns:t,tableHeader:"Academic Years",data:Ae,sortBy:q,sortDirection:G,onSortChange:we,page:me,rowsPerPage:h,onPageChange:Te,onRowsPerPageChange:ve,hiddenColumnsSmallScreen:["fromYear","toYear","studentCount","teacherCount","academicTermCount","actions"],hiddenColumnsTabScreen:["studentCount","teacherCount","academicTermCount"]})]})})]})})},bt=()=>{const s=ne(r=>r.users.user.role);return console.log(s),e.jsx("div",{children:s==="teacher"?e.jsx(ht,{}):e.jsx(xt,{})})},Lt=tt(bt);export{Lt as default};
