import{r,j as e,e as qe,a as Le,N as Ne,f as se,i as $e}from"./index-BgVW12L4.js";import{M as Q}from"./modal-BA-eVLt_.js";import{u as ne}from"./useApi-TIUFMcqH.js";import{C as Be}from"./accordion-D5e2Uz4A.js";import{H as re}from"./Header-CogA_8fZ.js";import{g as X,a as K,u as ce,_ as Z,az as Pe,aA as Oe,b as M,s as G,d as J,e as ee,c as ue,a4 as de,aa as Ge,h as Y,i as Fe,af as ze,o as Ae,K as _e,v as g,T as l,x as V}from"./TextField-NDbbILhh.js";import{D as De,G as W}from"./index-CjZWgTm8.js";import{S as Ue,F as Qe}from"./FormControlLabel-DWh9kxKY.js";import"./IconButton-4sz3Qd6x.js";import"./useSlot-DfBjlVf_.js";import"./confirmationModal-CMKhpNuH.js";import"./CircularProgress-ELwt6FEm.js";import"./MenuItem-B4LKlkvK.js";import"./index-D41-9XSs.js";import"./loadingButton-DGhAAS35.js";import"./crystal-land-log-removebg-DVF-nlbN.js";function Ve(t){return X("MuiFormGroup",t)}K("MuiFormGroup",["root","row","error"]);const We=["className","row"],Ye=t=>{const{classes:o,row:s,error:n}=t;return ee({root:["root",s&&"row",n&&"error"]},Ve,o)},He=G("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.root,s.row&&o.row]}})(({ownerState:t})=>M({display:"flex",flexDirection:"column",flexWrap:"wrap"},t.row&&{flexDirection:"row"})),Xe=r.forwardRef(function(o,s){const n=ce({props:o,name:"MuiFormGroup"}),{className:i,row:u=!1}=n,C=Z(n,We),d=Pe(),a=Oe({props:n,muiFormControl:d,states:["error"]}),v=M({},n,{row:u,error:a.error}),b=Ye(v);return e.jsx(He,M({className:J(b.root,i),ownerState:v,ref:s},C))}),Ke=ue(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),Ze=ue(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),Je=G("span",{name:"MuiRadioButtonIcon",shouldForwardProp:de})({position:"relative",display:"flex"}),eo=G(Ke,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),oo=G(Ze,{name:"MuiRadioButtonIcon"})(({theme:t,ownerState:o})=>M({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest})},o.checked&&{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}));function me(t){const{checked:o=!1,classes:s={},fontSize:n}=t,i=M({},t,{checked:o});return e.jsxs(Je,{className:s.root,ownerState:i,children:[e.jsx(eo,{fontSize:n,className:s.background,ownerState:i}),e.jsx(oo,{fontSize:n,className:s.dot,ownerState:i})]})}const xe=r.createContext(void 0);function to(){return r.useContext(xe)}function so(t){return X("MuiRadio",t)}const ae=K("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),no=["checked","checkedIcon","color","icon","name","onChange","size","className"],ro=t=>{const{classes:o,color:s,size:n}=t,i={root:["root",`color${Y(s)}`,n!=="medium"&&`size${Y(n)}`]};return M({},o,ee(i,so,o))},ao=G(Ue,{shouldForwardProp:t=>de(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.root,s.size!=="medium"&&o[`size${Y(s.size)}`],o[`color${Y(s.color)}`]]}})(({theme:t,ownerState:o})=>M({color:(t.vars||t).palette.text.secondary},!o.disableRipple&&{"&:hover":{backgroundColor:t.vars?`rgba(${o.color==="default"?t.vars.palette.action.activeChannel:t.vars.palette[o.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:Fe(o.color==="default"?t.palette.action.active:t.palette[o.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},o.color!=="default"&&{[`&.${ae.checked}`]:{color:(t.vars||t).palette[o.color].main}},{[`&.${ae.disabled}`]:{color:(t.vars||t).palette.action.disabled}}));function io(t,o){return typeof o=="object"&&o!==null?t===o:String(t)===String(o)}const ie=e.jsx(me,{checked:!0}),le=e.jsx(me,{}),lo=r.forwardRef(function(o,s){var n,i;const u=ce({props:o,name:"MuiRadio"}),{checked:C,checkedIcon:d=ie,color:a="primary",icon:v=le,name:b,onChange:S,size:R="medium",className:w}=u,y=Z(u,no),j=M({},u,{color:a,size:R}),E=ro(j),f=to();let m=C;const L=Ge(S,f&&f.onChange);let I=b;return f&&(typeof m>"u"&&(m=io(f.value,u.value)),typeof I>"u"&&(I=f.name)),e.jsx(ao,M({type:"radio",icon:r.cloneElement(v,{fontSize:(n=le.props.fontSize)!=null?n:R}),checkedIcon:r.cloneElement(d,{fontSize:(i=ie.props.fontSize)!=null?i:R}),ownerState:j,classes:E,name:I,checked:m,onChange:L,ref:s,className:J(E.root,w)},y))});function co(t){return X("MuiRadioGroup",t)}K("MuiRadioGroup",["root","row","error"]);const uo=["actions","children","className","defaultValue","name","onChange","value"],mo=t=>{const{classes:o,row:s,error:n}=t;return ee({root:["root",s&&"row",n&&"error"]},co,o)},xo=r.forwardRef(function(o,s){const{actions:n,children:i,className:u,defaultValue:C,name:d,onChange:a,value:v}=o,b=Z(o,uo),S=r.useRef(null),R=mo(o),[w,y]=ze({controlled:v,default:C,name:"RadioGroup"});r.useImperativeHandle(n,()=>({focus:()=>{let m=S.current.querySelector("input:not(:disabled):checked");m||(m=S.current.querySelector("input:not(:disabled)")),m&&m.focus()}}),[]);const j=Ae(s,S),E=_e(d),f=r.useMemo(()=>({name:E,onChange(m){y(m.target.value),a&&a(m,m.target.value)},value:w}),[E,a,y,w]);return e.jsx(xe.Provider,{value:f,children:e.jsx(Xe,M({role:"radiogroup",ref:j,className:J(R.root,u)},b,{children:i}))})}),fo=(t,o,s)=>{const[n,i]=r.useState(0);return r.useEffect(()=>{if(!s||t===0)return;if(n<=0){o();return}const d=setInterval(()=>{i(a=>a-1)},1e3);return()=>clearInterval(d)},[n,o,s,t]),{timeLeft:n,formatTime:()=>{const d=Math.floor(n/60),a=n%60;return`${d.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},resetTimer:d=>{i(d*60)}}},po=()=>{const t=qe(),{classLevelId:o,currentClassLevel:s,_id:n}=Le(c=>c.users.user||{}),i=(s==null?void 0:s.subclass)||null,u=r.useContext(Ne).navigator,[C,d]=r.useState([]),[a,v]=r.useState(null),[b,S]=r.useState(0),[R,w]=r.useState({}),[y,j]=r.useState(!1),[E,f]=r.useState(!1),[m,L]=r.useState(!1),[I,N]=r.useState(!1),[p,$]=r.useState(!1),[T,k]=r.useState(null),[F,h]=r.useState(null),[x,fe]=r.useState(null),{data:P,loading:pe,error:z,callApi:oe}=ne(),{data:O,loading:he,error:A,callApi:be}=ne();r.useEffect(()=>{if(!p)return;const c=H=>{H.preventDefault(),H.returnValue="",D()},B=()=>{document.visibilityState==="hidden"&&D()},q=()=>{N(!0),window.history.pushState(null,null,window.location.pathname)},ke=u.push;return u.push=(...H)=>{N(!0)},window.addEventListener("beforeunload",c),document.addEventListener("visibilitychange",B),window.addEventListener("popstate",q),()=>{window.removeEventListener("beforeunload",c),document.removeEventListener("visibilitychange",B),window.removeEventListener("popstate",q),u.push=ke}},[p,u]),r.useEffect(()=>{if(o&&i){const c=`${se.STUDENT_EXAM}/questions?classLevelId=${o}&subclassLetter=${i}`;oe(c,"GET")}else d([]),U("Missing class level ID or subclass letter")},[o,i,oe]),r.useEffect(()=>{var c;(c=P==null?void 0:P.data)!=null&&c.subjects&&d(P.data.subjects||[]),z&&U(z)},[P,z]),r.useEffect(()=>{(O==null?void 0:O.status)==="success"&&(h(O.data.score),L(!0),t("/dashboard/CBTExams")),A&&(U(A.message||"Failed to submit exam result"),t("/dashboard/CBTExams"))},[O,A,t]);const _=()=>{v(null),$(!1),S(0),w({}),h(null),k(null),j(!1),f(!1),L(!1),N(!1),te(0)},ge=c=>{k(c),j(!0)},Se=()=>{k(null),j(!1)},ve=()=>{T&&(_(),v(T),$(!0),S(0),w({[T.examId]:{}}),te(T.duration),j(!1),k(null))},{timeLeft:je,formatTime:Ce,resetTimer:te}=fo((a==null?void 0:a.duration)||0,()=>{a&&p&&D()},p),Re=(c,B)=>{!a||!p||w(q=>({...q,[a.examId]:{...q[a.examId],[c]:B}}))},we=()=>{a&&p&&b<a.questions.length-1&&S(b+1)},Me=()=>{p&&b>0&&S(b-1)},D=()=>{if(!a||!p||!n)return;$(!1),f(!1),_();const c=Object.entries(R[a.examId]||{}).map(([B,q])=>({questionId:B,selectedOption:q}));if(c.length===0){U("No answers provided");return}be(se.EXAM_RESULTS,"POST",{examId:a.examId,answeredQuestions:c})},Ee=()=>{_(),t("/dashboard/CBTExams")},ye=()=>{p&&f(!0)},Ie=()=>{f(!1)},Te=()=>{N(!1)},U=c=>{d([]),_(),fe(c)};return{subjects:C,selectedExam:a,currentQuestionIndex:b,examAnswers:R,loading:pe||he,error:x||z||A,isStartModalOpen:y,isSubmitModalOpen:E,isScoreModalOpen:m,isLeaveModalOpen:I,examScore:F,timeLeft:je,formatTime:Ce,openStartModal:ge,closeStartModal:Se,startExam:ve,handleOptionSelect:Re,handleNext:we,handlePrevious:Me,openSubmitModal:ye,closeSubmitModal:Ie,handleSubmit:D,pendingExam:T,closeScoreModal:Ee,isExamStarted:p,handleLeaveModalClose:Te}},Lo=()=>{var k,F;const{subjects:t,selectedExam:o,currentQuestionIndex:s,examAnswers:n,loading:i,error:u,isStartModalOpen:C,isSubmitModalOpen:d,isScoreModalOpen:a,isLeaveModalOpen:v,examScore:b,formatTime:S,openStartModal:R,closeStartModal:w,startExam:y,handleOptionSelect:j,handleNext:E,handlePrevious:f,openSubmitModal:m,closeSubmitModal:L,closeScoreModal:I,handleSubmit:N,pendingExam:p,handleLeaveModalClose:$}=po();if(i)return e.jsx($e,{});if(u)return e.jsxs(g,{children:[e.jsx(re,{title:"TESTS & EXAMS",subtitle:"Your approved Tests and Exams"}),e.jsx(l,{color:"error",sx:{mt:4,textAlign:"center"},children:u})]});const T=((k=o==null?void 0:o.questions)==null?void 0:k.reduce((h,x)=>h+(x.score||0),0))??0;return e.jsxs(g,{component:"main",sx:{minHeight:"100vh",p:{xs:2,md:4},bgcolor:"#0f1720",color:"#fff"},children:[e.jsx(re,{title:"TESTS & EXAMS",subtitle:"Your approved Tests and Exams"}),e.jsxs(g,{mb:"20px",children:[o?e.jsxs(g,{children:[e.jsxs(g,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",gap:2},children:[e.jsxs(g,{children:[e.jsx(l,{variant:"h5",sx:{fontWeight:700,color:"#fff"},children:o.examName}),e.jsxs(l,{sx:{color:"#94a3b8"},children:[o.examType," â€¢ ",o.questions.length," question",o.questions.length!==1?"s":""]})]}),e.jsxs(g,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsxs(g,{sx:{px:2,py:1,borderRadius:2,bgcolor:"#0b1220",border:"1px solid rgba(255,255,255,0.06)"},children:[e.jsx(l,{variant:"subtitle1",sx:{fontWeight:600},children:"Time Left"}),e.jsx(l,{variant:"h6",sx:{fontWeight:700},children:S()})]}),e.jsxs(g,{sx:{textAlign:"right"},children:[e.jsxs(l,{variant:"body2",sx:{color:"#94a3b8"},children:["Question ",s+1," of ",o.questions.length]}),e.jsxs(l,{variant:"body2",sx:{color:"#94a3b8"},children:["Total Points: ",T]})]})]})]}),e.jsx(De,{sx:{borderColor:"rgba(255,255,255,0.04)",mb:3}}),o.questions.length>0&&e.jsxs(g,{sx:{p:{xs:2,md:3},borderRadius:2,bgcolor:"#0f1724",boxShadow:"0 6px 20px rgba(2,6,23,0.6)",border:"1px solid rgba(255,255,255,0.03)"},children:[e.jsx(l,{variant:"subtitle2",sx:{color:"#94a3b8",mb:1},children:o.questions[s].sn?`#${o.questions[s].sn}`:`Q${s+1}`}),e.jsx(l,{variant:"h6",sx:{mb:2,fontWeight:700,color:"#fff"},children:o.questions[s].question}),e.jsxs(l,{variant:"body2",sx:{color:"#94a3b8",mb:2},children:["(",o.questions[s].score," points)"]}),e.jsx(xo,{"aria-label":`question-${o.questions[s]._id}`,name:`question-${o.questions[s]._id}`,value:((F=n[o.examId])==null?void 0:F[o.questions[s]._id])||"",onChange:h=>j(o.questions[s]._id,h.target.value),children:["optionA","optionB","optionC","optionD"].map(h=>{const x=o.questions[s][h];return x?e.jsx(Qe,{value:h,control:e.jsx(lo,{sx:{color:"rgba(255,255,255,0.7)","&.Mui-checked":{color:"#60a5fa"}}}),label:e.jsx(l,{sx:{color:"#e6eef8"},children:x}),sx:{my:1}},h):null})})]}),e.jsxs(W,{container:!0,spacing:2,sx:{mt:3},children:[e.jsx(W,{item:!0,children:e.jsx(V,{variant:"outlined",onClick:f,disabled:s===0,sx:{color:"#fff",borderColor:"rgba(255,255,255,0.12)"},children:"Previous"})}),e.jsx(W,{item:!0,children:s<o.questions.length-1?e.jsx(V,{variant:"contained",color:"primary",onClick:E,children:"Next"}):e.jsx(V,{variant:"contained",color:"success",onClick:m,children:"Submit Exam"})}),e.jsx(W,{item:!0,xs:!0,children:e.jsx(l,{sx:{color:"#94a3b8",mt:1},children:"The exam will auto-submit if you switch tabs or close the browser."})})]}),e.jsx(Q,{open:d,onClose:L,onConfirm:N,title:"Submit Exam",confirmText:"Submit",showCancel:!0,cancelText:"Cancel",children:e.jsx(l,{children:"Are you sure you want to submit? This cannot be undone."})})]}):e.jsx(e.Fragment,{children:t.length===0?e.jsx(l,{sx:{mt:4,textAlign:"center",color:"#cbd5e1"},children:"No exams available for your class."}):t.map(h=>e.jsx(Be,{title:h.subjectName,details:e.jsx(g,{children:h.exams.map(x=>e.jsxs(g,{sx:{mb:2,p:2,borderRadius:2,bgcolor:"#071426",border:"1px solid rgba(255,255,255,0.04)"},children:[e.jsxs(l,{variant:"h6",sx:{color:"#fff"},children:[x.examName," ",e.jsxs(l,{component:"span",sx:{color:"#94a3b8"},children:["(",x.examType,")"]})]}),e.jsxs(l,{sx:{color:"#93c5fd",mt:.5},children:["Date: ",new Date(x.examDate).toLocaleDateString()]}),e.jsxs(l,{sx:{color:"#94a3b8"},children:["Time: ",x.examTime," â€¢ Duration: ",x.duration," min â€¢ Questions: ",x.questions.length]}),e.jsx(g,{sx:{mt:1},children:e.jsx(V,{variant:"contained",color:"primary",onClick:()=>R(x),children:"Start Exam"})})]},x.examId))})},h.subjectId))}),e.jsx(Q,{open:C,onClose:w,onConfirm:y,title:"Start Exam",confirmText:"Start",showCancel:!0,cancelText:"Cancel",children:e.jsxs(l,{children:["Are you sure you want to start this exam? You will have ",(p==null?void 0:p.duration)??"the specified"," minutes to complete it."]})}),e.jsxs(Q,{open:a,onClose:I,onConfirm:I,title:"Exam Results",confirmText:"OK",showCancel:!1,children:[e.jsx(l,{sx:{mb:1},children:"You have completed the exam."}),e.jsxs(l,{sx:{fontWeight:700,fontSize:20},children:["Score: ",b??0," / ",T]})]}),e.jsx(Q,{open:v,onClose:$,onConfirm:$,title:"Cannot Leave Exam",confirmText:"OK",showCancel:!1,children:e.jsx(l,{children:"You cannot leave this page. Please stay to complete the exam."})})]})]})};export{Lo as default};
